"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[8558],{84365:(U,S,s)=>{s.d(S,{r:()=>T});var e=s(45007),p=s(18505),r=s(70262),n=s(94650),h=s(20388),C=s(36895),f=s(80125),m=s(59241),P=s(34420),A=s(19277),y=s(38198),x=s(46451),V=s(44469);function I(a,g){if(1&a&&n._UZ(0,"ed-eleve-notes-template",9),2&a){const c=n.oxw(2);n.Q6J("idEleve",c.idEleve)("idClasse",c.idClasse)("isModeConseil",!1)("isConsultationEnSaisie",!0)("paramNoteEtab",c.paramNoteEtab)("currentPeriode",c.currentPeriode)("isInModal",!0)("typeEntity",c.typeEntity)}}function F(a,g){1&a&&(n.TgZ(0,"div",10)(1,"h3"),n._uU(2,"Vous ne pouvez pas visualiser ces informations."),n.qZA()())}function q(a,g){if(1&a&&(n.TgZ(0,"tab",5)(1,"h1",6),n._uU(2,"Evaluations"),n.qZA(),n.YNc(3,I,1,8,"ed-eleve-notes-template",7),n.YNc(4,F,3,0,"div",8),n.qZA()),2&a){const c=n.oxw();n.Q6J("active",0===c.tabActive),n.xp6(3),n.Q6J("ngIf",c.authStore.isProfesseur()||c.authStore.isPersonnel()&&c.moduleNotesActif),n.xp6(1),n.Q6J("ngIf",c.authStore.isPersonnel()&&!c.moduleNotesActif)}}function O(a,g){if(1&a&&n._UZ(0,"ed-tab-vie-scolaire-evenements",13),2&a){const c=n.oxw(2);n.Q6J("idEntity",c.idEleve)("typeEntity",c.edTypeEntity.ELEVE)}}function Z(a,g){1&a&&(n.TgZ(0,"div",10)(1,"h3"),n._uU(2,"Vous ne pouvez pas visualiser ces informations."),n.qZA()())}function b(a,g){if(1&a&&(n.TgZ(0,"tab",11)(1,"h1",6),n._uU(2,"Vie scolaire"),n.qZA(),n.YNc(3,O,1,2,"ed-tab-vie-scolaire-evenements",12),n.YNc(4,Z,3,0,"div",8),n.qZA()),2&a){const c=n.oxw();n.Q6J("active",1===c.tabActive),n.xp6(3),n.Q6J("ngIf",c.authStore.isProfesseur()||c.authStore.isPersonnel()&&c.moduleVSActif),n.xp6(1),n.Q6J("ngIf",c.authStore.isPersonnel()&&!c.moduleVSActif)}}function N(a,g){if(1&a&&(n.TgZ(0,"tab",14)(1,"h1",6),n._uU(2,"Carnet de correspondance"),n.qZA(),n._UZ(3,"ed-tab-carnet-correspondance",15),n.qZA()),2&a){const c=n.oxw();n.Q6J("active",2===c.tabActive),n.xp6(3),n.Q6J("idEleve",c.idEleve)("isInModal",!0)}}function Y(a,g){if(1&a&&(n.TgZ(0,"tab",16)(1,"h1",6),n._uU(2,"Acc. p\xe9dagogique"),n.qZA(),n._UZ(3,"ed-tab-acc-pedagogique",17),n.qZA()),2&a){const c=n.oxw();n.Q6J("active",3===c.tabActive),n.xp6(3),n.Q6J("idEleve",c.idEleve)}}let R=(()=>{class a{constructor(c){this.authStore=c,this.tabActive=0,this.edTypeEntity=e.meW,this.displayElement=!1}ngOnInit(){this.seulPPVoieToutesLesNotes="1"===e.Kg5.getModuleParametre(e.qzA.CARNET_NOTES,"seulPPVoieToutesLesNotes",this.authStore.currentUser),"string"==typeof this.isPP&&(this.isPP="0"!==this.isPP),this.seulPPVoieToutesLesNotes?(this.displayElement=this.isPP,!1===this.displayElement&&(this.tabActive=1)):this.displayElement=!0,this.moduleVSVisible=!Object.isExists(this.moduleVSVisible)||this.moduleVSVisible,this.moduleNoteVisible=!Object.isExists(this.moduleNoteVisible)||this.moduleNoteVisible,this.moduleCarnetCorrespondanceActif=e.Kg5.isModuleEnabled(this.authStore.currentUser,e.qzA.CARNET_CORRESPONDANCE),this.authStore.isPersonnel()&&(this.moduleVSActif=e.Kg5.isModuleEnabled(this.authStore.currentUser,e.qzA.VIE_SCOLAIRE),this.moduleNotesActif=e.Kg5.isModuleEnabled(this.authStore.currentUser,e.qzA.NOTES))}}return a.\u0275fac=function(c){return new(c||a)(n.Y36(e.CnD))},a.\u0275cmp=n.Xpm({type:a,selectors:[["ed-detail-eleve"]],inputs:{moduleVSVisible:"moduleVSVisible",idEleve:"idEleve",idClasse:"idClasse",moduleNoteVisible:"moduleNoteVisible",isPP:"isPP",paramNoteEtab:"paramNoteEtab",typeEntity:"typeEntity",currentPeriode:"currentPeriode",tabActive:"tabActive"},decls:5,vars:4,consts:[["justified","true","id","tabDetailEleve",1,""],["class","visible","heading","Evaluations","edTabOrder","1",3,"active",4,"ngIf"],["heading","Vie Scolaire","class","visible","edTabOrder","2",3,"active",4,"ngIf"],["class","visible","heading","Carnet de correspondance","edTabOrder","3",3,"active",4,"ngIf"],["class","visible","heading","Acc. p\xe9dagogique","edTabOrder","4",3,"active",4,"ngIf"],["heading","Evaluations","edTabOrder","1",1,"visible",3,"active"],[1,"d-none","d-print-block","mt-5"],[3,"idEleve","idClasse","isModeConseil","isConsultationEnSaisie","paramNoteEtab","currentPeriode","isInModal","typeEntity",4,"ngIf"],["class","jumbotron",4,"ngIf"],[3,"idEleve","idClasse","isModeConseil","isConsultationEnSaisie","paramNoteEtab","currentPeriode","isInModal","typeEntity"],[1,"jumbotron"],["heading","Vie Scolaire","edTabOrder","2",1,"visible",3,"active"],[3,"idEntity","typeEntity",4,"ngIf"],[3,"idEntity","typeEntity"],["heading","Carnet de correspondance","edTabOrder","3",1,"visible",3,"active"],[3,"idEleve","isInModal"],["heading","Acc. p\xe9dagogique","edTabOrder","4",1,"visible",3,"active"],[3,"idEleve"]],template:function(c,E){1&c&&(n.TgZ(0,"tabset",0),n.YNc(1,q,5,3,"tab",1),n.YNc(2,b,5,3,"tab",2),n.YNc(3,N,4,3,"tab",3),n.YNc(4,Y,4,2,"tab",4),n.qZA()),2&c&&(n.xp6(1),n.Q6J("ngIf",E.moduleNoteVisible&&E.displayElement),n.xp6(1),n.Q6J("ngIf",E.moduleVSVisible),n.xp6(1),n.Q6J("ngIf",E.moduleCarnetCorrespondanceActif),n.xp6(1),n.Q6J("ngIf",E.moduleCarnetCorrespondanceActif))},dependencies:[C.O5,m.wW,m.AH,P.v,A.k,y.r,x.R,V.N],styles:["@media print{body.modal-open[_ngcontent-%COMP%]{font-size:10px}#tabDetailEleve[_ngcontent-%COMP%]   tab[_ngcontent-%COMP%]:not(:first-of-type)   h1[_ngcontent-%COMP%]{page-break-before:always;break-before:page}#tabDetailEleve[_ngcontent-%COMP%]   tab.visible.tab-pane[_ngcontent-%COMP%]{display:block}#tabDetailEleve[_ngcontent-%COMP%]   li.nav-item[_ngcontent-%COMP%]:not(.active){display:none}#tabDetailEleve[_ngcontent-%COMP%]   tab.nonVisible.tab-pane[_ngcontent-%COMP%]{display:none}}"]}),a})();function J(a,g){1&a&&n._UZ(0,"img",15)}function L(a,g){1&a&&n._UZ(0,"img",16)}function w(a,g){if(1&a&&n._UZ(0,"img",17),2&a){const c=n.oxw(2);n.s9C("src",c.eleve.photo,n.LSH)}}function _(a,g){if(1&a){const c=n.EpF();n.ynx(0),n.TgZ(1,"div",2)(2,"h3",3),n.YNc(3,J,1,0,"img",4),n.YNc(4,L,1,0,"img",5),n.YNc(5,w,1,1,"img",6),n._uU(6),n.ALo(7,"displayNom"),n.TgZ(8,"button",7),n.NdJ("click",function(){n.CHM(c);const M=n.oxw();return n.KtG(M.printDetail())}),n._UZ(9,"i",8),n.qZA()(),n.TgZ(10,"button",9),n.NdJ("click",function(){n.CHM(c);const M=n.oxw();return n.KtG(M.okFn())}),n.qZA(),n._UZ(11,"div",10),n.qZA(),n.TgZ(12,"div",11),n._UZ(13,"ed-detail-eleve",12),n.qZA(),n.TgZ(14,"div",13)(15,"button",14),n.NdJ("click",function(){n.CHM(c);const M=n.oxw();return n.KtG(M.okFn())}),n._uU(16,"Fermer"),n.qZA()(),n.BQk()}if(2&a){const c=n.oxw();n.xp6(3),n.Q6J("ngIf",""===c.eleve.photo&&"M"===c.eleve.sexe),n.xp6(1),n.Q6J("ngIf",""===c.eleve.photo&&"F"===c.eleve.sexe),n.xp6(1),n.Q6J("ngIf",""!==c.eleve.photo),n.xp6(1),n.hij(" Le d\xe9tail de ",n.lcZ(7,13,c.eleve)," "),n.xp6(7),n.Q6J("idEleve",c.idEleve)("idClasse",c.idClasse)("moduleNoteVisible",c.moduleNoteVisible)("moduleVSVisible",c.moduleVSVisible)("paramNoteEtab",c.paramNoteEtab)("isPP",c.isPP)("currentPeriode",c.currentPeriode)("tabActive",+c.tabActive)("typeEntity",c.typeEntity)}}let T=(()=>{class a extends((0,e.kCV)()){constructor(c,E,M,B){super(),this.modalRef=c,this.uiService=E,this.etablissementService=M,this.authStore=B,this.moduleNoteVisible=!0,this.moduleVSVisible=!0,this.tabActive=0,this.edTypeEntity=e.meW}ngOnInit(){Object.isExists(this.idEleve)&&(this.loader=this.etablissementService.getEleveById(this.idEleve).pipe((0,p.b)(c=>{this.eleve=new e.sZ$(c)}),(0,r.K)(c=>this.uiService.notifyErrorThenEmpty(c,!0,"D\xe9tail \xe9l\xe8ve","fa fa-warning"))).subscribe())}okFn(){this.modalRef.hide()}printDetail(){window.print()}}return a.\u0275fac=function(c){return new(c||a)(n.Y36(h.UZ),n.Y36(e.VLf),n.Y36(e.Xmb),n.Y36(e.CnD))},a.\u0275cmp=n.Xpm({type:a,selectors:[["ed-detail-eleve-modal"]],inputs:{idEleve:"idEleve",idClasse:"idClasse",moduleNoteVisible:"moduleNoteVisible",moduleVSVisible:"moduleVSVisible",paramNoteEtab:"paramNoteEtab",isPP:"isPP",typeEntity:"typeEntity",currentPeriode:"currentPeriode",tabActive:"tabActive"},features:[n.qOj],decls:2,vars:2,consts:[["id","eleve-note",3,"ngBusy"],[4,"ngIf"],[1,"modal-header","modale-detail-eleve"],[1,"modal-title"],["alt","photo \xe9l\xe8ve gar\xe7on","src","/assets/images/eleve-garcon.jpg","class","image-eleve d-print-none",4,"ngIf"],["alt","photo \xe9l\xe8ve fille","src","/assets/images/eleve-fille.jpg","class","image-eleve d-print-none",4,"ngIf"],["alt","photo \xe9l\xe8ve","class","image-eleve d-print-none",3,"src",4,"ngIf"],["type","button","aria-label","Imprimer le d\xe9tail de l'\xe9l\xe8ve",1,"btn","no-background","btn-secondary","d-print-none",3,"click"],["aria-hidden","true",1,"fa","fa-print"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"clearfix"],[1,"modal-body","detail-eleve","saisie-notes"],[3,"idEleve","idClasse","moduleNoteVisible","moduleVSVisible","paramNoteEtab","isPP","currentPeriode","tabActive","typeEntity"],[1,"modal-footer"],["type","button",1,"btn","btn-primary","d-print-none","float-end",2,"margin-top","15px",3,"click"],["alt","photo \xe9l\xe8ve gar\xe7on","src","/assets/images/eleve-garcon.jpg",1,"image-eleve","d-print-none"],["alt","photo \xe9l\xe8ve fille","src","/assets/images/eleve-fille.jpg",1,"image-eleve","d-print-none"],["alt","photo \xe9l\xe8ve",1,"image-eleve","d-print-none",3,"src"]],template:function(c,E){1&c&&(n.TgZ(0,"div",0),n.YNc(1,_,17,15,"ng-container",1),n.qZA()),2&c&&(n.Q6J("ngBusy",E.loader),n.xp6(1),n.Q6J("ngIf",E.eleve))},dependencies:[C.O5,f.DC,R,e.$t3],styles:["#eleve-note{padding:0}#eleve-note .modale-detail-eleve img.image-eleve{height:60px;margin-right:10px}#eleve-note #onglets-periodes{background-color:var(--footer-primary-color);display:block;padding:10px 10px 0}#eleve-note #onglets-periodes a{padding:8px}#eleve-note #onglets-periodes ul{float:none}#eleve-note #onglets-periodes ul li.active>a{background-color:#fff}#eleve-note #onglets-periodes ul li.active:after{background-color:#fff}#eleve-note #onglets-periodes ul>li:not(.active)>a{border-bottom:0 none}#eleve-note #onglets-periodes ul>li:not(.active)>a:hover{background-color:var(--light-placeholder-color)}#eleve-note #onglets-periodes ul>li.active:after{bottom:-3px}#eleve-note #onglets-periodes ul>li>a{background-color:#fff}#eleve-note ul.nav.nav-tabs{margin-top:10px}.nav-pills>li{font-size:12px}\n"],encapsulation:2}),a})()},37351:(U,S,s)=>{s.d(S,{Z:()=>f});var e=s(99658),p=s(98355),r=s(56190),n=s(65628),h=s(16917),C=s(94650);let f=(()=>{class m{}return m.\u0275fac=function(A){return new(A||m)},m.\u0275mod=C.oAB({type:m}),m.\u0275inj=C.cJS({imports:[e.m,p.o,r.u,n.K,h.C]}),m})()},15882:(U,S,s)=>{s.d(S,{i:()=>n});var e=s(84365),p=s(94650),r=s(20388);let n=(()=>{class h{constructor(f,m,P){this.modalService=f,this.elementRef=m,this.renderer=P,this.moduleNoteVisible=!0,this.moduleVSVisible=!0,this.paramNoteEtab={},this.tabActive=0,this.renderer.setStyle(this.elementRef.nativeElement,"cursor","pointer")}onClick(f){const m={idEleve:this.idEleve,moduleNoteVisible:this.moduleNoteVisible,moduleVSVisible:this.moduleVSVisible,paramNoteEtab:this.paramNoteEtab,currentPeriode:this.currentPeriode,tabActive:this.tabActive,isPP:this.isPP,typeEntity:this.typeEntity,idClasse:this.idClasse},P={id:this.modalService.getModalsCount()+1,ignoreBackdropClick:!0,initialState:m,class:"modal-xlg"};return this.modalService.show(e.r,P),f.preventDefault(),!1}}return h.\u0275fac=function(f){return new(f||h)(p.Y36(r.tT),p.Y36(p.SBq),p.Y36(p.Qsj))},h.\u0275dir=p.lG2({type:h,selectors:[["","edDetailEleve",""]],hostBindings:function(f,m){1&f&&p.NdJ("click",function(A){return m.onClick(A)})},inputs:{idEleve:"idEleve",idClasse:"idClasse",moduleNoteVisible:"moduleNoteVisible",moduleVSVisible:"moduleVSVisible",paramNoteEtab:"paramNoteEtab",isPP:"isPP",typeEntity:"typeEntity",currentPeriode:"currentPeriode",tabActive:"tabActive"}}),h})()},44469:(U,S,s)=>{s.d(S,{N:()=>w});var e=s(94650),p=s(45007),r=s(24006),n=s(68675),h=s(71884),C=s(18505),f=s(82722),m=s(70262),P=s(28746),A=s(92635),y=s(36895),x=s(80125),V=s(31355),I=s(43422),F=s(4602);function q(_,T){1&_&&(e.TgZ(0,"div",3)(1,"h3",4),e._uU(2,"Aucun contenu n'est disponible"),e.qZA()())}function O(_,T){if(1&_&&(e.TgZ(0,"option",10),e._uU(1),e.qZA()),2&_){const a=T.$implicit;e.Q6J("value",a.id),e.xp6(1),e.Oqu(a.libelle)}}function Z(_,T){if(1&_&&(e.TgZ(0,"div",7)(1,"strong",8),e._uU(2,"Filtrer par cat\xe9gorie"),e.qZA(),e.TgZ(3,"div",8)(4,"select",9)(5,"option",10),e._uU(6,"Tous"),e.qZA(),e.YNc(7,O,2,2,"option",11),e.ALo(8,"trackByProperty"),e.qZA()()()),2&_){const a=e.oxw(2);e.xp6(4),e.Q6J("formControl",a.filterCategorieSuivie),e.xp6(1),e.Q6J("value",-1),e.xp6(2),e.Q6J("ngForOf",a.listCategorieSuivie)("ngForTrackBy",e.lcZ(8,4,"id"))}}const b=function(){return{isEternel:1}};function N(_,T){if(1&_&&(e.TgZ(0,"button",17),e._uU(1),e._UZ(2,"i",18),e.qZA()),2&_){const a=e.oxw().$implicit,g=e.oxw(2);e.Q6J("canExportToCloud",!0)("typeModule",g.edModuleCodes.CARNET_CORRESPONDANCE)("file",a.fichier)("typeFichier",g.typeFichierTelechargement.CARNET_CORRESPONDANCE)("additionalData",e.DdM(6,b)),e.xp6(1),e.hij(" ",a.fichier.libelle," ")}}const Y=function(_){return{new:_}},R=function(_){return{"border-color":_}};function J(_,T){if(1&_&&(e.TgZ(0,"div",12)(1,"div",13)(2,"em"),e._uU(3,"Auteur :"),e.qZA(),e.TgZ(4,"strong",14),e._uU(5),e.ALo(6,"displayNom"),e.qZA(),e._uU(7),e.ALo(8,"edDate"),e.qZA(),e.TgZ(9,"div",15)(10,"em"),e._uU(11),e.qZA(),e.TgZ(12,"p"),e._uU(13),e.qZA(),e.YNc(14,N,3,7,"button",16),e.qZA()()),2&_){const a=T.$implicit,g=e.oxw(2);e.Q6J("ngClass",e.VKq(17,Y,null!==g.authStore.currentUser.lastConnexion&&g.authStore.currentUser.lastConnexion<a.dateCreation)),e.xp6(1),e.Q6J("ngStyle",e.VKq(19,R,a.categorie.couleur)),e.xp6(3),e.Q6J("userProfile",a.auteur.role)("userId",a.auteur.id),e.xp6(1),e.Oqu(e.Dn7(6,10,a.auteur,!1,!0)),e.xp6(2),e.hij(" ",e.xi3(8,14,a.dateCreation,"d MMMM y \xe0 HH:mm")," "),e.xp6(2),e.Q6J("ngStyle",e.VKq(21,R,a.categorie.couleur)),e.xp6(2),e.Oqu(a.categorie.libelle),e.xp6(2),e.Oqu(a.contenu),e.xp6(1),e.Q6J("ngIf",a.urlFichier)}}function L(_,T){if(1&_&&(e.ynx(0),e.YNc(1,Z,9,6,"div",5),e.YNc(2,J,15,23,"div",6),e.ALo(3,"trackByProperty"),e.BQk()),2&_){const a=e.oxw();e.xp6(1),e.Q6J("ngIf",a.listCategorieSuivie.length>1),e.xp6(1),e.Q6J("ngForOf",a.listeSuivis)("ngForTrackBy",e.lcZ(3,3,"$index"))}}let w=(()=>{class _ extends((0,p.kCV)()){constructor(a,g,c,E,M){super(),this.loaderService=a,this.uiService=g,this.carnetCorrespondanceService=c,this.authStore=E,this.carnetCorrespondanceStore=M,this.loading=new e.vpe,this.typeFichierTelechargement=p.Y9E,this.listeSuivis=[],this.listCategorieSuivie=[],this.filterCategorieSuivie=new r.NI(-1),this.edModuleCodes=p.qzA}ngOnInit(){this.filterCategorieSuivie.valueChanges.pipe((0,n.O)(-1),(0,h.x)(),(0,C.b)(a=>{this.updateFilter(+a)}),(0,f.R)(this.componentDestroyed$)).subscribe()}ngOnChanges(a){if(a.idEleve&&a.idEleve.currentValue>0&&a.idEleve.currentValue!==a.idEleve.previousValue){const g=p.$ej.edDBUserSpecificKey(this.authStore.currentUser.codeOgec,this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,[p.dcH.ELEVE,this.idEleve]);this.loader=this.loaderService.show(this),this.loading.emit(!0),this.carnetCorrespondanceService.getCarnetCorrespondanceEleve(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte,this.idEleve).pipe((0,m.K)(c=>this.uiService.notifyErrorThenEmpty(c,!0,"Erreur","fa fa-warning")),(0,P.x)(()=>{const c=Object.getEntity(this.carnetCorrespondanceStore.snapshot,g);Object.isExists(c)&&Array.isArray(c.suivis)?(this.carnet=new p.o5j(c),this.listeSuivis=[...this.carnet.suivis],this.listCategorieSuivie=[...this.listeSuivis.edPluck("categorie").edUniq("id")],this.listCategorieSuivie.edRemove(E=>0===E.id)):(this.carnet=void 0,this.listeSuivis=[],this.listCategorieSuivie=[]),this.loaderService.hide(this),this.loading.emit(!1)})).subscribe()}}updateFilter(a){if(Object.isExists(this.carnet)){if(-1===a)return void(this.listeSuivis=[...this.carnet.suivis]);this.listeSuivis=this.carnet.suivis.filter(g=>g.categorie.id===a)}}}return _.\u0275fac=function(a){return new(a||_)(e.Y36(A.S),e.Y36(p.VLf),e.Y36(p.HmK),e.Y36(p.CnD),e.Y36(p.TqJ))},_.\u0275cmp=e.Xpm({type:_,selectors:[["ed-tab-acc-pedagogique"]],inputs:{idEleve:"idEleve"},outputs:{loading:"loading"},features:[e.qOj,e.TTD],decls:3,vars:3,consts:[["id","eleveAccPedag",1,"ed-container","eleve","carnet-correspondance","suivi","double-padding",3,"ngBusy"],["class","jumbotron",4,"ngIf"],[4,"ngIf"],[1,"jumbotron"],[1,"d-print-none"],["class","row margin-top-10 margin-bottom-10 d-print-none",4,"ngIf"],["class","row equal",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"row","margin-top-10","margin-bottom-10","d-print-none"],[1,"col-lg-6"],[1,"form-control","form-select",3,"formControl"],[3,"value"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[1,"row","equal",3,"ngClass"],[1,"col-lg-2","no-padding","auteur",3,"ngStyle"],["edUserDetail","",3,"userProfile","userId"],[1,"col-lg-10","detail",3,"ngStyle"],["type","button","class","btn btn-primary-color no-background","edLightbox","","title","Consulter la pi\xe8ce-jointe",3,"canExportToCloud","typeModule","file","typeFichier","additionalData",4,"ngIf"],["type","button","edLightbox","","title","Consulter la pi\xe8ce-jointe",1,"btn","btn-primary-color","no-background",3,"canExportToCloud","typeModule","file","typeFichier","additionalData"],["aria-hidden","true",1,"i-small","fa","fa-search"]],template:function(a,g){1&a&&(e.TgZ(0,"div",0),e.YNc(1,q,3,0,"div",1),e.YNc(2,L,4,5,"ng-container",2),e.qZA()),2&a&&(e.Q6J("ngBusy",g.loader),e.xp6(1),e.Q6J("ngIf",0===(null==g.listeSuivis?null:g.listeSuivis.length)),e.xp6(1),e.Q6J("ngIf",g.listeSuivis))},dependencies:[y.mk,y.sg,y.O5,y.PC,r.YN,r.Kr,r.EJ,r.JJ,r.oH,x.DC,V.x,I.l,p.$t3,p.ifA,F.$],styles:[".auteur[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{opacity:.5}.auteur[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block}.auteur[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{vertical-align:middle}.detail[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{opacity:.5}.carnet-correspondance.eleve[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]{margin:5px 0;padding:10px 0}"],changeDetection:0}),_})()},16917:(U,S,s)=>{s.d(S,{C:()=>n});var e=s(99658),p=s(96272),r=s(94650);let n=(()=>{class h{}return h.\u0275fac=function(f){return new(f||h)},h.\u0275mod=r.oAB({type:h}),h.\u0275inj=r.cJS({imports:[e.m,p.Q]}),h})()},46451:(U,S,s)=>{s.d(S,{R:()=>ke});var e=s(94650),p=s(24006),r=s(45007),n=s(39646),h=s(39841),C=s(68675),f=s(71884),m=s(18505),P=s(82722),A=s(63900),y=s(70262),x=s(28746),V=s(11302),I=s(77579),F=s(78372),q=s(54004),O=s(20388),Z=s(92635),b=s(36895),N=s(80125),Y=s(93970),R=s(34414),J=s(34331),L=s(82945),w=s(4602);function _(i,d){if(1&i&&(e.TgZ(0,"div")(1,"label",15),e._uU(2,"Nom"),e.qZA(),e._UZ(3,"input",16),e.qZA()),2&i){const t=e.oxw();e.xp6(3),e.Q6J("formControl",t.filterNom)}}function T(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",17)(1,"input",18),e.NdJ("change",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.onChangePP())})("ngModelChange",function(l){e.CHM(t);const u=e.oxw();return e.KtG(u.filterPP=l)}),e.qZA(),e.TgZ(2,"label",19),e._uU(3,"Professeur principal"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.filterPP)}}function a(i,d){1&i&&(e.TgZ(0,"option",25),e._uU(1,"Aucunes fonctions disponibles"),e.qZA())}function g(i,d){if(1&i&&(e.TgZ(0,"option",22),e._uU(1),e.qZA()),2&i){const t=d.$implicit;e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t.libelle)}}function c(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"strong",20),e._uU(2,"Fonction"),e.qZA(),e.TgZ(3,"select",21),e.NdJ("ngModelChange",function(l){e.CHM(t);const u=e.oxw();return e.KtG(u.searchFonction=l)})("change",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.onChangeFonction())}),e.TgZ(4,"option",22),e._uU(5,"S\xe9lectionnez une fonction"),e.qZA(),e.YNc(6,a,2,0,"option",23),e.YNc(7,g,2,2,"option",24),e.ALo(8,"trackByProperty"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.searchFonction),e.xp6(1),e.Q6J("ngValue",null),e.xp6(2),e.Q6J("ngIf",0===t.fonctions.length),e.xp6(1),e.Q6J("ngForOf",t.fonctions)("ngForTrackBy",e.lcZ(8,5,"id"))}}function E(i,d){1&i&&(e.TgZ(0,"th"),e._uU(1,"Professeur Principal"),e.qZA())}function M(i,d){1&i&&(e.TgZ(0,"th"),e._uU(1,"Fonction"),e.qZA())}function B(i,d){if(1&i&&(e.TgZ(0,"tr"),e._UZ(1,"th",29),e.TgZ(2,"th",30),e._uU(3,"Nom"),e.qZA(),e.YNc(4,E,2,0,"th",5),e.YNc(5,M,2,0,"th",5),e.qZA()),2&i){const t=e.oxw(2);e.xp6(4),e.Q6J("ngIf",t.destPP&&t.typeAdulte===t.edTypeUser.ENSEIGNANT),e.xp6(1),e.Q6J("ngIf",t.typeAdulte===t.edTypeUser.PERSONNEL)}}function W(i,d){if(1&i&&(e._UZ(0,"i",38),e.ALo(1,"displayNom")),2&i){const t=e.oxw(2).item;e.uIk("aria-label",e.lcZ(1,1,t)+" est professeur principal")}}function G(i,d){if(1&i&&(e.TgZ(0,"td",32),e.YNc(1,W,2,3,"i",37),e.qZA()),2&i){const t=e.oxw().item;e.xp6(1),e.Q6J("ngIf",t.isPP)}}function X(i,d){if(1&i&&(e.TgZ(0,"td",32),e._uU(1),e.qZA()),2&i){const t=e.oxw().item;e.xp6(1),e.Oqu(t.fonction.libelle)}}const ee=function(i){return{info:i}};function te(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"tr",31),e.NdJ("click",function(){const u=e.CHM(t).item,v=e.oxw(2);return e.KtG(v.contactSelected.setValue(u))}),e.TgZ(1,"td",32)(2,"div",33),e._UZ(3,"input",34)(4,"label",35),e.ALo(5,"displayNom"),e.qZA()(),e.TgZ(6,"td",32),e._uU(7),e.ALo(8,"displayNom"),e.qZA(),e.YNc(9,G,2,1,"td",36),e.YNc(10,X,2,1,"td",36),e.qZA()}if(2&i){const t=d.item,o=e.oxw(2);e.Q6J("ngClass",e.VKq(16,ee,o.isAdulteSelected(t))),e.xp6(3),e.MGl("id","btnRadioDest",t.id,""),e.Q6J("value",t)("formControl",o.contactSelected),e.xp6(1),e.MGl("for","btnRadioDest",t.id,""),e.uIk("aria-label","S\xe9lectionner l'enseignant "+e.lcZ(5,9,t)),e.xp6(3),e.Oqu(e.gM2(8,11,t,!0,!0,o.authStore.isFouE())),e.xp6(2),e.Q6J("ngIf",o.destPP&&o.typeAdulte===o.edTypeUser.ENSEIGNANT),e.xp6(1),e.Q6J("ngIf",o.typeAdulte===o.edTypeUser.PERSONNEL)}}function ne(i,d){if(1&i&&(e.TgZ(0,"ed-smart-table",26),e.YNc(1,B,6,2,"ng-template",27),e.YNc(2,te,11,18,"ng-template",28),e.qZA()),2&i){const t=e.oxw();e.Q6J("pagination",!0)("stNBItemsPagination",3)("datas",t.listContacts)}}function oe(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"button",39),e.NdJ("click",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.addDestinataire())}),e._uU(1," Ajouter le destinataire s\xe9lectionn\xe9 "),e.qZA()}}function ie(i,d){1&i&&(e.TgZ(0,"div",40),e._uU(1,"Aucun contact trouv\xe9 !"),e.qZA())}let re=(()=>{class i extends((0,r.kCV)()){constructor(t,o,l,u,v){super(),this.modalRef=t,this.carnetCorrespondanceService=o,this.loaderService=l,this.uiService=u,this.authStore=v,this.edTypeUser=r.dcH,this.filterPP=!1,this.fonctions=[],this.onClose$=new I.x,this.listContacts=[],this.filterNom=new p.NI(""),this.contactSelected=new p.NI(null)}ngOnInit(){this.typeAdulte===r.dcH.ENSEIGNANT&&this.filterNom.valueChanges.pipe((0,F.b)(500),(0,f.x)(),(0,P.R)(this.componentDestroyed$)).pipe((0,A.w)(t=>this.search(t))).subscribe(),this.loader=this.loaderService.show(this),this.search().pipe((0,m.b)(t=>{t&&this.typeAdulte===r.dcH.PERSONNEL&&(this.fonctions=this.listeFonctions(this.listContacts))}),(0,x.x)(()=>this.loaderService.hide(this))).subscribe()}ngOnDestroy(){return this.onClose$.complete(),super.ngOnDestroy()}search(t=""){let o;return this.typeAdulte===r.dcH.PERSONNEL?o=this.carnetCorrespondanceService.getPersonnelsContacts(this.eleve):this.typeAdulte===r.dcH.ENSEIGNANT&&(o=this.carnetCorrespondanceService.getProfsContacts(t,this.eleve)),o.pipe((0,q.U)(l=>new r.b0J(l).contacts),(0,A.w)(l=>(this.refreshList(l,t),(0,n.of)(!0))),(0,y.K)(()=>(this.uiService.notifyEvent(r.DOJ.genericError,"Une erreur est survenue lors de la r\xe9cup\xe9ration des contacts","Erreur"),(0,n.of)(!1))))}refreshList(t,o){this.typeAdulte===r.dcH.PERSONNEL&&Array.isArray(this.listIdsAuteursPersonnel)&&this.listIdsAuteursPersonnel.length>0&&(t=t.filter(l=>this.listIdsAuteursPersonnel.findIndex(u=>u===l.id)>-1)),this.searchFonction&&this.searchFonction.id>0&&(t=t.filter(l=>l.fonction.id===this.searchFonction.id)),r.FSr.isNotEmptyString(o,!0)&&(t=t.filter(l=>l.prenom.toLowerCase().indexOf(o.toLowerCase())>-1||l.nom.toLowerCase().indexOf(o.toLowerCase())>-1)),this.filterPP&&(t=t.filter(l=>l.isPP===this.filterPP)),this.listContacts=[...t]}listeFonctions(t){return t.edPluckFlatten("fonction").edUniq("libelle").edSortBy("libelle").filter(o=>""!==o.libelle)}addDestinataire(){const t=new r.iJ0(this.contactSelected.value);this.onClose$.next(t),this.modalRef.hide()}isAdulteSelected(t){return!!Object.isExists(this.contactSelected.value)&&(this.typeAdulte===r.dcH.ENSEIGNANT?t.id===this.contactSelected.value.id:t.id===this.contactSelected.value.id&&t.fonction.id===this.contactSelected.value.fonction.id)}onChangeFonction(){this.loader=this.loaderService.show(this),this.search(this.filterNom.value).pipe((0,x.x)(()=>this.loaderService.hide(this))).subscribe()}onChangePP(){this.loader=this.loaderService.show(this),this.search(this.filterNom.value).pipe((0,x.x)(()=>this.loaderService.hide(this))).subscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(O.UZ),e.Y36(r.HmK),e.Y36(Z.S),e.Y36(r.VLf),e.Y36(r.CnD))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-compose-selection-adulte"]],inputs:{eleve:"eleve",destP:"destP",destPP:"destPP",typeAdulte:"typeAdulte",listIdsAuteursPersonnel:"listIdsAuteursPersonnel"},features:[e.qOj],decls:22,vars:9,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body","selectDestinataires",3,"ngBusy"],["name","selectDestinataires","novalidate",""],[4,"ngIf"],["class","form-check float-end mt-2",4,"ngIf"],[1,"clearfix"],["role","separator",1,"margin-top-10"],[3,"pagination","stNBItemsPagination","datas",4,"ngIf","ngIfElse"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-primary","float-start",3,"click"],["class","btn btn-primary float-end","type","button",3,"click",4,"ngIf"],["nolistescontacts",""],["for","nom",1,"form-label"],["name","nom","id","nom","type","search","edAutofocus","",1,"form-control","floating-label",3,"formControl"],[1,"form-check","float-end","mt-2"],["name","searchPP","id","isPP","type","checkbox",1,"form-check-input",3,"ngModel","change","ngModelChange"],["for","isPP",1,"form-check-label","fw-normal"],[1,"texte-label"],["name","fonction","id","selectFonction",1,"form-control","form-select",3,"ngModel","ngModelChange","change"],[3,"ngValue"],["disabled","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf","ngForTrackBy"],["disabled",""],[3,"pagination","stNBItemsPagination","datas"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],[1,"col-lg-1"],["stSort","nom",1,"sortable-header"],[1,"cliquable","text-center",3,"ngClass","click"],[1,"vert-align"],[1,"form-check","form-check-inline","me-0"],["type","radio",1,"form-check-input",3,"id","value","formControl"],[1,"form-check-label",3,"for"],["class","vert-align",4,"ngIf"],["class","fa fa-check",4,"ngIf"],[1,"fa","fa-check"],["type","button",1,"btn","btn-primary","float-end",3,"click"],[1,"alert","alert-dark"]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return o.modalRef.hide()}),e.qZA()(),e.TgZ(4,"div",3)(5,"form",4),e.YNc(6,_,4,1,"div",5),e.YNc(7,T,4,1,"div",6),e.YNc(8,c,9,7,"div",5),e._UZ(9,"div",7)(10,"hr",8),e.TgZ(11,"h3"),e._uU(12),e.qZA(),e.YNc(13,ne,3,3,"ed-smart-table",9),e._UZ(14,"div",7),e.qZA()(),e.TgZ(15,"div",10)(16,"div",11)(17,"button",12),e.NdJ("click",function(){return o.modalRef.hide()}),e._uU(18,"Fermer"),e.qZA(),e.YNc(19,oe,2,0,"button",13),e.qZA()(),e.YNc(20,ie,2,0,"ng-template",null,14,e.W1O)),2&t){const l=e.MAs(21);e.xp6(2),e.hij("Recherchez un ",o.typeAdulte===o.edTypeUser.ENSEIGNANT?"enseignant":"personnel administratif",""),e.xp6(2),e.Q6J("ngBusy",o.loader),e.xp6(2),e.Q6J("ngIf",o.typeAdulte===o.edTypeUser.ENSEIGNANT),e.xp6(1),e.Q6J("ngIf",o.destPP&&o.typeAdulte===o.edTypeUser.ENSEIGNANT),e.xp6(1),e.Q6J("ngIf",o.typeAdulte===o.edTypeUser.PERSONNEL),e.xp6(4),e.hij("S\xe9lectionnez un ",o.typeAdulte===o.edTypeUser.ENSEIGNANT?"enseignant":"personnel administratif",""),e.xp6(1),e.Q6J("ngIf",o.listContacts.length)("ngIfElse",l),e.xp6(6),e.Q6J("ngIf",null!==o.contactSelected.value)}},dependencies:[b.mk,b.sg,b.O5,p._Y,p.YN,p.Kr,p.Fj,p.Wl,p.EJ,p._,p.JJ,p.JL,p.On,p.F,p.oH,N.DC,Y.L,R.c,J.r,J.w,L.U,r.$t3,w.$],styles:['.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .sortable-header[_ngcontent-%COMP%]:before{content:"\\f0dc";display:inline-block;font: 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transform:translate(0);margin-right:5px}']}),i})();var K=s(87192),H=s(52497),$=s(60515),j=s(95698),se=s(9582),ae=s(48536);function ce(i,d){1&i&&(e.TgZ(0,"div",20)(1,"div",31)(2,"button",32)(3,"span",33),e._uU(4,"\xd7"),e.qZA()(),e.TgZ(5,"strong"),e._uU(6,"Attention !"),e.qZA(),e._uU(7," Certains champs ne sont pas renseign\xe9s ou incorrects "),e.qZA()())}function le(i,d){if(1&i&&(e.TgZ(0,"option",34),e._uU(1),e.qZA()),2&i){const t=d.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t," ")}}function de(i,d){1&i&&(e.TgZ(0,"div"),e._uU(1,"Aucun destinataire s\xe9lectionn\xe9"),e.qZA())}function pe(i,d){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.ALo(2,"displayNom"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(e.gM2(2,1,t.newCorrespondance.destinataire,!0,!0,t.authStore.isFouE()))}}const z=function(i){return{"has-error":i}};let ue=(()=>{class i{constructor(t,o,l,u,v,D,Q){this.modalRef=t,this.uiService=o,this.loaderService=l,this.authStore=u,this.modalService=v,this.cd=D,this.carnetCorrespondanceService=Q,this.listeTypesCorrespondance=[],this.listIdsAuteursPersonnel=[],this.edTypeUser=r.dcH,this.hasBeenSend=!1,this.onClose$=new I.x,this.dropZoneConfig={timeout:3e6,maxFilesize:5,maxFiles:1,url:`${(0,V.Je)()}/televersement.awp?verbe=post&mode=${r.Y9E.CARNET_CORRESPONDANCE}`},this.inputFilesConfig={fromCloudEnabled:!1,keepComplete:!0,dropzoneContainer:"#dropzone-container-doc-correspondance",libelleTitre:"D\xe9posez votre fichier ici, ou s\xe9lectionnez un fichier \xe0 l'aide du bouton."},this._displayNom=new r.$t3}ngOnInit(){this.parametrage=new r.aA2({destProf:"1"===this.parametrageCC.destP||"1"===this.parametrageCC.destPP,destAdmin:"2"===this.parametrageCC.destA||"1"===this.parametrageCC.destA&&this.listIdsAuteursPersonnel.length>0}),this.newCorrespondance=new r.chz({dateCreation:"",idEleve:this.eleve.id,nom:this.eleve.nom,prenom:this.eleve.prenom,type:"",contenu:"",urlFichier:"",isSignatureDemandee:!1,destinataire:new r.TSX,auteur:{id:this.authStore.currentUser.id,role:this.authStore.currentUser.typeCompte,nom:this.authStore.currentUser.nom,prenom:this.authStore.currentUser.prenom,particule:this.authStore.currentUser.particule}})}ngOnDestroy(){this.onClose$.complete()}trackByTypeCorrespondance(t){return t}onUploadSuccess(t){this.newCorrespondance.fichier=new r.eD9(t),this.newCorrespondance.urlFichier=t.unc,this.cd.detectChanges()}onRemovedFile(){delete this.newCorrespondance.fichier,this.newCorrespondance.urlFichier="",this.cd.detectChanges()}composeSelectionAdulte(t){const o={id:this.modalService.getModalsCount()+1,initialState:{destPP:"1"===this.parametrageCC.destPP,destP:this.parametrage.destProf,eleve:this.eleve,typeAdulte:t,listIdsAuteursPersonnel:"1"===this.parametrageCC.destA?this.listIdsAuteursPersonnel:void 0},class:"modal-lg"};this.modalService.show(re,o).content.onClose$.pipe((0,j.q)(1)).subscribe(u=>{this.newCorrespondance.destinataire=new r.TSX({id:u.id,nom:u.nom,prenom:u.prenom,particule:u.particule,civilite:u.civilite,type:u.type,lu:!1,dateLu:""}),this.cd.markForCheck()})}showConfirmAjout(){this.hasBeenSend=!1;const t={title:"Cr\xe9ation d'une nouvelle correspondance",message:`\n        <p>\xcates-vous vraiment s\xfbr de vouloir envoyer cette correspondance ?<br /><strong>${this.newCorrespondance.type}</strong></p>\n        <p><i>${this.newCorrespondance.contenu}</i></p>\n        <p>\xe0 <strong>${this._displayNom.transform(this.newCorrespondance.destinataire,!1,!0,this.authStore.isFouE())}</strong></p>\n        <p class="text-danger">Attention ! Une fois cr\xe9\xe9e <strong>vous ne pourrez plus modifier ou supprimer la correspondance</strong></p>\n      `,btnConfirm:"Valider",btnCancel:"Non"},o={id:this.modalService.getModalsCount()+1,initialState:t,ignoreBackdropClick:!0};this.modalService.show(K.z,o),this.modalService.onHide.pipe((0,j.q)(1),(0,m.b)(l=>{l===H.G.validation&&this.ajouterCorrespondance()})).subscribe()}ajouterCorrespondance(){if(!Object.isExists(this.newCorrespondance.destinataire)||0===this.newCorrespondance.destinataire.id)return void this.uiService.notifyEvent(r.DOJ.genericError,"Veuillez s\xe9lectionner un destinataire.","Carnet de correspondance");this.loader=this.loaderService.show(this),this.cd.markForCheck();const t=new r.chz(this.newCorrespondance);this.carnetCorrespondanceService.ajouterCorrespondanceEleve(t,this.eleve.id).pipe((0,m.b)(()=>{this.uiService.notifyEvent(r.DOJ.genericSuccess,"Enregistrement de votre correspondance effectu\xe9 !","Carnet de correspondance","icon-ed_carnetcorrespondance"),this.onClose$.next(t),this.modalRef.hide()}),(0,y.K)(()=>(this.uiService.notifyEvent(r.DOJ.genericError,"Une erreur est survenue","Carnet de correspondance"),$.E)),(0,x.x)(()=>this.loaderService.hide(this))).subscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(O.UZ),e.Y36(r.VLf),e.Y36(Z.S),e.Y36(r.CnD),e.Y36(O.tT),e.Y36(e.sBO),e.Y36(r.HmK))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-ajout-correspondance-modal"]],inputs:{eleve:"eleve",parametrageCC:"parametrageCC",listeTypesCorrespondance:"listeTypesCorrespondance",listIdsAuteursPersonnel:"listIdsAuteursPersonnel"},decls:44,vars:19,consts:[[1,"modal-header","form-f-ajout-cc"],[1,"modal-title"],[1,"libelle-eleve"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"clearfix"],["novalidate","","name","formAjoutCorrespondanceFamille","id","dropzone-container-doc-correspondance",1,"dropzone-container",3,"ngBusy"],["formAjoutCorrespondanceFamille","ngForm"],["id","form-f-ajout-cc",1,"modal-body"],["class","row",4,"ngIf"],[1,""],["for","selectTypeCorrespondance",1,"form-label"],["id","selectTypeCorrespondance","name","selectTypeCorrespondance",1,"form-control","form-select",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[2,"margin-top","15px",3,"ngClass"],[1,"clear"],[1,"float-start"],[1,"texte-label"],[4,"ngIf"],[3,"parametrages","composeSelection"],[1,"row"],[1,"col-lg-12",3,"ngClass"],["for","contenuCorrespondance",1,"form-label"],["id","contenuCorrespondance","name","contenuCorrespondance","rows","5","required","",1,"form-control",3,"ngModel","ngModelChange"],["contenuCorrespondance","ngModel"],[1,"col-lg-12"],[3,"dropzoneConfig","config","successUpload","removedFile"],[1,"modal-footer","form-f-ajout-cc"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["id","buttonAjout","type","submit",1,"btn","btn-success","float-end",3,"disabled","click"],[1,"alert","alert-dismissable","alert-danger"],["type","button","data-bs-dismiss","alert","aria-label","Masquer les messages d'erreur",1,"btn-close"],["aria-hidden","true"],[3,"value"]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2," Nouvelle correspondance "),e.TgZ(3,"span",2),e._uU(4),e.qZA()(),e.TgZ(5,"button",3),e.NdJ("click",function(){return o.modalRef.hide()}),e.qZA(),e._UZ(6,"div",4),e.qZA(),e.TgZ(7,"form",5,6)(9,"div",7),e.YNc(10,ce,8,0,"div",8),e.TgZ(11,"div")(12,"div",9)(13,"label",10),e._uU(14,"Type de correspondance"),e.qZA(),e.TgZ(15,"select",11),e.NdJ("ngModelChange",function(u){return o.newCorrespondance.type=u}),e._UZ(16,"option",12),e.YNc(17,le,2,2,"option",13),e.qZA()()(),e.TgZ(18,"div",14)(19,"div",15)(20,"div",16)(21,"strong",17),e._uU(22,"Destinataire"),e.qZA(),e.YNc(23,de,2,0,"div",18),e.YNc(24,pe,3,6,"div",18),e.qZA(),e.TgZ(25,"ed-choose-destinataire-tag",19),e.NdJ("composeSelection",function(u){return o.composeSelectionAdulte(u)}),e.qZA()()(),e.TgZ(26,"div",20)(27,"div",21)(28,"label",22),e._uU(29,"Contenu"),e.qZA(),e.TgZ(30,"textarea",23,24),e.NdJ("ngModelChange",function(u){return o.newCorrespondance.contenu=u}),e.qZA()()(),e.TgZ(32,"div",20)(33,"div",25)(34,"strong",17),e._uU(35,"Document"),e.qZA(),e.TgZ(36,"ed-input-files",26),e.NdJ("successUpload",function(u){return o.onUploadSuccess(u)})("removedFile",function(){return o.onRemovedFile()}),e.qZA()()()(),e.TgZ(37,"div",27)(38,"div",28)(39,"button",29),e.NdJ("click",function(){return o.modalRef.hide()}),e._uU(40,"Annuler"),e.qZA(),e.TgZ(41,"button",30),e.NdJ("click",function(){return o.showConfirmAjout()}),e._uU(42," Enregistrer "),e.qZA(),e._UZ(43,"div",4),e.qZA()()()),2&t){const l=e.MAs(8),u=e.MAs(31);e.xp6(4),e.Oqu(o.eleve.prenom),e.xp6(3),e.Q6J("ngBusy",o.loader),e.xp6(3),e.Q6J("ngIf",l.submitted&&l.invalid),e.xp6(5),e.Q6J("ngModel",o.newCorrespondance.type),e.xp6(2),e.Q6J("ngForOf",o.listeTypesCorrespondance)("ngForTrackBy",o.trackByTypeCorrespondance),e.xp6(1),e.Q6J("ngClass",e.VKq(15,z,!(o.newCorrespondance.destinataire.id>0))),e.xp6(5),e.Q6J("ngIf",!(o.newCorrespondance.destinataire.id>0)),e.xp6(1),e.Q6J("ngIf",o.newCorrespondance.destinataire.id>0),e.xp6(1),e.Q6J("parametrages",o.parametrage),e.xp6(2),e.Q6J("ngClass",e.VKq(17,z,u.invalid||""===o.newCorrespondance.contenu)),e.xp6(3),e.Q6J("ngModel",o.newCorrespondance.contenu),e.xp6(6),e.Q6J("dropzoneConfig",o.dropZoneConfig)("config",o.inputFilesConfig),e.xp6(5),e.Q6J("disabled",0===(null==o.newCorrespondance.destinataire?null:o.newCorrespondance.destinataire.id)||l.invalid||o.hasBeenSend)}},dependencies:[b.mk,b.sg,b.O5,p._Y,p.YN,p.Kr,p.Fj,p.EJ,p.JJ,p.JL,p.Q7,p.On,p.F,N.DC,se.G,ae.s,r.$t3],changeDetection:0}),i})();var ge=s(39300),_e=s(94359),me=s(31355),he=s(64115),Ce=s(43422);function ve(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.toggleRDVPP())}),e._UZ(1,"i",13),e._uU(2," Rendez-vous "),e.qZA()}}function fe(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const l=e.oxw();return e.KtG(l.supprimerCorrespondance())}),e._UZ(1,"i",15),e.qZA()}}function Ee(i,d){if(1&i&&(e.TgZ(0,"button",16),e._uU(1),e._UZ(2,"i",17),e.qZA()),2&i){const t=e.oxw();e.Q6J("canExportToCloud",!0)("typeModule",t.edModuleCodes.CARNET_CORRESPONDANCE)("file",t.correspondance.fichier)("typeFichier",t.typeFichierTelechargement.CARNET_CORRESPONDANCE),e.xp6(1),e.hij(" ",t.correspondance.fichier.libelle," ")}}function be(i,d){if(1&i&&(e.TgZ(0,"span"),e._uU(1," Code envoy\xe9 au "),e._UZ(2,"br"),e.TgZ(3,"strong"),e._uU(4),e.qZA()()),2&i){const t=e.oxw(3);e.xp6(4),e.Oqu(t.correspondance.signature.tel)}}function Pe(i,d){if(1&i&&(e.TgZ(0,"div"),e._uU(1," Sign\xe9e le "),e._UZ(2,"br"),e._uU(3),e.ALo(4,"edDate"),e._UZ(5,"br"),e.YNc(6,be,5,1,"span",19),e.qZA()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",e.xi3(4,2,t.correspondance.signature.dateValidation,"d MMMM y \xe0 HH:mm")," "),e.xp6(3),e.Q6J("ngIf",!t.authStore.isEleve())}}function Ae(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const l=e.oxw(2);return e.KtG(l.signerCorrespondance())}),e._uU(1," Signer "),e.qZA()}}function Te(i,d){if(1&i&&(e.TgZ(0,"div",18),e.YNc(1,Pe,7,5,"div",19),e.YNc(2,Ae,2,0,"button",20),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.correspondance.signature&&""!==t.correspondance.signature.dateValidation),e.xp6(1),e.Q6J("ngIf",t.authStore.isFamille()&&(!t.correspondance.signature||""===t.correspondance.signature.dateValidation))}}function Se(i,d){if(1&i&&(e.TgZ(0,"span"),e._uU(1," le "),e._UZ(2,"br"),e._uU(3),e.ALo(4,"edDate"),e.qZA()),2&i){const t=e.oxw(3);e.xp6(3),e.hij(" ",e.xi3(4,1,t.correspondance.destinataire.dateLu,"d MMMM y \xe0 HH:mm")," ")}}function ye(i,d){if(1&i&&(e.TgZ(0,"div"),e._uU(1," Lu "),e.YNc(2,Se,5,4,"span",19),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.correspondance.destinataire.dateLu)}}const Me=function(i,d,t){return{fa:i,"icon-ed_personnel":d,"icon-ed_enseignant":t}};function xe(i,d){if(1&i&&(e.TgZ(0,"div",22)(1,"em"),e._uU(2,"Destinataire :"),e.qZA(),e.TgZ(3,"strong"),e._UZ(4,"i",4),e._uU(5),e.ALo(6,"displayNom"),e.qZA(),e.YNc(7,ye,3,1,"div",19),e.qZA()),2&i){const t=e.oxw();e.xp6(4),e.Q6J("ngClass",e.kEZ(8,Me,t.authUtilHelper.isPersonnel(t.correspondance.destinataire.type)||t.authUtilHelper.isProfesseur(t.correspondance.destinataire.type),t.authUtilHelper.isPersonnel(t.correspondance.destinataire.type),t.authUtilHelper.isProfesseur(t.correspondance.destinataire.type))),e.xp6(1),e.hij(" ",e.gM2(6,3,t.correspondance.destinataire,!1,!0,t.authStore.isFouE())," "),e.xp6(2),e.Q6J("ngIf",!0===t.correspondance.destinataire.lu)}}function Oe(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"div",23)(1,"ed-rdv-session",24),e.NdJ("loaderChange",function(l){e.CHM(t);const u=e.oxw();return e.KtG(u.loader=l)}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("session",t.sessionRDVCorrespondance)("idEleve",t.correspondance.idEleve)("loader",t.loader)}}function Ze(i,d){if(1&i&&(e.TgZ(0,"i"),e._uU(1),e.ALo(2,"edDate"),e.ALo(3,"displayNom"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.lnq(" Rendez-vous pris le ",e.xi3(2,3,t.creneauReserve.date,"EEEE d LLLL")," \xe0 ",t.creneauReserve.heureDebut," avec ",e.Dn7(3,6,t.creneauReserve.invite,!1,!1)," ")}}function Ne(i,d){if(1&i&&(e.TgZ(0,"i"),e._uU(1),e.ALo(2,"edDate"),e.ALo(3,"edDate"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE(" Demande de rendez-vous en attente (du ",e.xi3(2,2,t.sessionRDVCorrespondance.dateDebut,"EEEE d LLLL")," au ",e.xi3(3,5,t.sessionRDVCorrespondance.dateFin,"EEEE d LLLL"),") ")}}function De(i,d){if(1&i&&(e.TgZ(0,"div",23),e.YNc(1,Ze,4,10,"i",19),e.YNc(2,Ne,4,8,"i",19),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.creneauReserve),e.xp6(1),e.Q6J("ngIf",!t.creneauReserve)}}const Ue=function(i){return{new:i}},Ie=function(i,d,t,o){return{"icon-ed_famille":i,"icon-ed_eleve":d,"icon-ed_enseignant":t,"icon-ed_personnel":o}};let Re=(()=>{class i{constructor(t,o,l,u,v,D,Q,k){this.authStore=t,this.modalService=o,this.carnetCorrespondanceService=l,this.carnetCorrespondanceUserStore=u,this.carnetCorrespondanceStore=v,this.cd=D,this.uiService=Q,this.loaderService=k,this.TYPE_USER=r.dcH,this.typeFichierTelechargement=r.Y9E,this.authUtilHelper=r.IDb,this.showRDVPP=!1,this.edModuleCodes=r.qzA}ngOnChanges(){Array.isArray(this.tabSessionsRDV)&&this.tabSessionsRDV.length>0&&(this.sessionRDVCorrespondance=this.tabSessionsRDV.find(t=>t.id===this.correspondance.idSessionRDV),Object.isExists(this.sessionRDVCorrespondance)&&(this.creneauReserve=this.sessionRDVCorrespondance.creneaux.find(t=>t.isReserve))),this._variant=r.$ej.edDBUserSpecificKey(this.authStore.currentUser.codeOgec,this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,[r.dcH.ELEVE,this.correspondance.idEleve])}signerCorrespondance(){this.modalService.show(_e.a,{id:this.modalService.getModalsCount()+1,ignoreBackdropClick:!0,initialState:{send3DSecureAuth:(l,u)=>l?this.carnetCorrespondanceService.signerCorrespondance(this.correspondance,l,u.signatureCanvas).pipe((0,A.w)(()=>(this.carnetCorrespondanceUserStore.updateStore({carnetCorrespondance:Object.getEntity(this.carnetCorrespondanceStore.snapshot,this._variant)},this._variant,!1),this.uiService.notifyEvent(r.DOJ.genericSuccess,"Votre signature a bien \xe9t\xe9 prise en compte","Carnet de correspondance","icon-ed_carnetcorrespondance"),this.cd.detectChanges(),(0,n.of)(!0))),(0,y.K)(v=>(this.uiService.notifyEvent(r.DOJ.genericError,r.FSr.isNotEmptyString(v.message)?v.message:"Signature impossible","Carnet de correspondance"),$.E))):(0,n.of)(!1),customMessage:"Pour signer <b>le carnet de correspondance</b>,"}}).content.onClose$.pipe((0,j.q)(1)).subscribe()}supprimerCorrespondance(){const t={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:"D\xe9sirez vous supprimer la correspondance ?",message:"\xcates-vous s\xfbr de vouloir supprimer <strong>d\xe9finitivement</strong> la correspondance ?"}};this.modalService.show(K.z,t),this.modalService.onHide.pipe((0,j.q)(1),(0,ge.h)(o=>o===H.G.validation),(0,A.w)(o=>{this.loader=this.loaderService.show(this),this.cd.markForCheck();const l=new r.chz(this.correspondance);return this.carnetCorrespondanceService.supprimerCorrespondanceEleve(l)}),(0,m.b)(o=>{this.carnetCorrespondanceUserStore.updateStore({carnetCorrespondance:Object.getEntity(this.carnetCorrespondanceStore.snapshot,this._variant)},this._variant,!1),this.uiService.notifyEvent(r.DOJ.genericSuccess,"La correspondance a bien \xe9t\xe9 supprim\xe9e","Correspondance supprim\xe9e","icon-ed_carnetcorrespondance"),this.cd.detectChanges()}),(0,x.x)(()=>this.loaderService.hide(this)),(0,y.K)(o=>this.uiService.notifyErrorThenEmpty(o,!0,"Erreur","icon-ed_carnetcorrespondance"))).subscribe()}toggleRDVPP(){this.showRDVPP=!this.showRDVPP}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(r.CnD),e.Y36(O.tT),e.Y36(r.HmK),e.Y36(r.$z9),e.Y36(r.TqJ),e.Y36(e.sBO),e.Y36(r.VLf),e.Y36(Z.S))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-eleve-correspondance-row"]],inputs:{correspondance:"correspondance",tabSessionsRDV:"tabSessionsRDV"},features:[e.TTD],decls:25,vars:31,consts:[[1,"eleve-correspondance-row",3,"ngClass","ngBusy"],[1,"equal","clear","item","row"],[1,"col-md-2","no-padding","auteur"],["edUserDetail","",3,"userId","userProfile"],[1,"icon-destinataire",3,"ngClass"],["class","btn btn-primary btn-sm btn-toggle-rdvpp","type","button",3,"click",4,"ngIf"],["type","button","class","btn btn-danger mt-1","title","Supprimer la correspondance","aria-label","Supprimer la correspondance",3,"click",4,"ngIf"],[1,"col-md-8","detail"],["class","btn btn-primary-color no-background","edLightbox","","type","button","title","Consulter la pi\xe8ce-jointe",3,"canExportToCloud","typeModule","file","typeFichier",4,"ngIf"],["class","col-md-2",4,"ngIf"],["class","col-md-2 destinataire",4,"ngIf"],["class","row equal",4,"ngIf"],["type","button",1,"btn","btn-primary","btn-sm","btn-toggle-rdvpp",3,"click"],[1,"icon-ed_rdvpp","small"],["type","button","title","Supprimer la correspondance","aria-label","Supprimer la correspondance",1,"btn","btn-danger","mt-1",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],["edLightbox","","type","button","title","Consulter la pi\xe8ce-jointe",1,"btn","btn-primary-color","no-background",3,"canExportToCloud","typeModule","file","typeFichier"],["aria-hidden","true",1,"i-small","fa","fa-search"],[1,"col-md-2"],[4,"ngIf"],["class","btn btn-primary","type","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],[1,"col-md-2","destinataire"],[1,"row","equal"],[3,"session","idEleve","loader","loaderChange"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"em"),e._uU(4,"Auteur :"),e.qZA(),e.TgZ(5,"strong",3),e._UZ(6,"i",4),e._uU(7),e.ALo(8,"displayNom"),e.qZA(),e._uU(9),e.ALo(10,"edDate"),e.YNc(11,ve,3,0,"button",5),e.YNc(12,fe,2,0,"button",6),e.qZA(),e.TgZ(13,"div",7)(14,"em"),e._uU(15,"Objet :"),e.qZA(),e.TgZ(16,"strong"),e._uU(17),e.qZA(),e.TgZ(18,"p"),e._uU(19),e.qZA(),e.YNc(20,Ee,3,5,"button",8),e.qZA(),e.YNc(21,Te,3,2,"div",9),e.YNc(22,xe,8,12,"div",10),e.qZA(),e.YNc(23,Oe,2,3,"div",11),e.YNc(24,De,3,2,"div",11),e.qZA()),2&t&&(e.Q6J("ngClass",e.VKq(24,Ue,null!==o.authStore.currentUser.lastConnexion&&o.authStore.currentUser.lastConnexion<o.correspondance.dateCreation||!0===o.correspondance.isSignatureDemandee&&!o.correspondance.signature))("ngBusy",o.loader),e.xp6(5),e.Q6J("userId",o.correspondance.auteur.id)("userProfile",o.correspondance.auteur.role),e.xp6(1),e.Q6J("ngClass",e.l5B(26,Ie,o.correspondance.auteur.role===o.TYPE_USER.FAMILLE_RESPONSABLE||o.correspondance.auteur.role===o.TYPE_USER.FAMILLE_CONJOINT,o.correspondance.auteur.role===o.TYPE_USER.ELEVE,o.correspondance.auteur.role===o.TYPE_USER.ENSEIGNANT,o.correspondance.auteur.role===o.TYPE_USER.PERSONNEL)),e.xp6(1),e.hij(" ",e.gM2(8,16,o.correspondance.auteur,!1,!0,o.authStore.isFouE())," "),e.xp6(2),e.hij(" ",e.xi3(10,21,o.correspondance.dateCreation,"d MMMM y \xe0 HH:mm")," "),e.xp6(2),e.Q6J("ngIf",o.authStore.isFamille()&&o.correspondance.idSessionRDV>0&&o.sessionRDVCorrespondance),e.xp6(1),e.Q6J("ngIf",(o.authStore.isModeSupervision()||o.authStore.isEphemere())&&!o.correspondance.isSupprime()&&!o.authStore.isEleve()),e.xp6(5),e.Oqu(o.correspondance.type),e.xp6(2),e.Oqu(o.correspondance.contenu),e.xp6(1),e.Q6J("ngIf",o.correspondance.urlFichier),e.xp6(1),e.Q6J("ngIf",!0===o.correspondance.isSignatureDemandee&&!o.correspondance.isSupprime()),e.xp6(1),e.Q6J("ngIf",o.correspondance.destinataire),e.xp6(1),e.Q6J("ngIf",o.showRDVPP),e.xp6(1),e.Q6J("ngIf",o.authStore.isProfOuPersonnel()&&o.sessionRDVCorrespondance))},dependencies:[b.mk,b.O5,N.DC,me.x,he.E,Ce.l,r.$t3,r.ifA],styles:['.eleve-correspondance-row[_ngcontent-%COMP%]{padding:10px;border:1px solid #eee;margin:10px 0}.eleve-correspondance-row.new[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]{border-left:5px solid #0c9ed0}.eleve-correspondance-row.new[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#289ecd}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]{margin:0;padding:10px 0 10px 10px}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]:not(.new){opacity:.8}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .auteur[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{opacity:.5}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .auteur[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .auteur[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{vertical-align:middle}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .auteur[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:11px}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .auteur[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{content:"[ "}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .auteur[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:after{content:" ]"}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{opacity:.5}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .detail[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{vertical-align:middle}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .destinataire[_ngcontent-%COMP%]   em[_ngcontent-%COMP%]{opacity:.5}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .destinataire[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .destinataire[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{vertical-align:middle}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .destinataire[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:11px}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .destinataire[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{content:"[ "}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .destinataire[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:after{content:" ]"}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-left:0}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-child{padding-right:0}.eleve-correspondance-row[_ngcontent-%COMP%]   .equal[_ngcontent-%COMP%]   .btn-toggle-rdvpp[_ngcontent-%COMP%]{display:block;margin-top:5px}'],changeDetection:0}),i})();function Je(i,d){if(1&i&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij("(",t.libelleEntity,")")}}function we(i,d){if(1&i){const t=e.EpF();e.TgZ(0,"button",4),e.NdJ("click",function(){e.CHM(t);const l=e.oxw(2);return e.KtG(l.openModalAjoutCorrespondance())}),e._UZ(1,"i",5),e._uU(2," Ajouter une correspondance "),e.qZA()}}function Ve(i,d){if(1&i&&(e.TgZ(0,"h2"),e._uU(1," Carnet de correspondance "),e.YNc(2,Je,2,1,"small",1),e.YNc(3,we,3,0,"button",3),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.authStore.isEleve()&&t.eleve),e.xp6(1),e.Q6J("ngIf",t.peutEcrire())}}function Fe(i,d){1&i&&(e.TgZ(0,"div",10)(1,"h3",11),e._uU(2,"Aucun contenu n'est disponible"),e.qZA(),e._UZ(3,"br"),e.qZA())}function qe(i,d){if(1&i&&(e.TgZ(0,"option",17),e._uU(1),e.qZA()),2&i){const t=d.$implicit;e.s9C("value",t),e.xp6(1),e.Oqu(t)}}function Ye(i,d){if(1&i&&(e.TgZ(0,"div",12)(1,"strong",13),e._uU(2,"Filtrer par type de correspondance"),e.qZA(),e.TgZ(3,"div",13)(4,"select",14)(5,"option",15),e._uU(6,"Tous"),e.qZA(),e.YNc(7,qe,2,2,"option",16),e.ALo(8,"trackByProperty"),e.qZA()()()),2&i){const t=e.oxw(2);e.xp6(4),e.Q6J("formControl",t.filterTypeCorrespondance),e.xp6(3),e.Q6J("ngForOf",t.listTypeCorresp)("ngForTrackBy",e.lcZ(8,3,"$index"))}}function Le(i,d){if(1&i&&(e.ynx(0),e._UZ(1,"ed-eleve-correspondance-row",18),e.BQk()),2&i){const t=d.$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("correspondance",t)("tabSessionsRDV",o.tabSessionsRDV)}}const Qe=function(i,d,t){return{"container-bg":i,"simple-padding":d,marginWithoutFilter:t}},je=function(){return["dateCreation|desc"]};function Be(i,d){if(1&i&&(e.TgZ(0,"div",6),e.YNc(1,Fe,4,0,"div",7),e.YNc(2,Ye,9,5,"div",8),e.YNc(3,Le,2,2,"ng-container",9),e.ALo(4,"orderBy"),e.ALo(5,"trackByProperty"),e.qZA()),2&i){const t=e.oxw();e.Q6J("ngClass",e.kEZ(10,Qe,!t.isInModal,!t.isInModal,!(t.authStore.isProfOuPersonnel()&&t.listTypeCorresp.length>1))),e.xp6(1),e.Q6J("ngIf",0===t.carnet.correspondances.length),e.xp6(1),e.Q6J("ngIf",t.authStore.isProfOuPersonnel()&&t.listTypeCorresp.length>1),e.xp6(1),e.Q6J("ngForOf",e.xi3(4,5,t.listeCorrespondances,e.DdM(14,je)))("ngForTrackBy",e.lcZ(5,8,"dateCreation"))}}let ke=(()=>{class i extends((0,r.kCV)()){constructor(t,o,l,u,v,D,Q,k,Ke,He,$e){super(),this.authStore=t,this.uiService=o,this.loaderService=l,this.carnetCorrespondanceStore=u,this.carnetCorrespondanceService=v,this.carnetCorrespondanceUserStore=D,this.cd=Q,this.modalService=k,this.badgesStore=Ke,this.rdvService=He,this.rdvStore=$e,this.isInModal=!1,this.loading=new e.vpe,this.typeFichierTelechargement=r.Y9E,this.listeCorrespondances=[],this.listTypeCorresp=[],this.listIdsAuteursPersonnel=[],this.filterTypeCorrespondance=new p.NI(""),this._datePipe=new r.ifA}ngOnInit(){this.filterTypeCorrespondance.valueChanges.pipe((0,C.O)(""),(0,f.x)(),(0,m.b)(t=>{this.updateFilter(t)}),(0,P.R)(this.componentDestroyed$)).subscribe()}ngOnChanges(t){if(t.idEleve&&t.idEleve.currentValue>0&&t.idEleve.currentValue!==t.idEleve.previousValue){this._variant=r.$ej.edDBUserSpecificKey(this.authStore.currentUser.codeOgec,this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,[r.dcH.ELEVE,t.idEleve.currentValue]),Object.isExists(this._carnetEleveSubscription)&&this._carnetEleveSubscription.unsubscribe();const o=this.carnetCorrespondanceUserStore.selectCarnetCorrespondanceUser(this._variant);let l=(0,n.of)(void 0);this.authStore.isFamille()?l=this.rdvStore.selectListeSessionsRDVEleve(this.authStore.variantForCurrentUser,t.idEleve.currentValue):this.authStore.isProfOuPersonnel()&&(l=this.rdvStore.selectListeSessionsRDV(r.$ej.edDBUserSpecificKey(this.authStore.currentUser.codeOgec,r.dcH.ELEVE,t.idEleve.currentValue))),this._carnetEleveSubscription=(0,h.a)([o,l]).pipe((0,m.b)(([u,v])=>{Object.isExists(u)&&Object.isExists(u.carnetCorrespondance)&&this.updateCarnetEleve(u.carnetCorrespondance),Array.isArray(v)&&(this.tabSessionsRDV=v.map(D=>new r.CAN(D)))}),(0,P.R)(this.componentDestroyed$)).subscribe(),this.loader=this.loaderService.show(this),this.loading.emit(!0),this.authStore.getEleve(t.idEleve.currentValue).pipe((0,A.w)(u=>(this.eleve=new r.Dfc(u),this.authStore.isProfOuPersonnel()||(this.paramsModule=r.Kg5.getModuleParams(r.qzA.CARNET_CORRESPONDANCE,this.eleve)),this.carnetCorrespondanceService.getCarnetCorrespondanceEleve(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte,t.idEleve.currentValue))),(0,A.w)(()=>this.authStore.isEleve()?(0,n.of)(void 0):this.rdvService.listSessionsRDV(r.dcH.ELEVE,t.idEleve.currentValue)),(0,y.K)(u=>this.uiService.notifyErrorThenEmpty(u)),(0,x.x)(()=>{this.carnetCorrespondanceUserStore.updateStore({carnetCorrespondance:Object.getEntity(this.carnetCorrespondanceStore.snapshot,this._variant)},this._variant,!1),this.loaderService.hide(this),this.loading.emit(!1)})).subscribe()}}updateFilter(t){if(Object.isExists(this.carnet)){if(!r.FSr.isNotEmptyString(t))return void(this.listeCorrespondances=[...this.carnet.correspondances]);this.listeCorrespondances=this.carnet.correspondances.filter(o=>o.type===t),this.cd.detectChanges()}}peutEcrire(){return!0===this.authStore.isFamille()&&"1"===this.paramsModule.peutEcrire&&this.idEleve>0&&("1"!==this.paramsModule.destP&&"1"!==this.paramsModule.destPP&&"1"===this.paramsModule.destA?this.listIdsAuteursPersonnel.length>0:!("1"!==this.paramsModule.destP&&"1"!==this.paramsModule.destPP&&"1"!==this.paramsModule.destA&&"2"!==this.paramsModule.destA))}openModalAjoutCorrespondance(){const t={eleve:this.eleve,parametrageCC:this.paramsModule,listeTypesCorrespondance:Object.isExists(this.paramsModule.typesCorrespondance)?this.paramsModule.typesCorrespondance.split(r.IZV):[],listIdsAuteursPersonnel:this.listIdsAuteursPersonnel},o={id:this.modalService.getModalsCount()+1,initialState:t,ignoreBackdropClick:!0,class:"modal-lg"};this.modalService.show(ue,o).content.onClose$.pipe((0,m.b)(u=>{Object.isExists(u)&&this.carnetCorrespondanceUserStore.updateStore({carnetCorrespondance:new r.o5j({...this.carnet,correspondances:[...this.carnet.correspondances,u]})},this._variant,!1)})).subscribe()}clearBadges(){const t=this.listeCorrespondances.filter(v=>null!==this.authStore.currentUser.lastConnexion&&this.authStore.currentUser.lastConnexion<v.dateCreation||!0===v.isSignatureDemandee&&!v.signature),o=this.badgesStore.cloneDeep();let l=r.o2q[this.authStore.currentUser.typeCompte],u=this.authStore.currentUser.id;this.authStore.isFamille()&&(l=r.o2q.FE,u=this.idEleve),o.getBadgeFromModule(r.qzA.CARNET_CORRESPONDANCE,u,l)>0&&(o.updateBadgeForModule(t.length,r.qzA.CARNET_CORRESPONDANCE,u,l),this.badgesStore.store=o,this.badgesStore.setStorage(o).catch(v=>console.error("TabCarnetCorrespondanceComponent.clearBadges badgesStore.setStorage : ",v)))}updateCarnetEleve(t){this.carnet=new r.o5j(t),this.listeCorrespondances=[...this.carnet.correspondances],this.listTypeCorresp=[...new Set(this.listeCorrespondances.edPluck("type"))],this.listIdsAuteursPersonnel=this.listeCorrespondances.filter(o=>o.auteur.role===r.dcH.PERSONNEL).map(o=>o.auteur.id),this.clearBadges(),this.cd.detectChanges()}get libelleEntity(){return Object.isExists(this.eleve)?this.eleve.prenom+" - "+this.eleve.classe.libelle:""}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(r.CnD),e.Y36(r.VLf),e.Y36(Z.S),e.Y36(r.TqJ),e.Y36(r.HmK),e.Y36(r.$z9),e.Y36(e.sBO),e.Y36(O.tT),e.Y36(r.et7),e.Y36(r.vIF),e.Y36(r.nUJ))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-tab-carnet-correspondance"]],inputs:{idEleve:"idEleve",isInModal:"isInModal"},outputs:{loading:"loading"},features:[e.qOj,e.TTD],decls:3,vars:3,consts:[["id","eleve-carnet-corres",1,"ed-container","double-padding","eleve","carnet-correspondance",3,"ngBusy"],[4,"ngIf"],[3,"ngClass",4,"ngIf"],["class","btn btn-primary float-end","type","button","title","Ajouter une correspondance",3,"click",4,"ngIf"],["type","button","title","Ajouter une correspondance",1,"btn","btn-primary","float-end",3,"click"],["aria-hidden","true",1,"fa","fa-plus"],[3,"ngClass"],["class","jumbotron",4,"ngIf"],["class","row margin-top-10 margin-bottom-10 d-print-none",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"jumbotron"],[1,"d-print-none"],[1,"row","margin-top-10","margin-bottom-10","d-print-none"],[1,"col-lg-6"],[1,"form-control","form-select",3,"formControl"],["value",""],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[3,"value"],[3,"correspondance","tabSessionsRDV"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Ve,4,2,"h2",1),e.YNc(2,Be,6,15,"div",2),e.qZA()),2&t&&(e.Q6J("ngBusy",o.loader),e.xp6(1),e.Q6J("ngIf",!o.isInModal),e.xp6(1),e.Q6J("ngIf",o.carnet))},dependencies:[b.mk,b.sg,b.O5,p.YN,p.Kr,p.EJ,p.JJ,p.oH,N.DC,Re,r.d0N,w.$],styles:["#formSignatureCorrespondance[_ngcontent-%COMP%]   .signe[_ngcontent-%COMP%]{padding-bottom:5px}#correspondance[_ngcontent-%COMP%]{margin:20px 0 0}.carnet-correspondance[_ngcontent-%COMP%]{padding:1px 20px}.carnet-correspondance[_ngcontent-%COMP%]   .marginWithoutFilter[_ngcontent-%COMP%]{margin-top:50px}.carnet-correspondance[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]:last-child{display:none}"],changeDetection:0}),i})()},65628:(U,S,s)=>{s.d(S,{K:()=>h});var e=s(99658),p=s(39499),r=s(96272),n=s(94650);let h=(()=>{class C{}return C.\u0275fac=function(m){return new(m||C)},C.\u0275mod=n.oAB({type:C}),C.\u0275inj=n.cJS({imports:[e.m,p.Y,r.Q]}),C})()}}]);