"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[6119],{36839:(ie,J,l)=>{l.d(J,{I:()=>R});var I=l(94650),F=l(95715);let R=(()=>{class h{constructor(C){this.router=C}canDeactivate(C,r,V,q){return!0===this.router.getCurrentNavigation()?.extras?.state?.canDeactivate||"/login"===q.url||!C?.canDeactivate||C.canDeactivate()}}return h.\u0275fac=function(C){return new(C||h)(I.LFG(F.F0))},h.\u0275prov=I.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},86119:(ie,J,l)=>{l.r(J),l.d(J,{MessagerieModule:()=>ls});var I=l(48262),F=l(99658),R=l(96272),h=l(95715),L=l(36839),C=l(11302),r=l(45007),V=l(3374),q=l(89379),K=l(48693),ne=l(17124),re=l(94024),ae=l(4714),oe=l(50532),k=l(87192),U=l(61099),y=l(52497),b=l(60515),P=l(39646),v=l(95698),E=l(63900),H=l(54004),D=l(28746),T=l(70262),M=l(18505),e=l(94650),$=l(92635),j=l(20388),Z=l(5402),m=l(36895),d=l(24006),N=l(59245),z=l(91752),Y=l(80125),ce=l(9582),le=l(20395),ge=l(48536),de=l(43422),w=l(4602);const pe=["composeForm"];function me(n,o){1&n&&(e.TgZ(0,"strong",36),e._uU(1," \xc0 "),e.qZA())}function ue(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"li",43)(1,"button",44),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.displayCC=!0)}),e._uU(2,"Cc"),e.qZA()()}}function _e(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"li",43)(1,"button",45),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.displayCCI=!0)}),e._uU(2,"Cci"),e.qZA()()}}function he(n,o){if(1&n&&(e.TgZ(0,"ul",41),e.YNc(1,ue,3,0,"li",42),e.YNc(2,_e,3,0,"li",42),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",!t.displayCC),e.xp6(1),e.Q6J("ngIf",!t.displayCCI&&!t.authStore.isFouE())}}function fe(n,o){1&n&&(e.TgZ(0,"div",37)(1,"button",38)(2,"b",39),e._uU(3,"\xc0"),e.qZA()(),e.YNc(4,he,3,2,"ul",40),e.qZA())}function ve(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Aucun destinataire s\xe9lectionn\xe9"),e.qZA())}function Me(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ed-groupe-destinataire",46),e.NdJ("editDestinataires",function(i){const c=e.CHM(t).index,g=e.oxw();return e.KtG(g.onEditDestinataires(i,c))})("moveDestinataires",function(i){const c=e.CHM(t).index,g=e.oxw();return e.KtG(g.onMoveDestinataires(i,"to",c))})("removeDestinataires",function(i){const c=e.CHM(t).index,g=e.oxw();return e.KtG(g.onRemoveDestinataires(i,c))}),e.qZA()}if(2&n){const t=o.$implicit;e.s9C("type",t.selection.type),e.Q6J("destinataires",t.destinataires)}}function Se(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",47),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.showModalCreateListeContact("to"))}),e._UZ(1,"i",48),e.qZA()}}function xe(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",49),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.showAllSelection())}),e._UZ(1,"i",50),e.qZA()}}function Ce(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Aucun cc s\xe9lectionn\xe9"),e.qZA())}function be(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ed-groupe-destinataire",54),e.NdJ("editDestinataires",function(i){const c=e.CHM(t).index,g=e.oxw(2);return e.KtG(g.onEditDestinataires(i,c))})("moveDestinataires",function(i){const c=e.CHM(t).index,g=e.oxw(2);return e.KtG(g.onMoveDestinataires(i,"cc",c))})("removeDestinataires",function(i){const c=e.CHM(t).index,g=e.oxw(2);return e.KtG(g.onRemoveDestinataires(i,c))}),e.qZA()}if(2&n){const t=o.$implicit;e.s9C("type",t.selection.type),e.Q6J("destinataires",t.destinataires)}}function Ee(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",51)(1,"strong",52),e._uU(2,"Cc"),e.qZA(),e.TgZ(3,"div",8)(4,"div",9),e.YNc(5,Ce,2,0,"span",10),e.YNc(6,be,1,2,"ed-groupe-destinataire",53),e.ALo(7,"trackByProperty"),e.qZA()(),e.TgZ(8,"div",12)(9,"ed-choose-destinataire-tag",16),e.NdJ("composeSelection",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onComposeSelection(i,"cc"))})("composeSelectionListeContacts",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onComposeSelectionListeContacts("cc"))}),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(5),e.Q6J("ngIf",!t.draftMessage.groupesDestinataires.length),e.xp6(1),e.Q6J("ngForOf",t.draftMessage.groupesDestinataires)("ngForTrackBy",e.lcZ(7,4,"$index")),e.xp6(3),e.Q6J("parametrages",t.parametrages)}}function Te(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Aucun cci s\xe9lectionn\xe9"),e.qZA())}function ye(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ed-groupe-destinataire",57),e.NdJ("editDestinataires",function(i){const c=e.CHM(t).index,g=e.oxw(2);return e.KtG(g.onEditDestinataires(i,c))})("moveDestinataires",function(i){const c=e.CHM(t).index,g=e.oxw(2);return e.KtG(g.onMoveDestinataires(i,"cci",c))})("removeDestinataires",function(i){const c=e.CHM(t).index,g=e.oxw(2);return e.KtG(g.onRemoveDestinataires(i,c))}),e.qZA()}if(2&n){const t=o.$implicit;e.s9C("type",t.selection.type),e.Q6J("destinataires",t.destinataires)}}function De(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",51)(1,"strong",55),e._uU(2,"Cci"),e.qZA(),e.TgZ(3,"div",8)(4,"div",9),e.YNc(5,Te,2,0,"span",10),e.YNc(6,ye,1,2,"ed-groupe-destinataire",56),e.ALo(7,"trackByProperty"),e.qZA()(),e.TgZ(8,"div",12)(9,"ed-choose-destinataire-tag",16),e.NdJ("composeSelection",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onComposeSelection(i,"cci"))})("composeSelectionListeContacts",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onComposeSelectionListeContacts("cci"))}),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(5),e.Q6J("ngIf",!t.draftMessage.groupesDestinataires.length),e.xp6(1),e.Q6J("ngForOf",t.draftMessage.groupesDestinataires)("ngForTrackBy",e.lcZ(7,4,"$index")),e.xp6(3),e.Q6J("parametrages",t.parametrages)}}function Ae(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"span",59)(1,"button",60),e._UZ(2,"i",61),e._uU(3),e.qZA(),e.TgZ(4,"button",62),e.NdJ("click",function(){const a=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.deleteTransfertFiles(a))}),e._UZ(5,"i",63),e.qZA()()}if(2&n){const t=o.$implicit;e.xp6(1),e.Q6J("file",t)("typeFichier",t.type),e.xp6(2),e.hij(" ",t.libelle," ")}}function Ie(n,o){if(1&n&&(e.TgZ(0,"div",5)(1,"strong",31),e._uU(2,"Les fichiers du message d'origine"),e.qZA(),e.TgZ(3,"div",20),e.YNc(4,Ae,6,3,"span",58),e.ALo(5,"trackByProperty"),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.Q6J("ngForOf",t.draftMessage.transfertFiles)("ngForTrackBy",e.lcZ(5,2,"id"))}}function Ue(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",64),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.saveDraft())}),e._uU(1," Enregistrer en brouillon "),e.qZA()}if(2&n){e.oxw();const t=e.MAs(6);e.Q6J("disabled",t.invalid)}}const W=function(n){return{"has-error":n}};let Ze=(()=>{class n extends((0,r.kCV)()){constructor(t,s,i,a,c,g,u,S,p){super(),this.authStore=t,this.loaderService=s,this.messagerieStore=i,this.messagerieService=a,this.modalService=c,this.route=g,this.router=u,this.uiService=S,this.messagerieUserStore=p,this.pageTitle="Nouveau message",this.processingFiles=0,this.dropZoneConfig={parallelUploads:3,maxFilesize:100,timeout:3e6,url:`${(0,C.Je)()}/televersement.awp?verbe=post`,processing:()=>this.processingEvent(),queuecomplete:()=>this.completeEvent()},this.inputFilesConfig={fromCloudEnabled:!1,keepComplete:!0,dropzoneContainer:"#container-messagerie-compose"},this.disableSubmit=!1,this.displayCC=!1,this.displayCCI=!1,this.noOneTo=!0,this._submitted=!1,this._datePipe=new r.ifA,this._htmlToPlaintext64Pipe=new r.VLW,this._displayNomPipe=new r.$t3,this.draftMessage={subject:"",content:"",groupesDestinataires:[],transfertFiles:[],files:[]}}get isForward(){return this._typeCompose===r.tHm.TYPE_COMPOSE.transfert}ngOnInit(){this.typeUser=this.route.snapshot.paramMap.get("typeUser"),this.idUser=+this.route.snapshot.paramMap.get("idUser"),this.route.queryParamMap.pipe((0,v.q)(1),(0,E.w)(t=>{const s=this.messagerieUserStore.snapshot.choosenAnnee;this.variantDefault=r.$ej.edDBUserSpecificKey(this.authStore.currentUser.codeOgec,this.typeUser,this.idUser),this.parametrages=new r.aA2(this.messagerieStore.getMessagerieParametrage(this.variantDefault)),this._typeCompose=t.get("typeCompose");const i=+t.get("idMessage"),a=i>0?new r.s2V(this.messagerieStore.getMessage(this.variantDefault,s,i,+t.get("idDossier"),+t.get("idClasseur"))):new r.s2V;return!0===a.brouillon?(this.promiseContents=this.loaderService.show(this),this.messagerieService.getMessage(this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,s,a,!0).pipe((0,H.U)(()=>this.messagerieStore.getMessage(this.variantDefault,"",i,+t.get("idDossier"),+t.get("idClasseur"))),(0,D.x)(()=>this.loaderService.hide(this)),(0,T.K)(c=>(this.uiService.notifyEvent(c.action,"Une erreur s'est produite lors de la r\xe9cup\xe9ration du brouillon","Erreur","fa fa-envelope"),b.E)))):(0,P.of)(a)}),(0,M.b)(t=>{this.createComposeForm(t,this._typeCompose)})).subscribe(),this.editorOptions={...C.x$,line_height:"1px;1;2px;1.4px;1.5px;2px;",toolbar:[{name:"basicstyles",items:["Bold","Italic","Strike","Underline"]},{name:"links",items:["Link","Unlink","base64image"]},{name:"paragraph",items:["BulletedList","NumberedList"]},{name:"editing",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"styles",items:["FontSize","TextColor","PasteText","PasteFromWord"]}],removePlugins:"elementspath",startupFocus:!0},delete this.editorOptions.allowedContent,this.inputFilesConfig.fromCloudEnabled=r.Kg5.isModuleEnabled(this.authStore.currentUser,r.qzA.MESSAGERIE)&&!this.authStore.isFamille()}canDeactivate(t){if(Object.isExists(t))return!(!this._submitted&&!this.composeForm.pristine)&&null;if(this._submitted||this.composeForm.pristine)return!0;const s={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:'<i class="fa fa-2x fa-exclamation-triangle"></i> <span class="margin-whitespace">Annuler le message</span>',message:"\xcates vous s\xfbr de vouloir quitter la page <strong>sans envoyer le message</strong> ?",warningButton:"OK"}};return this.modalService.show(k.z,s),this.modalService.onHide.pipe((0,v.q)(1),(0,H.U)(i=>i===y.G.validation))}createComposeForm(t,s){let i="";if(this.authStore.isProfOuPersonnel()){const a=this.messagerieStore.getMessagerieSignature(this.variantDefault);Object.isExists(a)&&r.FSr.isNotEmptyString(a.signature)&&(i=`<br/>${a.signature}`)}if(s===r.tHm.TYPE_COMPOSE.reponse||s===r.tHm.TYPE_COMPOSE.reponseAll){const a={id:t.from.id,type:t.from.role,isSelected:!0,nom:t.from.nom,prenom:t.from.prenom,civilite:t.from.civilite,particule:t.from.particule,to_cc_cci:r.tHm.TYPE_MESSAGERIE_DEST.TO,fonction:new r.wlj,classes:[],classe:new r.WRp,isPP:!1,responsable:new r.lEH};t.from.role===r.dcH.PERSONNEL&&(a.fonction.libelle=t.from.fonctionPersonnel),t.from.role===r.dcH.ELEVE&&(a.classe.libelle=t.from.fonctionPersonnel);const c=[{destinataires:[a],selection:{type:a.type}}];this.noOneTo=!1;let g=this._displayNomPipe.transform(t.from,!1,!0,this.authStore.isFouE());t.from.fonctionPersonnel&&(g=`${g} (${t.from.fonctionPersonnel})`);const u=t.date?this._datePipe.transform(t.date,"EEEE d MMMM y \xe0 HH:mm"):"???",S=t.content?r.YC.base64decode(t.content):"";if(s===r.tHm.TYPE_COMPOSE.reponseAll&&t.to.length>0){const p={destinataires:[],selection:{type:r.dcH.ELEVE}},_={destinataires:[],selection:{type:r.dcH.ENSEIGNANT}},Q={destinataires:[],selection:{type:r.dcH.PERSONNEL}},B={destinataires:[],selection:{type:r.dcH.FAMILLE_RESPONSABLE}};for(const f of t.to)if(this.authStore.currentUser.typeCompte!==f.role||this.authStore.currentUser.id!==f.id){f.to_cc_cci===r.tHm.TYPE_MESSAGERIE_DEST.TO&&(this.displayCC=!0);const x={id:f.id,type:f.role,isSelected:!0,nom:f.nom,prenom:f.prenom,civilite:f.civilite,particule:f.particule,to_cc_cci:f.to_cc_cci,fonction:new r.wlj,classes:[],classe:new r.WRp,isPP:!1,responsable:new r.lEH};f.role===r.dcH.PERSONNEL&&(x.fonction.libelle=f.fonctionPersonnel),f.role===r.dcH.ELEVE&&(x.classe.libelle=f.fonctionPersonnel),x.type===r.dcH.ELEVE?p.destinataires.push(x):x.type===r.dcH.ENSEIGNANT?_.destinataires.push(x):x.type===r.dcH.PERSONNEL?Q.destinataires.push(x):(x.type===r.dcH.FAMILLE_RESPONSABLE||x.type===r.dcH.FAMILLE_CONJOINT)&&B.destinataires.push(x)}_.destinataires.length>0&&c.push(_),Q.destinataires.length>0&&c.push(Q),B.destinataires.length>0&&c.push(B),p.destinataires.length>0&&c.push(p)}this.draftMessage={...this.draftMessage,responseId:t.id,idDossier:t.idDossier,idClasseur:t.idClasseur,mtype:t.mtype,groupesDestinataires:c,subject:`Re: ${t.subject}`,content:`<br/><br/><b>De ${g}</b><br/><i>(le ${u})</i><br/><br/><blockquote>${S}</blockquote>`},this.draftMessage.content=`${i}${this.draftMessage.content}`,this.pageTitle=this.draftMessage.subject}else if(s===r.tHm.TYPE_COMPOSE.transfert){let a=this._displayNomPipe.transform(t.from,!1,!0,this.authStore.isFouE());t.from.fonctionPersonnel&&(a=`${a} (${t.from.fonctionPersonnel})`);const c=t.date?this._datePipe.transform(t.date,"EEEE d MMMM y \xe0 HH:mm"):"???",g=t.content?r.YC.base64decode(t.content):"";this.draftMessage={...this.draftMessage,forwardId:t.id,idDossier:t.idDossier,idClasseur:t.idClasseur,mtype:t.mtype,transfertFiles:[...t.files],subject:`Transfert de : [${t.subject}]`,content:`<br/><br/><b>---------- Message transf\xe9r\xe9 ----------</b><br/><br/>\n        <b>De ${a}</b><br/><i>(le ${c})</i><br/><br/><blockquote>${g}</blockquote>`},this.draftMessage.content=`${i}${this.draftMessage.content}`,this.pageTitle=this.draftMessage.subject}else{if(!0===t.brouillon){const a=[];if(this.noOneTo=!t.to.some(c=>c.to_cc_cci===r.tHm.TYPE_MESSAGERIE_DEST.TO),t.to.length>0){const c={destinataires:[],selection:{type:r.dcH.ELEVE}},g={destinataires:[],selection:{type:r.dcH.ENSEIGNANT}},u={destinataires:[],selection:{type:r.dcH.PERSONNEL}},S={destinataires:[],selection:{type:r.dcH.FAMILLE_RESPONSABLE}};for(const p of t.to){p.to_cc_cci===r.tHm.TYPE_MESSAGERIE_DEST.CC&&(this.displayCC=!0),p.to_cc_cci===r.tHm.TYPE_MESSAGERIE_DEST.CCI&&(this.displayCCI=!0);const _={id:p.id,type:p.role,isSelected:!0,nom:p.nom,prenom:p.prenom,civilite:p.civilite,particule:p.particule,to_cc_cci:p.to_cc_cci,fonction:new r.wlj,classes:[],classe:new r.WRp,isPP:!1,responsable:new r.lEH,alreadySave:!0};p.role===r.dcH.PERSONNEL&&(_.fonction.libelle=p.fonctionPersonnel),p.role===r.dcH.ELEVE&&(_.classe.libelle=p.fonctionPersonnel),_.type===r.dcH.ELEVE?c.destinataires.push(_):_.type===r.dcH.ENSEIGNANT?g.destinataires.push(_):_.type===r.dcH.PERSONNEL?u.destinataires.push(_):(_.type===r.dcH.FAMILLE_RESPONSABLE||_.type===r.dcH.FAMILLE_CONJOINT)&&S.destinataires.push(_)}g.destinataires.length>0&&a.push(g),u.destinataires.length>0&&a.push(u),S.destinataires.length>0&&a.push(S),c.destinataires.length>0&&a.push(c)}this.draftMessage={...this.draftMessage,draftId:t.id,responseId:t.responseId,forwardId:t.forwardId,mtype:t.mtype,groupesDestinataires:a,content:r.YC.base64decode(t.content),subject:t.subject,transfertFiles:[...t.files]}}else this.authStore.isProfOuPersonnel()&&(this.draftMessage={...this.draftMessage,content:i});t.id>0&&(this.draftMessage.id=t.id)}}isAtLeastOne(){const t=this.draftMessage.groupesDestinataires.reduce((s,i)=>s+i.destinataires.filter(a=>a.to_cc_cci===r.tHm.TYPE_MESSAGERIE_DEST.TO).length,0);this.noOneTo=0===t}goBack(){this.router.navigate([".."],{relativeTo:this.route}).catch(()=>console.error("goBack navigate to .."))}deleteTransfertFiles(t){this.draftMessage.transfertFiles.edRemove(s=>s.id===t.id)}onSubmit(){this.disableSubmit||this.composeForm.valid&&(this.disableSubmit=!0,this.modalService.show(k.z,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:"Envoyer le message",message:"Voulez-vous envoyer le message ?"}}),this.modalService.onHide.pipe((0,v.q)(1)).subscribe(t=>{t===y.G.validation?this.sendMessage():(this.disableSubmit=!1,this._submitted=!1)}))}saveDraft(){this.sendMessage(!0)}sendMessage(t=!1){const s={...this.draftMessage,content:r.YC.base64encode(r.FSr.escapeHTMLEncode(this.draftMessage.content)),date:this._datePipe.transform(new Date,"y-MM-dd HH:mm:ss"),read:!0,from:{role:this.typeUser,id:this.idUser,read:!0},files:[...this.draftMessage.files,...this.draftMessage.transfertFiles],brouillon:t};this.promiseContents=this.messagerieService.sendMessage(this.typeUser,this.idUser,s).subscribe({next:i=>{this._submitted=!0,t?(this.draftMessage.id=i.id,this.uiService.notifyEvent(r.DOJ.genericSuccess,"Votre message a \xe9t\xe9 sauvegard\xe9 dans les brouillons","Messagerie","fa fa-envelope")):(this.disableSubmit=!1,this.uiService.notifyEvent(r.DOJ.genericSuccess,i.infos,"Messagerie","fa fa-envelope"),this.goBack())},error:i=>{this.disableSubmit=!1,this._submitted=!0,575===i.status?this.uiService.notifyEvent(i.action,i.message,"Erreur","fa fa-envelope"):(this.uiService.notifyEvent(i.action,Object.isExists(i.message)&&""!==i.message?i.message:t?"Sauvegarde du message impossible":"Une erreur s'est produite lors de l'envoi de votre message. V\xe9rifiez dans vos messages envoy\xe9s que le message n'a pas \xe9t\xe9 envoy\xe9 tout de m\xeame.","Erreur","fa fa-envelope"),t||this.goBack())}})}cleanTags(){for(let t=0;t<this.draftMessage.groupesDestinataires.length;t++)0===this.draftMessage.groupesDestinataires[t].destinataires.length&&(this.draftMessage.groupesDestinataires.splice(t,1),this.isAtLeastOne())}onMoveDestinataires(t,s,i){this.draftMessage.groupesDestinataires[i].destinataires=this.draftMessage.groupesDestinataires[i].destinataires.reduce((a,c)=>(c.to_cc_cci===s&&(c.to_cc_cci=t),a.push(c),a),[]),this.isAtLeastOne(),t===r.tHm.TYPE_MESSAGERIE_DEST.CC&&!this.displayCC&&(this.displayCC=!0),t===r.tHm.TYPE_MESSAGERIE_DEST.CCI&&!this.displayCCI&&(this.displayCCI=!0)}onRemoveDestinataires(t,s){if(s>-1)this.draftMessage.groupesDestinataires[s].destinataires=this.draftMessage.groupesDestinataires[s].destinataires.reduce((i,a)=>(-1===t.findIndex(g=>a.id===g.id)&&i.push(a),i),[]);else for(let i=0;i<this.draftMessage.groupesDestinataires.length;i++)this.draftMessage.groupesDestinataires[i].destinataires=this.draftMessage.groupesDestinataires[i].destinataires.reduce((a,c)=>(-1===t.findIndex(u=>c.id===u.id)&&a.push(c),a),[]);this.cleanTags()}onEditDestinataires(t,s){this.modalService.show(oe.N,{id:this.modalService.getModalsCount()+1,initialState:{destinataires:t},class:"modal-lg"}).content.onClose$.pipe((0,v.q)(1)).subscribe(a=>{Array.isArray(a)&&a.length>0&&this.onRemoveDestinataires(a,s)})}onComposeSelectionListeContacts(t){this.modalService.show(ne.L,{id:this.modalService.getModalsCount()+1,initialState:{toCcCci:t},class:"modal-lg"}).content.onClose$.pipe((0,v.q)(1)).subscribe(i=>{Array.isArray(i)&&i.length>0&&i.forEach(a=>{this.addGroupeDestinataire(a)})})}addGroupeDestinataire(t){const s={destinataires:[...t.destinataires],selection:{...t.selection}};return this.draftMessage.groupesDestinataires.push(s),this.isAtLeastOne(),s}showModalCreateListeContact(t){this.modalService.show(U.I,{id:this.modalService.getModalsCount()+1,initialState:{title:"Nouvelle liste de contacts",message:"Nom de la liste de contacts \xe0 cr\xe9er"}}),this.modalService.onHide.pipe((0,v.q)(1),(0,E.w)(s=>{const i=U.I.afterClosed(s);if(this.promiseContents=this.loaderService.show(this),i&&i.error)this.uiService.notifyEvent(r.DOJ.genericError,i.error);else if(i&&i.reason===y.G.validation){const a=this.draftMessage.groupesDestinataires.reduce((c,g)=>{const u={...g,destinataires:g.destinataires.filter(S=>t===S.to_cc_cci)};return c.push(u),c},[]);return this.messagerieService.createListeContacts(i.saisie,a).pipe((0,M.b)(c=>this.uiService.notifyEvent(r.DOJ.genericSuccess,"La liste de contacts a \xe9t\xe9 cr\xe9\xe9e","Messagerie","fa fa-envelope")))}return b.E}),(0,D.x)(()=>this.loaderService.hide(this)),(0,T.K)(s=>(this.uiService.notifyEvent(r.DOJ.genericError,s.message,"Erreur","fa fa-envelope"),b.E))).subscribe()}onComposeSelection(t,s){this.modalService.show({F:K.u,E:V.w,A:re.w,P:q.r,W:ae.O}[t],{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{toCcCci:s,sourceModule:r.qzA.MESSAGERIE},class:"modal-lg"}).content.onClose$.pipe((0,v.q)(1)).subscribe(c=>{if(Array.isArray(c)&&c.length>0){let g;switch(t){case r.dcH.FAMILLE_CONJOINT:case r.dcH.FAMILLE:g=r.dcH.FAMILLE_RESPONSABLE;break;case r.dcH.ELEVE:case r.dcH.ENSEIGNANT:case r.dcH.PERSONNEL:case r.dcH.FAMILLE_RESPONSABLE:case r.dcH.ESPACE_TRAVAIL:g=t}this.addGroupeDestinataire({destinataires:c,selection:{type:g}})}})}showAllSelection(){this.onEditDestinataires(this.draftMessage.groupesDestinataires.edPluckFlatten("destinataires"),-1)}processingEvent(){this.processingFiles++}completeEvent(){this.processingFiles=0}onUploadSuccess(t){this.draftMessage.files.push(new r.eD9(t))}onRemovedSuccess(t){this.draftMessage.files.splice(t.indice,1)}aucunDestinataire(){return!this.draftMessage.groupesDestinataires||0===this.draftMessage.groupesDestinataires.length||0===this.draftMessage.groupesDestinataires.reduce((s,i)=>s+i.destinataires.filter(a=>r.FSr.isNotEmptyString(a.to_cc_cci)).length,0)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(r.CnD),e.Y36($.S),e.Y36(r.q0O),e.Y36(r.KRh),e.Y36(j.tT),e.Y36(h.gz),e.Y36(h.F0),e.Y36(r.VLf),e.Y36(Z.C))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-messagerie-compose"]],viewQuery:function(t,s){if(1&t&&e.Gf(pe,5),2&t){let i;e.iGM(i=e.CRH())&&(s.composeForm=i.first)}},hostBindings:function(t,s){1&t&&e.NdJ("beforeunload",function(a){return s.canDeactivate(a)},!1,e.Jf7)},features:[e.qOj],decls:49,vars:28,consts:[[1,"ed-container","messagerie","double-padding","nouveau-message"],["id","container-messagerie-compose",1,"dropzone-container","card","ed-card"],[1,"card-body"],["novalidate","",3,"ngBusy","ngSubmit"],["composeForm","ngForm"],[1,"row"],["class","col-md-1 col-lg-1 col-xl-1 texte-label text-sm-end","title","Destinataire(s)",4,"ngIf"],["class","col-md-1 col-lg-1 col-xl-1 col-form-label cc-to btn-group","dropdown","",4,"ngIf"],[1,"col-md-12","col-lg-5","col-xl-6"],[1,"input-destinataires","centpourcent"],[4,"ngIf"],["toCcCci","to",3,"destinataires","type","editDestinataires","moveDestinataires","removeDestinataires",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-md-12","col-lg-6","col-xl-5"],["id","barre-actions-dest",1,"btn-group","float-start"],["class","btn btn-secondary","type","button","title","Cr\xe9er une liste de contacts \xe0 partir des destinataires du message",3,"click",4,"ngIf"],["class","btn btn-secondary","title","Voir toute ma s\xe9lection","type","button",3,"click",4,"ngIf"],[3,"parametrages","composeSelection","composeSelectionListeContacts"],["class","row mt-3",4,"ngIf"],[1,"row","my-3",3,"ngClass"],["for","subject",1,"col-md-1","col-lg-1","col-xl-1","col-form-label","text-sm-end"],[1,"col-lg-11"],["type","text","id","subject","name","subject","placeholder","","required","",1,"form-control",3,"ngModel","ngModelChange"],["subject","ngModel"],[1,"row","mb-3",3,"ngClass"],["for","content",1,"col-md-1","col-lg-1","col-xl-1","col-form-label","text-sm-end"],["id","content","name","content","required","",3,"config","ngModel","ngModelChange"],["content","ngModel"],[1,"col-md-1","col-lg-1","col-xl-1","texte-label","text-sm-end"],[1,"col-lg-11","position-static"],[3,"dropzoneConfig","config","successUpload","removedFile"],["class","row",4,"ngIf"],[1,"col-md-1","col-lg-1","col-xl-1","texte-label"],[1,"form-buttons-group","col"],["type","button",1,"btn","btn-danger",3,"click"],["class","btn btn-primary margin-whitespace","type","button","aria-label","Enregistrer en brouillon","title","Enregistrer en brouillon",3,"disabled","click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled"],["title","Destinataire(s)",1,"col-md-1","col-lg-1","col-xl-1","texte-label","text-sm-end"],["dropdown","",1,"col-md-1","col-lg-1","col-xl-1","col-form-label","cc-to","btn-group"],["id","dropdownDest","type","button","dropdownToggle","","aria-controls","dropdown-Destinataires",1,"dropdown-toggle","btn","border","border-0","p-1","btn-secondary","text-normal","text-sm-end"],["title","Destinataire(s)"],["aria-labelledby","dropdownDest","class","dropdown-menu","role","menu","id","dropdown-Destinataires",4,"dropdownMenu"],["aria-labelledby","dropdownDest","role","menu","id","dropdown-Destinataires",1,"dropdown-menu"],["role","menuitem",4,"ngIf"],["role","menuitem"],["title","Ajouter un champ cc","type","button",1,"dropdown-item",3,"click"],["title","Ajouter un champ cci","type","button",1,"dropdown-item",3,"click"],["toCcCci","to",3,"destinataires","type","editDestinataires","moveDestinataires","removeDestinataires"],["type","button","title","Cr\xe9er une liste de contacts \xe0 partir des destinataires du message",1,"btn","btn-secondary",3,"click"],["aria-hidden","true",1,"icon-ed_save"],["title","Voir toute ma s\xe9lection","type","button",1,"btn","btn-secondary",3,"click"],["aria-hidden","true",1,"fa","fa-eye"],[1,"row","mt-3"],["title","Copie carbone",1,"col-md-1","col-lg-1","col-xl-1","texte-label","text-sm-end"],["toCcCci","cc",3,"destinataires","type","editDestinataires","moveDestinataires","removeDestinataires",4,"ngFor","ngForOf","ngForTrackBy"],["toCcCci","cc",3,"destinataires","type","editDestinataires","moveDestinataires","removeDestinataires"],["title","Copie cach\xe9e",1,"col-md-1","col-lg-1","col-xl-1","texte-label","text-sm-end"],["toCcCci","cci",3,"destinataires","type","editDestinataires","moveDestinataires","removeDestinataires",4,"ngFor","ngForOf","ngForTrackBy"],["toCcCci","cci",3,"destinataires","type","editDestinataires","moveDestinataires","removeDestinataires"],["class","with-margin-left",4,"ngFor","ngForOf","ngForTrackBy"],[1,"with-margin-left"],["title","Visualiser","edLightbox","","type","button",1,"btn","btn-link",3,"file","typeFichier"],["aria-hidden","true",1,"fa","fa-paperclip"],["title","Supprimer le fichier","type","button",1,"btn","btn-sm","btn-danger","margin-whitespace",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o"],["type","button","aria-label","Enregistrer en brouillon","title","Enregistrer en brouillon",1,"btn","btn-primary","margin-whitespace",3,"disabled","click"]],template:function(t,s){if(1&t&&(e.TgZ(0,"div",0)(1,"h2"),e._uU(2),e.qZA(),e.TgZ(3,"div",1)(4,"div",2)(5,"form",3,4),e.NdJ("ngSubmit",function(){return s.onSubmit()}),e.TgZ(7,"div",5),e.YNc(8,me,2,0,"strong",6),e.YNc(9,fe,5,0,"div",7),e.TgZ(10,"div",8)(11,"div",9),e.YNc(12,ve,2,0,"span",10),e.YNc(13,Me,1,2,"ed-groupe-destinataire",11),e.ALo(14,"trackByProperty"),e.qZA()(),e.TgZ(15,"div",12)(16,"div",13),e.YNc(17,Se,2,0,"button",14),e.YNc(18,xe,2,0,"button",15),e.qZA(),e.TgZ(19,"ed-choose-destinataire-tag",16),e.NdJ("composeSelection",function(a){return s.onComposeSelection(a,"to")})("composeSelectionListeContacts",function(){return s.onComposeSelectionListeContacts("to")}),e.qZA()()(),e.YNc(20,Ee,10,6,"div",17),e.YNc(21,De,10,6,"div",17),e.TgZ(22,"div",18)(23,"label",19),e._uU(24,"Sujet"),e.qZA(),e.TgZ(25,"div",20)(26,"input",21,22),e.NdJ("ngModelChange",function(a){return s.draftMessage.subject=a}),e.qZA()()(),e.TgZ(28,"div",23)(29,"label",24),e._uU(30,"Message"),e.qZA(),e.TgZ(31,"div",20)(32,"ckeditor",25,26),e.NdJ("ngModelChange",function(a){return s.draftMessage.content=a}),e.qZA()()(),e.TgZ(34,"div",5)(35,"strong",27),e._uU(36,"Pi\xe8ces jointes"),e.qZA(),e.TgZ(37,"div",28)(38,"ed-input-files",29),e.NdJ("successUpload",function(a){return s.onUploadSuccess(a)})("removedFile",function(a){return s.onRemovedSuccess(a)}),e.qZA()()(),e.YNc(39,Ie,6,4,"div",30),e.TgZ(40,"div",5),e._UZ(41,"strong",31),e.TgZ(42,"div",32)(43,"div")(44,"button",33),e.NdJ("click",function(){return s.goBack()}),e._uU(45,"Annuler"),e.qZA(),e.YNc(46,Ue,2,1,"button",34),e.qZA(),e.TgZ(47,"button",35),e._uU(48,"Envoyer"),e.qZA()()()()()()()),2&t){const i=e.MAs(6),a=e.MAs(27),c=e.MAs(33);e.xp6(2),e.Oqu(s.pageTitle),e.xp6(3),e.Q6J("ngBusy",s.promiseContents),e.xp6(3),e.Q6J("ngIf",s.displayCC&&(s.displayCCI||!s.displayCCI&&s.authStore.isFouE())),e.xp6(1),e.Q6J("ngIf",!s.displayCC||!s.displayCCI&&!s.authStore.isFouE()),e.xp6(3),e.Q6J("ngIf",!s.draftMessage.groupesDestinataires.length),e.xp6(1),e.Q6J("ngForOf",s.draftMessage.groupesDestinataires)("ngForTrackBy",e.lcZ(14,22,"$index")),e.xp6(4),e.Q6J("ngIf",s.authStore.isProfOuPersonnel()&&!0!==s.noOneTo),e.xp6(1),e.Q6J("ngIf",s.draftMessage.groupesDestinataires.length),e.xp6(1),e.Q6J("parametrages",s.parametrages),e.xp6(1),e.Q6J("ngIf",s.displayCC),e.xp6(1),e.Q6J("ngIf",s.displayCCI),e.xp6(1),e.Q6J("ngClass",e.VKq(24,W,a.invalid)),e.xp6(4),e.Q6J("ngModel",s.draftMessage.subject),e.xp6(2),e.Q6J("ngClass",e.VKq(26,W,c.invalid&&c.touched)),e.xp6(4),e.Q6J("config",s.editorOptions)("ngModel",s.draftMessage.content),e.xp6(6),e.Q6J("dropzoneConfig",s.dropZoneConfig)("config",s.inputFilesConfig),e.xp6(1),e.Q6J("ngIf",s.draftMessage.transfertFiles.length),e.xp6(7),e.Q6J("ngIf",!s.isForward),e.xp6(1),e.Q6J("disabled",s.disableSubmit||i.invalid||s.aucunDestinataire()||s.processingFiles>0)}},dependencies:[m.mk,m.sg,m.O5,d._Y,d.Fj,d.JJ,d.JL,d.Q7,d.On,d.F,N.Hz,N.Mq,N.TO,z.u,Y.DC,ce.G,le.F,ge.s,de.l,w.$],styles:['@charset "UTF-8";#container-messagerie-compose h2.titre{font-size:22px}#container-messagerie-compose .input-destinataires{border:1px solid var(--dark-placeholder-color);border-radius:4px;height:34px;padding:6px 12px;color:#555;display:inline-table;box-shadow:inset 0 1px 1px #00000013}#container-messagerie-compose .show-all{margin-left:8px}#container-messagerie-compose .toolbar-selection{margin-bottom:5px}#container-messagerie-compose .toolbar-selection i.icon-ed_espacedetravail{font-size:1.6em}#container-messagerie-compose .btn-destinataires a.btn{text-transform:none}#container-messagerie-compose .cc-to .dropdown-toggle{cursor:pointer}#container-messagerie-compose .cc-to .dropdown-menu{min-width:20px;margin-left:2em;margin-top:-.5em}#container-messagerie-compose .btn-tocccci a.btn-secondary{padding:8px}#container-messagerie-compose .with-margin-left:not(:first-child){margin-left:15px}#container-messagerie-compose #barre-actions-dest i.icon-ed_save{font-size:21px}.nouveau-message .btn-group{margin:0}.nouveau-message .dropzone-ed{min-height:0;background:none;border:1px dashed #000}.nouveau-message .dropzonecadre{text-align:center}.nouveau-message .dropzonemess{width:100%;text-align:center}.nouveau-message .dropzone{min-height:100px;min-width:252px}.nouveau-message .dropzone h2{margin-top:4px;margin-bottom:11px;position:relative;font-weight:300;font-size:14pt}.nouveau-message .dropzone.dropzone-ed{position:relative;padding:10px;text-align:center}.nouveau-message .dropzone.dropzone-ed .dz-default.dz-message{background:none}\n'],encapsulation:2}),n})();var Ne=l(61135),we=l(4128),O=l(82722),A=l(39300),X=l(78372),ee=l(71884),G=l(46590);function Oe(n,o){if(1&n&&(e.TgZ(0,"div",15)(1,"input",16),e.NdJ("click",function(s){return s.stopPropagation()}),e.qZA(),e._UZ(2,"label",17),e.ALo(3,"displayNom"),e.ALo(4,"edDate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.cQ8("id","check_",t.message.id,"_",t.message.idDossier,"_",t.message.idClasseur,""),e.Q6J("formControl",t.mSelectedControl),e.xp6(1),e.cQ8("for","check_",t.message.id,"_",t.message.idDossier,"_",t.message.idClasseur,""),e.uIk("aria-label",(null!=t.mSelectedControl&&t.mSelectedControl.value?"D\xe9s\xe9lectionner ":"S\xe9lectionner ")+"le message avec le sujet "+t.message.subject+(t.messagerieUserStore.isBoxCurrent(t.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ENVOYE)?" envoy\xe9 ":" re\xe7u par "+e.gM2(3,8,t.message.from,!1,!0,t.authStore.isFouE()))+" le "+e.xi3(4,13,t.message.date,"EEE dd/MM \xe0 HH:mm"))}}function Je(n,o){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"displayNom"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" ",e.gM2(2,1,t.message.from,!1,!0,t.authStore.isFouE())," ")}}function ke(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"\xa0/\xa0"),e.qZA())}function Pe(n,o){if(1&n&&(e.TgZ(0,"span")(1,"span"),e._uU(2),e.ALo(3,"displayNom"),e.qZA(),e.YNc(4,ke,2,0,"span",6),e.qZA()),2&n){const t=o.$implicit,s=o.last,i=e.oxw(2);e.xp6(2),e.Oqu(e.gM2(3,2,t,!1,!0,i.authStore.isFouE())),e.xp6(2),e.Q6J("ngIf",!s)}}function He(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"/..."),e.qZA())}function Fe(n,o){if(1&n&&(e.TgZ(0,"span",18),e.YNc(1,Pe,5,7,"span",19),e.ALo(2,"slice"),e.ALo(3,"trackByProperty"),e.YNc(4,He,2,0,"span",6),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",e.Dn7(2,3,t.message.to,0,2))("ngForTrackBy",e.lcZ(3,7,"id")),e.xp6(3),e.Q6J("ngIf",t.message.to.length>2)}}function Re(n,o){if(1&n&&(e.TgZ(0,"span",20),e._uU(1),e.ALo(2,"edDate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.xi3(2,1,t.message.date,"HH:mm"))}}function Le(n,o){if(1&n&&(e.TgZ(0,"span",20),e._uU(1),e.ALo(2,"edDate"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.xi3(2,1,t.message.date,"EEE dd/MM \xe0 HH:mm"))}}function qe(n,o){1&n&&e._UZ(0,"i",21)}function Ye(n,o){1&n&&e._UZ(0,"i",22)}function Ge(n,o){1&n&&e._UZ(0,"i",23)}const Qe=function(n,o){return{unread:n,active:o}},Be=function(){return["42","..."]};let Ve=(()=>{class n{constructor(t,s,i){this.authStore=t,this.messagerieUserStore=s,this.rootFormGroup=i,this.actif=!1,this.openMessage=new e.vpe,this.ID_DOSSIER_MESSAGERIE=r.tHm.ID_DOSSIER_MESSAGERIE,this.isToday=r.C_1.isToday}seeMessage(t){this.openMessage.emit(t)}ngOnChanges(t){this.mSelectedControl=this.rootFormGroup.control.get("mSelected").controls[this.indexVS]}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(r.CnD),e.Y36(Z.C),e.Y36(d.sg))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-vs-message"]],inputs:{actif:"actif",message:"message",indexVS:"indexVS",canSelectMessage:"canSelectMessage"},outputs:{openMessage:"openMessage"},features:[e.TTD],decls:19,vars:17,consts:[[1,"un-message","cliquable",3,"ngClass","click"],[1,"d-flex"],["class","ckbox form-check",4,"ngIf"],[1,"media"],[1,"auteur"],[1,"bloc-auteur"],[4,"ngIf"],["class","send-to",4,"ngIf"],[1,"subject"],[1,"media-meta","date-item"],["class","date-heure-message",4,"ngIf"],[1,"media-attach"],["class","fa fa-reply","title","R\xe9ponse envoy\xe9e",4,"ngIf"],["class","fa fa-arrow-right","title","Message transf\xe9r\xe9",4,"ngIf"],["class","fa fa-paperclip","title","Fichiers joints",4,"ngIf"],[1,"ckbox","form-check"],["type","checkbox",1,"form-check-input","cliquable",3,"id","formControl","click"],[3,"for"],[1,"send-to"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"date-heure-message"],["title","R\xe9ponse envoy\xe9e",1,"fa","fa-reply"],["title","Message transf\xe9r\xe9",1,"fa","fa-arrow-right"],["title","Fichiers joints",1,"fa","fa-paperclip"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0),e.NdJ("click",function(){return s.seeMessage(s.message)}),e.TgZ(1,"div",1),e.YNc(2,Oe,5,16,"div",2),e.TgZ(3,"div",3)(4,"div")(5,"h5",4)(6,"span",5),e.YNc(7,Je,3,6,"span",6),e.qZA(),e.YNc(8,Fe,5,9,"span",7),e.qZA(),e.TgZ(9,"p",8),e._uU(10),e.ALo(11,"truncate"),e.qZA(),e.TgZ(12,"span",9),e.YNc(13,Re,3,4,"span",10),e.YNc(14,Le,3,4,"span",10),e.qZA(),e.TgZ(15,"span",11),e.YNc(16,qe,1,0,"i",12),e.YNc(17,Ye,1,0,"i",13),e.YNc(18,Ge,1,0,"i",14),e.qZA()()()()()),2&t&&(e.Q6J("ngClass",e.WLB(13,Qe,!s.message.read,s.actif)),e.xp6(2),e.Q6J("ngIf",s.messagerieUserStore.isHimself()&&s.canSelectMessage&&s.mSelectedControl),e.xp6(5),e.Q6J("ngIf",!s.messagerieUserStore.isBoxCurrent(s.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ENVOYE)),e.xp6(1),e.Q6J("ngIf",s.messagerieUserStore.isBoxCurrent(s.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ENVOYE)),e.xp6(2),e.Oqu(e.xi3(11,10,s.message.subject,e.DdM(16,Be))),e.xp6(3),e.Q6J("ngIf",s.isToday(s.message.date)),e.xp6(1),e.Q6J("ngIf",!s.isToday(s.message.date)),e.xp6(2),e.Q6J("ngIf",s.message.answered),e.xp6(1),e.Q6J("ngIf",s.message.transferred),e.xp6(1),e.Q6J("ngIf",s.message.files.length>0))},dependencies:[m.mk,m.sg,m.O5,d.Wl,d.JJ,d.oH,m.OU,r.$t3,r.ifA,r.W70,w.$],encapsulation:2,changeDetection:0}),n})();function Ke(n,o){1&n&&e._UZ(0,"input",9)}function $e(n,o){if(1&n&&(e.TgZ(0,"div",6),e.YNc(1,Ke,1,0,"input",7),e.TgZ(2,"label",8),e._uU(3),e.qZA()()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.messagerieUserStore.isHimself()&&t.messages.length>0),e.xp6(1),e.uIk("aria-label",t.selectAll.value?"D\xe9s\xe9lectionner l'ensemble des messages":"S\xe9lectionner l'ensemble des messages"),e.xp6(1),e.hij(" ",t.inboxTitle," ")}}function je(n,o){1&n&&(e.TgZ(0,"span",15)(1,"button",16),e._UZ(2,"i",17),e.qZA()())}function ze(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"span",18)(1,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.deleteInboxClasseur.emit())}),e._UZ(2,"i",17),e.qZA()()}}function We(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",10)(1,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.updateClasseur.emit())}),e._UZ(2,"i",12),e.qZA(),e.YNc(3,je,3,0,"span",13),e.YNc(4,ze,3,0,"span",14),e.qZA()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.messages.length>0),e.xp6(1),e.Q6J("ngIf",0===t.messages.length)}}function Xe(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"ed-vs-message",23),e.NdJ("openMessage",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.seeMessage(i))}),e.qZA()}if(2&n){const t=o.$implicit,s=o.index;e.oxw();const i=e.MAs(1),a=e.oxw();e.Q6J("indexVS",i.viewPortInfo.startIndex+s)("message",t)("canSelectMessage",a.canSelectMessage)("actif",a.messagerieUserStore.isCurrentMessage(t))}}function et(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"virtual-scroller",20,21),e.NdJ("vsEnd",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.doLoadNext(i))}),e.YNc(2,Xe,1,4,"ed-vs-message",22),e.ALo(3,"trackByProperty"),e.qZA()}if(2&n){const t=e.MAs(1),s=e.oxw();e.Q6J("items",s.messages),e.xp6(2),e.Q6J("ngForOf",t.viewPortItems)("ngForTrackBy",e.lcZ(3,3,"$index"))}}function tt(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Votre bo\xeete est actuellement vide !"),e.qZA())}function st(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Aucun message ne correspond \xe0 votre recherche !"),e.qZA())}function it(n,o){if(1&n&&(e.TgZ(0,"h5"),e.YNc(1,tt,2,0,"span",5),e.YNc(2,st,2,0,"span",5),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.search),e.xp6(1),e.Q6J("ngIf",t.search)}}const nt=function(n){return{"pas-vide":n}};let te=(()=>{class n extends((0,r.kCV)()){constructor(t,s,i){super(),this.messagerieUserStore=t,this.ref=s,this.authStore=i,this.messages=[],this.virtualForm=new d.cw({selectAll:new d.NI(!1),mSelected:new d.Oe([])}),this.ID_DOSSIER_MESSAGERIE=r.tHm.ID_DOSSIER_MESSAGERIE,this.isToday=r.C_1.isToday,this.changeSelected=new e.vpe,this.updateClasseur=new e.vpe,this.deleteInboxClasseur=new e.vpe,this.openMessage=new e.vpe,this.loadNext=new e.vpe}get mSelected(){return this.virtualForm.get("mSelected")}get selectAll(){return this.virtualForm.get("selectAll")}ngOnChanges(t){t.currentIdBox&&(this._sub1&&this._sub1.unsubscribe(),this._sub2&&this._sub2.unsubscribe(),this._sub1=this.messagerieUserStore.messagerie$.pipe((0,M.b)(s=>{this.canSelectMessage=!(s.inboxList.filter(a=>a.id>0).length<=0&&this.messagerieUserStore.currentIdBox===r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ENVOYE),this.messages=r.d0N.sortDatas(s.getMessages(t.currentIdBox.currentValue),["date|desc"]),this.inboxTitle=s.getTitleCurrentInbox(t.currentIdBox.currentValue);const i=this.messages.map(a=>new d.NI(!1));this.virtualForm.controls.mSelected=new d.Oe(i),!0===this.selectAll.value&&this.selectAll.patchValue(!1,{emitEvent:!1}),this.ref.markForCheck()}),(0,E.w)(s=>this.mSelected.valueChanges),(0,O.R)(this.componentDestroyed$)).subscribe(s=>{const i=s.every(c=>c);this.selectAll.value!==i&&this.selectAll.patchValue(i,{emitEvent:!1});const a=this.mSelected.value.map((c,g)=>c?this.messages[g]:null).filter(c=>null!==c);this.changeSelected.emit(a)}),this._sub2=this.selectAll.valueChanges.pipe((0,O.R)(this.componentDestroyed$)).subscribe(s=>{this.mSelected.patchValue(Array(this.mSelected.length).fill(s)),this.ref.markForCheck()}))}seeMessage(t){this.selectAll.value&&this.selectAll.patchValue(!1),this.openMessage.emit(t)}doLoadNext(t){const s=Math.floor(t.endIndex/r.Vqi);this.messagerieUserStore.currentPage!==s&&this.messagerieUserStore.updateCurrentPage(s),!(this.messages.length<r.Vqi||t.endIndex<this.messages.length-1)&&this.loadNext.emit()}scrollToTop(){Object.isExists(this.virtualScroller)&&this.virtualScroller.scrollToPosition(0,0)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Z.C),e.Y36(e.sBO),e.Y36(r.CnD))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-messagerie-messages"]],viewQuery:function(t,s){if(1&t&&e.Gf(I.Vw,5),2&t){let i;e.iGM(i=e.CRH())&&(s.virtualScroller=i.first)}},inputs:{currentIdBox:"currentIdBox",search:"search"},outputs:{changeSelected:"changeSelected",updateClasseur:"updateClasseur",deleteInboxClasseur:"deleteInboxClasseur",openMessage:"openMessage",loadNext:"loadNext"},features:[e.qOj,e.TTD],decls:6,vars:9,consts:[["novalidate","",3,"ngBusy","formGroup"],[3,"ngClass"],["class","form-check ps-0",4,"ngIf"],["class","btns-classeur",4,"ngIf"],[3,"items","vsEnd",4,"ngIf"],[4,"ngIf"],[1,"form-check","ps-0"],["id","check-all","class","form-check-input","type","checkbox","formControlName","selectAll",4,"ngIf"],["for","check-all",1,"form-check-label","fw-normal"],["id","check-all","type","checkbox","formControlName","selectAll",1,"form-check-input"],[1,"btns-classeur"],["type","button","title","Renommer le dossier",1,"btn","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-pencil"],["class","margin-whitespace","title","Suppression impossible : dossier non vide",4,"ngIf"],["class","margin-whitespace",4,"ngIf"],["title","Suppression impossible : dossier non vide",1,"margin-whitespace"],["disabled","true","type","button",1,"btn","btn-danger"],["aria-hidden","true",1,"fa","fa-trash"],[1,"margin-whitespace"],["title","Supprimer le dossier","type","button",1,"btn","btn-danger",3,"click"],[3,"items","vsEnd"],["scroll",""],["formArrayName","mSelected",3,"indexVS","message","canSelectMessage","actif","openMessage",4,"ngFor","ngForOf","ngForTrackBy"],["formArrayName","mSelected",3,"indexVS","message","canSelectMessage","actif","openMessage"]],template:function(t,s){1&t&&(e.TgZ(0,"form",0)(1,"h3",1),e.YNc(2,$e,4,3,"div",2),e.YNc(3,We,5,2,"div",3),e.qZA(),e.YNc(4,et,4,5,"virtual-scroller",4),e.qZA(),e.YNc(5,it,3,2,"h5",5)),2&t&&(e.Q6J("ngBusy",s.messagerieUserStore.promiseContents)("formGroup",s.virtualForm),e.xp6(1),e.Q6J("ngClass",e.VKq(7,nt,s.messages.length>0)),e.xp6(1),e.Q6J("ngIf",s.canSelectMessage),e.xp6(1),e.Q6J("ngIf",s.messagerieUserStore.isHimself()&&s.currentIdBox>0),e.xp6(1),e.Q6J("ngIf",s.messages.length>0),e.xp6(1),e.Q6J("ngIf",0===s.messages.length))},dependencies:[m.mk,m.sg,m.O5,d._Y,d.Wl,d.JJ,d.JL,d.sg,d.u,d.CE,Y.DC,I.Vw,Ve,w.$],encapsulation:2,changeDetection:0}),n})();function rt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.markMessagesAsUnread.emit())}),e._uU(1,"Marquer non lu"),e.qZA()}}function at(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.archiveMessages.emit())}),e._uU(1,"Archiver"),e.qZA()}}function ot(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.unArchiveMessages.emit())}),e._uU(1,"D\xe9sarchiver"),e.qZA()}}function ct(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"li",15)(1,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.supprimerMessages.emit())}),e._uU(2,"Supprimer"),e.qZA()()}}function lt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"li",15)(1,"button",26),e.NdJ("click",function(){const a=e.CHM(t).$implicit,c=e.oxw(5);return e.KtG(c.deplacerMessages.emit(a.id))}),e._uU(2),e.qZA()()}if(2&n){const t=o.$implicit;e.xp6(2),e.hij(" ",t.libelle," ")}}const gt=function(){return["order|asc"]};function dt(n,o){if(1&n&&(e.TgZ(0,"ul",24),e.YNc(1,lt,3,1,"li",25),e.ALo(2,"orderBy"),e.ALo(3,"trackByProperty"),e.qZA()),2&n){const t=e.oxw(4);e.xp6(1),e.Q6J("ngForOf",e.xi3(2,2,t.filtreDeplacerVers(),e.DdM(7,gt)))("ngForTrackBy",e.lcZ(3,5,"id"))}}function pt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"li",20)(1,"div",21)(2,"button",22),e.NdJ("click",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.displaySubMenu(i))}),e._uU(3," D\xe9placer vers... "),e.qZA(),e.YNc(4,dt,4,8,"ul",23),e.qZA()()}}function mt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"li",15)(1,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.deplacerMessages.emit(0))}),e._uU(2,"Retirer du dossier"),e.qZA()()}}function ut(n,o){if(1&n&&(e.TgZ(0,"ul",14)(1,"li",15),e.YNc(2,rt,2,0,"button",16),e.qZA(),e.TgZ(3,"li",15),e.YNc(4,at,2,0,"button",16),e.qZA(),e.TgZ(5,"li",15),e.YNc(6,ot,2,0,"button",16),e.qZA(),e.YNc(7,ct,3,0,"li",17),e.YNc(8,pt,5,0,"li",18),e.YNc(9,mt,3,0,"li",17),e.qZA()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngIf",t.canMarkAsUnread()),e.xp6(2),e.Q6J("ngIf",t.canArchive()),e.xp6(2),e.Q6J("ngIf",t.canUnArchive()),e.xp6(1),e.Q6J("ngIf",t.canDelete()),e.xp6(1),e.Q6J("ngIf",t.isDeplacerVersEnable()&&t.authStore.isAnneeCourante(t.messagerieUserStore.snapshot.choosenAnnee)),e.xp6(1),e.Q6J("ngIf",t.messagerieUserStore.currentIdBox>0&&t.authStore.isAnneeCourante(t.messagerieUserStore.snapshot.choosenAnnee))}}function _t(n,o){if(1&n&&(e.TgZ(0,"li",10)(1,"div",11)(2,"button",12),e._uU(3),e.qZA(),e.YNc(4,ut,10,6,"ul",13),e.qZA()()),2&n){const t=e.oxw();e.xp6(3),e.AsE(" ",t.messagesSelected.length," coch\xe9",t.messagesSelected.length>1?"s":""," ")}}function ht(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).ngIf,a=e.oxw();return a.messagerieUserStore.updateChoosenAnnee(i[1]),e.KtG(a.refreshMessages.emit(!0))}),e._uU(1," Ann\xe9e en cours "),e.qZA()}}function ft(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).ngIf,a=e.oxw();return a.messagerieUserStore.updateChoosenAnnee(i[0]),e.KtG(a.refreshMessages.emit(!0))}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw(2).ngIf;e.xp6(1),e.hij(" ",t[0]," ")}}function vt(n,o){if(1&n&&(e.TgZ(0,"ul",31)(1,"li",15),e.YNc(2,ht,2,0,"button",16),e.YNc(3,ft,2,1,"button",16),e.qZA()()),2&n){const t=e.oxw().ngIf,s=e.oxw();e.xp6(2),e.Q6J("ngIf",s.messagerieUserStore.snapshot.choosenAnnee===t[0]),e.xp6(1),e.Q6J("ngIf",s.messagerieUserStore.snapshot.choosenAnnee!==t[0])}}function Mt(n,o){if(1&n&&(e.TgZ(0,"div",27)(1,"ul",1)(2,"li",28)(3,"div",11)(4,"button",29)(5,"span"),e._uU(6),e.qZA()(),e.YNc(7,vt,4,2,"ul",30),e.qZA()()()()),2&n){const t=e.oxw();e.xp6(6),e.Oqu(t.authStore.isAnneeCourante(t.messagerieUserStore.snapshot.choosenAnnee)?"Ann\xe9e pr\xe9c\xe9dente":t.messagerieUserStore.snapshot.choosenAnnee)}}const St=["*"];let xt=(()=>{class n{constructor(t,s){this.authStore=t,this.messagerieUserStore=s,this.markMessagesAsUnread=new e.vpe,this.archiveMessages=new e.vpe,this.unArchiveMessages=new e.vpe,this.supprimerMessages=new e.vpe,this.deplacerMessages=new e.vpe,this.refreshMessages=new e.vpe}canMarkAsUnread(){return this.messagerieUserStore.currentIdBox===r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION}canArchive(){return this.canMarkAsUnread()}canUnArchive(){return this.messagerieUserStore.currentIdBox===r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ARCHIVE}canDelete(){return(this.messagerieUserStore.currentIdBox===r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_DRAFT||!this.authStore.isFouE())&&this.messagerieUserStore.currentIdBox!==r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ENVOYE}filtreDeplacerVers(){return this.messagerie.inboxList.filter(t=>t.id>0&&!this.messagerieUserStore.isBoxCurrent(t.id))}isDeplacerVersEnable(){return this.authStore.isAnneeCourante(this.messagerieUserStore.snapshot.choosenAnnee)&&this.messagerieUserStore.currentIdBox!==r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_DRAFT&&this.messagerieUserStore.currentIdBox!==r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ARCHIVE&&this.messagerie.inboxList.filter(t=>t.id>0&&t.id!==this.messagerieUserStore.currentIdBox).length>0}displaySubMenu(t){t.preventDefault(),t.stopPropagation()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(r.CnD),e.Y36(Z.C))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-messagerie-header"]],inputs:{messagerie:"messagerie",messagesSelected:"messagesSelected"},outputs:{markMessagesAsUnread:"markMessagesAsUnread",archiveMessages:"archiveMessages",unArchiveMessages:"unArchiveMessages",supprimerMessages:"supprimerMessages",deplacerMessages:"deplacerMessages",refreshMessages:"refreshMessages"},ngContentSelectors:St,decls:13,vars:2,consts:[[1,"float-start"],[1,"list-inline"],["class","list-inline-item actions-checked",4,"ngIf"],[1,"list-inline-item","refresh"],[1,"btn-group"],["title","Rafra\xeechir la liste des messages","type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],[1,"list-inline-item","search"],["class","float-end",4,"ngIf"],[1,"clearfix"],[1,"list-inline-item","actions-checked"],["dropdown","",1,"btn-group"],["dropdownToggle","","id","dropdown1","type","button","aria-controls","dropdown-actions-message",1,"btn","btn-primary","dropdown-toggle"],["aria-labelledby","dropdown1","class","dropdown-menu","role","menu","id","dropdown-actions-message",4,"dropdownMenu"],["aria-labelledby","dropdown1","role","menu","id","dropdown-actions-message",1,"dropdown-menu"],["role","menuitem"],["type","button","class","dropdown-item",3,"click",4,"ngIf"],["role","menuitem",4,"ngIf"],["class","dropdown-submenu","dropdown","","role","menuitem","triggers","mouseover",4,"ngIf"],["type","button",1,"dropdown-item",3,"click"],["dropdown","","role","menuitem","triggers","mouseover",1,"dropdown-submenu"],[1,"btn-group","w-100"],["dropdownToggle","","type","button","id","dropdownDeplacer","aria-controls","dropdown-deplacer-vers","aria-haspopup","true","aria-expanded","false",1,"dropdown-item","dropdown-toggle",3,"click"],["class","dropdown-menu","role","menu","aria-labelledby","dropdownDeplacer","id","dropdown-deplacer-vers",4,"dropdownMenu"],["role","menu","aria-labelledby","dropdownDeplacer","id","dropdown-deplacer-vers",1,"dropdown-menu"],["role","menuitem",4,"ngFor","ngForOf","ngForTrackBy"],["type","button","fragment","nested-dropdowns",1,"dropdown-item",3,"click"],[1,"float-end"],[1,"list-inline-item","older-year","custom-ed"],["dropdownToggle","","id","dropdown2","type","button","aria-controls","dropdown-annees",1,"btn","btn-secondary","dropdown-toggle"],["aria-labelledby","dropdown2","class","dropdown-menu dropdown-menu-right","role","menu","id","dropdown-annees",4,"dropdownMenu"],["aria-labelledby","dropdown2","role","menu","id","dropdown-annees",1,"dropdown-menu","dropdown-menu-right"]],template:function(t,s){1&t&&(e.F$t(),e.TgZ(0,"div")(1,"div",0)(2,"ul",1),e.YNc(3,_t,5,2,"li",2),e.TgZ(4,"li",3)(5,"div",4)(6,"button",5),e.NdJ("click",function(){return s.refreshMessages.emit(!1)}),e._UZ(7,"i",6),e.qZA()()(),e.TgZ(8,"li",7)(9,"div",4),e.Hsn(10),e.qZA()()()(),e.YNc(11,Mt,8,1,"div",8),e._UZ(12,"div",9),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",s.messagerieUserStore.isHimself()&&s.messagesSelected.length>0),e.xp6(8),e.Q6J("ngIf",s.messagerieUserStore.getAnneesMessagesArchive()))},dependencies:[m.sg,m.O5,N.Hz,N.Mq,N.TO,r.d0N,w.$],encapsulation:2}),n})();var Ct=l(39841),bt=l(35684),Et=l(4358);const Tt=["inputAutreMailNotification"];function yt(n,o){1&n&&(e.TgZ(0,"alert",5),e._uU(1,"Aucun param\xe9trage disponible"),e.qZA())}function Dt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",10)(1,"div",11)(2,"input",12),e.NdJ("change",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.updateEstEnBlackList())})("ngModelChange",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.parametrages.estEnBlackList=i)}),e.qZA(),e.TgZ(3,"label",13),e._uU(4,"Ne pas appara\xeetre sur la liste des contacts pour les parents et les \xe9l\xe8ves"),e.qZA(),e.TgZ(5,"div",14),e._uU(6,"Les parents/\xe9l\xe8ves ne pourront pas vous contacter directement"),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(2),e.Q6J("ngModel",t.parametrages.estEnBlackList)}}function At(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"label",16),e._uU(2,"Signature"),e.qZA(),e.TgZ(3,"ckeditor",17),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.signature.signature=i)}),e.qZA(),e.TgZ(4,"div",18)(5,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.saveSignature())}),e._UZ(6,"i",20),e._uU(7," Enregistrer ma signature "),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(3),e.Q6J("config",t.editorOptions)("ngModel",t.signature.signature)}}function It(n,o){if(1&n&&(e.TgZ(0,"div",7)(1,"div",1),e._uU(2,"Param\xe9trage"),e.qZA(),e.TgZ(3,"div",2),e.YNc(4,Dt,7,1,"div",8),e.YNc(5,At,8,2,"div",9),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("ngIf",t.parametrages.blackListProfActive),e.xp6(1),e.Q6J("ngIf",t.authStore.isProfOuPersonnel())}}function Ut(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",11)(1,"input",24),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.parametrages.disabledNotification=i)})("change",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.updateReceiveNotif())}),e.qZA(),e.TgZ(2,"label",25),e._uU(3,"Ne pas recevoir de notification par e-mail"),e.qZA()()}if(2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngModel",t.parametrages.disabledNotification)}}const se=function(n){return{disabled:n}};function Zt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",26)(1,"input",36),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(4);return e.KtG(a.parametrages.choixMailNotification=i)})("change",function(){e.CHM(t);const i=e.oxw(4);return e.KtG(i.updateChoixMailNotification())}),e.qZA(),e.TgZ(2,"label",37),e._uU(3),e.qZA()()}if(2&n){const t=e.oxw(4);e.Q6J("ngClass",e.VKq(5,se,0===t.parametrages.mailPro.length)),e.xp6(1),e.Q6J("value",1)("disabled",0===t.parametrages.mailPro.length)("ngModel",t.parametrages.choixMailNotification),e.xp6(2),e.hij(" Mail professionnel : ",t.parametrages.mailPro.length>0?t.parametrages.mailPro:"Aucun mail"," ")}}function Nt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",21)(2,"strong"),e._uU(3,"Mail de notification :"),e.qZA(),e.TgZ(4,"div",26)(5,"input",27),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.parametrages.choixMailNotification=i)})("change",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.updateChoixMailNotification())}),e.qZA(),e.TgZ(6,"label",28),e._uU(7),e.qZA()(),e.YNc(8,Zt,4,7,"div",29),e.TgZ(9,"div",11)(10,"input",30),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.parametrages.choixMailNotification=i)})("change",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.updateChoixMailNotification())}),e.qZA(),e.TgZ(11,"label",31),e._uU(12,"Autre :"),e.qZA(),e.TgZ(13,"input",32,33),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.parametrages.autreMailNotification=i)}),e.qZA()()(),e.TgZ(15,"div",18)(16,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.envoyerTestMailNotification())}),e._UZ(17,"i",35),e._uU(18," Recevoir un email de test "),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(4),e.Q6J("ngClass",e.VKq(10,se,0===t.parametrages.mailPerso.length)),e.xp6(1),e.Q6J("value",2)("disabled",0===t.parametrages.mailPerso.length)("ngModel",t.parametrages.choixMailNotification),e.xp6(2),e.hij(" Mail personnel : ",t.parametrages.mailPerso.length>0?t.parametrages.mailPerso:"Aucun mail"," "),e.xp6(1),e.Q6J("ngIf",!t.authStore.isEleve()),e.xp6(2),e.Q6J("value",3)("ngModel",t.parametrages.choixMailNotification),e.xp6(3),e.Q6J("ngModel",t.parametrages.autreMailNotification),e.xp6(3),e.Q6J("disabled",!t.isButtonTestMailNotificationEnabled())}}function wt(n,o){if(1&n&&(e.TgZ(0,"div",7)(1,"div",1),e._uU(2,"Notifications"),e.qZA(),e.TgZ(3,"div",2)(4,"div",21),e.YNc(5,Ut,4,1,"div",22),e.qZA(),e.YNc(6,Nt,19,12,"div",23),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(5),e.Q6J("ngIf",t.parametrages.notificationEmailEtablissement),e.xp6(1),e.Q6J("ngIf",!t.parametrages.disabledNotification&&t.parametrages.notificationEmailEtablissement)}}function Ot(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",39)(1,"div",14),e._uU(2,"Vous pouvez choisir d'activer ou non la r\xe9ception de notifications email et push (application mobile EcoleDirecte)"),e.qZA(),e.TgZ(3,"div",11)(4,"input",40),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.parametrages.droitDeconnexion=i)})("change",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.updateDroitDeconnexion())}),e.qZA(),e.TgZ(5,"label",41),e._uU(6,"Toujours recevoir"),e.qZA()(),e.TgZ(7,"div",11)(8,"input",42),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.parametrages.droitDeconnexion=i)})("change",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.updateDroitDeconnexion())}),e.qZA(),e.TgZ(9,"label",43),e._uU(10,"Ne jamais recevoir"),e.qZA()(),e.TgZ(11,"div",11)(12,"input",44),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(3);return e.KtG(a.parametrages.droitDeconnexion=i)})("change",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.updateDroitDeconnexion())}),e.qZA(),e.TgZ(13,"label",45),e._uU(14,"Activer la r\xe9ception aux horaires suivants"),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(4),e.Q6J("value",0)("ngModel",t.parametrages.droitDeconnexion),e.xp6(4),e.Q6J("value",1)("ngModel",t.parametrages.droitDeconnexion),e.xp6(4),e.Q6J("value",2)("ngModel",t.parametrages.droitDeconnexion)}}function Jt(n,o){if(1&n&&(e.TgZ(0,"th"),e._uU(1),e.qZA()),2&n){const t=o.$implicit;e.xp6(1),e.Oqu(t)}}function kt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"td"),e._uU(1," de "),e.TgZ(2,"input",50),e.NdJ("ngModelChange",function(i){const c=e.CHM(t).$implicit,g=e.oxw(4);return e.KtG(g.parametrages.periodesDroitDeconnexion[c].de=i)})("blur",function(){const a=e.CHM(t).$implicit,c=e.oxw(4);return e.KtG(c.updatePeriodeDroitDeconnexion(a,"de"))}),e.qZA(),e._UZ(3,"br"),e._uU(4," \xe0 "),e.TgZ(5,"input",51),e.NdJ("ngModelChange",function(i){const c=e.CHM(t).$implicit,g=e.oxw(4);return e.KtG(g.parametrages.periodesDroitDeconnexion[c].a=i)})("blur",function(){const a=e.CHM(t).$implicit,c=e.oxw(4);return e.KtG(c.updatePeriodeDroitDeconnexion(a,"a"))}),e.qZA()()}if(2&n){const t=o.$implicit,s=o.index,i=e.oxw(4);e.xp6(2),e.MGl("name","appt-time-de-",s,""),e.Q6J("ngModel",i.parametrages.periodesDroitDeconnexion[t].de),e.xp6(3),e.MGl("name","appt-time-a-",s,""),e.Q6J("ngModel",i.parametrages.periodesDroitDeconnexion[t].a)}}function Pt(n,o){if(1&n&&(e.TgZ(0,"div",15)(1,"div",46)(2,"table",47)(3,"thead")(4,"tr",48),e.YNc(5,Jt,2,1,"th",49),e.ALo(6,"trackByProperty"),e.qZA()(),e.TgZ(7,"tbody")(8,"tr"),e.YNc(9,kt,6,4,"td",49),e.ALo(10,"trackByProperty"),e.qZA()()()()()),2&n){const t=e.oxw(3);e.xp6(5),e.Q6J("ngForOf",t.listOfDays)("ngForTrackBy",e.lcZ(6,4,"$index")),e.xp6(4),e.Q6J("ngForOf",t.listOfDays)("ngForTrackBy",e.lcZ(10,6,"$index"))}}function Ht(n,o){if(1&n&&(e.TgZ(0,"div",7)(1,"div",1),e._uU(2,"Droit \xe0 la d\xe9connexion"),e.qZA(),e.TgZ(3,"div",2),e.YNc(4,Ot,15,6,"div",38),e.YNc(5,Pt,11,8,"div",9),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("ngIf",t.authStore.isProfOuPersonnel()),e.xp6(1),e.Q6J("ngIf",t.authStore.isProfOuPersonnel()&&2===t.parametrages.droitDeconnexion)}}function Ft(n,o){if(1&n&&(e.YNc(0,It,6,2,"div",6),e.YNc(1,wt,7,2,"div",6),e.YNc(2,Ht,6,2,"div",6)),2&n){const t=e.oxw();e.Q6J("ngIf",t.parametrages.blackListProfActive||t.authStore.isProfOuPersonnel()),e.xp6(1),e.Q6J("ngIf",t.parametrages.notificationEmailEtablissement),e.xp6(1),e.Q6J("ngIf",t.authStore.isProfOuPersonnel())}}let Rt=(()=>{class n extends((0,r.kCV)()){constructor(t,s,i,a,c,g){super(),this.authStore=t,this.authService=s,this.messagerieService=i,this.messagerieStore=a,this.messagerieUserStore=c,this.uiService=g,this.listOfDays=r.aA2.semaine,this.parametrages=new r.aA2,this.signature=new r.sdI}set inputAutreMailNotification(t){this._sub&&this._sub.unsubscribe(),Object.isExists(t)&&(this._sub=t.valueChanges.pipe((0,bt.T)(1),(0,X.b)(500),(0,ee.x)(),(0,A.h)(s=>0===s.length||s.length>=5),(0,O.R)(this.componentDestroyed$)).subscribe(s=>this.updateMailAutreNotification()))}ngOnInit(){this.editorOptions={...C.x$,height:200,extraPlugins:"colorbutton,font,base64image,deselect",toolbar:[{name:"basicstyles",items:["Bold","Italic","Strike","Underline"]},{name:"paragraph",items:["BulletedList","NumberedList"]},{name:"editing",items:["JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"styles",items:["FontSize","TextColor","PasteText","PasteFromWord"]},{name:"links",items:["Link","Unlink","base64image"]}],removePlugins:"elementspath",startupFocus:!1},delete this.editorOptions.allowedContent,(0,Ct.a)([this.messagerieStore.select$(),this.messagerieUserStore.select$()]).pipe((0,A.h)(([t,s])=>s.variantDefault&&""!==s.variantDefault),(0,H.U)(([t,s])=>{const i=Object.getEntity(t,s.variantDefault);if(Object.isExists(i)){if(this.signature=new r.sdI(i.signature),this.parametrages=new r.aA2(i.parametrage),!this.parametrages.disabledNotification&&this.parametrages.notificationEmailEtablissement){let a=!1;0===this.parametrages.choixMailNotification&&this.authStore.isFouE()&&(this.parametrages.choixMailNotification=2,a=!0),0===this.parametrages.choixMailNotification&&!this.authStore.isEleve()&&(this.parametrages.choixMailNotification=1,a=!0),a&&this.updateChoixMailNotification(!1)}}else this.parametrages=new r.aA2,this.signature=new r.sdI}),(0,O.R)(this.componentDestroyed$)).subscribe()}isButtonTestMailNotificationEnabled(){return r.FSr.isValidEmail(this.getEmailPourNotification())}getEmailPourNotification(){return 1===this.parametrages.choixMailNotification?this.parametrages.mailPro:2===this.parametrages.choixMailNotification?this.parametrages.mailPerso:3===this.parametrages.choixMailNotification?this.parametrages.autreMailNotification:""}envoyerTestMailNotification(){this.messagerieUserStore.promiseContents=this.messagerieService.envoyerTestMailNotification(this.messagerieUserStore.snapshot.typeUser,this.messagerieUserStore.snapshot.idUser).subscribe(t=>this.uiService.notifyEvent(r.DOJ.genericSuccess,"Email de notification envoy\xe9 avec succ\xe8s \xe0 l'adresse "+this.getEmailPourNotification(),"Messagerie","fa fa-envelope"),t=>this.uiService.notifyEvent(r.DOJ.genericError,t.message,"Erreur","fa fa-envelope"))}updateReceiveNotif(){const t=!0===this.parametrages.disabledNotification?"1":"0",s="0"===t?"activ\xe9e":"d\xe9sactiv\xe9e";this.messagerieUserStore.promiseContents=this.authService.updateParametrageIndividuel(this.messagerieUserStore.snapshot.typeUser,this.messagerieUserStore.snapshot.idUser,"PasDeNotificationEmail",t).subscribe({next:i=>{this.messagerieStore.updateMessagerieStore(this.parametrages,this.messagerieUserStore.snapshot.variantDefault,"",0,"updateParams"),this.uiService.notifyEvent(r.DOJ.genericSuccess,"Notification de mail "+s,"Messagerie","fa fa-envelope")},error:i=>this.uiService.notifyEvent(i.action,"La modification du param\xe9trage a \xe9chou\xe9","Erreur","fa fa-envelope")})}updateEstEnBlackList(){this.messagerieUserStore.promiseContents=this.authService.updateParametrageIndividuel(this.messagerieUserStore.snapshot.typeUser,this.messagerieUserStore.snapshot.idUser,"estEnBlackList",!0===this.parametrages.estEnBlackList?"1":"0").subscribe({next:s=>{this.messagerieStore.updateMessagerieStore(this.parametrages,this.messagerieUserStore.snapshot.variantDefault,"",0,"updateParams"),this.uiService.notifyEvent(r.DOJ.genericSuccess,"Modification prise en compte","Messagerie","fa fa-envelope")},error:s=>this.uiService.notifyEvent(r.DOJ.genericError,"La modification du param\xe9trage a \xe9chou\xe9","Erreur","fa fa-envelope")})}updateChoixMailNotification(t=!0){this.messagerieUserStore.promiseContents=this.authService.updateParametrageIndividuel(this.messagerieUserStore.snapshot.typeUser,this.messagerieUserStore.snapshot.idUser,"NotificationEmailDest",`${this.parametrages.choixMailNotification}`).subscribe({next:s=>{this.messagerieStore.updateMessagerieStore(this.parametrages,this.messagerieUserStore.snapshot.variantDefault,"",0,"updateParams"),!0===t&&this.uiService.notifyEvent(r.DOJ.genericSuccess,"Type de mail de notification mis \xe0 jour","Messagerie","fa fa-envelope")},error:s=>!0===t&&this.uiService.notifyEvent(r.DOJ.genericError,"La modification du param\xe9trage a \xe9chou\xe9","Erreur","fa fa-envelope")})}updateMailAutreNotification(){r.FSr.isValidEmail(this.parametrages.autreMailNotification,!0)?this.messagerieUserStore.promiseContents=this.authService.updateParametrageIndividuel(this.messagerieUserStore.snapshot.typeUser,this.messagerieUserStore.snapshot.idUser,"NotificationEmailAutre",`${this.parametrages.autreMailNotification}`).subscribe(t=>{this.messagerieStore.updateMessagerieStore(this.parametrages,this.messagerieUserStore.snapshot.variantDefault,"",0,"updateParams"),this.uiService.notifyEvent(r.DOJ.genericSuccess,"Le param\xe9trage a \xe9t\xe9 appliqu\xe9 avec succ\xe8s","Messagerie","fa fa-envelope")},t=>this.uiService.notifyEvent(r.DOJ.genericError,"La modification du param\xe9trage a \xe9chou\xe9","Erreur","fa fa-envelope")):this.uiService.notifyEvent(r.DOJ.genericError,"V\xe9rifiez la bonne synthaxe de l'adresse email saisie","Erreur","fa fa-envelope")}saveSignature(){this.signature.signature?this.messagerieUserStore.promiseContents=this.messagerieService.saveSignatureMessage(this.signature).subscribe(t=>this.uiService.notifyEvent(r.DOJ.genericSuccess,"L'enregistrement de votre signature a bien \xe9t\xe9 effectu\xe9","Messagerie","fa fa-envelope"),t=>this.uiService.notifyEvent(r.DOJ.genericError,t.message,"Erreur","fa fa-envelope")):this.uiService.notifyEvent(r.DOJ.genericError,"Saisissez une signature.","Erreur","fa fa-envelope")}updateDroitDeconnexion(){!this.authStore.isProfOuPersonnel()||(this.messagerieUserStore.promiseContents=this.authService.updateParametrageIndividuel(this.messagerieUserStore.snapshot.typeUser,this.messagerieUserStore.snapshot.idUser,"DroitDeconnexion",`${this.parametrages.droitDeconnexion}`).subscribe(t=>{this.messagerieStore.updateMessagerieStore(this.parametrages,this.messagerieUserStore.snapshot.variantDefault,"",0,"updateParams"),this.uiService.notifyEvent(r.DOJ.genericSuccess,"Modification prise en compte","Messagerie","fa fa-envelope")},t=>this.uiService.notifyEvent(r.DOJ.genericError,"La modification du param\xe9trage a \xe9chou\xe9","Erreur","fa fa-envelope")))}updatePeriodeDroitDeconnexion(t,s){if(!this.authStore.isProfOuPersonnel())return;const i=`PeriodesDroitDeconnexion_${t}_${s}`,a=new RegExp("[0-9]{2}:[0-9]{2}");""!==this.parametrages.periodesDroitDeconnexion[t][s]&&!a.test(this.parametrages.periodesDroitDeconnexion[t][s])||""!==this.parametrages.periodesDroitDeconnexion[t].a&&""!==this.parametrages.periodesDroitDeconnexion[t].de&&this.parametrages.periodesDroitDeconnexion[t].de>this.parametrages.periodesDroitDeconnexion[t].a?this.uiService.notifyEvent(r.DOJ.genericError,"La modification du param\xe9trage a \xe9chou\xe9 : v\xe9rifiez la concordance de vos horaires de droit \xe0 la d\xe9connexion.","Messagerie","fa fa-envelope"):this.messagerieUserStore.promiseContents=this.authService.updateParametrageIndividuel(this.messagerieUserStore.snapshot.typeUser,this.messagerieUserStore.snapshot.idUser,i,`${this.parametrages.periodesDroitDeconnexion[t][s]}`).subscribe(c=>{this.messagerieStore.updateMessagerieStore(this.parametrages,this.messagerieUserStore.snapshot.variantDefault,"",0,"updateParams"),this.uiService.notifyEvent(r.DOJ.genericSuccess,"Le param\xe9trage a \xe9t\xe9 appliqu\xe9 avec succ\xe8s","Messagerie","fa fa-envelope")},c=>this.uiService.notifyEvent(r.DOJ.genericError,"La modification du param\xe9trage a \xe9chou\xe9","Erreur","fa fa-envelope"))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(r.CnD),e.Y36(r.e80),e.Y36(r.KRh),e.Y36(r.q0O),e.Y36(Z.C),e.Y36(r.VLf))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-messagerie-parametrages"]],viewQuery:function(t,s){if(1&t&&e.Gf(Tt,5),2&t){let i;e.iGM(i=e.CRH())&&(s.inputAutreMailNotification=i.first)}},features:[e.qOj],decls:8,vars:3,consts:[[1,"card","ed-card",3,"ngBusy"],[1,"card-header"],[1,"card-body"],["type","info",4,"ngIf","ngIfElse"],["parametrage",""],["type","info"],["class","card my-3",4,"ngIf"],[1,"card","my-3"],["class","row gx-1 mb-3",4,"ngIf"],["class","row mb-3",4,"ngIf"],[1,"row","gx-1","mb-3"],[1,"form-check"],["type","checkbox","id","checkListeRouge",1,"form-check-input",3,"ngModel","change","ngModelChange"],["for","checkListeRouge",1,"form-check-label","fw-normal"],[1,"form-text"],[1,"row","mb-3"],["for","signature",1,"form-label"],["id","signature","name","signature",3,"config","ngModel","ngModelChange"],[1,"form-buttons-group","flex-row-reverse"],["type","button","id","btn-save-signature","name","btn-save-signature",1,"btn","btn-primary","col-auto",3,"click"],["aria-hidden","true",1,"icon-ed_save"],[1,"row","mb-3","gx-1"],["class","form-check",4,"ngIf"],[4,"ngIf"],["type","checkbox","name","disabledNotification","id","checkNotifMail",1,"form-check-input",3,"ngModel","ngModelChange","change"],["for","checkNotifMail",1,"form-check-label","fw-normal"],[1,"form-check",3,"ngClass"],["type","radio","name","choixMailNotification","id","choixMailNotification-2",1,"form-check-input",3,"value","disabled","ngModel","ngModelChange","change"],["for","choixMailNotification-2",1,"form-check-label","fw-normal"],["class","form-check",3,"ngClass",4,"ngIf"],["type","radio","name","choixMailNotification","id","choixMailNotification-3",1,"form-check-input","margin-top-10",3,"value","ngModel","ngModelChange","change"],["for","choixMailNotification-3",1,"form-check-label","fw-normal"],["type","email","name","autreMailNotification","id","autreMailNotification","email","","placeholder","prefixe@domaine.xxx","pattern","^[0-9a-z._-]+@{1}[0-9a-z.-]{2,}[.]{1}[a-z]{2,15}$",1,"form-control","w-50","d-inline-block","ms-1",3,"ngModel","ngModelChange"],["inputAutreMailNotification","ngModel"],["id","singlebutton","name","singlebutton","type","button",1,"btn","btn-primary","col-auto",3,"disabled","click"],["aria-hidden","true",1,"fa","fa","fa-envelope-o"],["type","radio","name","choixMailNotification","id","choixMailNotification-1",1,"form-check-input",3,"value","disabled","ngModel","ngModelChange","change"],["for","choixMailNotification-1",1,"form-check-label","fw-normal"],["class","mb-3",4,"ngIf"],[1,"mb-3"],["type","radio","name","radios","id","tjrs",1,"form-check-input",3,"value","ngModel","ngModelChange","change"],["for","tjrs",1,"form-check-label","fw-normal"],["type","radio","name","radios","id","jamais",1,"form-check-input",3,"value","ngModel","ngModelChange","change"],["for","jamais",1,"form-check-label","fw-normal"],["type","radio","name","radios","id","choix",1,"form-check-input",3,"value","ngModel","ngModelChange","change"],["for","choix",1,"form-check-label","fw-normal"],[1,"table-responsive"],[1,"table","text-center","ed-table"],[1,"entete"],[4,"ngFor","ngForOf","ngForTrackBy"],["type","time","step","900","placeholder","HH:mm","pattern","[0-9]{2}:[0-9]{2}",2,"margin-bottom","5px",3,"name","ngModel","ngModelChange","blur"],["type","time","step","900","placeholder","HH:mm","pattern","[0-9]{2}:[0-9]{2}",3,"name","ngModel","ngModelChange","blur"]],template:function(t,s){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3"),e._uU(3,"Param\xe9trage"),e.qZA()(),e.TgZ(4,"div",2),e.YNc(5,yt,2,0,"alert",3),e.YNc(6,Ft,3,3,"ng-template",null,4,e.W1O),e.qZA()()),2&t){const i=e.MAs(7);e.Q6J("ngBusy",s.messagerieUserStore.promiseContents),e.xp6(5),e.Q6J("ngIf",s.authStore.isFouE()&&!s.parametrages.notificationEmailEtablissement)("ngIfElse",i)}},dependencies:[m.mk,m.sg,m.O5,d.Fj,d.Wl,d._,d.JJ,d.c5,d.on,d.On,Et.wx,z.u,Y.DC,w.$],encapsulation:2}),n})();var Lt=l(53569);function qt(n,o){if(1&n&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.AsE("(",t.eleve.prenom," - ",t.eleve.classe.libelle,")")}}const Yt=function(){return["./Compose"]};function Gt(n,o){1&n&&(e.TgZ(0,"button",17),e._UZ(1,"i",18),e._uU(2," Nouveau message "),e.qZA()),2&n&&e.Q6J("routerLink",e.DdM(1,Yt))}function Qt(n,o){if(1&n&&(e.TgZ(0,"span",26),e._uU(1),e.qZA()),2&n){const t=o.ngIf;e.xp6(1),e.Oqu(t)}}function Bt(n,o){if(1&n&&(e.ynx(0),e.YNc(1,Qt,2,1,"span",25),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw(4);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.messagerieUserStore.badge$))}}function Vt(n,o){if(1&n&&(e.TgZ(0,"span",26),e._uU(1),e.qZA()),2&n){const t=e.oxw(4).ngIf;e.xp6(1),e.hij(" ",t.pagination.messagesDraftCount," ")}}function Kt(n,o){if(1&n&&(e.ynx(0),e.YNc(1,Vt,2,1,"span",25),e.BQk()),2&n){const t=e.oxw(3).ngIf;e.xp6(1),e.Q6J("ngIf",t.pagination.messagesDraftCount>0)}}const $t=function(n){return{active:n}};function jt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"li")(1,"button",23),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,a=e.oxw(2);return e.KtG(a.openBox(i.id))}),e._UZ(2,"i",24),e._uU(3),e.YNc(4,Bt,3,3,"ng-container",2),e.YNc(5,Kt,2,1,"ng-container",2),e.qZA()()}if(2&n){const t=e.oxw().$implicit,s=e.oxw(2);e.Tol(e.VKq(6,$t,s.messagerieUserStore.isBoxCurrent(t.id))),e.xp6(2),e.Q6J("ngClass",t.icon),e.xp6(1),e.hij(" ",t.libelle," "),e.xp6(1),e.Q6J("ngIf",t.id===s.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION),e.xp6(1),e.Q6J("ngIf",t.id===s.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_DRAFT)}}function zt(n,o){if(1&n&&(e.ynx(0),e.YNc(1,jt,6,8,"li",22),e.BQk()),2&n){const t=o.$implicit,s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.id!==s.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_DRAFT||t.id===s.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_DRAFT&&s.authStore.isAnneeCourante(s.messagerieUserStore.snapshot.choosenAnnee)&&s.messagerieUserStore.isHimself()&&s.messagerieStore.canWrite())}}function Wt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"li",27)(1,"button",23),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.createClasseur())}),e._UZ(2,"i",28),e._uU(3," Nouveau dossier "),e.qZA()()}}const Xt=function(){return["order|asc"]};function es(n,o){if(1&n&&(e.TgZ(0,"ul",19),e.YNc(1,zt,2,1,"ng-container",20),e.ALo(2,"orderBy"),e.ALo(3,"trackByProperty"),e.YNc(4,Wt,4,0,"li",21),e.qZA()),2&n){const t=o.ngIf,s=e.oxw();e.xp6(1),e.Q6J("ngForOf",e.xi3(2,3,t.inboxList,e.DdM(8,Xt)))("ngForTrackBy",e.lcZ(3,6,"id")),e.xp6(3),e.Q6J("ngIf",s.messagerieUserStore.isHimself()&&s.authStore.isAnneeCourante(s.messagerieUserStore.snapshot.choosenAnnee))}}function ts(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",29)(1,"div",30)(2,"button",31),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openBox(i.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_SETTINGS))}),e._UZ(3,"i",32),e._uU(4," Param\xe9trage "),e.qZA()()()}}function ss(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",33)(1,"div",10)(2,"div",34)(3,"div",35)(4,"ed-messagerie-messages",36),e.NdJ("loadNext",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onLoadNext())})("changeSelected",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.onSelectedMessages(i))})("updateClasseur",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onUpdateClasseur())})("deleteInboxClasseur",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onDeleteInboxClasseur())})("openMessage",function(i){e.CHM(t);const a=e.oxw();return e.KtG(a.openMessage(i))}),e.qZA()()(),e.TgZ(5,"div",37)(6,"div",38),e._UZ(7,"ed-messagerie-message",39),e.ALo(8,"async"),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(4),e.Q6J("currentIdBox",t.messagerieUserStore.currentIdBox)("search",t.search.value),e.xp6(3),e.Q6J("message",t.messagerieUserStore.currentMessage)("messagerie",e.lcZ(8,4,t.messagerieUserStore.messagerie$))}}function is(n,o){1&n&&(e.TgZ(0,"div",40),e._UZ(1,"ed-messagerie-parametrages"),e.qZA())}const as=[{path:"",component:(()=>{class n extends((0,r.kCV)()){constructor(t,s,i,a,c,g,u,S,p,_){super(),this.activatedRoute=t,this.authStore=s,this.loaderService=i,this.messagerieStore=a,this.messagerieService=c,this.messagerieUserStore=g,this.modalService=u,this.router=S,this.route=p,this.uiService=_,this._messagesSelected=new Ne.X([]),this.search=new d.NI(""),this.ID_DOSSIER_MESSAGERIE=r.tHm.ID_DOSSIER_MESSAGERIE,this.messagesSelected$=this._messagesSelected.asObservable()}ngOnDestroy(){return this.onSelectedMessages([]),this._messagesSelected.complete(),super.ngOnDestroy()}ngOnInit(){this.activatedRoute.paramMap.pipe((0,M.b)(t=>this.afterRouteUpdated(t)),(0,O.R)(this.componentDestroyed$)).subscribe(),this.messagerieUserStore.select$().pipe((0,v.q)(2),(0,A.h)(t=>r.FSr.isNotEmptyString(t.variantDefault)),(0,E.w)(t=>(0,P.of)(this.activatedRoute.snapshot.queryParamMap)),(0,H.U)(t=>+t.get("messageId")),(0,A.h)(t=>t>0&&this.messagerieStore.hasMessage(this.mUser.variantDefault,this.mUser.choosenAnnee,t,r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION)),(0,M.b)(t=>{this.messagerieUserStore.currentMessage=new r.s2V(this.messagerieStore.getMessage(this.mUser.variantDefault,this.mUser.choosenAnnee,t,r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION)),this.openBox(r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION),this.openMessage(this.messagerieUserStore.currentMessage)})).subscribe(),this.search.valueChanges.pipe((0,X.b)(500),(0,ee.x)(),(0,A.h)(t=>0===t.length||t.length>=3),(0,M.b)(t=>this.doRefreshMessages(!0,!1,!1)),(0,O.R)(this.componentDestroyed$)).subscribe()}get mUser(){return this.messagerieUserStore.snapshot}afterRouteUpdated(t){const s=t.get("typeUser")!==this.messagerieUserStore.snapshot.typeUser||+t.get("idUser")!==this.messagerieUserStore.snapshot.idUser;let i;this.messagerieUserStore.updateStore(this.authStore.currentUser.codeOgec,t.get("typeUser"),+t.get("idUser"),this.authStore.currentUser.anneeScolaireCourante),this.messagerieUserStore.onChanges(s),i=this.authStore.isFamille()&&this.mUser.typeUser===r.dcH.ELEVE?this.authStore.getEleve(this.mUser.idUser):(0,P.of)(null),i.subscribe(a=>{this.eleve=Object.isExists(a)?new r.Dfc(a):a,this.search.patchValue("",{emitEvent:!1}),this.doRefreshMessages(!1)})}onLoadNext(){const t=this.messagerieStore.getLastPageLoaded(this.mUser.variantDefault,this.mUser.choosenAnnee,this.messagerieUserStore.currentIdBox),i=this.messagerieUserStore.currentPage+1;i>t&&this.doRefreshMessages(!0,!1,!0,i)}doRefreshMessages(t,s=!0,i=!0,a=0,c=!1){t&&c&&this.messagerieUserStore.onChanges(!0),0===a&&(this.loader=this.loaderService.show(this)),0===a&&Object.isExists(this.edVsMessages)&&this.edVsMessages.scrollToTop(),this.messagerieUserStore.promiseContents=(0,we.D)([this.messagerieService.getMessages(this.mUser.typeUser,this.mUser.idUser,this.mUser.choosenAnnee,this.messagerieUserStore.currentIdBox,t,i,{query:this.search.value,page:a}).pipe((0,G.d)(void 0)),s&&this.authStore.isProfOuPersonnel()?this.messagerieService.getSignatureMessage(t).pipe((0,G.d)(void 0)):(0,P.of)(void 0)]).pipe((0,T.K)(u=>this.uiService.notifyErrorThenEmpty(u,!0,"Erreur","fa fa-envelope")),(0,D.x)(()=>{if(Object.isExists(this.messagerieUserStore.currentMessage))if(this.messagerieStore.hasMessageFromMessage(this.mUser.variantDefault,this.mUser.choosenAnnee,this.messagerieUserStore.currentMessage)){const u=this.messagerieUserStore.currentMessage;this.messagerieUserStore.currentMessage=void 0,this.openMessage(u)}else this.messagerieUserStore.currentMessage=void 0;this.onSelectedMessages([]),0===a&&this.loaderService.hide(this)})).subscribe()}openBox(t){this.messagerieUserStore.currentIdBox!==t&&(this._messagesSelected.value.length>0&&this.onSelectedMessages([]),this.messagerieUserStore.currentIdBox=t,this.messagerieUserStore.currentMessage=void 0,this.search.patchValue("",{emitEvent:!1}),this.doRefreshMessages(!1,!1))}openMessage(t){!0!==t.brouillon?this.messagerieUserStore.isCurrentMessage(t)||(this.messagerieUserStore.promiseContents=this.messagerieService.getMessage(this.mUser.typeUser,this.mUser.idUser,this.mUser.choosenAnnee,t).pipe((0,G.d)(void 0),(0,M.b)(s=>{this.messagerieUserStore.currentMessage=new r.s2V(this.messagerieStore.getMessageFromMessage(this.mUser.variantDefault,this.mUser.choosenAnnee,t)),this._messagesSelected.value.length>0&&this.onSelectedMessages([])}),(0,T.K)(s=>(this.messagerieUserStore.currentMessage=void 0,this.uiService.notifyErrorThenEmpty(s,!0,"Erreur","fa fa-envelope")))).subscribe()):this.router.navigate(["./Compose"],{queryParams:{idMessage:t.id,idDossier:r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_DRAFT},relativeTo:this.route}).catch(()=>console.error("draft list navigate to /Compose"))}createClasseur(){this.modalService.show(U.I,{id:this.modalService.getModalsCount()+1,initialState:{title:"Nouveau dossier",message:"Nom du dossier \xe0 cr\xe9er"}}),this.modalService.onHide.pipe((0,v.q)(1),(0,E.w)(t=>{const s=U.I.afterClosed(t);if(this.messagerieUserStore.promiseContents=this.loaderService.show(this),s&&s.error)this.uiService.notifyEvent(r.DOJ.genericError,s.error);else if(s&&s.reason===y.G.validation)return this.messagerieService.createClasseur(this.mUser.variantDefault,this.mUser.choosenAnnee,s.saisie).pipe((0,M.b)(i=>this.uiService.notifyEvent(r.DOJ.genericSuccess,"Le dossier a \xe9t\xe9 ajout\xe9 avec succ\xe8s","Messagerie","fa fa-envelope")));return b.E}),(0,D.x)(()=>this.loaderService.hide(this)),(0,T.K)(t=>(this.uiService.notifyEvent(r.DOJ.genericError,"Cr\xe9ation du dossier impossible","Erreur","fa fa-envelope"),b.E))).subscribe()}onMarkMessagesAsUnread(){this.messagerieUserStore.promiseContents=this.messagerieService.markMessagesAsUnread(this.mUser.typeUser,this.mUser.idUser,this.mUser.choosenAnnee,this._messagesSelected.value.filter(t=>!0===t.read)).subscribe({next:t=>{this.uiService.notifyEvent(r.DOJ.genericSuccess,this._messagesSelected.value.length>1?"Vos messages ont bien \xe9t\xe9 marqu\xe9s comme non lus":"Votre message a bien \xe9t\xe9 marqu\xe9 comme non lu",this._messagesSelected.value.length>1?"Messages non lus":"Message non lu","fa fa-envelope"),this.onSelectedMessages([]),this.messagerieUserStore.currentMessage=void 0},error:t=>this.uiService.notifyEvent(t.action,t.message,"Erreur","fa fa-envelope")})}onArchiveMessages(){this.messagerieUserStore.promiseContents=this.messagerieService.archiveMessages(this.mUser.typeUser,this.mUser.idUser,this.mUser.choosenAnnee,this._messagesSelected.value).subscribe({next:t=>{this.uiService.notifyEvent(r.DOJ.genericSuccess,this._messagesSelected.value.length>1?"Vos messages ont bien \xe9t\xe9 archiv\xe9s":"Votre message a bien \xe9t\xe9 archiv\xe9",this._messagesSelected.value.length>1?"Messages archiv\xe9s":"Message archiv\xe9","fa fa-envelope"),this.onSelectedMessages([]),this.messagerieUserStore.currentMessage=void 0},error:t=>this.uiService.notifyEvent(t.action,t.message,"Erreur","fa fa-envelope")})}onUnArchiveMessages(){this.messagerieUserStore.promiseContents=this.messagerieService.unArchiveMessages(this.mUser.typeUser,this.mUser.idUser,this.mUser.choosenAnnee,this._messagesSelected.value).subscribe({next:t=>{this.uiService.notifyEvent(r.DOJ.genericSuccess,this._messagesSelected.value.length>1?"Vos messages sont de retour dans votre boite de r\xe9ception":"Message de retour dans votre boite de r\xe9ception",this._messagesSelected.value.length>1?"Messages d\xe9sarchiv\xe9s":"Message d\xe9sarchiv\xe9","fa fa-envelope"),this.onSelectedMessages([]),this.messagerieUserStore.currentMessage=void 0},error:t=>this.uiService.notifyEvent(t.action,t.message,"Erreur","fa fa-envelope")})}onSupprimerMessages(){let t="\xcates-vous s\xfbr de vouloir supprimer <strong>d\xe9finitivement</strong> ";t+=this._messagesSelected.value.length>1?`ces <strong>${this._messagesSelected.value.length}</strong> messages ?`:"ce message ?";const s={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:"Suppression des messages",message:t}};this.modalService.show(k.z,s),this.modalService.onHide.pipe((0,v.q)(1),(0,A.h)(i=>i===y.G.validation),(0,E.w)(i=>(this.messagerieUserStore.promiseContents=this.loaderService.show(this),this.messagerieService.supprimerOuAnnulerMessages(this.mUser.typeUser,this.mUser.idUser,this.mUser.choosenAnnee,this.messagerieUserStore.currentIdBox,this._messagesSelected.value))),(0,M.b)(i=>{this.uiService.notifyEvent(r.DOJ.genericSuccess,this._messagesSelected.value.length>1?"Vos messages ont bien \xe9t\xe9 supprim\xe9s":"Votre message a bien \xe9t\xe9 supprim\xe9",this._messagesSelected.value.length>1?"Messages supprim\xe9s":"Message supprim\xe9","fa fa-envelope"),this.onSelectedMessages([]),this.messagerieUserStore.currentMessage=void 0}),(0,D.x)(()=>this.loaderService.hide(this)),(0,T.K)(i=>this.uiService.notifyErrorThenEmpty(i,!0,"Erreur","fa fa-envelope"))).subscribe()}onDeplacerMessages(t){this.messagerieUserStore.promiseContents=this.messagerieService.deplacerMessages(this.mUser.typeUser,this.mUser.idUser,this.mUser.choosenAnnee,this._messagesSelected.value,t).subscribe({next:s=>{this.uiService.notifyEvent(r.DOJ.genericSuccess,"Le d\xe9placement a \xe9t\xe9 effectu\xe9 avec succ\xe8s","D\xe9placement","fa fa-envelope"),this.onSelectedMessages([]),this.messagerieUserStore.currentMessage=void 0},error:s=>this.uiService.notifyEvent(s.action,s.message,"Erreur","fa fa-envelope")})}onSelectedMessages(t){this._messagesSelected.next(t)}onUpdateClasseur(){const t=this.messagerieStore.getInbox(this.mUser.variantDefault,this.mUser.choosenAnnee,this.messagerieUserStore.currentIdBox);this.modalService.show(U.I,{id:this.modalService.getModalsCount()+1,initialState:{title:"Renommer le dossier",message:"Nom du dossier",initialValue:t.libelle}}),this.modalService.onHide.pipe((0,v.q)(1),(0,E.w)(s=>{const i=U.I.afterClosed(s);if(this.messagerieUserStore.promiseContents=this.loaderService.show(this),i&&i.error)this.uiService.notifyEvent(r.DOJ.genericError,i.error);else if(i&&i.reason===y.G.validation)return this.messagerieService.updateClasseur(this.mUser.variantDefault,this.mUser.choosenAnnee,{...t,libelle:i.saisie}).pipe((0,M.b)(a=>this.uiService.notifyEvent(r.DOJ.genericSuccess,"Le dossier a \xe9t\xe9 renomm\xe9 avec succ\xe8s","Messagerie","fa fa-envelope")));return b.E}),(0,D.x)(()=>this.loaderService.hide(this)),(0,T.K)(s=>(this.uiService.notifyEvent(r.DOJ.genericError,"La modification du dossier a \xe9chou\xe9","Erreur","fa fa-envelope"),b.E))).subscribe()}onDeleteInboxClasseur(){const t=this.messagerieStore.getInbox(this.mUser.variantDefault,this.mUser.choosenAnnee,this.messagerieUserStore.currentIdBox);this.modalService.show(k.z,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:"Supprimer le dossier",message:`\xcates-vous s\xfbr de vouloir supprimer le dossier <b>${t.libelle}</b> ?`,btnConfirm:"Supprimer",btnCancel:"Annuler"}}),this.modalService.onHide.pipe((0,v.q)(1),(0,A.h)(s=>s===y.G.validation),(0,E.w)(s=>(this.messagerieUserStore.promiseContents=this.loaderService.show(this),this.messagerieService.deleteClasseur(this.mUser.variantDefault,this.mUser.choosenAnnee,t))),(0,M.b)(s=>{this.uiService.notifyEvent(r.DOJ.genericSuccess,"Le dossier a \xe9t\xe9 supprim\xe9 avec succ\xe8s","Messagerie","fa fa-envelope"),this.openBox(r.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION)}),(0,D.x)(()=>this.loaderService.hide(this)),(0,T.K)(s=>(this.uiService.notifyEvent(r.DOJ.genericError,"La suppression du dossier a \xe9chou\xe9","Erreur","fa fa-envelope"),b.E))).subscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(h.gz),e.Y36(r.CnD),e.Y36($.S),e.Y36(r.q0O),e.Y36(r.KRh),e.Y36(Z.C),e.Y36(j.tT),e.Y36(h.F0),e.Y36(h.gz),e.Y36(r.VLf))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-messagerie"]],viewQuery:function(t,s){if(1&t&&e.Gf(te,5),2&t){let i;e.iGM(i=e.CRH())&&(s.edVsMessages=i.first)}},features:[e.qOj],decls:22,vars:15,consts:[[1,"ed-container","double-padding","page-messagerie"],[1,"entete-page"],[4,"ngIf"],[1,"messagerie-options"],[3,"messagerie","messagesSelected","markMessagesAsUnread","archiveMessages","unArchiveMessages","supprimerMessages","deplacerMessages","refreshMessages"],["title","Rechercher dans les messages","novalidate","","role","search"],["id","search-message","placeholder","Rechercher","title","Rechercher dans les messages","type","search",1,"form-control-sm",3,"formControl"],["type","submit","title","Lancer la recherche",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-search"],[1,"container-bg","simple-padding"],[1,"row"],[1,"col-md-3","col-lg-3","col-xl-2","inbox","sticky"],["class","btn btn-compose btn-primary",3,"routerLink",4,"ngIf"],["class","inbox-nav",4,"ngIf"],["class","inbox-others",4,"ngIf"],["class","col-md-9 col-lg-9 col-xl-10 messages",4,"ngIf"],["class","col-md-9 col-lg-10 col-xl-10 messagerie-parametrage",4,"ngIf"],[1,"btn","btn-compose","btn-primary",3,"routerLink"],["aria-hidden","true",1,"fa","fa-pencil"],[1,"inbox-nav"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","new-classeur",4,"ngIf"],[3,"class",4,"ngIf"],["type","button",1,"btn","btn-link",3,"click"],["aria-hidden","true",1,"fa",3,"ngClass"],["class","badge alert-danger",4,"ngIf"],[1,"badge","alert-danger"],[1,"new-classeur"],["aria-hidden","true",1,"fa","fa-plus-circle"],[1,"inbox-others"],[1,"btn-group","btn-group-sm"],["title","Param\xe9trage",1,"btn","btn-params","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-cog"],[1,"col-md-9","col-lg-9","col-xl-10","messages"],[1,"col-md-5","col-lg-5","col-xl-4","py-3"],[1,"messages-listing","selected-message"],[3,"currentIdBox","search","loadNext","changeSelected","updateClasseur","deleteInboxClasseur","openMessage"],[1,"col-md-7","col-lg-7","col-xl-8"],[1,"message-detail"],[3,"message","messagerie"],[1,"col-md-9","col-lg-10","col-xl-10","messagerie-parametrage"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"header",1)(2,"h2"),e._uU(3," Messagerie "),e.YNc(4,qt,2,2,"small",2),e.qZA(),e.TgZ(5,"div",3)(6,"ed-messagerie-header",4),e.NdJ("markMessagesAsUnread",function(){return s.onMarkMessagesAsUnread()})("archiveMessages",function(){return s.onArchiveMessages()})("unArchiveMessages",function(){return s.onUnArchiveMessages()})("supprimerMessages",function(){return s.onSupprimerMessages()})("deplacerMessages",function(a){return s.onDeplacerMessages(a)})("refreshMessages",function(a){return s.doRefreshMessages(!0,!0,!0,0,a)}),e.ALo(7,"async"),e.ALo(8,"async"),e.TgZ(9,"form",5),e._UZ(10,"input",6),e.TgZ(11,"button",7),e.NdJ("click",function(){return s.doRefreshMessages(!0,!1,!1)}),e._UZ(12,"i",8),e.qZA()()()()(),e.TgZ(13,"div",9)(14,"div",10)(15,"div",11),e.YNc(16,Gt,3,2,"button",12),e.YNc(17,es,5,9,"ul",13),e.ALo(18,"async"),e.YNc(19,ts,5,0,"div",14),e.qZA(),e.YNc(20,ss,9,6,"div",15),e.YNc(21,is,2,0,"div",16),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("ngIf",s.eleve),e.xp6(2),e.Q6J("messagerie",e.lcZ(7,9,s.messagerieUserStore.messagerie$))("messagesSelected",e.lcZ(8,11,s.messagesSelected$)),e.xp6(4),e.Q6J("formControl",s.search),e.xp6(6),e.Q6J("ngIf",s.messagerieUserStore.isHimself()&&s.messagerieStore.canWrite()),e.xp6(1),e.Q6J("ngIf",e.lcZ(18,13,s.messagerieUserStore.messagerie$)),e.xp6(2),e.Q6J("ngIf",s.messagerieUserStore.isHimself()),e.xp6(1),e.Q6J("ngIf",!s.messagerieUserStore.isBoxCurrent(s.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_SETTINGS)),e.xp6(1),e.Q6J("ngIf",s.messagerieUserStore.isBoxCurrent(s.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_SETTINGS)))},dependencies:[m.mk,m.sg,m.O5,d._Y,d.Fj,d.JJ,d.JL,d.F,d.oH,h.rH,xt,Rt,Lt.q,te,m.Ov,r.d0N,w.$],styles:['@charset "UTF-8";.page-messagerie .entete-page{align-items:center}.page-messagerie .messagerie-options{flex:1;margin:0 0 0 20px}.page-messagerie .refresh .btn{color:var(--light-primary-color)}.page-messagerie .search{position:relative}.page-messagerie .search input{width:100%;border:1px solid var(--smalldark-placeholder-color);height:33px}.page-messagerie .search button{position:absolute;top:0;right:0;color:var(--light-primary-color)}.page-messagerie .inbox .btn-compose{margin:40px 0}.page-messagerie .inbox-nav:first-child{margin-top:20px}.page-messagerie .inbox-nav:last-child{margin-bottom:20px}.page-messagerie .inbox-nav li{padding:10px 5px}.page-messagerie .inbox-nav li:hover{background:var(--menu-hover-color)}.page-messagerie .inbox-nav li.active{position:relative;background:var(--smalldark-placeholder-color);font-weight:700}.page-messagerie .inbox-nav li.active:after{content:"";position:absolute;bottom:0;left:0;right:0;height:1px}.page-messagerie .inbox-nav li button{position:relative;width:100%}.page-messagerie .badge{position:absolute;top:5px;right:0}.page-messagerie .badge.alert-danger{font-size:10px;margin-right:5px}.page-messagerie .inbox-others .btn-params{display:block;margin:0}.page-messagerie .inbox-nav button i.fa{font-size:18px}.page-messagerie .messages-listing{background:#fff;overflow-y:inherit;right:10px}.page-messagerie .messages-listing h3{padding:0 5px}.page-messagerie .messages-listing .btns-classeur{text-align:right}.page-messagerie .messages-listing .btns-classeur span{display:inline-block}.page-messagerie .messages-listing .btns-classeur .btn:disabled{opacity:.25}.page-messagerie virtual-scroller{height:calc(90vh - 200px)}.page-messagerie .un-message{display:table;margin-right:-20px;padding:5px;border-radius:5px;transform:all .5s;opacity:.8;min-height:76px;height:76px;width:100%}.page-messagerie .un-message.unread{margin-right:-20px;opacity:1;border-left:4px solid #0c9ed0;border-radius:0}.page-messagerie .un-message.active,.page-messagerie .un-message:hover{margin-right:-20px;background:var(--light-placeholder-color);opacity:1}.page-messagerie .un-message.active:hover{background:var(--light-placeholder-color);opacity:1}.page-messagerie .messages-listing h3 input,.page-messagerie .ckbox{margin:0 10px 0 0}.page-messagerie .media,.page-messagerie .media p{margin:0}.page-messagerie .media-attach i{margin:0 10px 0 0}.page-messagerie .unread .subject{color:#289ecd;font-weight:700}.page-messagerie .messages-listing h5{font-size:1rem}.page-messagerie .message-detail{margin:10px 0;padding:10px 20px 0;height:calc(100vh - 220px);overflow-y:auto;background-color:var(--light-placeholder-color);border-radius:9px}.page-messagerie .inbox-others{margin-top:10px}.messagerie-parametrage .card.ed-card{box-shadow:none;margin:0;border:0 none}@media screen and (max-width: 767px){virtual-scroller,.page-messagerie .messages-listing{height:300px}.page-messagerie .inbox-nav li{margin:0}.page-messagerie .message-detail{height:auto}}\n'],encapsulation:2}),n})(),resolve:{etablissementStoreThreadReady:l(584).n}},{path:"Compose",component:Ze,canDeactivate:[L.I]}];let os=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[h.Bz.forChild(as),h.Bz]}),n})();var cs=l(13666);let ls=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[cs.L,F.m,os,R.Q,I.Lr]}),n})()}}]);