"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[3569],{5402:(Me,U,_)=>{_.d(U,{C:()=>v});var A=_(70655),o=_(45007),C=_(39841),Z=_(39300),I=_(54004),x=_(94650);let v=class extends o.yh4{constructor(e,h,f,M){super(e),this.devTool=e,this.authStore=h,this.badgesStore=f,this.messagerieStore=M,this.onChanges(),this.messagerie$=(0,C.a)([this.messagerieStore.select$(),this.select$()]).pipe((0,Z.h)(([u,t])=>t.variantDefault&&""!==t.variantDefault),(0,I.U)(([u,t])=>{const S=this.messagerieStore.getMessagerie(t.variantDefault,t.choosenAnnee);return new o.xkM(S)}),o.z43),this.badge$=(0,C.a)([this.badgesStore.select$(),this.select$()]).pipe((0,Z.h)(([u,t])=>t.idUser>0),(0,I.U)(([u,t])=>u.getBadgeFromModule(o.qzA.MESSAGERIE,t.idUser,o.o2q[t.typeUser])))}get currentPage(){return this.snapshot.pagination[this.currentIdBox]?this.snapshot.pagination[this.currentIdBox]:0}updateStore(e,h,f,M){const u=o.$ej.edDBUserSpecificKey(e,h,f);this.store=new o.SnS({variantDefault:u,typeUser:h,idUser:f,choosenAnnee:M})}updateChoosenAnnee(e){this.store=new o.SnS({...this.snapshot,choosenAnnee:e})}updateCurrentPage(e){let h={...this.snapshot.pagination};h[this.currentIdBox]=e,this.store=new o.SnS({...this.snapshot,pagination:h})}onChanges(e=!1){(!Object.isExists(this.currentIdBox)||e)&&(this.currentIdBox=o.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION),this.currentMessage=void 0}getIconTypeUser(e){const h=o.FSr.getIconTypePersonne(e.role);return`icon-ed_${h} text-${h}`}isHimself(){return this.authStore.isHimself(this.snapshot.typeUser,this.snapshot.idUser)}getAnneesMessagesArchive(){return this.authStore.getAnneesArchive(1)}isBoxCurrent(e){return e===this.currentIdBox}isCurrentMessage(e){return Object.isExists(e)&&Object.isExists(this.currentMessage)&&this.currentMessage.id===e.id&&this.currentMessage.idDossier===e.idDossier&&this.currentMessage.idClasseur===e.idClasseur}reset(){this.onChanges(),super.reset()}};v.\u0275fac=function(e){return new(e||v)(x.LFG(o.lbX),x.LFG(o.CnD),x.LFG(o.et7),x.LFG(o.q0O))},v.\u0275prov=x.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v=(0,A.gn)([(0,o.pcA)({classInstanceRef:o.SnS,resetWhenSwipe:!0,className:"MessagerieUserStore"})],v)},50532:(Me,U,_)=>{_.d(U,{N:()=>ye});var A=_(77579),o=_(45007),C=_(24006),Z=_(68675),I=_(78372),x=_(71884),v=_(54004),O=_(82722),e=_(94650),h=_(20388),f=_(36895),M=_(55253),u=_(4602),t=_(93970),S=_(34414),E=_(34331);function F(i,c){1&i&&(e.TgZ(0,"tr"),e._UZ(1,"th"),e.TgZ(2,"th",3),e._uU(3,"Nom"),e.qZA(),e.TgZ(4,"th"),e._uU(5,"Mati\xe8re"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Professeur Principal"),e.qZA()())}const D=function(i){return{"fa fa-check":i}};function N(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"tr")(1,"td",4)(2,"button",5),e.NdJ("click",function(){const d=e.CHM(s).item,b=e.oxw();return e.KtG(b.removeEnseignant.emit(d))}),e._UZ(3,"i",6),e.qZA()(),e.TgZ(4,"td"),e._uU(5),e.ALo(6,"displayNom"),e.qZA(),e.TgZ(7,"td",7),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._UZ(10,"i",8),e.qZA()()}if(2&i){const s=c.item,r=e.oxw();e.xp6(5),e.Oqu(e.gM2(6,3,s,!0,!0,r.authStore.isFouE())),e.xp6(3),e.Oqu(r.displayMatiere(s,s.classe)),e.xp6(2),e.Q6J("ngClass",e.VKq(8,D,s.isPP))}}const L=function(){return["nom|asc"]};let R=(()=>{class i{constructor(s){this.authStore=s,this.removeEnseignant=new e.vpe}displayMatiere(s,r){return o.tHm.displayMatiere(s,r)}trackByFn(){return(new u.$).transform("value.id")}}return i.\u0275fac=function(s){return new(s||i)(e.Y36(o.CnD))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-csl-enseignants"]],inputs:{destinataires:"destinataires"},outputs:{removeEnseignant:"removeEnseignant"},decls:4,vars:7,consts:[["cssCustom","liste-destinataires-message",3,"datas","pagination","trackByFn"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],["stSort","nom",1,"cliquable","sortable-header"],["title","Retirer le destinataire"],["type","button","aria-label","Retirer le destinataire",1,"btn","btn-danger","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],[1,"specialEnseignantBreakSpaces"],["aria-label","ic\xf4ne permettant de savoir si l'enseignant est prof principal",3,"ngClass"]],template:function(s,r){1&s&&(e.TgZ(0,"ed-smart-table",0),e.ALo(1,"orderBy"),e.YNc(2,F,8,0,"ng-template",1),e.YNc(3,N,11,10,"ng-template",2),e.qZA()),2&s&&e.Q6J("datas",e.xi3(1,3,r.destinataires,e.DdM(6,L)))("pagination",!1)("trackByFn",r.trackByFn)},dependencies:[f.mk,t.L,S.c,E.r,E.w,o.$t3,o.d0N],encapsulation:2}),i})();function w(i,c){1&i&&(e.TgZ(0,"tr"),e._UZ(1,"th"),e.TgZ(2,"th",3),e._uU(3,"Nom"),e.qZA(),e.TgZ(4,"th"),e._uU(5,"Fonction"),e.qZA()())}function B(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"tr")(1,"td",4)(2,"button",5),e.NdJ("click",function(){const d=e.CHM(s).item,b=e.oxw();return e.KtG(b.removePersonnel.emit(d))}),e._UZ(3,"i",6),e.qZA()(),e.TgZ(4,"td"),e._uU(5),e.ALo(6,"displayNom"),e.qZA(),e.TgZ(7,"td",7),e._uU(8),e.qZA()()}if(2&i){const s=c.item,r=e.oxw();e.xp6(5),e.Oqu(e.gM2(6,2,s,!0,!0,r.authStore.isFouE())),e.xp6(3),e.Oqu(s.fonction.libelle)}}const J=function(){return["nom|asc"]};let k=(()=>{class i{constructor(s){this.authStore=s,this.removePersonnel=new e.vpe}trackByFn(){return(new u.$).transform("value.id")}}return i.\u0275fac=function(s){return new(s||i)(e.Y36(o.CnD))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-csl-personnels"]],inputs:{destinataires:"destinataires"},outputs:{removePersonnel:"removePersonnel"},decls:4,vars:7,consts:[["cssCustom","liste-destinataires-message",3,"datas","pagination","trackByFn"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],["stSort","nom",1,"cliquable","sortable-header"],["title","Retirer le destinataire"],["type","button","aria-label","Retirer le destinataire",1,"btn","btn-danger","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],[1,"width100"]],template:function(s,r){1&s&&(e.TgZ(0,"ed-smart-table",0),e.ALo(1,"orderBy"),e.YNc(2,w,6,0,"ng-template",1),e.YNc(3,B,9,7,"ng-template",2),e.qZA()),2&s&&e.Q6J("datas",e.xi3(1,3,r.destinataires,e.DdM(6,J)))("pagination",!1)("trackByFn",r.trackByFn)},dependencies:[t.L,S.c,E.r,E.w,o.$t3,o.d0N],encapsulation:2}),i})();function q(i,c){1&i&&(e.TgZ(0,"th"),e._uU(1,"Mati\xe8re"),e.qZA())}function H(i,c){if(1&i&&(e.TgZ(0,"tr"),e._UZ(1,"th"),e.TgZ(2,"th",3),e._uU(3,"Nom"),e.qZA(),e.YNc(4,q,2,0,"th",4),e.TgZ(5,"th"),e._uU(6,"Classe"),e.qZA()()),2&i){const s=e.oxw();e.xp6(4),e.Q6J("ngIf",s.authStore.isProfesseur())}}function Y(i,c){if(1&i&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&i){const s=e.oxw().item;e.xp6(1),e.Oqu(s.matiere)}}function Q(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"tr")(1,"td",5)(2,"button",6),e.NdJ("click",function(){const d=e.CHM(s).item,b=e.oxw();return e.KtG(b.removeEleve.emit(d))}),e._UZ(3,"i",7),e.qZA()(),e.TgZ(4,"td"),e._uU(5),e.ALo(6,"displayNom"),e.qZA(),e.YNc(7,Y,2,1,"td",4),e.TgZ(8,"td",8),e._uU(9),e.qZA()()}if(2&i){const s=c.item,r=e.oxw();e.xp6(5),e.Oqu(e.xi3(6,3,s,!0)),e.xp6(2),e.Q6J("ngIf",r.authStore.isProfesseur()),e.xp6(2),e.Oqu(s.classe.libelle)}}const G=function(){return["nom|asc"]};let K=(()=>{class i{constructor(s){this.authStore=s,this.removeEleve=new e.vpe}trackByFn(){return(new u.$).transform("value.id")}}return i.\u0275fac=function(s){return new(s||i)(e.Y36(o.CnD))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-csl-eleves"]],inputs:{destinataires:"destinataires"},outputs:{removeEleve:"removeEleve"},decls:4,vars:7,consts:[["cssCustom","liste-destinataires-message",3,"datas","pagination","trackByFn"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],["stSort","nom",1,"cliquable","sortable-header"],[4,"ngIf"],["title","Retirer le destinataire"],["type","button","aria-label","Retirer le destinataire",1,"btn","btn-danger","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],[1,"width100"]],template:function(s,r){1&s&&(e.TgZ(0,"ed-smart-table",0),e.ALo(1,"orderBy"),e.YNc(2,H,7,1,"ng-template",1),e.YNc(3,Q,10,6,"ng-template",2),e.qZA()),2&s&&e.Q6J("datas",e.xi3(1,3,r.destinataires,e.DdM(6,G)))("pagination",!1)("trackByFn",r.trackByFn)},dependencies:[f.O5,t.L,S.c,E.r,E.w,o.$t3,o.d0N],encapsulation:2}),i})();function W(i,c){1&i&&(e.TgZ(0,"th"),e._uU(1,"Mati\xe8re"),e.qZA())}function $(i,c){if(1&i&&(e.TgZ(0,"tr"),e._UZ(1,"th"),e.TgZ(2,"th",3),e._uU(3,"\xc9l\xe8ve"),e.qZA(),e.TgZ(4,"th"),e._uU(5,"Classe"),e.qZA(),e.YNc(6,W,2,0,"th",4),e.TgZ(7,"th"),e._uU(8,"Parent"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Responsable principal"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Autorit\xe9 parentale"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Autre"),e.qZA()()),2&i){const s=e.oxw();e.xp6(6),e.Q6J("ngIf",s.authStore.isProfesseur())}}function j(i,c){if(1&i&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&i){const s=e.oxw().item;e.xp6(1),e.Oqu(null==s.eleve?null:s.eleve.matiere)}}function V(i,c){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const s=c.$implicit;e.xp6(1),e.Oqu(s)}}function z(i,c){1&i&&e._UZ(0,"i",14)}function X(i,c){1&i&&e._UZ(0,"i",15)}function ee(i,c){1&i&&e._UZ(0,"i",16)}function te(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"tr")(1,"td",5)(2,"button",6),e.NdJ("click",function(){const d=e.CHM(s).item,b=e.oxw();return e.KtG(b.removeFamille.emit(d))}),e._UZ(3,"i",7),e.qZA()(),e.TgZ(4,"td"),e._uU(5),e.ALo(6,"displayNom"),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.YNc(9,j,2,1,"td",4),e.TgZ(10,"td")(11,"ul"),e.YNc(12,V,2,1,"li",8),e.ALo(13,"trackByProperty"),e.qZA()(),e.TgZ(14,"td",9),e.YNc(15,z,1,0,"i",10),e.qZA(),e.TgZ(16,"td",9),e.YNc(17,X,1,0,"i",11),e.qZA(),e.TgZ(18,"td",12),e.YNc(19,ee,1,0,"i",13),e.qZA()()}if(2&i){const s=c.item,r=e.oxw();e.xp6(5),e.Oqu(e.xi3(6,8,s,!0)),e.xp6(3),e.Oqu(null==s.classe?null:s.classe.libelle),e.xp6(1),e.Q6J("ngIf",r.authStore.isProfesseur()),e.xp6(3),e.Q6J("ngForOf",s.responsable.contacts)("ngForTrackBy",e.lcZ(13,11,"$index")),e.xp6(3),e.Q6J("ngIf","1"===s.responsable.typeResp),e.xp6(2),e.Q6J("ngIf","2"===s.responsable.typeResp),e.xp6(2),e.Q6J("ngIf","3"===s.responsable.typeResp)}}const se=function(){return["nom|asc"]};let ne=(()=>{class i{constructor(s){this.authStore=s,this.removeFamille=new e.vpe}trackByFn(){return(new u.$).transform("value.id")}}return i.\u0275fac=function(s){return new(s||i)(e.Y36(o.CnD))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-csl-familles"]],inputs:{destinataires:"destinataires"},outputs:{removeFamille:"removeFamille"},decls:4,vars:7,consts:[["cssCustom","liste-destinataires-message",3,"datas","pagination","trackByFn"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],["stSort","nom",1,"cliquable","sortable-header"],[4,"ngIf"],["title","Retirer le destinataire"],["type","button","aria-label","Retirer le destinataire",1,"btn","btn-danger","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-center"],["class","fa fa-check","aria-label","ce contact est responsable principal",4,"ngIf"],["class","fa fa-check","aria-label","ce contact est responsable conjoint",4,"ngIf"],[1,"text-center","width100"],["class","fa fa-check","aria-label","ce contact est de type autre contact",4,"ngIf"],["aria-label","ce contact est responsable principal",1,"fa","fa-check"],["aria-label","ce contact est responsable conjoint",1,"fa","fa-check"],["aria-label","ce contact est de type autre contact",1,"fa","fa-check"]],template:function(s,r){1&s&&(e.TgZ(0,"ed-smart-table",0),e.ALo(1,"orderBy"),e.YNc(2,$,15,1,"ng-template",1),e.YNc(3,te,20,13,"ng-template",2),e.qZA()),2&s&&e.Q6J("datas",e.xi3(1,3,r.destinataires,e.DdM(6,se)))("pagination",!1)("trackByFn",r.trackByFn)},dependencies:[f.sg,f.O5,t.L,S.c,E.r,E.w,o.$t3,o.d0N,u.$],encapsulation:2}),i})();var ie=_(31355);function oe(i,c){1&i&&e._UZ(0,"th")}function re(i,c){1&i&&(e.TgZ(0,"th"),e._uU(1,"Lu"),e.qZA())}function ae(i,c){if(1&i&&(e.TgZ(0,"tr"),e.YNc(1,oe,1,0,"th",3),e.YNc(2,re,2,0,"th",3),e.TgZ(3,"th",4),e._uU(4,"Nom"),e.qZA()()),2&i){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",!s.readOnly),e.xp6(1),e.Q6J("ngIf",s.readOnly&&s.toOrFrom===s.MESSAGERIE_STATE.send&&s.authStore.isProfOuPersonnel())}}function le(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"td",8)(1,"button",9),e.NdJ("click",function(){e.CHM(s);const l=e.oxw().item,d=e.oxw();return e.KtG(d.removeDestinataire.emit(l))}),e._UZ(2,"i",10),e.qZA()()}}const ce=function(i){return{"fa fa-check":i}};function _e(i,c){if(1&i&&(e.TgZ(0,"td",11),e._UZ(1,"i",12),e.qZA()),2&i){const s=e.oxw().item;e.xp6(1),e.Q6J("ngClass",e.VKq(1,ce,s.read))}}function pe(i,c){if(1&i&&(e.TgZ(0,"li",15),e._uU(1),e.qZA()),2&i){const s=c.$implicit,r=e.oxw(2).item;e.Q6J("userId",r.id)("userProfile",r.role),e.xp6(1),e.hij(" ",s," ")}}function me(i,c){if(1&i&&(e.TgZ(0,"td",13)(1,"ul"),e.YNc(2,pe,2,3,"li",14),e.ALo(3,"trackByProperty"),e.qZA()()),2&i){const s=e.oxw().item,r=e.oxw();e.xp6(2),e.Q6J("ngForOf",r.rightNames(s))("ngForTrackBy",e.lcZ(3,2,"$index"))}}function de(i,c){if(1&i&&(e.TgZ(0,"li",15),e._uU(1),e.qZA()),2&i){const s=c.$implicit,r=e.oxw(2).item;e.Q6J("userId",r.id)("userProfile",r.type),e.xp6(1),e.hij(" ",s," ")}}function ge(i,c){if(1&i&&(e.TgZ(0,"td",13)(1,"ul"),e.YNc(2,de,2,3,"li",14),e.ALo(3,"trackByProperty"),e.qZA()()),2&i){const s=e.oxw().item,r=e.oxw();e.xp6(2),e.Q6J("ngForOf",r.rightNames(s))("ngForTrackBy",e.lcZ(3,2,"$index"))}}function ue(i,c){if(1&i&&(e.TgZ(0,"tr"),e.YNc(1,le,3,0,"td",5),e.YNc(2,_e,2,3,"td",6),e.YNc(3,me,4,4,"td",7),e.YNc(4,ge,4,4,"td",7),e.qZA()),2&i){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",!s.readOnly),e.xp6(1),e.Q6J("ngIf",s.readOnly&&s.toOrFrom===s.MESSAGERIE_STATE.send&&s.authStore.isProfOuPersonnel()),e.xp6(1),e.Q6J("ngIf",s.readOnly),e.xp6(1),e.Q6J("ngIf",!s.readOnly)}}const fe=function(){return["nom","prenom"]};let he=(()=>{class i{constructor(s){this.authStore=s,this.readOnly=!1,this.toOrFrom="",this.pagination=!1,this.removeDestinataire=new e.vpe,this.MESSAGERIE_STATE=o.tHm.MESSAGERIE_STATE,this._displayNomPipe=new o.$t3}rightNames(s){return[this._displayNomPipe.transform(s,!0,!0,this.authStore.isFouE())]}trackByFn(){return(new u.$).transform("value.id")}}return i.\u0275fac=function(s){return new(s||i)(e.Y36(o.CnD))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-csl-simple-display"]],inputs:{destinataires:"destinataires",readOnly:"readOnly",toOrFrom:"toOrFrom",pagination:"pagination"},outputs:{removeDestinataire:"removeDestinataire"},decls:4,vars:7,consts:[["cssCustom","liste-destinataires-message",3,"datas","pagination","trackByFn"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],[4,"ngIf"],["stSort","nom",1,"cliquable","sortable-header"],["title","Retirer le destinataire",4,"ngIf"],["class","text-center","data-title","Lu",4,"ngIf"],["class","width100",4,"ngIf"],["title","Retirer le destinataire"],["type","button","aria-label","Retirer le destinataire",1,"btn","btn-danger","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],["data-title","Lu",1,"text-center"],[3,"ngClass"],[1,"width100"],["edUserDetail","",3,"userId","userProfile",4,"ngFor","ngForOf","ngForTrackBy"],["edUserDetail","",3,"userId","userProfile"]],template:function(s,r){1&s&&(e.TgZ(0,"ed-smart-table",0),e.ALo(1,"orderBy"),e.YNc(2,ae,5,2,"ng-template",1),e.YNc(3,ue,5,4,"ng-template",2),e.qZA()),2&s&&e.Q6J("datas",e.xi3(1,3,r.destinataires,e.DdM(6,fe)))("pagination",r.pagination)("trackByFn",r.trackByFn)},dependencies:[f.mk,f.sg,f.O5,t.L,S.c,E.r,E.w,ie.x,o.d0N,u.$],changeDetection:0}),i})();function ve(i,c){if(1&i&&(e.TgZ(0,"div",10),e._UZ(1,"input",11),e.qZA()),2&i){const s=e.oxw();e.xp6(1),e.Q6J("formControl",s.searchDestinataire)}}function Ee(i,c){if(1&i&&(e.TgZ(0,"div",12)(1,"button",13),e._UZ(2,"span",14),e._uU(3," Ecrire aux destinataires qui n'ont pas lu le message "),e.qZA()()),2&i){const s=e.oxw();e.xp6(1),e.Q6J("listContact",s.destNoRead)("typeContact",s.edModule.MESSAGERIE)}}function xe(i,c){if(1&i){const s=e.EpF();e.ynx(0),e.TgZ(1,"ed-csl-enseignants",19),e.NdJ("removeEnseignant",function(l){e.CHM(s);const d=e.oxw(2);return e.KtG(d.onRemoveEnseignant(l))}),e.qZA(),e.BQk()}if(2&i){const s=e.oxw(2);e.xp6(1),e.Q6J("destinataires",s.enseignants)}}function Ce(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"ed-csl-simple-display",20),e.NdJ("removeDestinataire",function(l){e.CHM(s);const d=e.oxw(2);return e.KtG(d.removeDest(l))}),e.qZA()}if(2&i){const s=e.oxw(2);e.Q6J("pagination",s.pagination)("toOrFrom",s.toOrFrom)("readOnly",s.readOnly)("destinataires",s.enseignants)}}function Se(i,c){if(1&i&&(e.TgZ(0,"div",15)(1,"h4",16),e._uU(2,"Enseignants"),e.qZA(),e.YNc(3,xe,2,1,"ng-container",17),e.YNc(4,Ce,1,4,"ng-template",null,18,e.W1O),e.qZA()),2&i){const s=e.MAs(5),r=e.oxw();e.xp6(3),e.Q6J("ngIf",!r.displaySimple)("ngIfElse",s)}}function a(i,c){if(1&i){const s=e.EpF();e.ynx(0),e.TgZ(1,"ed-csl-eleves",22),e.NdJ("removeEleve",function(l){e.CHM(s);const d=e.oxw(2);return e.KtG(d.onRemoveEleve(l))}),e.qZA(),e.BQk()}if(2&i){const s=e.oxw(2);e.xp6(1),e.Q6J("destinataires",s.eleves)}}function g(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"ed-csl-simple-display",20),e.NdJ("removeDestinataire",function(l){e.CHM(s);const d=e.oxw(2);return e.KtG(d.removeDest(l))}),e.qZA()}if(2&i){const s=e.oxw(2);e.Q6J("pagination",s.pagination)("toOrFrom",s.toOrFrom)("readOnly",s.readOnly)("destinataires",s.eleves)}}function n(i,c){if(1&i&&(e.TgZ(0,"div",15)(1,"h4",21),e._uU(2,"\xc9l\xe8ves"),e.qZA(),e.YNc(3,a,2,1,"ng-container",17),e.YNc(4,g,1,4,"ng-template",null,18,e.W1O),e.qZA()),2&i){const s=e.MAs(5),r=e.oxw();e.xp6(3),e.Q6J("ngIf",!r.displaySimple)("ngIfElse",s)}}function p(i,c){if(1&i){const s=e.EpF();e.ynx(0),e.TgZ(1,"ed-csl-personnels",24),e.NdJ("removePersonnel",function(l){e.CHM(s);const d=e.oxw(2);return e.KtG(d.onRemovePersonnel(l))}),e.qZA(),e.BQk()}if(2&i){const s=e.oxw(2);e.xp6(1),e.Q6J("destinataires",s.personnels)}}function m(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"ed-csl-simple-display",20),e.NdJ("removeDestinataire",function(l){e.CHM(s);const d=e.oxw(2);return e.KtG(d.removeDest(l))}),e.qZA()}if(2&i){const s=e.oxw(2);e.Q6J("pagination",s.pagination)("toOrFrom",s.toOrFrom)("readOnly",s.readOnly)("destinataires",s.personnels)}}function T(i,c){if(1&i&&(e.TgZ(0,"div",15)(1,"h4",23),e._uU(2,"Personnels"),e.qZA(),e.YNc(3,p,2,1,"ng-container",17),e.YNc(4,m,1,4,"ng-template",null,18,e.W1O),e.qZA()),2&i){const s=e.MAs(5),r=e.oxw();e.xp6(3),e.Q6J("ngIf",!r.displaySimple)("ngIfElse",s)}}function P(i,c){if(1&i){const s=e.EpF();e.ynx(0),e.TgZ(1,"ed-csl-familles",26),e.NdJ("removeFamille",function(l){e.CHM(s);const d=e.oxw(2);return e.KtG(d.onRemoveFamille(l))}),e.qZA(),e.BQk()}if(2&i){const s=e.oxw(2);e.xp6(1),e.Q6J("destinataires",s.familles)}}function y(i,c){if(1&i){const s=e.EpF();e.TgZ(0,"ed-csl-simple-display",20),e.NdJ("removeDestinataire",function(l){e.CHM(s);const d=e.oxw(2);return e.KtG(d.removeDest(l))}),e.qZA()}if(2&i){const s=e.oxw(2);e.Q6J("pagination",s.pagination)("toOrFrom",s.toOrFrom)("readOnly",s.readOnly)("destinataires",s.familles)}}function Te(i,c){if(1&i&&(e.TgZ(0,"div",15)(1,"h4",25),e._uU(2,"Familles"),e.qZA(),e.YNc(3,P,2,1,"ng-container",17),e.YNc(4,y,1,4,"ng-template",null,18,e.W1O),e.qZA()),2&i){const s=e.MAs(5),r=e.oxw();e.xp6(3),e.Q6J("ngIf",!r.displaySimple)("ngIfElse",s)}}let ye=(()=>{class i extends((0,o.kCV)()){constructor(s,r){super(),this.authStore=s,this.modalRef=r,this.readOnly=!1,this.toOrFrom="",this.pagination=!1,this.removed=[],this.onClose$=new A.x,this.displaySimple=!1,this.edTypeUser=o.dcH,this.searchDestinataire=new C.NI(""),this.destNoRead=[],this.edModule=o.qzA,this.MESSAGERIE_STATE=o.tHm.MESSAGERIE_STATE,this._displayNomPipe=new o.$t3}ngOnInit(){if(Object.isExists(this.destinataires)&&this.readOnly&&(this.copyDest=[...this.destinataires]),this.readOnly){let s=this.copyDest.filter(r=>!1===r.read);s.length>0&&this.toOrFrom===this.MESSAGERIE_STATE.send&&this.authStore.isProfOuPersonnel()&&s.forEach(r=>{let l=new o.iJ0({id:r.id,type:r.role,isSelected:!0,nom:r.nom,prenom:r.prenom,civilite:r.civilite,particule:r.particule,to_cc_cci:o.tHm.TYPE_MESSAGERIE_DEST.TO,fonction:new o.wlj,classes:[],classe:new o.WRp,isPP:!1,responsable:new o.lEH});this.destNoRead.push(l)}),this.displaySimple=!0,this.enseignants=this.destinataires.filter(r=>o.dcH.ENSEIGNANT===r.role).edUniq("id"),this.personnels=this.destinataires.filter(r=>o.dcH.PERSONNEL===r.role).edUniq("id"),this.eleves=this.destinataires.filter(r=>o.dcH.ELEVE===r.role).edUniq("id"),this.familles=this.destinataires.filter(r=>o.dcH.FAMILLE_RESPONSABLE===r.role||o.dcH.FAMILLE_CONJOINT===r.role)}else Object.isExists(this.destinataires[0])&&this.destinataires[0].alreadySave&&(this.displaySimple=!0),this.enseignants=this.destinataires.filter(s=>o.dcH.ENSEIGNANT===s.type).edUniq("id"),this.personnels=this.destinataires.filter(s=>o.dcH.PERSONNEL===s.type).edUniq("id"),this.eleves=this.destinataires.filter(s=>o.dcH.ELEVE===s.type).edUniq("id"),this.familles=this.destinataires.filter(s=>o.dcH.FAMILLE_RESPONSABLE===s.type||o.dcH.FAMILLE_CONJOINT===s.type);this.readOnly&&this.searchDestinataire.valueChanges.pipe((0,Z.O)(""),(0,I.b)(500),(0,x.x)(),(0,v.U)(s=>{if(""===s)return this.enseignants=this.copyDest.filter(l=>o.dcH.ENSEIGNANT===l.role).edUniq("id"),this.personnels=this.copyDest.filter(l=>o.dcH.PERSONNEL===l.role).edUniq("id"),this.eleves=this.copyDest.filter(l=>o.dcH.ELEVE===l.role).edUniq("id"),this.familles=this.copyDest.filter(l=>o.dcH.FAMILLE_RESPONSABLE===l.role||o.dcH.FAMILLE_CONJOINT===l.role),this.destinataires;const r=this.destinataires.filter(l=>this._displayNomPipe.transform(l,!1,!1,this.authStore.isFouE()).toLowerCase().includes(s.toLowerCase()));return this.enseignants=r.filter(l=>o.dcH.ENSEIGNANT===l.role).edUniq("id"),this.personnels=r.filter(l=>o.dcH.PERSONNEL===l.role).edUniq("id"),this.eleves=r.filter(l=>o.dcH.ELEVE===l.role).edUniq("id"),this.familles=r.filter(l=>o.dcH.FAMILLE_RESPONSABLE===l.role||o.dcH.FAMILLE_CONJOINT===l.role),r}),(0,O.R)(this.componentDestroyed$)).subscribe()}ngOnDestroy(){return this.onClose$.complete(),this.removed=[],super.ngOnDestroy()}onRemoveEnseignant(s){const r=this.enseignants.findIndex(l=>s.id===l.id);r>-1&&(this.removed.push(this.enseignants[r]),this.enseignants=this.enseignants.reduce((l,d)=>(s.id!==d.id&&l.push(d),l),[]))}onRemoveEleve(s){const r=this.eleves.findIndex(l=>s.id===l.id);r>-1&&(this.removed.push(this.eleves[r]),this.eleves=this.eleves.reduce((l,d)=>(s.id!==d.id&&l.push(d),l),[]))}onRemovePersonnel(s){const r=this.personnels.findIndex(l=>s.id===l.id);r>-1&&(this.removed.push(this.personnels[r]),this.personnels=this.personnels.reduce((l,d)=>(s.id!==d.id&&l.push(d),l),[]))}onRemoveFamille(s){const r=this.familles.findIndex(l=>s.id===l.id);r>-1&&(this.removed.push(this.familles[r]),this.familles=this.familles.reduce((l,d)=>(s.id!==d.id&&l.push(d),l),[]))}close(){this.onClose$.next(this.removed),this.modalRef.hide()}removeDest(s){(s.type===o.dcH.FAMILLE_RESPONSABLE||s.type===o.dcH.FAMILLE_CONJOINT)&&this.onRemoveFamille(s),s.type===o.dcH.ELEVE&&this.onRemoveEleve(s),s.type===o.dcH.ENSEIGNANT&&this.onRemoveEnseignant(s),s.type===o.dcH.PERSONNEL&&this.onRemovePersonnel(s)}}return i.\u0275fac=function(s){return new(s||i)(e.Y36(o.CnD),e.Y36(h.UZ))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-compose-selection-liste"]],inputs:{readOnly:"readOnly",toOrFrom:"toOrFrom",pagination:"pagination",destinataires:"destinataires"},features:[e.qOj],decls:15,vars:6,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body"],[1,"row"],["class","col-lg-12 margin-bottom-10",4,"ngIf"],["class","col-lg-12 margin-bottom-10 text-center",4,"ngIf"],["class","col-lg-12",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-primary","float-end",3,"click"],[1,"col-lg-12","margin-bottom-10"],["placeholder","Rechercher un destinataire","type","search",1,"form-control",3,"formControl"],[1,"col-lg-12","margin-bottom-10","text-center"],["type","button","edMessageTo","","title","Envoyer un message aux familles",1,"btn","btn-primary","btn-sm","margin-whitespace",3,"listContact","typeContact"],[1,"fa","fa-2x","icon-ed_messagerie"],[1,"col-lg-12"],[1,"text-enseignant"],[4,"ngIf","ngIfElse"],["simple",""],[3,"destinataires","removeEnseignant"],[3,"pagination","toOrFrom","readOnly","destinataires","removeDestinataire"],[1,"text-eleve"],[3,"destinataires","removeEleve"],[1,"text-personnel"],[3,"destinataires","removePersonnel"],[1,"text-famille"],[3,"destinataires","removeFamille"]],template:function(s,r){1&s&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2,"Liste des destinataires"),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return r.close()}),e.qZA()(),e.TgZ(4,"div",3)(5,"div",4),e.YNc(6,ve,2,1,"div",5),e.YNc(7,Ee,4,2,"div",6),e.YNc(8,Se,6,2,"div",7),e.YNc(9,n,6,2,"div",7),e.YNc(10,T,6,2,"div",7),e.YNc(11,Te,6,2,"div",7),e.qZA()(),e.TgZ(12,"div",8)(13,"button",9),e.NdJ("click",function(){return r.close()}),e._uU(14,"Fermer"),e.qZA()()),2&s&&(e.xp6(6),e.Q6J("ngIf",r.destinataires.length>10&&r.readOnly),e.xp6(1),e.Q6J("ngIf",r.destNoRead.length>0&&r.readOnly&&r.toOrFrom===r.MESSAGERIE_STATE.send&&r.authStore.isProfOuPersonnel()),e.xp6(1),e.Q6J("ngIf",r.enseignants.length>0),e.xp6(1),e.Q6J("ngIf",r.eleves.length>0),e.xp6(1),e.Q6J("ngIf",r.personnels.length>0),e.xp6(1),e.Q6J("ngIf",r.familles.length>0))},dependencies:[f.O5,C.Fj,C.JJ,C.oH,M.x,R,k,K,ne,he],styles:['.liste-destinataires-message>table th:nth-child(2){width:200px}.liste-destinataires-message>table td{min-width:50px;white-space:nowrap}.specialEnseignantBreakSpaces{white-space:break-spaces!important;max-width:300px!important}.liste-destinataires-message>table td ul{padding-left:0}.width100{width:100%}.liste-destinataires-message .sortable-header:before{content:"\\f0dc";display:inline-block;font: 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transform:translate(0);margin-right:5px}\n'],encapsulation:2}),i})()},53569:(Me,U,_)=>{_.d(U,{q:()=>Se});var A=_(5402),o=_(45007),C=_(50532),Z=_(87192),I=_(61099),x=_(52497),v=_(60515),O=_(95698),e=_(39300),h=_(63900),f=_(18505),M=_(28746),u=_(70262),t=_(94650),S=_(92635),E=_(20388),F=_(95715),D=_(36895),N=_(59245),L=_(80125),R=_(77069),w=_(31355),B=_(43422),J=_(935),k=_(39653),q=_(4602);function H(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"button",23),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(3);return t.KtG(m.setWantToReply(!1))}),t._UZ(1,"i",24),t._uU(2," R\xe9pondre "),t.qZA()}}function Y(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(3);return t.KtG(m.setWantToReply(!0))}),t._UZ(1,"i",26),t._uU(2," \xc0 tous "),t.qZA()}}function Q(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(3);return t.KtG(m.forwardMessage())}),t._UZ(1,"i",28),t._uU(2," Transf\xe9rer "),t.qZA()}}function G(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(3);return t.KtG(m.supprimeMessageOuAnnuler(!0))}),t._UZ(1,"i",30),t._uU(2," Annuler l'envoi "),t.qZA()}}function K(a,g){if(1&a&&(t.TgZ(0,"div",18),t.YNc(1,H,3,0,"button",19),t.YNc(2,Y,3,0,"button",20),t.YNc(3,Q,3,0,"button",21),t.YNc(4,G,3,0,"button",22),t.qZA()),2&a){const n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",n.droits.canReply&&!(n.message.from.id<=0)),t.xp6(1),t.Q6J("ngIf",n.droits.canReply&&!n.cantResponseToAll()),t.xp6(1),t.Q6J("ngIf",n.messagerieUserStore.snapshot.choosenAnnee!==n.messagerieUserStore.getAnneesMessagesArchive()[0]&&n.messagerieUserStore.isHimself()&&n.droits.canWrite),t.xp6(1),t.Q6J("ngIf",n.cancelMessagePossible())}}function W(a,g){1&a&&(t.TgZ(0,"button",42),t._UZ(1,"i",43),t.qZA())}function $(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"li",46)(1,"button",47),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(5);return t.KtG(m.deplacerMessages(0))}),t._uU(2,"Retirer du dossier"),t.qZA()()}}function j(a,g){1&a&&t._UZ(0,"li",50)}function V(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"li",46)(1,"button",47),t.NdJ("click",function(){t.CHM(n);const m=t.oxw().$implicit,T=t.oxw(6);return t.KtG(T.deplacerMessages(m.id))}),t._uU(2),t.qZA()()}if(2&a){const n=t.oxw().$implicit;t.xp6(2),t.Oqu(n.libelle)}}function z(a,g){if(1&a&&(t.ynx(0),t.YNc(1,V,3,1,"li",45),t.BQk()),2&a){const n=g.$implicit,p=t.oxw(6);t.xp6(1),t.Q6J("ngIf",n.id>0&&!p.messagerieUserStore.isBoxCurrent(n.id))}}const X=function(){return["order|asc"]};function ee(a,g){if(1&a&&(t.ynx(0),t.YNc(1,j,1,0,"li",48),t.TgZ(2,"li",46)(3,"i"),t._uU(4,"D\xe9placer vers..."),t.qZA()(),t.YNc(5,z,2,1,"ng-container",49),t.ALo(6,"orderBy"),t.ALo(7,"trackByProperty"),t.BQk()),2&a){const n=t.oxw(5);t.xp6(1),t.Q6J("ngIf",n.messagerieUserStore.currentIdBox>0),t.xp6(4),t.Q6J("ngForOf",t.xi3(6,3,n.messagerie.inboxList,t.DdM(8,X)))("ngForTrackBy",t.lcZ(7,6,"id"))}}function te(a,g){if(1&a&&(t.TgZ(0,"ul",44),t.YNc(1,$,3,0,"li",45),t.YNc(2,ee,8,9,"ng-container",14),t.qZA()),2&a){const n=t.oxw(4);t.xp6(1),t.Q6J("ngIf",n.messagerieUserStore.currentIdBox>0),t.xp6(1),t.Q6J("ngIf",n.isDeplacerVersEnable())}}function se(a,g){if(1&a&&(t.TgZ(0,"div",39),t.YNc(1,W,2,0,"button",40),t.YNc(2,te,3,2,"ul",41),t.qZA()),2&a){const n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",!n.messagerieUserStore.isBoxCurrent(n.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ARCHIVE))}}function ne(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"button",51),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(3);return t.KtG(m.archiveMessage())}),t._UZ(1,"i",52),t.qZA()}}function ie(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"button",53),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(3);return t.KtG(m.desArchiveMessage())}),t._UZ(1,"i",54),t.qZA()}}function oe(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"button",55),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(3);return t.KtG(m.convertToMail())}),t._UZ(1,"i",56),t.qZA()}}function re(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"button",57),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(3);return t.KtG(m.supprimeMessageOuAnnuler())}),t._UZ(1,"i",58),t.qZA()}}const ae=function(a){return{"col-md-offset-7":a}};function le(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"div",31)(1,"div",18),t.YNc(2,se,3,1,"div",32),t.YNc(3,ne,2,0,"button",33),t.YNc(4,ie,2,0,"button",34),t.YNc(5,oe,2,0,"button",35),t.TgZ(6,"button",36),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(2);return t.KtG(m.printMessage())}),t._UZ(7,"i",37),t.qZA(),t.YNc(8,re,2,0,"button",38),t.qZA()()}if(2&a){const n=t.oxw(2);t.Q6J("ngClass",t.VKq(6,ae,!n.messagerieUserStore.isHimself())),t.xp6(2),t.Q6J("ngIf",n.authStore.isAnneeCourante(n.messagerieUserStore.snapshot.choosenAnnee)&&!n.messagerieUserStore.isBoxCurrent(n.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ARCHIVE)&&(n.messagerieUserStore.currentIdBox>0||n.isDeplacerVersEnable())),t.xp6(1),t.Q6J("ngIf",n.droits.canArchive&&n.messagerieUserStore.isBoxCurrent(n.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION)),t.xp6(1),t.Q6J("ngIf",n.messagerieUserStore.isBoxCurrent(n.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_ARCHIVE)),t.xp6(1),t.Q6J("ngIf",n.messagerieUserStore.snapshot.choosenAnnee!==n.messagerieUserStore.getAnneesMessagesArchive()[0]),t.xp6(3),t.Q6J("ngIf",n.isSuppressionPossible())}}function ce(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"button",61),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(3);return t.KtG(m.showContact())}),t._uU(1," [...] "),t._UZ(2,"span",62),t.qZA()}}function _e(a,g){if(1&a&&(t.TgZ(0,"div")(1,"strong",59),t._uU(2),t.ALo(3,"displayNom"),t.qZA(),t._uU(4," \xe0 "),t.TgZ(5,"strong"),t._uU(6),t.qZA(),t.YNc(7,ce,3,0,"button",60),t.qZA()),2&a){const n=t.oxw(2);t.xp6(1),t.Q6J("userId",n.message.from.id)("userProfile",n.message.from.role),t.xp6(1),t.Oqu(t.gM2(3,5,n.message.from,!1,!0,n.authStore.isFouE())),t.xp6(4),t.hij("","to"===n.message.to_cc_cci?"":n.message.to_cc_cci+" : "," moi"),t.xp6(1),t.Q6J("ngIf",n.message.to.length>1)}}function pe(a,g){if(1&a&&(t.TgZ(0,"span"),t._UZ(1,"i",66),t.TgZ(2,"span"),t._uU(3),t.ALo(4,"displayNom"),t.qZA()()),2&a){const n=t.oxw(3);t.xp6(1),t.s9C("title",n.getTypePersonne(n.message.to[0].role)),t.Q6J("ngClass","fa fa-2x "+n.messagerieUserStore.getIconTypeUser(n.message.to[0])),t.xp6(2),t.Oqu(t.gM2(4,3,n.message.to[0],!1,!0,n.authStore.isFouE()))}}function me(a,g){if(1&a&&(t.TgZ(0,"span",67)(1,"span"),t._uU(2),t.qZA()()),2&a){const n=t.oxw(3);t.xp6(2),t.Oqu(n.message.to.length+" destinataires")}}function de(a,g){if(1&a){const n=t.EpF();t.TgZ(0,"div")(1,"span",63),t._uU(2,"\xc0"),t.qZA(),t.TgZ(3,"button",61),t.NdJ("click",function(){t.CHM(n);const m=t.oxw(2);return t.KtG(m.showContact())}),t.YNc(4,pe,5,8,"span",14),t.YNc(5,me,3,1,"span",64),t._UZ(6,"span",65),t.qZA()()}if(2&a){const n=t.oxw(2);t.xp6(4),t.Q6J("ngIf",1===n.message.to.length),t.xp6(1),t.Q6J("ngIf",n.message.to.length>1)}}function ge(a,g){1&a&&(t.TgZ(0,"span"),t._uU(1,"s"),t.qZA())}function ue(a,g){1&a&&(t.TgZ(0,"span"),t._uU(1,"s"),t.qZA())}const fe=function(){return[]},he=function(a){return{anneeMessages:a}};function ve(a,g){if(1&a&&(t.TgZ(0,"div",71)(1,"a",72),t._UZ(2,"i",73),t.qZA(),t.TgZ(3,"a",74)(4,"b"),t._uU(5),t.qZA(),t._UZ(6,"i",75),t.qZA()()),2&a){const n=g.$implicit,p=t.oxw(3);t.xp6(1),t.Q6J("anneeMessages",p.messagerieUserStore.snapshot.choosenAnnee)("fileId",n.id)("fileType",n.type)("routerLink",t.DdM(10,fe)),t.xp6(2),t.Q6J("file",n)("typeFichier",n.type)("typeModule",p.moduleCodes.MESSAGERIE)("canExportToCloud",!0)("additionalData",t.VKq(11,he,p.messagerieUserStore.snapshot.choosenAnnee)),t.xp6(2),t.Oqu(n.libelle)}}function Ee(a,g){if(1&a&&(t.TgZ(0,"div",68)(1,"p"),t._UZ(2,"i",69),t.TgZ(3,"span",67)(4,"span"),t._uU(5),t.qZA(),t.YNc(6,ge,2,0,"span",14),t.TgZ(7,"span",67),t._uU(8,"jointe"),t.qZA(),t.YNc(9,ue,2,0,"span",14),t.qZA()(),t.YNc(10,ve,7,13,"div",70),t.ALo(11,"trackByProperty"),t.qZA()),2&a){const n=t.oxw(2);t.xp6(5),t.hij("",n.message.files.length," pi\xe8ce"),t.xp6(1),t.Q6J("ngIf",n.message.files.length>1),t.xp6(3),t.Q6J("ngIf",n.message.files.length>1),t.xp6(1),t.Q6J("ngForOf",n.message.files)("ngForTrackBy",t.lcZ(11,5,"id"))}}function xe(a,g){if(1&a&&(t.TgZ(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6),t.YNc(4,K,5,4,"div",7),t.qZA(),t.YNc(5,le,9,8,"div",8),t.qZA(),t.TgZ(6,"div",9)(7,"h3",10),t._uU(8),t.qZA()()(),t.TgZ(9,"div",11)(10,"div",12)(11,"div",13),t.YNc(12,_e,8,10,"div",14),t.YNc(13,de,7,2,"div",14),t.TgZ(14,"div",15),t._uU(15),t.ALo(16,"edDate"),t.qZA()()(),t._UZ(17,"div",16),t.ALo(18,"filterHtml"),t.ALo(19,"detectUrl"),t.ALo(20,"base64"),t.qZA(),t.YNc(21,Ee,12,7,"div",17),t.qZA()),2&a){const n=t.oxw();t.xp6(4),t.Q6J("ngIf",n.messagerieUserStore.isHimself()&&n.authStore.isAnneeCourante(n.messagerieUserStore.snapshot.choosenAnnee)),t.xp6(1),t.Q6J("ngIf",n.messagerieUserStore.isHimself()),t.xp6(3),t.Oqu(n.message.subject?n.message.subject:"[aucun objet]"),t.xp6(4),t.Q6J("ngIf",n.message.mtype===n.MESSAGERIE_STATE.received),t.xp6(1),t.Q6J("ngIf",n.message.mtype===n.MESSAGERIE_STATE.send),t.xp6(2),t.Oqu(t.xi3(16,8,n.message.date,"EEEE d MMMM y \xe0 HH:mm")),t.xp6(2),t.Q6J("innerHTML",t.xi3(18,11,t.lcZ(19,14,t.lcZ(20,16,n.message.content)),!0),t.oJD),t.xp6(4),t.Q6J("ngIf",n.message.files&&n.message.files.length>0)}}function Ce(a,g){1&a&&(t.TgZ(0,"div")(1,"div",3)(2,"div",76)(3,"h3",77),t._uU(4,"S\xe9lectionnez un message pour le lire"),t.qZA()()()())}let Se=(()=>{class a{constructor(n,p,m,T,P,y,Te,ye,i){this.authStore=n,this.loaderService=p,this.messagerieService=m,this.messagerieStore=T,this.messagerieUserStore=P,this.modalService=y,this.router=Te,this.ref=ye,this.uiService=i,this.ID_DOSSIER_MESSAGERIE=o.tHm.ID_DOSSIER_MESSAGERIE,this.MESSAGERIE_STATE=o.tHm.MESSAGERIE_STATE,this.moduleCodes=o.qzA,this.getTypePersonne=o.FSr.getTypePersonne}ngOnChanges(n){if(n.message){if(Object.isExists(n.message.currentValue)){const p=this.messagerieUserStore.isHimself();this.droits={canWrite:p&&this.messagerieStore.canWrite(),canReply:p&&this.messagerieStore.canReply(this.message),canDelete:p&&!this.authStore.isFouE(),canArchive:p&&o.tHm.canArchive(this.message)}}else this.droits={canWrite:!1,canReply:!1,canDelete:!1,canArchive:!1};this.ref.markForCheck()}}cantResponseToAll(){if(this.authStore.isFouE()||this.message.to.length<=1)return!0;let n=!1;for(let p=0;p<this.message.to.length;p++){const m=this.message.to[p];if((this.authStore.currentUser.typeCompte!==m.role||this.authStore.currentUser.id!==m.id)&&!this.messagerieStore.canReplyToTypeDest(m.role)){n=!0;break}}return n}isDeplacerVersEnable(){return Object.isExists(this.messagerie)&&this.messagerie.inboxList.filter(n=>n.id>0&&n.id!==this.messagerieUserStore.currentIdBox).length>0}isSuppressionPossible(){return this.message.isSuppressionMessagePossible(this.authStore.isProfOuPersonnel(),this.authStore.isModeSupervision(),this.authStore.isEphemere())}cancelMessagePossible(){return this.message.isCancelMessagePossible(this.authStore.isProfOuPersonnel(),this.authStore.isModeSupervision(),this.authStore.isEphemere())}deplacerMessages(n){this.messagerieUserStore.promiseContents=this.messagerieService.deplacerMessages(this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,this.messagerieUserStore.snapshot.choosenAnnee,[this.message],n).subscribe({next:p=>{this.uiService.notifyEvent(o.DOJ.genericSuccess,"Le d\xe9placement a \xe9t\xe9 effectu\xe9 avec succ\xe8s","D\xe9placement","fa fa-envelope"),this.messagerieUserStore.currentMessage=void 0},error:p=>this.uiService.notifyEvent(p.action,p.message,"Erreur","fa fa-envelope")})}archiveMessage(){this.messagerieUserStore.promiseContents=this.messagerieService.archiveMessages(this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,this.messagerieUserStore.snapshot.choosenAnnee,[this.message]).subscribe({next:n=>{this.uiService.notifyEvent(o.DOJ.genericSuccess,"Votre message a bien \xe9t\xe9 archiv\xe9","Message archiv\xe9","fa fa-envelope"),this.messagerieUserStore.currentMessage=void 0},error:n=>this.uiService.notifyEvent(n.action,n.message,"Erreur","fa fa-envelope")})}desArchiveMessage(){this.messagerieUserStore.promiseContents=this.messagerieService.unArchiveMessages(this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,this.messagerieUserStore.snapshot.choosenAnnee,[this.message]).subscribe({next:n=>{this.uiService.notifyEvent(o.DOJ.genericSuccess,"Message de retour dans votre boite de r\xe9ception","Message d\xe9sarchiv\xe9","fa fa-envelope"),this.messagerieUserStore.currentMessage=void 0},error:n=>this.uiService.notifyEvent(n.action,n.message,"Erreur","fa fa-envelope")})}supprimeMessageOuAnnuler(n=!1){const p=n?o.tHm.ACT_ON_MESSAGE.annuler:o.tHm.ACT_ON_MESSAGE.supprimer,m=this.messagerieUserStore.currentIdBox===o.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION?"l'exp\xe9diteur":"le destinataire",T=this.messagerieUserStore.currentIdBox===o.tHm.ID_DOSSIER_MESSAGERIE.ID_DOSSIER_RECEPTION?"votre bo\xeete de reception":"vos messages envoy\xe9s",P={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:n?"Suppression du message":"D\xe9sirez vous supprimer le message ?",message:n?"\xcates-vous s\xfbr de vouloir annuler <strong>d\xe9finitivement</strong> l'envoi du message ?":`Seul le message dans <strong>${T}</strong> sera supprim\xe9. Il restera visible chez ${m}.`}};this.modalService.show(Z.z,P),this.modalService.onHide.pipe((0,O.q)(1),(0,e.h)(y=>y===x.G.validation),(0,h.w)(y=>(this.messagerieUserStore.promiseContents=this.loaderService.show(this),this.ref.markForCheck(),this.messagerieService.supprimerOuAnnulerMessages(this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,this.messagerieUserStore.snapshot.choosenAnnee,this.messagerieUserStore.currentIdBox,[this.message],p))),(0,f.b)(y=>{this.uiService.notifyEvent(o.DOJ.genericSuccess,"Votre message a bien \xe9t\xe9 supprim\xe9","Message supprim\xe9","fa fa-envelope"),this.messagerieUserStore.currentMessage=void 0}),(0,M.x)(()=>this.loaderService.hide(this)),(0,u.K)(y=>this.uiService.notifyErrorThenEmpty(y,!0,"Erreur","fa fa-envelope"))).subscribe()}convertToMail(){this.modalService.show(I.I,{id:this.modalService.getModalsCount()+1,class:"modal-sm",initialState:{title:"Votre email",message:"Sur quelle adresse mail doit \xeatre envoy\xe9 le message ?",initialValue:this.authStore.currentUser.profile.email,inputValidator:n=>o.FSr.isValidEmail(n.value)?null:{emaiFormatError:!0}}}),this.modalService.onHide.pipe((0,O.q)(1),(0,h.w)(n=>{const p=JSON.parse(n);return p.reason!==x.G.validation?(this.uiService.notifyEvent(o.DOJ.genericError,"La valeur saisie est incorrecte : "+p.reason),v.E):(this.messagerieUserStore.promiseContents=this.loaderService.show(this),this.ref.markForCheck(),this.messagerieService.convertToMail(this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,this.messagerieUserStore.snapshot.choosenAnnee,this.message,p.data).pipe((0,f.b)(m=>this.uiService.notifyEvent(o.DOJ.genericSuccess,"Conversion en email effectu\xe9e","Messagerie","fa fa-envelope"))))}),(0,M.x)(()=>this.loaderService.hide(this)),(0,u.K)(n=>this.uiService.notifyErrorThenEmpty(n,!0,"Erreur","fa fa-envelope"))).subscribe()}printMessage(){let n="";const p=document.getElementsByClassName("printable-message");Array.from(p).forEach(T=>{n+=T.innerHTML});const m=window.open("","","height=400,width=800");m.document.write("<html><head><title>"+this.message.subject+"</title>"),m.document.write("</head><body >"),m.document.write(n),m.document.write("</body></html>"),m.document.close(),m.print()}setWantToReply(n){this.router.navigate([`/${this.authStore.currentUser.typeCompte}/${this.authStore.currentUser.id}/Messagerie/Compose`,{outlets:{auxiliaryModal:null}}],{queryParams:{typeCompose:n?o.tHm.TYPE_COMPOSE.reponseAll:o.tHm.TYPE_COMPOSE.reponse,idMessage:this.message.id,idDossier:this.message.idDossier,idClasseur:this.message.idClasseur},skipLocationChange:!0}).then(()=>{this.modalService.getModalsCount()>0&&this.modalService.hide()}).catch(()=>console.error("setWantToReply navigate to ./Compose"))}forwardMessage(){this.router.navigate([`/${this.authStore.currentUser.typeCompte}/${this.authStore.currentUser.id}/Messagerie/Compose`,{outlets:{auxiliaryModal:null}}],{queryParams:{typeCompose:o.tHm.TYPE_COMPOSE.transfert,idMessage:this.message.id,idDossier:this.message.idDossier,idClasseur:this.message.idClasseur},skipLocationChange:!0}).then(()=>{this.modalService.getModalsCount()>0&&this.modalService.hide()}).catch(()=>console.error("forwardMessage navigate to ./Compose"))}showContact(){this.modalService.show(C.N,{id:this.modalService.getModalsCount()+1,initialState:{pagination:!0,toOrFrom:this.message.mtype,readOnly:!0,destinataires:this.message.to},class:"modal-lg",providers:[{provide:A.C,useValue:this.messagerieUserStore}]})}getRole(n){return n===o.dcH.ENSEIGNANT?o.dcH.ENSEIGNANT:n===o.dcH.PERSONNEL?o.dcH.PERSONNEL:n===o.dcH.FAMILLE?o.dcH.FAMILLE:n===o.dcH.ELEVE?o.dcH.ELEVE:n===o.dcH.FAMILLE_RESPONSABLE?o.dcH.FAMILLE_RESPONSABLE:o.dcH.FAMILLE_CONJOINT}}return a.\u0275fac=function(n){return new(n||a)(t.Y36(o.CnD),t.Y36(S.S),t.Y36(o.KRh),t.Y36(o.q0O),t.Y36(A.C),t.Y36(E.tT),t.Y36(F.F0),t.Y36(t.sBO),t.Y36(o.VLf))},a.\u0275cmp=t.Xpm({type:a,selectors:[["ed-messagerie-message"]],inputs:{message:"message",messagerie:"messagerie"},features:[t.TTD],decls:4,vars:3,consts:[[1,"ed-messagerie-message",3,"ngBusy"],["class","inbox-body",4,"ngIf","ngIfElse"],["nomessage",""],[1,"inbox-body"],[1,"heading-inbox"],[1,"row","g-0"],[1,"col-md-7"],["class","compose-btn",4,"ngIf"],["class","col-md-5 text-end",3,"ngClass",4,"ngIf"],[1,"printable-message"],[1,"my-4"],[1,"content-inbox"],[1,"sender-info","printable-message"],[1,"infos-mail"],[4,"ngIf"],[1,"date-message"],[1,"view-message","printable-message","ed-cke",3,"innerHTML"],["class","attachments printable-message",4,"ngIf"],[1,"compose-btn"],["class","btn btn-sm btn-primary","title","R\xe9pondre","type","button",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary","title","R\xe9pondre \xe0 tous","type","button",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary","title","Transf\xe9rer","type","button",3,"click",4,"ngIf"],["class","btn btn-sm btn-danger","title","Annuler l'envoi","type","button",3,"click",4,"ngIf"],["title","R\xe9pondre","type","button",1,"btn","btn-sm","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-reply"],["title","R\xe9pondre \xe0 tous","type","button",1,"btn","btn-sm","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-reply-all"],["title","Transf\xe9rer","type","button",1,"btn","btn-sm","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-right"],["title","Annuler l'envoi","type","button",1,"btn","btn-sm","btn-danger",3,"click"],["aria-hidden","true",1,"fa","fa-ban"],[1,"col-md-5","text-end",3,"ngClass"],["class","btn-group","dropdown","",4,"ngIf"],["aria-label","Archiver","class","btn btn-primary-color p-1","title","Archiver","type","button",3,"click",4,"ngIf"],["aria-label","D\xe9sarchiver","class","btn btn-primary-color p-1","title","D\xe9sarchiver","type","button",3,"click",4,"ngIf"],["aria-label","Convertir en email","class","btn btn-primary-color p-1","title","Convertir en email","type","button",3,"click",4,"ngIf"],["aria-label","Imprimer","title","Imprimer","type","button",1,"btn","btn-primary-color","p-1",3,"click"],["aria-hidden","true",1,"fa","fa-print"],["aria-label","Supprimer","class","btn btn-danger-color p-1","title","Supprimer","type","button",3,"click",4,"ngIf"],["dropdown","",1,"btn-group"],["class","btn btn-primary-color dropdown-toggle p-1","dropdownToggle","","id","dropdownMessage","aria-controls","dropdown-message-action","title","D\xe9placer vers...","type","button",4,"ngIf"],["aria-labelledby","dropdownMessage","id","dropdown-message-action","class","dropdown-menu",4,"dropdownMenu"],["dropdownToggle","","id","dropdownMessage","aria-controls","dropdown-message-action","title","D\xe9placer vers...","type","button",1,"btn","btn-primary-color","dropdown-toggle","p-1"],["aria-hidden","true",1,"fa","fa-folder"],["aria-labelledby","dropdownMessage","id","dropdown-message-action",1,"dropdown-menu"],["role","menuitem",4,"ngIf"],["role","menuitem"],["type","button",1,"dropdown-item",3,"click"],["class","divider dropdown-divider","role","separator",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["role","separator",1,"divider","dropdown-divider"],["aria-label","Archiver","title","Archiver","type","button",1,"btn","btn-primary-color","p-1",3,"click"],["aria-hidden","true",1,"fa","fa-archive"],["aria-label","D\xe9sarchiver","title","D\xe9sarchiver","type","button",1,"btn","btn-primary-color","p-1",3,"click"],["aria-hidden","true",1,"icon-ed_recu"],["aria-label","Convertir en email","title","Convertir en email","type","button",1,"btn","btn-primary-color","p-1",3,"click"],["aria-hidden","true",1,"fa","fa-at"],["aria-label","Supprimer","title","Supprimer","type","button",1,"btn","btn-danger-color","p-1",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o"],["edUserDetail","",3,"userId","userProfile"],["class","btn btn-link margin-whitespace","title","Consulter la liste des destinataires de ce message","type","button",3,"click",4,"ngIf"],["title","Consulter la liste des destinataires de ce message","type","button",1,"btn","btn-link","margin-whitespace",3,"click"],[1,"fa","fa-eye"],[1,"send-to-a"],["class","margin-whitespace",4,"ngIf"],[1,"margin-whitespace","fa","fa-eye",2,"font-size","14px"],[3,"ngClass","title"],[1,"margin-whitespace"],[1,"attachments","printable-message"],["aria-hidden","true",1,"fa","fa-paperclip"],["class","attachment",4,"ngFor","ngForOf","ngForTrackBy"],[1,"attachment"],["edTelechargement","","href","","title","T\xe9l\xe9charger","role","button",1,"margin-whitespace",3,"anneeMessages","fileId","fileType","routerLink"],["aria-hidden","true",1,"fa","fa-download"],["edLightbox","","title","Pr\xe9visualiser","role","button",1,"margin-whitespace",3,"file","typeFichier","typeModule","canExportToCloud","additionalData","routerLink"],["aria-hidden","true",1,"margin-whitespace","fa","fa-search"],[1,"no-message","text-center"],[1,"mt-5"]],template:function(n,p){if(1&n&&(t.TgZ(0,"div",0),t.YNc(1,xe,22,18,"div",1),t.qZA(),t.YNc(2,Ce,5,0,"ng-template",null,2,t.W1O)),2&n){const m=t.MAs(3);t.Q6J("ngBusy",p.messagerieUserStore.promiseContents),t.xp6(1),t.Q6J("ngIf",p.message)("ngIfElse",m)}},dependencies:[D.mk,D.sg,D.O5,F.yS,N.Hz,N.Mq,N.TO,L.DC,R.x,w.x,B.l,o.$t3,o.YC,o.d0N,o.ifA,J.p,k.w,q.$],styles:[".ed-messagerie-message .infos-mail{margin:10px 0 20px;padding:5px 0;border-top:1px solid var(--smalldark-placeholder-color);border-bottom:1px solid var(--smalldark-placeholder-color);opacity:.5;font-style:italic;font-size:11px}.ed-messagerie-message .attachments{margin:20px 0 10px;padding:5px 0;border-top:1px solid var(--secondary-color);border-bottom:1px solid var(--secondary-color);color:var(--secondary-color)}.ed-messagerie-message .attachments>p{font-weight:700;text-transform:uppercase}.ed-messagerie-message .attachments>.attachment{color:#000}.ed-messagerie-message .compose-btn>div[dropdown]{position:relative}.ed-messagerie-message .compose-btn>div[dropdown] .dropdown-menu{right:0;left:auto}.ed-messagerie-message .compose-btn button{margin-right:3px}.ed-messagerie-message .view-message ul{list-style:inherit}.ed-messagerie-message .view-message blockquote{margin:0;padding:0;border:0 none}.ed-messagerie-message .view-message p a{color:#15c!important;text-decoration:underline!important}\n"],encapsulation:2,changeDetection:0}),a})()}}]);