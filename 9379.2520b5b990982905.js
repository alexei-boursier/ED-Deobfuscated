"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[9379],{89379:(X,f,r)=>{r.d(f,{r:()=>z});var p=r(24006),i=r(45007),E=r(77579),x=r(78372),P=r(71884),b=r(82722),u=r(54004),T=r(28746),d=r(4602),e=r(94650),M=r(20388),g=r(36895),m=r(59245),S=r(80125),O=r(93970),A=r(34414),h=r(34331),Z=r(82945);function v(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,a=e.oxw(3);return e.KtG(a.onChangeClasse(o))}),e._UZ(1,"i",31),e.TgZ(2,"strong",32),e._uU(3),e.qZA()()}if(2&n){const t=e.oxw().$implicit;e.xp6(3),e.Oqu(t.libelle)}}function y(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,a=e.oxw(3);return e.KtG(a.onChangeClasse(o))}),e._UZ(1,"i",34),e.TgZ(2,"span",32),e._uU(3),e.qZA()()}if(2&n){const t=e.oxw().$implicit;e.xp6(3),e.Oqu(t.libelle)}}const D=function(n,c){return{"classe-option":n,"all-option":c}};function I(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",35),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,a=e.oxw(3);return e.KtG(a.onChangeClasse(o))}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw().$implicit,s=e.oxw(3);e.Q6J("ngClass",e.WLB(2,D,s.authStore.isProfOuPersonnel(),!s.authStore.isProfOuPersonnel())),e.xp6(1),e.hij(" ",t.libelle," ")}}function w(n,c){if(1&n&&(e.TgZ(0,"li",25),e.ynx(1,26),e.YNc(2,v,4,1,"button",27),e.YNc(3,y,4,1,"button",28),e.YNc(4,I,2,5,"button",29),e.BQk(),e.qZA()),2&n){const t=c.$implicit,s=e.oxw(3);e.xp6(1),e.Q6J("ngSwitch",t.optionType),e.xp6(1),e.Q6J("ngSwitchCase",s.OPTIONS_TYPE.etab),e.xp6(1),e.Q6J("ngSwitchCase",s.OPTIONS_TYPE.niveau),e.xp6(1),e.Q6J("ngSwitchCase",s.OPTIONS_TYPE.classe)}}function N(n,c){if(1&n&&(e.TgZ(0,"ul",23),e.YNc(1,w,5,4,"li",24),e.ALo(2,"trackByProperty"),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.classes)("ngForTrackBy",e.lcZ(2,2,"uniqueID"))}}function U(n,c){if(1&n&&(e.TgZ(0,"div")(1,"div")(2,"label",17),e._uU(3,"Nom de l'enseignant"),e.qZA(),e._UZ(4,"input",18),e.qZA(),e.TgZ(5,"div",19)(6,"strong"),e._uU(7,"Classe"),e.qZA(),e.TgZ(8,"div",20)(9,"button",21),e._uU(10),e.qZA(),e.YNc(11,N,3,4,"ul",22),e.qZA()()()),2&n){const t=e.oxw();e.xp6(4),e.Q6J("formControl",t.searchNom),e.xp6(6),e.hij(" ",t.searchClasse?t.searchClasse.libelle:"S\xe9lectionnez une classe"," ")}}function k(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",36)(1,"input",37),e.NdJ("ngModelChange",function(o){e.CHM(t);const a=e.oxw();return e.KtG(a.searchPP=o)})("change",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.onChangePP())}),e.qZA(),e.TgZ(2,"label",38),e._uU(3," Professeur principal "),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",t.searchPP),e.xp6(1),e.uIk("aria-label",t.searchPP?"Afficher l'ensemble des professeurs":"Afficher seulement les professeurs principaux")}}function q(n,c){1&n&&(e.TgZ(0,"tr"),e._UZ(1,"th",44),e.TgZ(2,"th",45),e._uU(3,"Nom"),e.qZA(),e.TgZ(4,"th",46),e._uU(5,"Mati\xe8re"),e.qZA()())}function F(n,c){1&n&&(e.TgZ(0,"th"),e._uU(1,"Professeur Principal"),e.qZA())}function J(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"th",47)(2,"div")(3,"label")(4,"input",48),e.NdJ("change",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.selectAll())})("ngModelChange",function(o){e.CHM(t);const a=e.oxw(3);return e.KtG(a.isSelectAll=o)}),e.qZA()()()(),e.TgZ(5,"th",45),e._uU(6,"Nom"),e.qZA(),e.TgZ(7,"th",46),e._uU(8,"Mati\xe8re"),e.qZA(),e.YNc(9,F,2,0,"th",7),e.qZA()}if(2&n){const t=e.oxw(3);e.xp6(4),e.Q6J("ngModel",t.isSelectAll),e.xp6(5),e.Q6J("ngIf",t.searchClasse)}}function B(n,c){if(1&n&&(e.YNc(0,q,6,0,"tr",42),e.YNc(1,J,10,2,"ng-template",null,43,e.W1O)),2&n){const t=e.MAs(2),s=e.oxw(2);e.Q6J("ngIf",s.sourceModule===s.edModuleCustomCodes.SUIVI_STAGE)("ngIfElse",t)}}function Y(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"tr",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().item,a=e.oxw(2);return e.KtG(a.selectDestinataire(o))}),e.TgZ(1,"td",44)(2,"button",52),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().item,a=e.oxw(2);return e.KtG(a.selectDestinataire(o))}),e.ALo(3,"displayNom"),e.qZA()(),e.TgZ(4,"td"),e._uU(5),e.ALo(6,"displayNom"),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA()()}if(2&n){const t=e.oxw().item,s=e.oxw(2);e.xp6(2),e.uIk("aria-label","S\xe9lectionner le tuteur "+e.lcZ(3,3,t)),e.xp6(3),e.Oqu(e.gM2(6,5,t,!0,!0,s.authStore.isFouE())),e.xp6(3),e.Oqu(t.matiere)}}function R(n,c){if(1&n&&(e._UZ(0,"i",56),e.ALo(1,"displayNom")),2&n){const t=e.oxw(3).item;e.uIk("aria-label",e.lcZ(1,1,t)+" est professeur principal")}}function K(n,c){if(1&n&&(e.TgZ(0,"td"),e.YNc(1,R,2,3,"i",55),e.qZA()),2&n){const t=e.oxw(2).item,s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",s.isPP(t))}}const L=function(n){return{info:n}};function H(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"tr",53),e.NdJ("click",function(o){e.CHM(t);const a=e.oxw().item,l=e.oxw(2);return e.KtG(l.selectDestinataireEnseignant(a,o))}),e.TgZ(1,"td")(2,"div")(3,"label"),e._UZ(4,"input",54),e.ALo(5,"displayNom"),e.qZA()()(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"displayNom"),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.YNc(11,K,2,1,"td",7),e.qZA()}if(2&n){const t=e.oxw().item,s=e.oxw(2);e.Q6J("ngClass",e.VKq(14,L,t.isSelected)),e.xp6(4),e.Q6J("checked",t.isSelected),e.uIk("name","isSelected"+t.uniqID)("aria-label","S\xe9lectionner le destinataire "+e.lcZ(5,7,t)),e.xp6(3),e.Oqu(e.gM2(8,9,t,!0,!0,s.authStore.isFouE())),e.xp6(3),e.Oqu(t.matiere),e.xp6(1),e.Q6J("ngIf",s.searchClasse)}}function Q(n,c){if(1&n&&(e.YNc(0,Y,9,10,"tr",49),e.YNc(1,H,12,16,"ng-template",null,50,e.W1O)),2&n){const t=e.MAs(2),s=e.oxw(2);e.Q6J("ngIf",s.sourceModule===s.edModuleCustomCodes.SUIVI_STAGE)("ngIfElse",t)}}const W=function(){return["nom"]};function $(n,c){if(1&n&&(e.TgZ(0,"ed-smart-table",39),e.ALo(1,"orderBy"),e.YNc(2,B,3,2,"ng-template",40),e.YNc(3,Q,3,2,"ng-template",41),e._UZ(4,"tfoot"),e.qZA()),2&n){const t=e.oxw();e.Q6J("stNBItemsPagination",3)("datas",e.xi3(1,4,t.resultatsSearch,e.DdM(7,W)))("pagination",!0)("trackByFn",t.trackByFn)}}function j(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",57),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.addListesContactsToMessage())}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.hij(" Ajouter ",1===t.getSelectionnes().length?"la personne s\xe9lectionn\xe9e":"les "+t.getSelectionnes().length+" personnes s\xe9lectionn\xe9es"," ")}}function G(n,c){1&n&&(e.TgZ(0,"div",58),e._uU(1,"Aucun contact trouv\xe9 !"),e.qZA())}let z=(()=>{class n extends((0,i.kCV)()){constructor(t,s,o,a,l){super(),this.authStore=t,this.etablissementService=s,this.messagerieService=o,this.modalRef=a,this.uiService=l,this.fonctionDest="des enseignants",this.OPTIONS_TYPE=i.P9Y,this.onClose$=new E.x,this.classes=[],this.searchPP=!1,this.edModuleCustomCodes=i.lFO,this.resultatsSearch=[],this.resultatsFinal=[],this.searchNom=new p.NI("")}ngOnInit(){this.authStore.isEleve()||this.searchNom.valueChanges.pipe((0,x.b)(500),(0,P.x)(),(0,b.R)(this.componentDestroyed$)).subscribe(t=>{this.search(t)})}ngAfterViewInit(){this.getClasses()}ngOnDestroy(){return this.onClose$.complete(),super.ngOnDestroy()}search(t="",s=!1){let o="idClasse",a=0;this.searchClasse&&(a=this.searchClasse.id,this.searchClasse.optionType===i.P9Y.niveau&&(o="idNiveau"),this.searchClasse.optionType===i.P9Y.etab&&(o="idEtab")),this.promiseContents=this.messagerieService.getProfsContacts(o,a,t,this.sourceModule,s).pipe((0,u.U)(l=>new i.b0J(l).contacts),(0,u.U)(l=>l.map(_=>(_.matiere=this.displayMatiere(_,this.searchClasse),_.uniqID=`${_.uniqID}_${i.FSr.getNormalizeString(_.matiere)}`,_)))).subscribe({next:l=>{this.loadResultats(a,o,l,t),this.resultatsSearch.forEach(_=>{const C=this.resultatsFinal.find(V=>_.id===V.id);Object.isExists(C)&&(_.isSelected=C.isSelected)})},error:l=>this.uiService.notifyEvent(l.action,l.message,"Erreur","fa fa-envelope")})}loadResultats(t,s,o,a){if(t>0&&"idClasse"===s&&(o=o.filter(l=>!!l.classes&&l.classes.findIndex(_=>_.id===t)>-1)),i.FSr.isNotEmptyString(a,!0)){i.dR7.calculateDiacriticsMap();const l=new RegExp(`${i.dR7.replaceDiacritics(a)}`,"mi");o=o.filter(_=>i.dR7.replaceDiacritics(_.prenom).search(l)>-1||i.dR7.replaceDiacritics(_.nom).search(l)>-1)}this.searchPP&&this.searchClasse&&(o=o.filter(this.searchClasse.optionType!==i.P9Y.niveau&&this.searchClasse.optionType!==i.P9Y.etab||"niveau"===this.searchClasse.optionType||"etab"===this.searchClasse.optionType&&this.searchClasse.libelle!==i.tHm.TYPE_RECHERCHE.allProfsEtablissements?l=>l.classes.findIndex(_=>_.isPP===this.searchPP)>-1:l=>l.isPP===this.searchPP)),this.resultatsSearch=Array.isArray(o)?o.map(l=>new i.iJ0(l)):[],this.isSelectAll=!1}onChangeClasse(t){this.searchClasse=t,this.searchClasse||(this.searchPP=!1),this.search(this.searchNom.value)}onChangePP(){this.search(this.searchNom.value)}refresh(){this.search(this.searchNom.value,!0)}selectAll(){this.resultatsSearch.forEach(t=>{t.isSelected=!0===this.isSelectAll;const s=this.resultatsFinal.find(o=>t.id===o.id);Object.isExists(s)?s.isSelected=!0===this.isSelectAll:this.resultatsFinal.push(new i.iJ0(t))})}oneIsSelected(){return Object.isExists(this.resultatsFinal)&&this.resultatsFinal.some(t=>!0===t.isSelected)}addListesContactsToMessage(){const t=this.getSelectionnes().map(s=>(s.to_cc_cci=this.toCcCci,s.type=i.dcH.ENSEIGNANT,s));this.onClose$.next(t),this.close()}getSelectionnes(){return this.resultatsFinal.filter(t=>!0===t.isSelected)}getClasses(){this.authStore.isProfOuPersonnel()?this.promiseContents=this.etablissementService.getNiveauxListeAll().pipe((0,u.U)(t=>t.etablissements.map(s=>new i.Gbw(s))),(0,T.x)(()=>{1===this.classes.length?this.onChangeClasse(this.classes[0]):this.onChangeClasse()})).subscribe({next:t=>{this.classes=i.uKw.getClassesAllByNiveauxByEtabs(t).edUniq("uniqueID"),this.classes.unshift({libelle:i.tHm.TYPE_RECHERCHE.allProfsEtablissements,id:0,optionType:i.P9Y.etab,uniqueID:"0__",code:""})},error:t=>this.uiService.notifyEvent(t.action,"Une erreur est survenue lors de la r\xe9cup\xe9ration des classes","Erreur","fa fa-envelope")}):(this.classes=this.authStore.getClasses().map(t=>({...t,optionType:i.P9Y.classe,uniqueID:`${t.id}__`})).edUniq("uniqueID"),1===this.classes.length?this.onChangeClasse(this.classes[0]):this.onChangeClasse())}displayMatiere(t,s){return i.tHm.displayMatiere(t,s)}isPP(t){return i.tHm.isPP(t,this.searchClasse)}close(){this.modalRef.hide()}selectDestinataire(t){this.onClose$.next([t]),this.close()}selectDestinataireEnseignant(t,s){s.stopPropagation(),t.isSelected=!t.isSelected;const o=this.resultatsFinal.find(a=>t.id===a.id);Object.isExists(o)?o.isSelected=!o.isSelected:this.resultatsFinal.push(new i.iJ0(t))}trackByFn(){return(new d.$).transform("uniqID")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(i.CnD),e.Y36(i.Xmb),e.Y36(i.KRh),e.Y36(M.UZ),e.Y36(i.VLf))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-compose-selection-enseignant-eag"]],inputs:{toCcCci:"toCcCci",sourceModule:"sourceModule",fonctionDest:"fonctionDest"},features:[e.qOj],decls:22,vars:8,consts:[[1,"modal-header"],[1,"modal-title"],["title","Rafra\xeechir les contacts","type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body","selectDestinataires",3,"ngBusy"],["name","selectDestinataires","novalidate",""],[4,"ngIf"],["class","form-check float-end mt-2",4,"ngIf"],[1,"clearfix"],["role","separator",1,"margin-top-10"],[3,"stNBItemsPagination","datas","pagination","trackByFn",4,"ngIf","ngIfElse"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","button","class","btn btn-primary float-end",3,"click",4,"ngIf"],["nolistescontacts",""],["for","nom",1,"form-label"],["name","nom","id","nom","type","search","edAutofocus","",1,"form-control","floating-label",3,"formControl"],[1,"mt-2"],["dropdown","",1,"dropdown"],["type","button","id","dropdown1","aria-controls","dropdown-classe","dropdownToggle","",1,"btn","btn-secondary","dropdown-toggle","form-control","classe-selection"],["aria-labelledby","dropdown1","class","dropdown-menu classe-selection","role","menu","id","dropdown-classe",4,"dropdownMenu"],["aria-labelledby","dropdown1","role","menu","id","dropdown-classe",1,"dropdown-menu","classe-selection"],["role","menuitem",4,"ngFor","ngForOf","ngForTrackBy"],["role","menuitem"],[3,"ngSwitch"],["type","button","class","etab-option dropdown-item",3,"click",4,"ngSwitchCase"],["type","button","class","niveau-option dropdown-item",3,"click",4,"ngSwitchCase"],["type","button","class","dropdown-item",3,"ngClass","click",4,"ngSwitchCase"],["type","button",1,"etab-option","dropdown-item",3,"click"],["aria-hidden","true",1,"fa","fa-institution"],[1,"margin-whitespace"],["type","button",1,"niveau-option","dropdown-item",3,"click"],["aria-hidden","true",1,"fa","fa-bars"],["type","button",1,"dropdown-item",3,"ngClass","click"],[1,"form-check","float-end","mt-2"],["id","isPP","type","checkbox","name","searchPP",1,"form-check-input",3,"ngModel","ngModelChange","change"],["for","isPP",1,"form-check-label","fw-normal"],[3,"stNBItemsPagination","datas","pagination","trackByFn"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],[4,"ngIf","ngIfElse"],["autreTh",""],[1,"screen-reader"],["stSort","nom",1,"cliquable","sortable-header"],["stSort","matiere",1,"cliquable","sortable-header"],[1,"col-lg-1"],["type","checkbox","name","isSelectAll",1,"form-check-input",3,"ngModel","change","ngModelChange"],["class","text-center cliquable",3,"click",4,"ngIf","ngIfElse"],["autreTr",""],[1,"text-center","cliquable",3,"click"],["type","button",3,"click"],[1,"text-center","cliquable",3,"ngClass","click"],["type","checkbox",1,"form-check-input",3,"checked"],["class","fa fa-check",4,"ngIf"],[1,"fa","fa-check"],["type","button",1,"btn","btn-primary","float-end",3,"click"],[1,"alert","alert-dark"]],template:function(t,s){if(1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2),e.TgZ(3,"button",2),e.NdJ("click",function(){return s.refresh()}),e._UZ(4,"i",3),e.qZA()(),e.TgZ(5,"button",4),e.NdJ("click",function(){return s.close()}),e.qZA()(),e.TgZ(6,"div",5)(7,"form",6),e.YNc(8,U,12,2,"div",7),e.YNc(9,k,4,2,"div",8),e._UZ(10,"div",9)(11,"hr",10),e.TgZ(12,"h3"),e._uU(13),e.qZA(),e.YNc(14,$,5,8,"ed-smart-table",11),e.qZA()(),e.TgZ(15,"div",12)(16,"div",13)(17,"button",14),e.NdJ("click",function(){return s.close()}),e._uU(18,"Fermer"),e.qZA(),e.YNc(19,j,2,1,"button",15),e.qZA()(),e.YNc(20,G,2,0,"ng-template",null,16,e.W1O)),2&t){const o=e.MAs(21);e.xp6(2),e.hij(" Recherchez ",s.fonctionDest," "),e.xp6(4),e.Q6J("ngBusy",s.promiseContents),e.xp6(2),e.Q6J("ngIf",!s.authStore.isEleve()),e.xp6(1),e.Q6J("ngIf",s.searchClasse),e.xp6(4),e.hij("S\xe9lectionnez ",s.fonctionDest,""),e.xp6(1),e.Q6J("ngIf",s.resultatsSearch.length>0)("ngIfElse",o),e.xp6(5),e.Q6J("ngIf",s.oneIsSelected()&&s.sourceModule!==s.edModuleCustomCodes.SUIVI_STAGE)}},dependencies:[g.mk,g.sg,g.O5,g.RF,g.n9,p._Y,p.Fj,p.Wl,p.JJ,p.JL,p.On,p.F,p.oH,m.Hz,m.Mq,m.TO,S.DC,O.L,A.c,h.r,h.w,Z.U,i.$t3,i.d0N,d.$],styles:['.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .radio[_ngcontent-%COMP%]{margin:2px 0 0}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .sortable-header[_ngcontent-%COMP%]{cursor:pointer}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .sortable-header[_ngcontent-%COMP%]:before{content:"\\f0dc";display:inline-block;font: 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transform:translate(0);margin-right:5px}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button.classe-selection[_ngcontent-%COMP%]{text-align:left}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   ul.classe-selection[_ngcontent-%COMP%]{width:100%}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .etab-option[_ngcontent-%COMP%]{padding-left:5px}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .etab-option[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--light-primary-color)}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .niveau-option[_ngcontent-%COMP%]{padding-left:35px}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .classe-option[_ngcontent-%COMP%]{padding-left:65px}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .all-option[_ngcontent-%COMP%]{padding-left:15px}']}),n})()}}]);