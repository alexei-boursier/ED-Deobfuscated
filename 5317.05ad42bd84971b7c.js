"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[5317],{75317:(Qn,O,u)=>{u.r(O),u.d(O,{EDFormsModule:()=>xn});var $=u(99658),K=u(38804),v=u(95715),V=u(39841),N=u(39646),I=u(60515),q=u(18505),y=u(82722),Z=u(39300),E=u(54004),Q=u(70262),x=u(28746),g=u(95698),U=u(63900),a=u(45007),w=u(87192),k=u(52497),A=u(77579),F=u(11302),j=u(57701),z=u(89379),X=u(48693),W=u(3374),ee=u(94024),te=u(4714),ne=u(17124),oe=u(38947),e=u(94650),_=u(20388),d=u(36895),l=u(24006),T=u(4358),Y=u(91752),b=u(80125),ie=u(9582),se=u(20395),h=u(4602);const re=["editFSForm"];function ae(o,s){if(1&o&&(e.TgZ(0,"div",48)(1,"p",17),e._uU(2),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.hij(" Le ","f"===t.fs.typeF?"formulaire":"sondage"," a bien \xe9t\xe9 dupliqu\xe9 sur l'ann\xe9e en cours. Vous pouvez maintenant le modifier si vous le souhaitez. ")}}function ce(o,s){1&o&&(e.TgZ(0,"alert",49)(1,"strong"),e._uU(2,"Attention !"),e.qZA(),e._uU(3," Certains champs ne sont pas renseign\xe9s ou sont incorrects "),e.qZA()),2&o&&e.Q6J("dismissible",!0)}function ue(o,s){1&o&&(e.TgZ(0,"span",50),e._uU(1,"Saisissez un titre !"),e.qZA())}function le(o,s){1&o&&(e.TgZ(0,"span",50),e._uU(1,"Saisissez un texte d'introduction !"),e.qZA())}function de(o,s){1&o&&(e.TgZ(0,"span",50),e._uU(1,"Saisissez un texte de conclusion !"),e.qZA())}function pe(o,s){1&o&&(e.TgZ(0,"span",17),e._uU(1,"Les r\xe9ponses d'un sondage sont anonymes."),e.qZA())}function me(o,s){1&o&&(e.TgZ(0,"span",50),e._uU(1,"Choisissez un type de formulaire !"),e.qZA())}function fe(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",32)(1,"div",51)(2,"div",41)(3,"input",52),e.NdJ("ngModelChange",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.fs.signature=i)}),e.qZA(),e.TgZ(4,"label",53),e._uU(5,"Signature demand\xe9e"),e.qZA(),e.TgZ(6,"span",17),e._uU(7," Si coch\xe9, les participants devront signer le formulaire apr\xe8s la derni\xe8re question. Un num\xe9ro de mobile doit \xeatre renseign\xe9 pour chacun d'eux. "),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.fs.signature)}}function _e(o,s){1&o&&(e.TgZ(0,"span"),e._uU(1,"Aucun participant s\xe9lectionn\xe9"),e.qZA())}function ge(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"ed-groupe-destinataire",54),e.NdJ("editDestinataires",function(i){const c=e.CHM(t).index,p=e.oxw();return e.KtG(p.onEditDestinataires(i,c))})("removeDestinataires",function(i){const c=e.CHM(t).index,p=e.oxw();return e.KtG(p.onRemoveDestinataires(i,c))}),e.qZA()}if(2&o){const t=s.$implicit;e.s9C("type",t.selection.type),e.Q6J("destinataires",t.destinataires)}}const C=function(o){return{"has-error":o}};let he=(()=>{class o{constructor(t,n,i,r,c){this.authStore=t,this.modalRef=n,this.edfService=i,this.modalService=r,this.uiService=c,this.questionnaireTypeInverse=a.j4M,this.ckConf=F.x$,this.parametrages=new a.aA2({destProf:!0,destAdmin:!0,destEleve:!0,destFamille:!0,destEspTravail:!0,hideListesContacts:!1}),this.encours=!1,this.demandeSignatureActif=!1,this.participants={groupesDestinataires:[]},this.isDupliqAnneePrecedente=!1,this.onClose$=new A.x}ngOnInit(){if(this.pageTitre=this.fs.id>0?`Modifier : ${this.fs.titre}`:"Nouveau formulaire",this.fs.introductionDecode=a.FSr.isNotEmptyString(this.fs.introduction)?a.YC.base64decode(this.fs.introduction):"",this.fs.conclusionDecode=a.FSr.isNotEmptyString(this.fs.conclusion)?a.YC.base64decode(this.fs.conclusion):"",this.demandeSignatureActif="1"===a.Kg5.getModuleParametre(a.qzA.EDFORMS,"demandeSignatureActif",this.authStore.currentUser),this.fs.participants.length>0){const t={selection:{type:"participant"},destinataires:[]};t.destinataires=this.fs.participants.map(n=>({id:n.idUser,type:n.typeUser,to_cc_cci:"to",prenom:n.prenom,nom:n.nom,particule:n.particule,civilite:n.civilite,participant:{fini:n.fini}})),this.participants.groupesDestinataires=[t]}}onCKReady(t){(0,F.UZ)(t)}onSubmit(){if(this.formFS.valid&&!this.encours){if(this.encours=!0,this.fs.introductionDecode.length>1572864||this.fs.conclusionDecode.length>1572864)return this.uiService.notifyEvent(a.DOJ.genericError,"Enregistrement impossible. Votre saisie est trop grande (>1.5Mo).","Erreur","icon-ed_edforms"),void(this.encours=!1);const t=new a.U0N(this.fs);t.introduction=a.YC.base64encode(t.introductionDecode),t.conclusion=a.YC.base64encode(t.conclusionDecode),t.resume=a.YC.base64encode(j.V.strip(t.introductionDecode)),delete t.introductionDecode,delete t.conclusionDecode,t.typeF===a.j4M.sondage&&(t.signature=!1),t.participants=this.participants.groupesDestinataires.reduce((n,i)=>(i.destinataires.forEach(r=>{let c;c=(r.type===a.dcH.FAMILLE_RESPONSABLE||r.type===a.dcH.FAMILLE_CONJOINT)&&Object.isExists(r.responsable)&&r.responsable.id>0?new a.Noz({idUser:r.responsable.id,typeUser:r.responsable.versQui===a.dcH.FAMILLE_CONJOINT?a.dcH.FAMILLE_CONJOINT:a.dcH.FAMILLE_RESPONSABLE,prenom:"",nom:Object.isExists(r.responsable.contacts)&&r.responsable.contacts.length>0?r.responsable.contacts[0]:"",particule:"",civilite:"",versQui:r.responsable.versQui}):new a.Noz({idUser:r.id,typeUser:r.type,prenom:r.prenom,nom:r.nom,particule:r.particule,civilite:r.civilite}),Object.isExists(r.participant)&&(c.fini=r.participant.fini),-1===n.findIndex(f=>c.idUser===f.idUser&&c.typeUser===f.typeUser)&&n.push(c)}),n),[]),this.loader=this.edfService.saveFS(t).pipe((0,x.x)(()=>this.encours=!1)).subscribe({next:()=>{this.uiService.notifyEvent(a.DOJ.genericSuccess,"Votre questionnaire a bien \xe9t\xe9 enregistr\xe9.","Formulaires et sondages","icon-ed_edforms"),this.close(!0)},error:n=>this.uiService.notifyEvent(n.action,"Une erreur s'est produite lors de l'enregistrement de votre questionnaire.","Erreur","icon-ed_edforms")})}}cleanTags(){for(let t=0;t<this.participants.groupesDestinataires.length;t++)0===this.participants.groupesDestinataires[t].destinataires.length&&this.participants.groupesDestinataires.splice(t,1)}onRemoveDestinataires(t,n){if(n>-1)this.participants.groupesDestinataires[n].destinataires=this.participants.groupesDestinataires[n].destinataires.reduce((i,r)=>(-1===t.findIndex(p=>r.id===p.id)&&i.push(r),i),[]);else for(let i=0;i<this.participants.groupesDestinataires.length;i++)this.participants.groupesDestinataires[i].destinataires=this.participants.groupesDestinataires[i].destinataires.reduce((r,c)=>(-1===t.findIndex(f=>c.id===f.id)&&r.push(c),r),[]);this.cleanTags()}onComposeSelection(t,n){this.modalService.show({F:X.u,E:W.w,A:ee.w,P:z.r,W:te.O}[t],{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{toCcCci:n,sourceModule:a.qzA.EDFORMS},class:"modal-lg"}).content.onClose$.pipe((0,g.q)(1)).subscribe(c=>{if(Array.isArray(c)&&c.length>0){let p;switch(t){case a.dcH.FAMILLE_CONJOINT:case"F":p=a.dcH.FAMILLE_RESPONSABLE;break;case a.dcH.ELEVE:case a.dcH.ENSEIGNANT:case a.dcH.PERSONNEL:case a.dcH.FAMILLE_RESPONSABLE:case"W":p=t}this.addGroupeDestinataire({destinataires:c,selection:{type:p}})}})}onComposeSelectionListeContacts(t){this.modalService.show(ne.L,{id:this.modalService.getModalsCount()+1,initialState:{toCcCci:t},class:"modal-lg"}).content.onClose$.pipe((0,g.q)(1)).subscribe(i=>{Array.isArray(i)&&i.length>0&&i.forEach(r=>{this.addGroupeDestinataire(r)})})}addGroupeDestinataire(t){const n={destinataires:[...t.destinataires],selection:{...t.selection}};return this.participants.groupesDestinataires.push(n),n}onEditDestinataires(t,n){this.modalService.show(oe.w,{id:this.modalService.getModalsCount()+1,initialState:{destinataires:t,title:"liste des participants"},class:"modal-lg"}).content.onClose$.pipe((0,g.q)(1)).subscribe(r=>{Array.isArray(r)&&r.length>0&&this.onRemoveDestinataires(r,n)})}close(t){t&&this.onClose$.next(!0),this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(a.CnD),e.Y36(_.UZ),e.Y36(a.i4Q),e.Y36(_.tT),e.Y36(a.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-fs-manage"]],viewQuery:function(t,n){if(1&t&&e.Gf(re,5),2&t){let i;e.iGM(i=e.CRH())&&(n.formFS=i.first)}},inputs:{fs:"fs",isDupliqAnneePrecedente:"isDupliqAnneePrecedente"},decls:81,vars:46,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body",3,"ngBusy"],["class","margin-bottom-10",4,"ngIf"],["name","editFSForm","novalidate","",1,"row",3,"ngSubmit"],["editFSForm","ngForm"],["type","danger",3,"dismissible",4,"ngIf"],[1,"row","required",3,"ngClass"],["for","titre",1,"col-md-2","col-form-label"],[1,"col-md-10"],["name","titre","type","text","id","titre","required","",1,"form-control",3,"ngModel","ngModelChange"],["titre","ngModel"],["class","text-danger",4,"ngIf"],["for","introductionDecode",1,"col-md-2","col-form-label"],["id","introductionDecode","name","introductionDecode","required","",3,"config","ngModel","ready","ngModelChange"],["introductionDecode","ngModel"],[1,"form-text"],["for","conclusionDecode",1,"col-md-2","col-form-label"],["id","conclusionDecode","name","conclusionDecode","required","",3,"config","ngModel","ready","ngModelChange"],["conclusionDecode","ngModel"],["for","typeF",1,"col-md-2","col-form-label"],[1,"input-group"],["name","typeF","id","typeF","required","",1,"form-control","form-select",3,"disabled","ngModel","ngModelChange"],["typeF","ngModel"],[3,"ngValue"],["value","f"],["value","s"],["class","form-text",4,"ngIf"],["class","row",4,"ngIf"],["id","container-fs-choose-dests",1,"row"],[1,"col-md-2","texte-label"],[1,"row"],[1,"col-md-5","col-lg-5","col-xl-5"],[1,"input-destinataires","centpourcent"],[4,"ngIf"],["toCcCci","to",3,"destinataires","type","editDestinataires","removeDestinataires",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-md-7","col-lg-7","col-xl-7"],[1,"float-end"],[3,"parametrages","composeSelection","composeSelectionListeContacts"],[1,"offset-md-2","col-md-10"],[1,"form-check"],["name","fInsteadOfE","type","checkbox","id","checkParticipantFamille",1,"form-check-input",3,"ngModel","ngModelChange"],["for","checkParticipantFamille",1,"form-check-label","fw-normal"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","button",1,"btn","btn-success","float-end",3,"disabled","click"],[1,"margin-bottom-10"],["type","danger",3,"dismissible"],[1,"text-danger"],[1,"offset-sm-2","col-md-6"],["name","signature","type","checkbox","id","checkAvecSignature",1,"form-check-input",3,"ngModel","ngModelChange"],["for","checkAvecSignature",1,"form-check-label","fw-normal"],["toCcCci","to",3,"destinataires","type","editDestinataires","removeDestinataires"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(4,"div",3),e.YNc(5,ae,3,1,"div",4),e.TgZ(6,"form",5,6),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.YNc(8,ce,4,1,"alert",7),e.TgZ(9,"div",8)(10,"label",9),e._uU(11,"Titre"),e.qZA(),e.TgZ(12,"div",10)(13,"input",11,12),e.NdJ("ngModelChange",function(r){return n.fs.titre=r}),e.qZA(),e.YNc(15,ue,2,0,"span",13),e.qZA()(),e.TgZ(16,"div",8)(17,"label",14),e._uU(18,"Introduction"),e.qZA(),e.TgZ(19,"div",10)(20,"ckeditor",15,16),e.NdJ("ready",function(r){return n.onCKReady(r)})("ngModelChange",function(r){return n.fs.introductionDecode=r}),e.qZA(),e.TgZ(22,"span",17),e._uU(23,"Ce texte sera affich\xe9 au d\xe9marrage du questionnaire."),e.qZA(),e.YNc(24,le,2,0,"span",13),e.qZA()(),e.TgZ(25,"div",8)(26,"label",18),e._uU(27,"Conclusion"),e.qZA(),e.TgZ(28,"div",10)(29,"ckeditor",19,20),e.NdJ("ready",function(r){return n.onCKReady(r)})("ngModelChange",function(r){return n.fs.conclusionDecode=r}),e.qZA(),e.TgZ(31,"span",17),e._uU(32,"Ce texte sera affich\xe9 une fois les r\xe9ponses envoy\xe9es par l'utilisateur."),e.qZA(),e.YNc(33,de,2,0,"span",13),e.qZA()(),e.TgZ(34,"div",8)(35,"label",21),e._uU(36,"Type de formulaire"),e.qZA(),e.TgZ(37,"div",10)(38,"div",22)(39,"select",23,24),e.NdJ("ngModelChange",function(r){return n.fs.typeF=r}),e._UZ(41,"option",25),e.TgZ(42,"option",26),e._uU(43,"Formulaire"),e.qZA(),e.TgZ(44,"option",27),e._uU(45,"Sondage"),e.qZA()()(),e.YNc(46,pe,2,0,"span",28),e.YNc(47,me,2,0,"span",13),e.qZA()(),e.YNc(48,fe,8,1,"div",29),e.TgZ(49,"div",30)(50,"strong",31),e._uU(51,"Participants"),e.qZA(),e.TgZ(52,"div",10)(53,"div",32)(54,"div",33)(55,"div",34),e.YNc(56,_e,2,0,"span",35),e.YNc(57,ge,1,2,"ed-groupe-destinataire",36),e.ALo(58,"trackByProperty"),e.qZA()(),e.TgZ(59,"div",37)(60,"div",38)(61,"ed-choose-destinataire-tag",39),e.NdJ("composeSelection",function(r){return n.onComposeSelection(r,"to")})("composeSelectionListeContacts",function(){return n.onComposeSelectionListeContacts("to")}),e.qZA()()()()()(),e.TgZ(62,"div",32)(63,"div",40)(64,"div",41)(65,"input",42),e.NdJ("ngModelChange",function(r){return n.fs.fInsteadOfE=r}),e.qZA(),e.TgZ(66,"label",43),e._uU(67," Les familles des "),e.TgZ(68,"strong"),e._uU(69,'participants de type "\xe9l\xe8ve" s\xe9lectionn\xe9s'),e.qZA(),e._uU(70," r\xe9pondront \xe0 ce questionnaire \xe0 leur place. "),e.qZA(),e.TgZ(71,"span",17),e._uU(72," Cochez cette option, si il s'agit par exemple d'un questionnaire pour obtenir des informations sp\xe9cifiques \xe0 chaque \xe9l\xe8ve de la part de la famille. "),e._UZ(73,"br"),e._uU(74," Dans ce cas, il ne sera plus affich\xe9 aux \xe9l\xe8ves, mais \xe0 la famille. "),e.qZA()()()()()(),e.TgZ(75,"div",44)(76,"div",45)(77,"button",46),e.NdJ("click",function(){return n.close()}),e._uU(78,"Annuler"),e.qZA(),e.TgZ(79,"button",47),e.NdJ("click",function(){return n.formFS.ngSubmit.emit()}),e._uU(80,"Sauvegarder"),e.qZA()()()),2&t){const i=e.MAs(7),r=e.MAs(14),c=e.MAs(21),p=e.MAs(30),f=e.MAs(40);e.xp6(2),e.Oqu(n.pageTitre),e.xp6(2),e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("ngIf",n.isDupliqAnneePrecedente),e.xp6(3),e.Q6J("ngIf",i.submitted&&i.invalid),e.xp6(1),e.Q6J("ngClass",e.VKq(34,C,r.invalid)),e.xp6(4),e.Q6J("ngModel",n.fs.titre),e.xp6(2),e.Q6J("ngIf",null==r.errors?null:r.errors.required),e.xp6(1),e.Q6J("ngClass",e.VKq(36,C,c.invalid)),e.xp6(4),e.Tol(e.VKq(38,C,c.invalid&&(c.dirty||c.touched))),e.Q6J("config",n.ckConf)("ngModel",n.fs.introductionDecode),e.xp6(4),e.Q6J("ngIf",null==c.errors?null:c.errors.required),e.xp6(1),e.Q6J("ngClass",e.VKq(40,C,p.invalid)),e.xp6(4),e.Tol(e.VKq(42,C,p.invalid&&(p.dirty||p.touched))),e.Q6J("config",n.ckConf)("ngModel",n.fs.conclusionDecode),e.xp6(4),e.Q6J("ngIf",null==p.errors?null:p.errors.required),e.xp6(1),e.Q6J("ngClass",e.VKq(44,C,f.invalid)),e.xp6(5),e.Q6J("disabled",n.fs.id>0)("ngModel",n.fs.typeF),e.xp6(2),e.Q6J("ngValue",null),e.xp6(5),e.Q6J("ngIf",n.fs.typeF===n.questionnaireTypeInverse.sondage),e.xp6(1),e.Q6J("ngIf",null==f.errors?null:f.errors.required),e.xp6(1),e.Q6J("ngIf",n.fs.typeF===n.questionnaireTypeInverse.formulaire&&n.demandeSignatureActif),e.xp6(8),e.Q6J("ngIf",!n.participants.groupesDestinataires.length),e.xp6(1),e.Q6J("ngForOf",n.participants.groupesDestinataires)("ngForTrackBy",e.lcZ(58,32,"$index")),e.xp6(4),e.Q6J("parametrages",n.parametrages),e.xp6(4),e.Q6J("ngModel",n.fs.fInsteadOfE),e.xp6(14),e.Q6J("disabled",null==i?null:i.invalid)}},dependencies:[d.mk,d.sg,d.O5,l._Y,l.YN,l.Kr,l.Fj,l.Wl,l.EJ,l.JJ,l.JL,l.Q7,l.On,l.F,T.wx,Y.u,b.DC,ie.G,se.F,h.$],styles:['.required[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]:after{content:"*";color:red;padding-left:5px}#container-fs-choose-dests[_ngcontent-%COMP%]{padding-top:40px}#container-fs-choose-dests[_ngcontent-%COMP%]   h2.titre[_ngcontent-%COMP%]{font-size:22px}#container-fs-choose-dests[_ngcontent-%COMP%]   .input-destinataires[_ngcontent-%COMP%]{border:1px solid var(--dark-placeholder-color);border-radius:4px;height:34px;padding:6px 12px;color:#555;display:inline-table;box-shadow:inset 0 1px 1px #00000013}#container-fs-choose-dests[_ngcontent-%COMP%]   .show-all[_ngcontent-%COMP%]{margin-left:8px}#container-fs-choose-dests[_ngcontent-%COMP%]   .toolbar-selection[_ngcontent-%COMP%]{margin-bottom:5px}#container-fs-choose-dests[_ngcontent-%COMP%]   .btn-destinataires[_ngcontent-%COMP%]   a.btn[_ngcontent-%COMP%]{text-transform:none}#container-fs-choose-dests[_ngcontent-%COMP%]   .cc-to[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]{cursor:pointer}#container-fs-choose-dests[_ngcontent-%COMP%]   .cc-to[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{min-width:20px;right:0;left:unset}#container-fs-choose-dests[_ngcontent-%COMP%]   .btn-tocccci[_ngcontent-%COMP%]   a.btn-secondary[_ngcontent-%COMP%]{padding:8px}']}),o})();var ve=u(70655);let m=class extends a.yh4{constructor(s,t){super(t),this.authStore=s,this.devTool=t}updateStore(s,t,n,i,r=[]){const c=a.$ej.edDBUserSpecificKey(s,t,n,r);this.store=new a.SnS({variantDefault:c,typeUser:t,idUser:n,choosenAnnee:i})}updateChoosenAnnee(s){this.store=new a.SnS({...this.snapshot,choosenAnnee:s})}getAnneesEDFormsArchive(){return this.authStore.isProfOuPersonnel()?this.authStore.getAnneesArchive(3):this.authStore.getAnneesArchive(1)}selectChoosenAnnee(){return this.select$(s=>s.choosenAnnee)}reset(){super.reset()}};m.\u0275fac=function(s){return new(s||m)(e.LFG(a.CnD),e.LFG(a.lbX))},m.\u0275prov=e.Yz7({token:m,factory:m.\u0275fac}),m=(0,ve.gn)([(0,a.pcA)({classInstanceRef:a.SnS,resetWhenSwipe:!0,className:"EDFormsUserStore"})],m);var P=u(55253),be=u(77069),L=u(99533),Fe=u(43422),B=u(39653),R=u(67451);function Ce(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.refresh(!0))}),e._UZ(1,"i",18),e.qZA()}}function qe(o,s){if(1&o&&(e.TgZ(0,"button",19),e._UZ(1,"i",20),e.qZA()),2&o){const t=e.oxw();e.Q6J("typeContact",t.edModuleCodes.MESSAGERIE)("listContact",t.fs.nonFinisAsContacts)}}function xe(o,s){if(1&o&&(e.TgZ(0,"button",21),e._UZ(1,"i",22),e.qZA()),2&o){const t=e.oxw();e.s9C("fileId",t.fs.id),e.Q6J("fileType",t.typeFichierTelechargement.FICHIER_EDFORMS_SIGNATURES)}}function Te(o,s){1&o&&(e.TgZ(0,"alert",23),e._uU(1,"Aucune donn\xe9e disponible !"),e.qZA())}function Se(o,s){if(1&o&&(e.TgZ(0,"div",27)(1,"div",28)(2,"div",29),e._uU(3),e.TgZ(4,"strong"),e._uU(5),e.qZA(),e._uU(6," ) "),e.qZA(),e.TgZ(7,"div",30),e._uU(8,"termin\xe9(s)"),e.qZA()()()),2&o){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.resultatsFS.combienEnded," ( "),e.xp6(2),e.hij("",t.resultatsFS.pourcentageTermine," %")}}function ye(o,s){if(1&o&&(e.TgZ(0,"div",24)(1,"div",25)(2,"div",26)(3,"div",27)(4,"div",28)(5,"div",29),e._uU(6),e.qZA(),e.TgZ(7,"div",30),e._uU(8,"participant(s)"),e.qZA()()(),e.YNc(9,Se,9,2,"div",31),e.qZA()()()),2&o){const t=e.oxw();e.xp6(6),e.Oqu(t.resultatsFS.combienParticipants),e.xp6(3),e.Q6J("ngIf",t.resultatsFS.combienParticipants>0)}}function Ze(o,s){1&o&&(e.TgZ(0,"span",15),e._uU(1,"*"),e.qZA())}function Qe(o,s){if(1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",41)(2,"span",42),e.ALo(3,"filterHtml"),e.ALo(4,"replaceFormulaQuestionProp"),e.ALo(5,"base64"),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("content",t.enonce)("innerHTML",e.xi3(3,2,e.lcZ(4,5,e.lcZ(5,7,t.enonce)),!0),e.oJD)}}function Ae(o,s){if(1&o&&(e.TgZ(0,"div"),e._UZ(1,"i",43)(2,"span",42),e.ALo(3,"filterHtml"),e.ALo(4,"replaceFormulaQuestionProp"),e.ALo(5,"base64"),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("content",t.enonce)("innerHTML",e.xi3(3,2,e.lcZ(4,5,e.lcZ(5,7,t.enonce)),!0),e.oJD)}}function Me(o,s){1&o&&(e.TgZ(0,"div"),e._uU(1,"\xa0"),e.qZA())}function Ee(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"td",34)(2,"div",39),e.YNc(3,Qe,6,9,"div",40),e.YNc(4,Ae,6,9,"div",40),e.YNc(5,Me,2,0,"div",40),e.qZA()(),e.TgZ(6,"td"),e._uU(7),e.TgZ(8,"strong"),e._uU(9),e.qZA(),e._uU(10," ) "),e.qZA()()),2&o){const t=s.$implicit,n=e.oxw().$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("ngSwitch",n.typeQ),e.xp6(1),e.Q6J("ngSwitchCase",i.questionBaseType.radio.id),e.xp6(1),e.Q6J("ngSwitchCase",i.questionBaseType.checkbox.id),e.xp6(1),e.Q6J("ngSwitchCase",i.questionBaseType.textarea.id),e.xp6(2),e.hij(" ",t.choisie," ( "),e.xp6(2),e.hij("",i.displayStatProposition(t)," %")}}function Ue(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"tr",36)(2,"td",37),e._uU(3),e.ALo(4,"base64"),e.YNc(5,Ze,2,0,"span",38),e.qZA()(),e.YNc(6,Ee,11,6,"tr",35),e.ALo(7,"trackByProperty"),e.BQk()),2&o){const t=s.$implicit;e.xp6(3),e.hij(" ",e.xi3(4,4,t.question,"decode")," "),e.xp6(2),e.Q6J("ngIf",t.required),e.xp6(1),e.Q6J("ngForOf",t.propositions)("ngForTrackBy",e.lcZ(7,7,"id"))}}function we(o,s){if(1&o&&(e.TgZ(0,"div",32)(1,"table",33)(2,"thead")(3,"tr")(4,"th",34),e._uU(5,"Question et propositions"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"ont r\xe9pondu"),e.qZA()()(),e.TgZ(8,"tbody"),e.YNc(9,Ue,8,9,"ng-container",35),e.ALo(10,"trackByProperty"),e.qZA()()()),2&o){const t=e.oxw();e.xp6(9),e.Q6J("ngForOf",t.resultatsFS.questions)("ngForTrackBy",e.lcZ(10,2,"id"))}}const ke=function(o){return{anneeForms:o}};let Je=(()=>{class o{constructor(t,n,i,r,c,p){this.modalRef=t,this.edfService=n,this.uiService=i,this.edFormsUserStore=r,this.authStore=c,this.cloudService=p,this.typeFichierTelechargement=a.Y9E,this.questionBaseType=a.xq9,this.apiExtension=F.sX.apiExtension,this.apiUri=(0,F.Je)(),this.resultatsFS=new a.Xhd,this.edTypeFichier=a.Vav,this.edModuleCodes=a.qzA}get fUser(){return this.edFormsUserStore.snapshot}ngOnInit(){this.refresh()}refresh(t=!1){if(t){const n=this.file("edforms/"+this.fs.id+"/resultats");this.cloudService.clearCacheBlobFile(n.id,n.url)}this.loader=this.edfService.getResultatsFormulaire(this.fs.id,this.fUser.choosenAnnee,t).subscribe({next:n=>{this.resultatsFS=new a.Xhd(n)},error:n=>this.uiService.notifyEvent(a.DOJ.genericError,"Une erreur s'est produite lors de la r\xe9cup\xe9ration des donn\xe9es.","Erreur","icon-ed_edforms")})}displayStatProposition(t){return 0===this.resultatsFS.combienParticipants?0:Math.round(t.choisie/this.resultatsFS.combienParticipants*100)}close(){this.modalRef.hide()}file(t=""){const n=new a.eD9;return n.id=this.fs.id.toString(),n.libelle=this.fs.titre,n.type=this.edTypeFichier.FICHIER_PRELOADED,n.url=t,n}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.UZ),e.Y36(a.i4Q),e.Y36(a.VLf),e.Y36(m),e.Y36(a.CnD),e.Y36(a.eyc))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-fs-resultats"]],inputs:{fs:"fs"},decls:22,vars:14,consts:[[1,"modal-header"],[1,"modal-title"],[1,"icon-ed_edforms"],["class","btn btn-secondary btn-sm","title","Rafra\xeechir les donn\xe9es","type","button",3,"click",4,"ngIf"],["type","button","edMessageTo","","class","btn btn-secondary btn-sm d-print-none margin-whitespace","title","Relancer les participants qui n'ont pas encore termin\xe9",3,"typeContact","listContact",4,"ngIf"],["edLightbox","","href","","type","button","title","Exporter les donn\xe9es",1,"btn","btn-secondary","btn-sm","d-print-none","margin-whitespace",3,"file","typeFichier","otherTypeDL","additionalData"],["aria-hidden","true",1,"fa","fa-file-excel-o"],["edTelechargement","","href","","type","button","class","btn btn-secondary btn-sm d-print-none margin-whitespace","title","T\xe9l\xe9charger l'ensemble des signatures",3,"fileId","fileType",4,"ngIf"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body",3,"ngBusy"],["type","warning",4,"ngIf"],["class","stats-participant",4,"ngIf"],["class","table-responsive",4,"ngIf"],[1,"modal-footer"],[1,"legende"],[1,"requis"],["type","button",1,"margin-top-10","btn","btn-primary","float-end",3,"click"],["title","Rafra\xeechir les donn\xe9es","type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],["type","button","edMessageTo","","title","Relancer les participants qui n'ont pas encore termin\xe9",1,"btn","btn-secondary","btn-sm","d-print-none","margin-whitespace",3,"typeContact","listContact"],["aria-hidden","true",1,"fa","fa-envelope"],["edTelechargement","","href","","type","button","title","T\xe9l\xe9charger l'ensemble des signatures",1,"btn","btn-secondary","btn-sm","d-print-none","margin-whitespace",3,"fileId","fileType"],["aria-hidden","true",1,"fa","fa-download"],["type","warning"],[1,"stats-participant"],[1,"recap-participant-fs"],[1,"row","g-2","justify-content-center"],[1,"col-md-3"],[1,"card","text-center"],[1,"card-body"],[1,"card-footer"],["class","col-md-3",4,"ngIf"],[1,"table-responsive"],[1,"table","ed-table","table-hover"],["colspan","2"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"la-question"],["colspan","3"],["class","requis",4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],["aria-label","ic\xf4ne question choix unique",1,"fa","fa-fw","fa-check-circle-o"],["edMathjax","",3,"content","innerHTML"],["aria-label","ic\xf4ne question choix multiple",1,"fa","fa-fw","fa-check-square-o"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._UZ(2,"span",2),e._uU(3),e.YNc(4,Ce,2,0,"button",3),e.YNc(5,qe,2,2,"button",4),e.TgZ(6,"button",5),e._UZ(7,"i",6),e.qZA(),e.YNc(8,xe,2,2,"button",7),e.qZA(),e.TgZ(9,"button",8),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(10,"div",9),e.YNc(11,Te,2,0,"alert",10),e.YNc(12,ye,10,2,"div",11),e.YNc(13,we,11,4,"div",12),e.qZA(),e.TgZ(14,"div",13)(15,"div",14)(16,"div")(17,"span",15),e._uU(18,"*"),e.qZA(),e._uU(19," R\xe9ponse requise "),e.qZA()(),e.TgZ(20,"button",16),e.NdJ("click",function(){return n.close()}),e._uU(21,"Fermer"),e.qZA()()),2&t&&(e.xp6(3),e.hij(" ",n.fs.titre," "),e.xp6(1),e.Q6J("ngIf",n.authStore.isAnneeCourante(n.fUser.choosenAnnee)),e.xp6(1),e.Q6J("ngIf","f"===n.fs.typeF&&n.fs.nonFinisAsContacts.length>0),e.xp6(1),e.Q6J("file",n.file("edforms/"+n.fs.id+"/resultats"))("typeFichier",n.edTypeFichier.FICHIER_EDFORMS_SIGNATURES)("otherTypeDL",!0)("additionalData",e.VKq(12,ke,n.fUser.choosenAnnee)),e.xp6(2),e.Q6J("ngIf",n.fs.signature&&n.resultatsFS.combienEnded>0),e.xp6(2),e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("ngIf",!n.resultatsFS),e.xp6(1),e.Q6J("ngIf",n.resultatsFS),e.xp6(1),e.Q6J("ngIf",n.resultatsFS.combienParticipants>0))},dependencies:[d.sg,d.O5,d.RF,d.n9,T.wx,b.DC,P.x,be.x,L.L,Fe.l,a.YC,B.w,h.$,R.T],styles:['@charset "UTF-8";ul.nav.nav-tabs[_ngcontent-%COMP%]{margin-bottom:20px}div.stats-participant[_ngcontent-%COMP%]{margin-top:15px;margin-bottom:15px}div.recap-participant-fs[_ngcontent-%COMP%]   div.card-body[_ngcontent-%COMP%] > h1[_ngcontent-%COMP%]{font-size:1.5rem}.table-responsive[_ngcontent-%COMP%]   .la-question[_ngcontent-%COMP%]{background-color:var(--footer-primary-color)}span.requis[_ngcontent-%COMP%]{color:var(--secondary-color)}.legende[_ngcontent-%COMP%]{text-align:left}.legende[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border:1px solid var(--dark-placeholder-color);margin-right:15px;padding:5px}']}),o})();var H=u(92635),J=u(59245);function De(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",2)(1,"ul",3)(2,"li",4)(3,"div",5)(4,"button",6),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.manageFS.emit())}),e._UZ(5,"i",7),e._uU(6," Nouveau formulaire ou sondage "),e.qZA()()()()()}}function Oe(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).ngIf,r=e.oxw();return r.edFormsUserStore.updateChoosenAnnee(i[i.length-1]),e.KtG(r.refreshFS.emit(!1))}),e._uU(1," Ann\xe9e en cours "),e.qZA()}}function Ne(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw(3);return c.edFormsUserStore.updateChoosenAnnee(r),e.KtG(c.refreshFS.emit(!1))}),e._uU(1),e.qZA()}if(2&o){const t=s.$implicit;e.xp6(1),e.hij(" ",t," ")}}function Ie(o,s){if(1&o&&(e.TgZ(0,"ul",13)(1,"li",14),e.YNc(2,Oe,2,0,"button",15),e.YNc(3,Ne,2,1,"button",16),e.ALo(4,"slice"),e.ALo(5,"trackByProperty"),e.qZA()()),2&o){const t=e.oxw().ngIf,n=e.oxw();e.xp6(2),e.Q6J("ngIf",n.choosenAnnee),e.xp6(1),e.Q6J("ngForOf",e.Dn7(4,3,t,0,t.length-1))("ngForTrackBy",e.lcZ(5,7,"$index"))}}function Ye(o,s){if(1&o&&(e.TgZ(0,"div",8)(1,"ul",3)(2,"li",9)(3,"div",10)(4,"button",11)(5,"span"),e._uU(6),e.qZA()(),e.YNc(7,Ie,6,9,"ul",12),e.qZA()()()()),2&o){const t=e.oxw();e.xp6(6),e.Oqu(t.authStore.isAnneeCourante(t.choosenAnnee)?"Acc\xe8s aux archives":t.choosenAnnee)}}let Pe=(()=>{class o extends((0,a.kCV)()){constructor(t,n,i){super(),this.authStore=t,this.cd=n,this.edFormsUserStore=i,this.manageFS=new e.vpe,this.refreshFS=new e.vpe}ngOnInit(){this.edFormsUserStore.selectChoosenAnnee().pipe((0,y.R)(this.componentDestroyed$)).subscribe(t=>{this.choosenAnnee=t,this.cd.markForCheck()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(a.CnD),e.Y36(e.sBO),e.Y36(m))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-forms-globals-actions"]],outputs:{manageFS:"manageFS",refreshFS:"refreshFS"},features:[e.qOj],decls:2,vars:2,consts:[["class","float-start",4,"ngIf"],["class","float-end",4,"ngIf"],[1,"float-start"],[1,"list-inline"],[1,"list-inline-item","add-new-form"],[1,"btn-group"],["type","button","title","Nouveau formulaire ou sondage",1,"btn","btn-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-plus"],[1,"float-end"],[1,"list-inline-item","older-year"],["dropdown","",1,"btn-group"],["dropdownToggle","","id","dropdown2","type","button","aria-controls","dropdown-annees",1,"btn","btn-secondary","dropdown-toggle"],["aria-labelledby","dropdown2","id","dropdown-annees","class","dropdown-menu dropdown-menu-right","role","menu",4,"dropdownMenu"],["aria-labelledby","dropdown2","id","dropdown-annees","role","menu",1,"dropdown-menu","dropdown-menu-right"],["role","menuitem"],["type","button","class","dropdown-item",3,"click",4,"ngIf"],["type","button","class","dropdown-item",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"dropdown-item",3,"click"]],template:function(t,n){1&t&&(e.YNc(0,De,7,0,"div",0),e.YNc(1,Ye,8,1,"div",1)),2&t&&(e.Q6J("ngIf",n.authStore.isProfOuPersonnel()&&n.authStore.isAnneeCourante(n.choosenAnnee)),e.xp6(1),e.Q6J("ngIf",n.edFormsUserStore.getAnneesEDFormsArchive()))},dependencies:[d.sg,d.O5,J.Hz,J.Mq,J.TO,d.OU,h.$],encapsulation:2,changeDetection:0}),o})();var G=u(94702),Le=u(56776);function Be(o,s){1&o&&(e.TgZ(0,"div",6)(1,"div",33),e._uU(2,"V\xe9rifiez la concordance de vos dates"),e.qZA()())}const M=function(o){return{"has-error":o}};function Re(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"form",4),e.NdJ("ngSubmit",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onSubmit())}),e.TgZ(1,"div",5)(2,"div",6)(3,"div",7)(4,"div")(5,"label",8),e._uU(6,"Date de d\xe9but"),e.qZA(),e.TgZ(7,"div",9),e._UZ(8,"input",10,11),e.TgZ(10,"span",12)(11,"button",13),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(9);return e.KtG(i.toggle())}),e._UZ(12,"i",14),e.qZA()()()()(),e.TgZ(13,"div",7)(14,"div")(15,"label",15),e._uU(16,"Date de fin"),e.qZA(),e.TgZ(17,"div",9),e._UZ(18,"input",16,17),e.TgZ(20,"span",12)(21,"button",18),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(19);return e.KtG(i.toggle())}),e._UZ(22,"i",14),e.qZA()()()()()(),e.TgZ(23,"div",6)(24,"div",19)(25,"div")(26,"strong",20),e._uU(27,"Heure de d\xe9but"),e.qZA(),e.TgZ(28,"div",21),e._UZ(29,"timepicker",22),e.qZA()()(),e.TgZ(30,"div",23)(31,"div",24)(32,"strong",20),e._uU(33,"Heure de fin"),e.qZA(),e.TgZ(34,"div",25),e._UZ(35,"timepicker",26),e.qZA()()()(),e.YNc(36,Be,3,0,"div",27),e.qZA(),e.TgZ(37,"div",28)(38,"button",29),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.close())}),e._uU(39,"Annuler"),e.qZA(),e.TgZ(40,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.maintenant())}),e._UZ(41,"i",31),e.qZA(),e.TgZ(42,"button",32),e._uU(43,"Enregistrer"),e.qZA()()()}if(2&o){const t=e.MAs(9),n=e.MAs(19),i=e.oxw();e.Q6J("formGroup",i.associationForm),e.xp6(4),e.Tol(e.VKq(18,M,i.associationForm.get("dateDebut").invalid)),e.xp6(4),e.Q6J("bsConfig",i.configDatePicker),e.uIk("aria-expanded",t.isOpen),e.xp6(6),e.Tol(e.VKq(20,M,i.associationForm.get("dateFin").invalid)),e.xp6(4),e.Q6J("bsConfig",i.configDatePicker),e.uIk("aria-expanded",n.isOpen),e.xp6(7),e.Tol(e.VKq(22,M,i.associationForm.get("heureDebut").invalid)),e.xp6(4),e.Q6J("showSpinners",!0)("showMeridian",!1),e.xp6(2),e.Q6J("ngClass",e.VKq(24,M,i.associationForm.get("heureFin").invalid)),e.xp6(4),e.Q6J("showSpinners",!0)("showMeridian",!1),e.xp6(1),e.Q6J("ngIf",null==i.associationForm.errors?null:i.associationForm.errors.dateDebutNotSuperieur),e.xp6(6),e.Q6J("disabled",i.associationForm.invalid)}}let He=(()=>{class o{constructor(t,n,i){this.fb=t,this.modalRef=n,this.uiService=i,this.onClose$=new A.x,this.configDatePicker={...F.gL,minDate:a.C_1.addNbJourToDate(new Date,-1)}}ngOnInit(){this.associationForm=this.fb.group(this.fs.isDatesOK?{dateDebut:new Date(this.fs.debute),heureDebut:new Date(this.fs.debute),dateFin:new Date(this.fs.fini),heureFin:new Date(this.fs.fini)}:{dateDebut:null,heureDebut:null,dateFin:null,heureFin:null},{validators:this.datesValidator()})}ngOnDestroy(){this.onClose$.complete()}datesValidator(){return t=>{const n=t.get("dateDebut").value,i=t.get("dateFin").value,r=t.get("heureDebut").value,c=t.get("heureFin").value;if(n&&i&&r&&c){const p=new Date(`${a.C_1.dateToString(n,"YYY/MM/dd")} ${a.C_1.dateToString(r,"HH:mm:00")}`),f=new Date(`${a.C_1.dateToString(i,"YYY/MM/dd")} ${a.C_1.dateToString(c,"HH:mm:00")}`);if(!a.C_1.isAfter(f,p,!0)&&!a.C_1.isEqual(f,p,!0))return{dateDebutNotSuperieur:!0}}return null}}maintenant(){const t=new Date;t.setSeconds(0);const n=a.C_1.addNbHoursToDate(t,1);this.associationForm.setValue({dateDebut:t,heureDebut:new Date(t),dateFin:n,heureFin:new Date(n)})}onSubmit(){if(this.associationForm.valid){const t=this.associationForm.get("dateDebut").value,n=this.associationForm.get("dateFin").value,i=this.associationForm.get("heureDebut").value,r=this.associationForm.get("heureFin").value;if(!(t&&n&&i&&r))return void this.uiService.notifyEvent(a.DOJ.genericError,"V\xe9rifiez la concordance de vos dates !","Erreur","icon-ed_qcm");const c=new Date(`${a.C_1.dateToString(t,"YYY/MM/dd")} ${a.C_1.dateToString(i,"HH:mm:00")}`),p=new Date(`${a.C_1.dateToString(n,"YYY/MM/dd")} ${a.C_1.dateToString(r,"HH:mm:00")}`);this.onClose$.next([c,p]),this.close()}}close(){this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(l.qu),e.Y36(_.UZ),e.Y36(a.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-fs-evaluation-parametres"]],inputs:{fs:"fs"},decls:5,vars:2,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],["name","formEditAssociation","novalidate","",3,"formGroup","ngSubmit",4,"ngIf"],["name","formEditAssociation","novalidate","",3,"formGroup","ngSubmit"],["id","form-parametrage-association",1,"modal-body"],[1,"row"],[1,"col-lg-6"],["for","dateDebut",1,"form-label"],[1,"input-group"],["formControlName","dateDebut","bsDatepicker","","name","dateDebut","id","dateDebut","type","text",1,"form-control",3,"bsConfig"],["datePickerDateDebut","bsDatepicker"],[1,"input-group-text","input-group-md","no-background"],["type","button","aria-label","Ouvrir le calendrier pour choisir la date de d\xe9but",1,"btn","btn-secondary","no-background",3,"click"],["aria-hidden","true",1,"fa","fa-calendar"],["for","dateFin",1,"form-label"],["formControlName","dateFin","bsDatepicker","","name","dateFin","id","dateFin","type","text",1,"form-control",3,"bsConfig"],["datePickerDateFin","bsDatepicker"],["type","button","aria-label","Ouvrir le calendrier pour choisir la date de fin",1,"btn","btn-secondary","no-background",3,"click"],[1,"col-lg-4"],[1,"texte-label"],[1,"input-group","heureDebut"],["formControlName","heureDebut",3,"showSpinners","showMeridian"],[1,"col-lg-4","col-lg-offset-2"],[3,"ngClass"],[1,"input-group","heureFin"],["formControlName","heureFin",3,"showSpinners","showMeridian"],["class","row",4,"ngIf"],[1,"modal-footer","form-parametrage-association"],["type","button",1,"btn","btn-warning",3,"click"],["type","button","title","Rendre accessible maintenant",1,"btn","btn-secondary",3,"click"],["aria-hidden","true",1,"fa","fa-clock-o","i-small"],["id","buttonAjout","type","submit",1,"btn","btn-success",3,"disabled"],[1,"col-lg-12","form-text","text-danger"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.YNc(4,Re,44,26,"form",3)),2&t&&(e.xp6(2),e.hij("Programmation (",n.fs.titre,")"),e.xp6(2),e.Q6J("ngIf",n.associationForm))},dependencies:[d.mk,d.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,G.Np,G.Y5,Le.EV],encapsulation:2}),o})();function Ge(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.manageFS.emit())}),e._UZ(1,"i",11),e.qZA()}}function $e(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.showStats.emit())}),e._UZ(1,"i",13),e.qZA()}}function Ke(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.removeFS.emit())}),e._UZ(1,"i",15),e.qZA()}}let Ve=(()=>{class o{constructor(t,n,i){this.authStore=t,this.edFormsUserStore=n,this.modalService=i,this.edModuleCodes=a.qzA,this.manageFS=new e.vpe,this.openFS=new e.vpe,this.cloneFS=new e.vpe,this.removeFS=new e.vpe,this.showStats=new e.vpe}dupliquerFS(){let t;if(this.authStore.isAnneeCourante(this.edFormsUserStore.snapshot.choosenAnnee))t=(0,N.of)(!0);else{const n={id:this.modalService.getModalsCount()+1,class:"modal-sm",initialState:{title:"Duplication",message:"Voulez-vous dupliquer ce formulaire sur l'ann\xe9e scolaire en cours ?"}};this.modalService.show(w.z,n),t=this.modalService.onHide.pipe((0,g.q)(1),(0,Z.h)(i=>i===k.G.validation),(0,E.U)(i=>!0))}t.pipe((0,q.b)(n=>{n&&this.cloneFS.emit()})).subscribe()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(a.CnD),e.Y36(m),e.Y36(_.tT))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-un-fs-actions"]],inputs:{fs:"fs"},outputs:{manageFS:"manageFS",openFS:"openFS",cloneFS:"cloneFS",removeFS:"removeFS",showStats:"showStats"},decls:10,vars:6,consts:[[1,"fs-actions","float-end"],["class","btn btn-sm btn-primary-color","title","Param\xe9trer le formulaire et ajouter des participants","type","button",3,"click",4,"ngIf"],["title","Voir le formulaire","type","button",1,"btn","btn-sm","btn-primary-color",3,"click"],["aria-hidden","true",1,"fa","fa-eye"],["type","button","edMessageTo","","title","\xc9crire \xe0 tous les participants",1,"btn","btn-sm","btn-primary-color",3,"typeContact","listContact"],["aria-hidden","true",1,"fa","fa-envelope"],["type","button",1,"btn","btn-sm","btn-primary-color",3,"title","click"],["aria-hidden","true",1,"fa","fa-clone"],["class","btn btn-sm btn-primary-color","title","Voir les statistiques de participation","type","button",3,"click",4,"ngIf"],["class","btn btn-sm btn-danger-color","title","Supprimer le formulaire","type","button",3,"click",4,"ngIf"],["title","Param\xe9trer le formulaire et ajouter des participants","type","button",1,"btn","btn-sm","btn-primary-color",3,"click"],["aria-hidden","true",1,"fa","fa-cogs"],["title","Voir les statistiques de participation","type","button",1,"btn","btn-sm","btn-primary-color",3,"click"],["aria-hidden","true",1,"fa","fa-bar-chart"],["title","Supprimer le formulaire","type","button",1,"btn","btn-sm","btn-danger-color",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Ge,2,0,"button",1),e.TgZ(2,"button",2),e.NdJ("click",function(){return n.openFS.emit()}),e._UZ(3,"i",3),e.qZA(),e.TgZ(4,"button",4),e._UZ(5,"i",5),e.qZA(),e.TgZ(6,"button",6),e.NdJ("click",function(){return n.dupliquerFS()}),e._UZ(7,"i",7),e.qZA(),e.YNc(8,$e,2,0,"button",8),e.YNc(9,Ke,2,0,"button",9),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",!n.fs.isActive),e.xp6(3),e.Q6J("typeContact",n.edModuleCodes.MESSAGERIE)("listContact",n.fs.participantsAsContacts),e.xp6(2),e.MGl("title","Dupliquer le formulaire ",n.authStore.isAnneeCourante(n.edFormsUserStore.snapshot.choosenAnnee)?"":"sur l'ann\xe9e en cours",""),e.xp6(2),e.Q6J("ngIf",n.fs.participants.length&&n.fs.nbQuestions>0),e.xp6(1),e.Q6J("ngIf",!n.fs.isActive))},dependencies:[d.O5,P.x],encapsulation:2,changeDetection:0}),o})();function je(o,s){if(1&o&&(e.TgZ(0,"span",12),e._UZ(1,"i",13),e.TgZ(2,"span",14),e._uU(3),e.qZA()()),2&o){const t=s.$implicit;e.xp6(3),e.Oqu(t)}}function ze(o,s){if(1&o&&(e.TgZ(0,"div",10),e.YNc(1,je,4,1,"span",11),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.fs.etiquettes)("ngForTrackBy",e.lcZ(2,2,"$index"))}}const Xe=function(o){return[o,"questions"]};function We(o,s){if(1&o&&(e.TgZ(0,"div")(1,"button",15),e._uU(2," G\xe9rer les questions "),e.TgZ(3,"span",16),e._uU(4),e.qZA()(),e._UZ(5,"div",7),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("routerLink",e.VKq(2,Xe,t.fs.id)),e.xp6(3),e.Oqu(t.fs.nbQuestions)}}const et=function(o,s){return{arg1:o,arg2:s}};function tt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",24)(1,"div",25),e._UZ(2,"i",26),e.TgZ(3,"small",27),e._uU(4),e.ALo(5,"lowercase"),e.ALo(6,"formattedDate"),e.qZA()(),e.TgZ(7,"div",28)(8,"span",29)(9,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.automatiser())}),e._UZ(10,"i",31),e.qZA(),e.TgZ(11,"button",32),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.deleteAutomatisation())}),e._UZ(12,"i",33),e.qZA(),e.TgZ(13,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.refreshFS.emit())}),e._UZ(14,"i",35),e.qZA()()()()}if(2&o){const t=e.oxw(3);e.xp6(4),e.hij("Programm\xe9 ",e.lcZ(5,1,e.xi3(6,3,e.WLB(6,et,t.fs.debute,t.fs.fini),"EEEE d MMMM")),"")}}function nt(o,s){1&o&&e._UZ(0,"div",7)}function ot(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",36)(1,"button",37),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.startStop.emit())}),e._UZ(2,"i",38),e.TgZ(3,"span",14),e._uU(4),e.qZA()()()}if(2&o){const t=e.oxw(3);e.xp6(4),e.hij("Activer l'acc\xe8s pour les ",t.fs.participants.length," participants")}}function it(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",36)(1,"button",39),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.startStop.emit())}),e._UZ(2,"i",40),e.TgZ(3,"span",14),e._uU(4),e.qZA()()()}if(2&o){const t=e.oxw(3);e.xp6(4),e.hij("D\xe9sactiver l'acc\xe8s pour les ",t.fs.participants.length," participants")}}function st(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",36)(1,"button",41),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.automatiser())}),e._UZ(2,"i",26),e.TgZ(3,"span",14),e._uU(4,"Programmation"),e.qZA()()()}}const rt=function(o,s){return{"fs-inactif":o,"fs-actif":s}};function at(o,s){if(1&o&&(e.ynx(0),e._UZ(1,"hr",17),e.TgZ(2,"ul",18)(3,"li",19),e.YNc(4,tt,15,9,"div",20),e.YNc(5,nt,1,0,"div",21),e.TgZ(6,"div",22),e.YNc(7,ot,5,1,"div",23),e.YNc(8,it,5,1,"div",23),e.YNc(9,st,5,0,"div",23),e.qZA(),e._UZ(10,"div",7),e.qZA()(),e.BQk()),2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("ngClass",e.WLB(6,rt,!t.fs.isActive,t.fs.isActive)),e.xp6(1),e.Q6J("ngIf",t.fs.isDatesOK),e.xp6(1),e.Q6J("ngIf",t.fs.isDatesOK),e.xp6(2),e.Q6J("ngIf",!t.fs.isActive),e.xp6(1),e.Q6J("ngIf",t.fs.isActive),e.xp6(1),e.Q6J("ngIf",!t.fs.isDatesOK)}}function ct(o,s){if(1&o&&(e.ynx(0),e.YNc(1,We,6,4,"div",9),e.YNc(2,at,11,9,"ng-container",9),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",!t.fs.isActive),e.xp6(1),e.Q6J("ngIf",t.fs.participants.length&&t.fs.nbQuestions>0)}}const ut=function(o,s){return{"fa-unlock":o,"fa-lock":s}},lt=function(){return["200","..."]};let dt=(()=>{class o{constructor(t,n,i,r,c){this.authStore=t,this.edfService=n,this.edFormsUserStore=i,this.modalService=r,this.uiService=c,this.cloneFS=new e.vpe,this.manageFS=new e.vpe,this.openFS=new e.vpe,this.removeFS=new e.vpe,this.showStats=new e.vpe,this.startStop=new e.vpe,this.refreshFS=new e.vpe,this._datePipe=new a.ifA}get fUser(){return this.edFormsUserStore.snapshot}automatiser(){this.modalService.show(He,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{fs:this.fs}}).content.onClose$.pipe((0,g.q)(1)).subscribe(n=>{Array.isArray(n)&&2===n.length&&(this.loader=this.edfService.editParametresProgrammation(this.fs.id,{debute:this._datePipe.transform(n[0],"y-MM-dd HH:mm:ss"),fini:this._datePipe.transform(n[1],"y-MM-dd HH:mm:ss")}).subscribe({next:i=>{this.uiService.notifyEvent(a.DOJ.genericSuccess,"La p\xe9riode a bien \xe9t\xe9 enregistr\xe9e.","Formulaires et sondages","icon-ed_edforms")},error:i=>{this.uiService.notifyEvent(a.DOJ.genericError,"Une erreur s'est produite lors de l'enregistrement de la p\xe9riode.","Erreur","icon-ed_edforms")}}))})}deleteAutomatisation(){this.loader=this.edfService.deleteProgrammation(this.fs.id).subscribe({next:t=>{this.uiService.notifyEvent(a.DOJ.genericSuccess,"La p\xe9riode a bien \xe9t\xe9 supprim\xe9e.","Formulaires et sondages","icon-ed_edforms")},error:t=>this.uiService.notifyEvent(a.DOJ.genericError,"Une erreur s'est produite lors de la suppression de la p\xe9riode.","Erreur","icon-ed_edforms")})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(a.CnD),e.Y36(a.i4Q),e.Y36(m),e.Y36(_.tT),e.Y36(a.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-un-fs"]],inputs:{fs:"fs"},outputs:{cloneFS:"cloneFS",manageFS:"manageFS",openFS:"openFS",removeFS:"removeFS",showStats:"showStats",startStop:"startStop",refreshFS:"refreshFS"},decls:16,vars:20,consts:[[1,"ed-card","card","with-epingle",3,"ngBusy"],[1,"card-header","d-flex","align-items-center","justify-content-between","flex-wrap"],["aria-hidden","true",1,"fa",3,"ngClass"],[3,"fs","manageFS","openFS","cloneFS","removeFS","showStats"],[1,"card-body"],[3,"innerHTML"],[1,"date-item","clearfix"],[1,"clearfix"],["class","etiquettes",4,"ngIf"],[4,"ngIf"],[1,"etiquettes"],["class","etiquette",4,"ngFor","ngForOf","ngForTrackBy"],[1,"etiquette"],["aria-hidden","true",1,"fa","fa-tag"],[1,"margin-whitespace"],["type","button","title","G\xe9rer les questions",1,"btn","btn-primary","btn-sm","float-end",3,"routerLink"],[1,"badge"],["role","separator"],[1,"list-group","row","list-group-horizontal"],[1,"list-group-item","col-lg-6","col-xl-4",3,"ngClass"],["class","fs-programmation row",4,"ngIf"],["class","clearfix",4,"ngIf"],[1,"row","row-cols-auto","gy-1"],["class","col",4,"ngIf"],[1,"fs-programmation","row"],[1,"col-md-9"],["aria-hidden","true",1,"fa","fa-clock-o","i-small"],[1,"margin-whitespace","text-primary"],[1,"col-md-3"],[1,"float-end","btn-action-programmation"],["type","button","title","Modifier la programmation",1,"btn","btn-primary-color","no-padding",3,"click"],["aria-hidden","true",1,"fa","fa-pencil","i-small","size-17"],["type","button","title","Supprimer la programmation",1,"btn","btn-danger-color","no-padding","margin-whitespace",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o","i-small","size-17"],["type","button","title","Rafra\xeechir la vue",1,"btn","btn-primary-color","no-padding","margin-whitespace",3,"click"],["aria-hidden","true",1,"fa","fa-refresh","i-small","size-17"],[1,"col"],["title","Activer l'acc\xe8s au formulaire","type","button",1,"btn","btn-success","float-start",3,"click"],["aria-hidden","true",1,"fa","fa-play","i-small"],["title","D\xe9sactiver l'acc\xe8s au formulaire","type","button",1,"btn","btn-danger","float-start",3,"click"],["aria-hidden","true",1,"fa","fa-stop","i-small"],["title","Param\xe9trer l'acc\xe8s au formulaire","type","button",1,"btn","btn-secondary","btn-sm",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3"),e._UZ(3,"i",2),e._uU(4),e.qZA(),e.TgZ(5,"ed-un-fs-actions",3),e.NdJ("manageFS",function(){return n.manageFS.emit()})("openFS",function(){return n.openFS.emit()})("cloneFS",function(){return n.cloneFS.emit()})("removeFS",function(){return n.removeFS.emit()})("showStats",function(){return n.showStats.emit()}),e.qZA()(),e.TgZ(6,"div",4),e._UZ(7,"div",5),e.ALo(8,"truncate"),e.ALo(9,"base64"),e.TgZ(10,"span",6),e._uU(11),e.ALo(12,"edDate"),e.qZA(),e._UZ(13,"div",7),e.YNc(14,ze,3,4,"div",8),e.YNc(15,ct,3,2,"ng-container",9),e.qZA()()),2&t&&(e.Q6J("ngBusy",n.loader),e.xp6(3),e.Q6J("ngClass",e.WLB(16,ut,!n.fs.isActive,n.fs.isActive)),e.xp6(1),e.hij(" ",n.fs.titre," "),e.xp6(1),e.Q6J("fs",n.fs),e.xp6(2),e.Q6J("innerHTML",e.xi3(8,8,e.lcZ(9,11,n.fs.resume),e.DdM(19,lt)),e.oJD),e.xp6(4),e.hij("Cr\xe9\xe9 le ",e.xi3(12,13,n.fs.created,"EEEE d MMMM y \xe0 HH:mm"),""),e.xp6(3),e.Q6J("ngIf",n.fs.etiquettes.length>0),e.xp6(1),e.Q6J("ngIf",n.authStore.isAnneeCourante(n.fUser.choosenAnnee)))},dependencies:[d.mk,d.sg,d.O5,v.rH,b.DC,Ve,d.i8,a.YC,a.ifA,a.Jij,a.W70,h.$],styles:[".list-group[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;margin-bottom:0}.list-group[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:block;padding:20px;background:var(--light-placeholder-color);border-radius:5px;overflow:hidden}.list-group[_ngcontent-%COMP%]   li.fs-inactif[_ngcontent-%COMP%]   .fs-programmation[_ngcontent-%COMP%]{color:var(--light-primary-color)}.list-group[_ngcontent-%COMP%]   li.fs-actif[_ngcontent-%COMP%]   .fs-programmation[_ngcontent-%COMP%]{color:var(--secondary-color)}"],changeDetection:0}),o})();function pt(o,s){if(1&o&&(e.ynx(0),e.TgZ(1,"h6",8),e._uU(2),e.ALo(3,"edDate"),e.qZA(),e.TgZ(4,"h6",9),e._uU(5," Code envoy\xe9 au "),e.TgZ(6,"strong"),e._uU(7),e.qZA()(),e.BQk()),2&o){const t=e.oxw();e.xp6(2),e.hij("R\xe9pondu et sign\xe9 le ",e.xi3(3,2,t.fs.participant.signature.dateValidation,"d MMMM y \xe0 HH:mm"),""),e.xp6(5),e.Oqu(t.fs.participant.signature.tel)}}function mt(o,s){if(1&o&&(e.TgZ(0,"h6",11),e._uU(1),e.ALo(2,"edDate"),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij("R\xe9pondu le ",e.xi3(2,1,t.fs.participant.fini,"EEEE d MMMM y \xe0 HH:mm"),"")}}function ft(o,s){if(1&o&&e.YNc(0,mt,3,4,"h6",10),2&o){const t=e.oxw();e.Q6J("ngIf",t.fs.participant.fini)}}const _t=function(o,s){return{"fa-arrow-right":o,"fa-eye":s}};let gt=(()=>{class o{constructor(t,n,i){this.authStore=t,this.edFormsUserStore=n,this.router=i}ngOnChanges(t){t.fs&&(this.readonly=a.FSr.isNotEmptyString(this.fs.participant.fini)||!this.authStore.isAnneeCourante(this.edFormsUserStore.snapshot.choosenAnnee))}openFS(){this.router.navigate(["",{outlets:{auxiliaryModal:["repondre-au-fs"]}}],{skipLocationChange:!0,queryParams:{idFS:this.fs.formulaire.id,idParticipant:this.fs.participant.id,titre:this.fs.formulaire.titre,choosenAnnee:this.edFormsUserStore.snapshot.choosenAnnee}}).catch(()=>console.error("UnFsEvalueComponent.openFS navigate to fs form"))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(a.CnD),e.Y36(m),e.Y36(v.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-un-fs-evalue"]],inputs:{fs:"fs"},features:[e.TTD],decls:11,vars:11,consts:[[1,"card","ed-card","with-epingle"],[1,"card-header"],[1,"card-title"],[4,"ngIf","ngIfElse"],["nosignature",""],[1,"card-body"],["type","button","title","Acc\xe9der \xe0 ce formulaire",1,"btn","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-right",3,"ngClass"],[1,"card-subtitle","mb-2","text-muted"],[1,"card-subtitle","text-muted"],["class","card-subtitle text-muted margin-bottom-5",4,"ngIf"],[1,"card-subtitle","text-muted","margin-bottom-5"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),e._uU(3),e.qZA(),e.YNc(4,pt,8,5,"ng-container",3),e.YNc(5,ft,1,1,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(7,"div",5)(8,"button",6),e.NdJ("click",function(){return n.openFS()}),e._UZ(9,"i",7),e._uU(10),e.qZA()()()),2&t){const i=e.MAs(6);e.ekj("danger",!n.readonly),e.xp6(3),e.Oqu(n.fs.formulaire.titre),e.xp6(1),e.Q6J("ngIf",n.fs.participant.signature)("ngIfElse",i),e.xp6(5),e.Q6J("ngClass",e.WLB(8,_t,!n.readonly,n.readonly)),e.xp6(1),e.AsE(" ",n.readonly?"Consulter le ":"R\xe9pondre au ","",n.fs.formulaire.typeToLibelleEDForms," ")}},dependencies:[d.mk,d.O5,a.ifA],encapsulation:2,changeDetection:0}),o})();function ht(o,s){if(1&o&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.AsE("(",t.eleve.prenom," - ",t.eleve.classe.libelle,")")}}function vt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.doRefreshForms(!0))}),e._UZ(2,"i",10),e.qZA()()}}function bt(o,s){1&o&&(e.TgZ(0,"div",11),e._uU(1,"Aucun formulaire / sondage disponible actuellement !"),e.qZA())}function Ft(o,s){if(1&o&&e._UZ(0,"ed-un-fs-evalue",13),2&o){const t=s.$implicit;e.MGl("id","fs_evalue_",t.id,""),e.Q6J("fs",t)}}function Ct(o,s){if(1&o&&(e.ynx(0),e.YNc(1,Ft,1,2,"ed-un-fs-evalue",12),e.ALo(2,"async"),e.ALo(3,"trackByProperty"),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,2,t.questionnaires$))("ngForTrackBy",e.lcZ(3,4,"id"))}}function qt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"ed-un-fs",15),e.NdJ("cloneFS",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onCloneFS(r))})("manageFS",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onManageFS(r))})("openFS",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onOpenFS(r))})("removeFS",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onRemoveFS(r))})("startStop",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onStartStop(r))})("showStats",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onShowStats(r))})("refreshFS",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.doRefreshForms(!0))}),e.qZA()}if(2&o){const t=s.$implicit;e.MGl("id","fs_",t.id,""),e.Q6J("fs",t)}}function xt(o,s){if(1&o&&(e.ynx(0),e.YNc(1,qt,1,2,"ed-un-fs",14),e.ALo(2,"async"),e.ALo(3,"trackByProperty"),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,2,t.questionnaires$))("ngForTrackBy",e.lcZ(3,4,"id"))}}let Tt=(()=>{class o extends((0,a.kCV)()){constructor(t,n,i,r,c,p,f,D,Tn,Sn,yn,Zn){super(),this.activatedRoute=t,this.authStore=n,this.loaderService=i,this.modalService=r,this.edfService=c,this.edfParticipantStore=p,this.edfStore=f,this.edFormsUserStore=D,this.events=Tn,this.router=Sn,this.uiService=yn,this.viewportScroller=Zn}get fUser(){return this.edFormsUserStore.snapshot}ngOnInit(){this.activatedRoute.paramMap.pipe((0,q.b)(t=>this.afterRouteUpdated(t)),(0,y.R)(this.componentDestroyed$)).subscribe(),this.questionnaires$=(0,V.a)([this.edFormsUserStore.select$(),this.authStore.isProfOuPersonnel()?this.edfStore.select$():this.edfParticipantStore.select$()]).pipe((0,Z.h)(t=>a.FSr.isNotEmptyString(t[0].variantDefault)),(0,E.U)(t=>{if(this.authStore.isProfOuPersonnel())return this.edfStore.getSubStore(this.fUser.choosenAnnee);{const n=this.edfParticipantStore.getSubStore(this.fUser.variantDefault,this.fUser.choosenAnnee);return a.d0N.sortDatas(n.map(i=>new a.Qek(i)),["participant.fini|desc","formulaire.created|asc"])}}),a.z43),this.authStore.isFouE()&&this.events.select$("array:removeEntityById").pipe((0,y.R)(this.componentDestroyed$)).subscribe(t=>{t>0&&this.doRefreshForms(!1)})}ngAfterViewInit(){if(this.authStore.isProfOuPersonnel()){const t=this.activatedRoute.snapshot.fragment;t&&this.viewportScroller.scrollToAnchor(t)}}afterRouteUpdated(t){const n=this.authStore.isFamille()&&t.get("typeUser")===a.dcH.ELEVE?[this.authStore.currentUser.typeCompte,this.authStore.currentUser.id]:[];let i;this.edFormsUserStore.updateStore(this.authStore.currentUser.codeOgec,t.get("typeUser"),+t.get("idUser"),this.authStore.currentUser.anneeScolaireCourante,n),i=this.authStore.isFamille()&&this.fUser.typeUser===a.dcH.ELEVE?this.authStore.getEleve(this.fUser.idUser):(0,N.of)(null),i.subscribe(r=>{this.eleve=Object.isExists(r)?new a.Dfc(r):r,this.doRefreshForms(!1)})}doRefreshForms(t=!0){this.loader=this.loaderService.show(this),(this.authStore.isFouE()?this.edfService.listForms(this.fUser.typeUser,this.fUser.idUser,this.fUser.variantDefault,this.fUser.choosenAnnee,t):this.edfService.manageForms(this.fUser.choosenAnnee,t)).pipe((0,Q.K)(i=>this.uiService.notifyErrorThenEmpty(i,!0,"Erreur","icon-ed_edforms")),(0,x.x)(()=>this.loaderService.hide(this))).subscribe()}onManageFS(t){this.modalService.show(he,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,class:"modal-lg",initialState:{fs:Object.isExists(t)?new a.U0N(t):a.U0N.create(this.authStore.currentUser),isDupliqAnneePrecedente:!this.authStore.isAnneeCourante(this.fUser.choosenAnnee)}}).content.onClose$.pipe((0,g.q)(1)).subscribe(i=>{Object.isExists(i)&&this.doRefreshForms(!0)})}onCloneFS(t){const n=new a.U0N({...t,id:0,idAuteur:this.authStore.currentUser.id,typeAuteur:this.authStore.currentUser.typeCompte,participants:[],reviewState:a.Q$.privated});this.loader=this.edfService.cloneFS(t.id,n,this.fUser.choosenAnnee).subscribe({next:()=>{this.uiService.notifyEvent(a.DOJ.genericSuccess,"Le formulaire a bien \xe9t\xe9 dupliqu\xe9.","Formulaires et sondages","icon-ed_edforms");const i=this.edfStore.getSubStore(this.authStore.currentUser.anneeScolaireCourante).find(r=>r.id===n.id);Object.isExists(i)&&this.onManageFS(i)},error:i=>this.uiService.notifyEvent(a.DOJ.genericError,"Une erreur s'est produite lors de la duplication du questionnaire.","Erreur","icon-ed_edforms")})}onOpenFS(t){this.router.navigate(["",{outlets:{auxiliaryModal:["repondre-au-fs"]}}],{skipLocationChange:!0,queryParams:{idFS:t.id,idParticipant:0,titre:t.titre,choosenAnnee:this.fUser.choosenAnnee}}).catch(()=>console.error("onOpenFS navigate to fs form"))}onRemoveFS(t){const n={title:"Suppression du formulaire",message:`\xcates-vous s\xfbr de vouloir supprimer <strong>d\xe9finitivement</strong> le questionnaire <strong>${t.titre}</strong> ?`,warningButton:"OK"},i={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:n};this.modalService.show(w.z,i),this.modalService.onHide.pipe((0,g.q)(1),(0,Z.h)(r=>r===k.G.validation),(0,U.w)(r=>(this.loader=this.loaderService.show(this),this.edfService.supprimerFS(t.id,this.fUser.choosenAnnee))),(0,q.b)(r=>{this.uiService.notifyEvent(a.DOJ.genericSuccess,"Votre formulaire a bien \xe9t\xe9 supprim\xe9.","Formulaires et sondages","icon-ed_edforms")}),(0,x.x)(()=>this.loaderService.hide(this)),(0,Q.K)(r=>(this.uiService.notifyEvent(a.DOJ.genericError,"Une erreur s'est produite lors de la suppression du formulaire.","Erreur","icon-ed_edforms"),I.E))).subscribe()}onStartStop(t){this.loader=t.isActive?this.edfService.stopFS(t.id).subscribe({next:()=>this.uiService.notifyEvent(a.DOJ.genericSuccess,"Le formulaire a bien \xe9t\xe9 d\xe9sactiv\xe9.","Formulaires et sondages","icon-ed_edforms"),error:n=>this.uiService.notifyEvent(a.DOJ.genericError,"Une erreur s'est produite lors de l'op\xe9ration.","Erreur","icon-ed_edforms")}):this.edfService.startFS(t.id).subscribe({next:()=>this.uiService.notifyEvent(a.DOJ.genericSuccess,"Le formulaire a bien \xe9t\xe9 activ\xe9.","Formulaires et sondages","icon-ed_edforms"),error:n=>this.uiService.notifyEvent(a.DOJ.genericError,"Une erreur s'est produite lors de l'op\xe9ration.","Erreur","icon-ed_edforms")})}onShowStats(t){this.modalService.show(Je,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,class:"modal-lg",initialState:{fs:t},providers:[{provide:m,useValue:this.edFormsUserStore}]})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(v.gz),e.Y36(a.CnD),e.Y36(H.S),e.Y36(_.tT),e.Y36(a.i4Q),e.Y36(a.pIS),e.Y36(a.GBF),e.Y36(m),e.Y36(a.eq2),e.Y36(v.F0),e.Y36(a.VLf),e.Y36(d.EM))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-questionnaires"]],features:[e.qOj],decls:14,vars:11,consts:[[1,"ed-container","page-questionnaires","double-padding"],[1,"entete-page"],[4,"ngIf"],["class","btn-group btn-refresh",4,"ngIf"],[1,"globals-actions"],[3,"manageFS","refreshFS"],[3,"ngBusy"],["class","alert alert-info","role","alert",4,"ngIf"],[1,"btn-group","btn-refresh"],["title","Rafra\xeechir la liste des formulaires et sondages","type","button",1,"btn","btn-sm","btn-secondary","float-end",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],["role","alert",1,"alert","alert-info"],["class","un-fs-evalue",3,"id","fs",4,"ngFor","ngForOf","ngForTrackBy"],[1,"un-fs-evalue",3,"id","fs"],["class","un-fs",3,"id","fs","cloneFS","manageFS","openFS","removeFS","startStop","showStats","refreshFS",4,"ngFor","ngForOf","ngForTrackBy"],[1,"un-fs",3,"id","fs","cloneFS","manageFS","openFS","removeFS","startStop","showStats","refreshFS"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"header",1)(2,"h2"),e._uU(3),e.ALo(4,"async"),e.YNc(5,ht,2,2,"small",2),e.qZA(),e.YNc(6,vt,3,0,"div",3),e.TgZ(7,"div",4)(8,"ed-forms-globals-actions",5),e.NdJ("manageFS",function(){return n.onManageFS()})("refreshFS",function(r){return n.doRefreshForms(r)}),e.qZA()()(),e.TgZ(9,"div",6),e.YNc(10,bt,2,0,"div",7),e.ALo(11,"async"),e.YNc(12,Ct,4,6,"ng-container",2),e.YNc(13,xt,4,6,"ng-container",2),e.qZA()()),2&t){let i,r;e.xp6(3),e.hij(" Formulaires et sondages (",null==(i=e.lcZ(4,7,n.questionnaires$))?null:i.length,") "),e.xp6(2),e.Q6J("ngIf",n.eleve),e.xp6(1),e.Q6J("ngIf",n.authStore.isFouE()),e.xp6(3),e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("ngIf",!((null==(r=e.lcZ(11,9,n.questionnaires$))?null:r.length)>0)),e.xp6(2),e.Q6J("ngIf",n.authStore.isFouE()),e.xp6(1),e.Q6J("ngIf",n.authStore.isProfOuPersonnel())}},dependencies:[d.sg,d.O5,b.DC,Pe,dt,gt,d.Ov,h.$],styles:['@charset "UTF-8";textarea{padding:2px}.page-questionnaires .alert-info{margin-top:25px}.page-questionnaires .ed-card hr{margin-left:-20px;margin-right:-20px}.page-questionnaires .ed-card .list-group{display:flex;flex-wrap:wrap;margin-bottom:0}.fs-img-container img{max-width:100%}.page-questionnaires .entete-page{align-items:center}.page-questionnaires .btn-refresh{margin-top:10px;margin-left:10px}.page-questionnaires .globals-actions{flex:1;padding:0 0 0 40px}.page-questionnaires .globals-actions .btn{padding:8px 15px}.page-questionnaires .btn-warning:not(.btn-link):not(.btn-flat){background-color:#f0ad4e}.page-questionnaires .fs-actions .btn{background-color:transparent}.page-questionnaires .un-fs .btn-sm{margin:0;padding:5px 10px}.page-questionnaires .un-fs .list-group-item{border:none}.page-questionnaires .un-fs .etiquettes{padding:6px 0;display:inline-table}.page-questionnaires .un-fs .etiquettes .etiquette{color:#737373;margin:0 10px 0 0;display:block;float:left}\n'],encapsulation:2}),o})();var St=u(34813),yt=u(88673);let Zt=(()=>{class o{constructor(){}ngOnChanges(t){t.question&&(0===this.question.propositions.length?this.question.propositions.push(new a.$ws):this.question.propositions.length>1&&(this.question.propositions.length=1))}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-fs-question-type-textarea"]],inputs:{idFS:"idFS",question:"question"},features:[e.TTD],decls:0,vars:0,template:function(t,n){},encapsulation:2,changeDetection:0}),o})();function Qt(o,s){1&o&&e._UZ(0,"i",12)}function At(o,s){1&o&&e._UZ(0,"i",13)}function Mt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",7)(1,"div",2),e.YNc(2,Qt,1,0,"i",3),e.YNc(3,At,1,0,"i",4),e.qZA(),e.TgZ(4,"div",8)(5,"input",9),e.NdJ("ngModelChange",function(i){const c=e.CHM(t).$implicit;return e.KtG(c.enonceDecode=i)})("ngModelChange",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.checkErrors())}),e.qZA()(),e.TgZ(6,"button",10),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.removeProposition(r))}),e._UZ(7,"i",11),e.qZA()()}if(2&o){const t=s.$implicit,n=s.index,i=e.oxw();e.xp6(2),e.Q6J("ngIf",i.question.typeQ===i.questionBaseType.radio.id),e.xp6(1),e.Q6J("ngIf",i.question.typeQ===i.questionBaseType.checkbox.id),e.xp6(2),e.MGl("name","proposition",n,""),e.Q6J("ngModel",t.enonceDecode)}}function Et(o,s){1&o&&e._UZ(0,"i",12)}function Ut(o,s){1&o&&e._UZ(0,"i",13)}function wt(o,s){1&o&&(e.TgZ(0,"span",14),e._uU(1,"Vous devez saisir un texte pour chaque proposition."),e.qZA())}function kt(o,s){1&o&&(e.TgZ(0,"span",14),e._uU(1,"Vous devez ajouter des propositions."),e.qZA())}let Jt=(()=>{class o{constructor(){this.questionBaseType=a.xq9}ngOnInit(){this.checkErrors()}checkErrors(){this.validateHasLabelForeachPropRequired()}removeFormError(t){this.qForm.hasError(t)&&(delete this.qForm.errors[t],this.qForm.form.updateValueAndValidity())}addFormError(t){this.qForm.hasError(t)||this.qForm.form.setErrors({...this.qForm.errors,[t]:!0},{emitEvent:!0})}validateHasLabelForeachPropRequired(){0===this.question.propositions.length?(this.removeFormError("hasLabelForeachPropRequired"),this.addFormError("hasNoProp")):(this.removeFormError("hasNoProp"),this.question.propositions.some(n=>!a.FSr.isNotEmptyString(n.enonceDecode,!0))?this.addFormError("hasLabelForeachPropRequired"):this.removeFormError("hasLabelForeachPropRequired"))}removeProposition(t){const n=this.question.propositions.indexOf(t);-1!==n&&(this.question.propositions.splice(n,1),this.checkErrors())}addNewProposition(){this.question.propositions.push(new a.$ws),this.checkErrors()}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-fs-question-type-choice"]],inputs:{idFS:"idFS",question:"question",qForm:"qForm"},decls:10,vars:8,consts:[["class","question-proposition",4,"ngFor","ngForOf","ngForTrackBy"],[1,"question-proposition","add-new-question-proposition"],[1,"question-proposition-type-indicator"],["class","fa fa-fw fa-circle-thin","aria-label","ic\xf4ne question choix unique",4,"ngIf"],["class","fa fa-fw fa-square-o","aria-label","ic\xf4ne question choix multiple",4,"ngIf"],["type","button",1,"btn","active","no-background","no-padding",3,"click"],["class","text-danger",4,"ngIf"],[1,"question-proposition"],[1,"form-control-wrapper"],["type","text","maxlength","2000","required","",1,"form-control","circle",3,"name","ngModel","ngModelChange"],["type","button","title","Supprimer la proposition",1,"btn","btn-secondary","proposition-remove",3,"click"],["aria-hidden","true",1,"fa","fa-close"],["aria-label","ic\xf4ne question choix unique",1,"fa","fa-fw","fa-circle-thin"],["aria-label","ic\xf4ne question choix multiple",1,"fa","fa-fw","fa-square-o"],[1,"text-danger"]],template:function(t,n){1&t&&(e.YNc(0,Mt,8,4,"div",0),e.ALo(1,"trackByProperty"),e.TgZ(2,"div",1)(3,"div",2),e.YNc(4,Et,1,0,"i",3),e.YNc(5,Ut,1,0,"i",4),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return n.addNewProposition()}),e._uU(7,"cliquez ici pour ajouter une proposition"),e.qZA()(),e.YNc(8,wt,2,0,"span",6),e.YNc(9,kt,2,0,"span",6)),2&t&&(e.Q6J("ngForOf",n.question.propositions)("ngForTrackBy",e.lcZ(1,6,"id")),e.xp6(4),e.Q6J("ngIf",n.question.typeQ===n.questionBaseType.radio.id),e.xp6(1),e.Q6J("ngIf",n.question.typeQ===n.questionBaseType.checkbox.id),e.xp6(3),e.Q6J("ngIf",null==n.qForm||null==n.qForm.errors?null:n.qForm.errors.hasLabelForeachPropRequired),e.xp6(1),e.Q6J("ngIf",null==n.qForm||null==n.qForm.errors?null:n.qForm.errors.hasNoProp))},dependencies:[d.sg,d.O5,l.Fj,l.JJ,l.Q7,l.nD,l.On,h.$],styles:[".question-proposition[_ngcontent-%COMP%]{margin-top:4px}.question-proposition[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px}.question-proposition[_ngcontent-%COMP%]   .question-proposition-type-indicator[_ngcontent-%COMP%]{display:inline-block;margin-right:5px;cursor:pointer}.question-proposition[_ngcontent-%COMP%]   .form-control-wrapper[_ngcontent-%COMP%]{display:inline-block;width:300px}.question-proposition[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]{border:none;padding:6px;opacity:.5}.question-proposition[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]:hover{opacity:1}.question-proposition[_ngcontent-%COMP%]   .proposition-remove[_ngcontent-%COMP%]{color:red}.question-proposition.add-new-question-proposition[_ngcontent-%COMP%]{opacity:.5;margin-bottom:5px}.question-proposition.add-new-question-proposition[_ngcontent-%COMP%]   .question-proposition-type-indicator[_ngcontent-%COMP%]{cursor:default}.question-proposition.add-new-question-proposition[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:inline-block;cursor:pointer;border:1px dashed #757575;width:300px;height:28px;padding:2px 5px 0;font-size:14px}"]}),o})();const Dt=["editQuestionForm"];function Ot(o,s){1&o&&(e.TgZ(0,"alert",36)(1,"strong"),e._uU(2,"Attention !"),e.qZA(),e._uU(3," Certains champs ne sont pas renseign\xe9s ou sont incorrects "),e.qZA()),2&o&&e.Q6J("dismissible",!0)}function Nt(o,s){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Saisissez une question !"),e.qZA())}function It(o,s){if(1&o&&(e.TgZ(0,"option",38),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.Q6J("ngValue",t.id),e.xp6(1),e.Oqu(t.libelle)}}function Yt(o,s){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Choisissez un type de question !"),e.qZA())}function Pt(o,s){if(1&o&&e._UZ(0,"ed-fs-question-type-choice",42),2&o){const t=e.oxw(2),n=e.MAs(6);e.Q6J("idFS",t.idFS)("qForm",n)("question",t.question)}}function Lt(o,s){if(1&o&&e._UZ(0,"ed-fs-question-type-textarea",43),2&o){const t=e.oxw(2);e.Q6J("idFS",t.idFS)("question",t.question)}}function Bt(o,s){if(1&o&&(e.TgZ(0,"div",13)(1,"div",39),e.YNc(2,Pt,1,3,"ed-fs-question-type-choice",40),e.YNc(3,Lt,1,2,"ed-fs-question-type-textarea",41),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.question.typeQ===t.questionBaseType.checkbox.id||t.question.typeQ===t.questionBaseType.radio.id),e.xp6(1),e.Q6J("ngIf",t.question.typeQ===t.questionBaseType.textarea.id)}}function Rt(o,s){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Saisissez un entier !"),e.qZA())}function Ht(o,s){1&o&&(e.TgZ(0,"span",37),e._uU(1,"Saisissez un entier !"),e.qZA())}const S=function(o){return{"has-error":o}};function Gt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",44)(1,"div",45)(2,"strong",46),e._uU(3," Nombre de r\xe9ponses requises "),e.qZA()(),e.TgZ(4,"div",13)(5,"div",47),e._uU(6," Minimum "),e.TgZ(7,"input",48,49),e.NdJ("ngModelChange",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.question.minChecks=i)}),e.qZA(),e.TgZ(9,"span",16),e._uU(10,"Laissez \xe0 0 si pas de minimum requis"),e.qZA(),e.YNc(11,Rt,2,0,"span",12),e.qZA(),e.TgZ(12,"div",47),e._uU(13," Maximum "),e.TgZ(14,"input",50,51),e.NdJ("ngModelChange",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.question.maxChecks=i)}),e.qZA(),e.TgZ(16,"span",16),e._uU(17,"Laissez \xe0 0 si pas de maximum requis"),e.qZA(),e.YNc(18,Ht,2,0,"span",12),e.qZA()()()}if(2&o){const t=e.MAs(8),n=e.MAs(15),i=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(9,S,n.invalid||t.invalid)),e.xp6(4),e.Q6J("ngClass",e.VKq(11,S,t.invalid)),e.xp6(2),e.Q6J("ngModel",i.question.minChecks)("edEntierWithNoZero",!1),e.xp6(4),e.Q6J("ngIf",null==t.errors?null:t.errors.entierWithNoZero),e.xp6(1),e.Q6J("ngClass",e.VKq(13,S,n.invalid)),e.xp6(2),e.Q6J("ngModel",i.question.maxChecks)("edEntierWithNoZero",!1),e.xp6(4),e.Q6J("ngIf",null==n.errors?null:n.errors.entierWithNoZero)}}let $t=(()=>{class o{constructor(t,n,i,r){this.modalService=t,this.modalRef=n,this.edfService=i,this.uiService=r,this.ckConf=F.x$,this.onClose$=new A.x,this.encours=!1,this.questionBaseType={...a.xq9},delete this.questionBaseType.textholes}ngOnInit(){this.pageTitre=this.question.id>0?"Modifier la question":"Nouvelle question",this.question.questionDecode=a.FSr.isNotEmptyString(this.question.question)?a.YC.base64decode(this.question.question):"",this.question.enonceDecode=a.FSr.isNotEmptyString(this.question.enonce)?a.YC.base64decode(this.question.enonce):"",this.question.propositions.forEach(t=>{t.enonceDecode=a.FSr.isNotEmptyString(t.enonce)?a.YC.base64decode(t.enonce):""})}ngOnDestroy(){this.onClose$.complete()}onSubmit(){if(this.formQuestion.valid&&!this.encours){if(this.encours=!0,this.question.questionDecode.length>1572864||this.question.enonceDecode.length>1572864)return this.uiService.notifyEvent(a.DOJ.genericError,"Enregistrement impossible. Votre saisie est trop grande (>1.5Mo).","Erreur","icon-ed_edforms"),void(this.encours=!1);const t=new a.woQ(this.question);switch(t.question=a.YC.base64encode(t.questionDecode),t.enonce=a.YC.base64encode(t.enonceDecode),delete t.questionDecode,delete t.enonceDecode,t.typeQ){case a.xq9.radio.id:case a.xq9.checkbox.id:t.propositions.forEach(n=>{n.enonce=a.YC.base64encode(n.enonceDecode),delete n.enonceDecode});break;case a.xq9.textarea.id:break;default:this.encours=!1}if(!this.encours)return void this.uiService.notifyEvent(a.DOJ.genericError,"Enregistrement impossible. Vous n'avez pas choisi le type de question.","Erreur","icon-ed_edforms");this.loader=this.edfService.saveQuestion(this.idFS,t).pipe((0,x.x)(()=>this.encours=!1)).subscribe(n=>{t.id=n.id>0?n.id:t.id,this.uiService.notifyEvent(a.DOJ.genericSuccess,"La question a bien \xe9t\xe9 enregistr\xe9e.","Formulaires et sondages","icon-ed_edforms"),this.close({question:t})},n=>{this.uiService.notifyEvent(a.DOJ.genericError,501===n.status?n.message:"Une erreur s'est produite lors de l'enregistrement de la question.","Erreur","icon-ed_edforms")})}}changeminmax(){this.question.typeQ===a.xq9.checkbox.id&&(typeof this.formQuestion.value.minChecks>"u"&&(this.question.minChecks=0),typeof this.formQuestion.value.maxChecks>"u"&&(this.question.maxChecks=0))}resetErrors(){Object.isExists(this.formQuestion.errors)&&Object.keys(this.formQuestion.errors).forEach(t=>{this.question.typeQ===a.xq9.textarea.id&&"hasLabelForeachPropRequired"===t&&this.formQuestion.form.controls.typeQ.setErrors({...this.formQuestion.form.controls.typeQ.errors,hasLabelForeachPropRequired:!0})})}openCKFormula(){const t={id:this.modalService.getModalsCount()+1,initialState:{title:"Aide \xe0 la saisie",close:"Fermer",message:"<p>Pour int\xe9grer une formule dans la proposition (choix unique ou multiples uniquement), entourez-l\xe0 par <b>#</b> de part et d'autre. Exemple : <b>#</b>x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}<b>#</b></p>"}};this.modalService.show(St.z,t)}close(t){Object.isExists(t)&&this.onClose$.next(t),this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.tT),e.Y36(_.UZ),e.Y36(a.i4Q),e.Y36(a.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-fs-question-manage"]],viewQuery:function(t,n){if(1&t&&e.Gf(Dt,5),2&t){let i;e.iGM(i=e.CRH())&&(n.formQuestion=i.first)}},inputs:{idFS:"idFS",question:"question"},decls:53,vars:25,consts:[[1,"modal-header"],[1,"modal-title"],["aria-label","Fermer cette fen\xeatre","type","button",1,"btn-close","d-print-none",3,"click"],["id","container-question-manage",1,"modal-body",3,"ngBusy"],["name","editQuestionForm","novalidate","",1,"row",3,"ngSubmit"],["editQuestionForm","ngForm"],["type","danger",3,"dismissible",4,"ngIf"],[1,"row","required",3,"ngClass"],["for","questionDecode",1,"col-md-2","col-form-label"],[1,"col-md-10"],["id","questionDecode","maxlength","2000","name","questionDecode","required","","type","text",1,"form-control",3,"ngModel","ngModelChange"],["questionDecode","ngModel"],["class","text-danger",4,"ngIf"],[1,"row"],["for","enonceDecode",1,"col-md-2","col-form-label"],["id","enonceDecode","name","enonceDecode",3,"ngModel","config","ngModelChange"],[1,"form-text"],[1,"offset-md-2","col-md-6"],[1,"form-check"],["name","required","type","checkbox","id","checkReponseObligatoire",1,"form-check-input",3,"ngModel","ngModelChange"],["for","checkReponseObligatoire",1,"form-check-label"],["for","typeQ",1,"col-md-2","col-form-label"],[1,"input-group"],["id","typeQ","name","typeQ","required","",1,"form-control","form-select",3,"ngModel","change","ngModelChange"],["typeQ","ngModel"],["value",""],[3,"ngValue",4,"ngFor","ngForOf","ngForTrackBy"],[1,"input-group-text","input-group-md","no-background"],["title","Comment ins\xe9rer une formule math\xe9matique","type","button",1,"btn","btn-secondary","btn-sm","no-background","mt-1",3,"click"],["aria-label","ic\xf4ne texte d'aide",1,"fa","fa-question-circle"],["class","row",4,"ngIf"],["class","row form-control-minmax",4,"ngIf"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","button",1,"btn","btn-success","float-end",3,"disabled","click"],["type","danger",3,"dismissible"],[1,"text-danger"],[3,"ngValue"],[1,"offset-md-2","col-md-10"],[3,"idFS","qForm","question",4,"ngIf"],[3,"idFS","question",4,"ngIf"],[3,"idFS","qForm","question"],[3,"idFS","question"],[1,"row","form-control-minmax"],[3,"ngClass"],["title","Nombre de points attribu\xe9s par question, qui permettra le calcul des notes dans le cas d'une \xe9valuation.",1,"col-md-2","col-form-label"],[1,"col-lg-4",3,"ngClass"],["id","minChecks","name","minChecks","step","1","type","number",1,"form-control","form-control-sm",3,"ngModel","edEntierWithNoZero","ngModelChange"],["minChecks","ngModel"],["id","maxChecks","name","maxChecks","step","1","type","number",1,"form-control","form-control-sm",3,"ngModel","edEntierWithNoZero","ngModelChange"],["maxChecks","ngModel"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(4,"div",3)(5,"form",4,5),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.YNc(7,Ot,4,1,"alert",6),e.TgZ(8,"div",7)(9,"label",8),e._uU(10,"Question"),e.qZA(),e.TgZ(11,"div",9)(12,"input",10,11),e.NdJ("ngModelChange",function(r){return n.question.questionDecode=r}),e.qZA(),e.YNc(14,Nt,2,0,"span",12),e.qZA()(),e.TgZ(15,"div",13)(16,"label",14),e._uU(17,"Enonc\xe9"),e.qZA(),e.TgZ(18,"div",9)(19,"ckeditor",15),e.NdJ("ngModelChange",function(r){return n.question.enonceDecode=r}),e.qZA(),e.TgZ(20,"span",16),e._uU(21,"Ce texte sera affich\xe9 en dessous de la question."),e.qZA()()(),e.TgZ(22,"div",13)(23,"div",17)(24,"div",18)(25,"input",19),e.NdJ("ngModelChange",function(r){return n.question.required=r}),e.qZA(),e.TgZ(26,"label",20),e._uU(27,"R\xe9ponse obligatoire"),e.qZA(),e.TgZ(28,"span",16),e._uU(29,"Si coch\xe9, l'utilisateur devra obligatoirement r\xe9pondre."),e.qZA()()()(),e.TgZ(30,"div",7)(31,"label",21),e._uU(32,"Type de question"),e.qZA(),e.TgZ(33,"div",9)(34,"div",22)(35,"select",23,24),e.NdJ("change",function(){return n.resetErrors(),n.changeminmax()})("ngModelChange",function(r){return n.question.typeQ=r}),e._UZ(37,"option",25),e.YNc(38,It,2,2,"option",26),e.ALo(39,"values"),e.ALo(40,"trackByProperty"),e.qZA(),e.TgZ(41,"span",27)(42,"button",28),e.NdJ("click",function(){return n.openCKFormula()}),e._UZ(43,"i",29),e.qZA()()(),e.YNc(44,Yt,2,0,"span",12),e.qZA()(),e.YNc(45,Bt,4,2,"div",30),e.YNc(46,Gt,19,15,"div",31),e.qZA()(),e.TgZ(47,"div",32)(48,"div",33)(49,"button",34),e.NdJ("click",function(){return n.close()}),e._uU(50,"Annuler"),e.qZA(),e.TgZ(51,"button",35),e.NdJ("click",function(){return n.formQuestion.ngSubmit.emit()}),e._uU(52,"Sauvegarder"),e.qZA()()()),2&t){const i=e.MAs(6),r=e.MAs(13),c=e.MAs(36);e.xp6(2),e.Oqu(n.pageTitre),e.xp6(2),e.Q6J("ngBusy",n.loader),e.xp6(3),e.Q6J("ngIf",i.submitted&&i.invalid),e.xp6(1),e.Q6J("ngClass",e.VKq(21,S,r.invalid)),e.xp6(4),e.Q6J("ngModel",n.question.questionDecode),e.xp6(2),e.Q6J("ngIf",null==r.errors?null:r.errors.required),e.xp6(5),e.Q6J("ngModel",n.question.enonceDecode)("config",n.ckConf),e.xp6(6),e.Q6J("ngModel",n.question.required),e.xp6(5),e.Q6J("ngClass",e.VKq(23,S,c.invalid)),e.xp6(5),e.Q6J("ngModel",n.question.typeQ),e.xp6(3),e.Q6J("ngForOf",e.lcZ(39,17,n.questionBaseType))("ngForTrackBy",e.lcZ(40,19,"id")),e.xp6(6),e.Q6J("ngIf",null==c.errors?null:c.errors.required),e.xp6(1),e.Q6J("ngIf",n.question.typeQ),e.xp6(1),e.Q6J("ngIf",n.question.typeQ===n.questionBaseType.checkbox.id),e.xp6(5),e.Q6J("disabled",null==i?null:i.invalid)}},dependencies:[d.mk,d.sg,d.O5,l._Y,l.YN,l.Kr,l.Fj,l.wV,l.Wl,l.EJ,l.JJ,l.JL,l.Q7,l.nD,l.On,l.F,T.wx,Y.u,b.DC,yt.c,Zt,Jt,a.gLd,h.$],styles:['.required[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]:after{content:"*";color:red;padding-left:5px}']}),o})();function Kt(o,s){1&o&&(e.TgZ(0,"alert",13),e._uU(1,"Aucun questionnaire disponible"),e.qZA())}function Vt(o,s){if(1&o&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.Q6J("ngValue",t.id),e.xp6(1),e.Oqu(t.titre)}}function jt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",14)(1,"label",15),e._uU(2,"Questionnaires"),e.qZA(),e.TgZ(3,"div",16)(4,"select",17),e.NdJ("ngModelChange",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.choosedId=i)}),e._UZ(5,"option",18),e.YNc(6,Vt,2,2,"option",19),e.ALo(7,"trackByProperty"),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngModel",t.choosedId),e.xp6(1),e.Q6J("ngValue",0),e.xp6(1),e.Q6J("ngForOf",t.fss)("ngForTrackBy",e.lcZ(7,4,"id"))}}function zt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t),e.oxw();const i=e.MAs(9);return e.KtG(i.ngSubmit.emit())}),e._uU(1,"Choisir ce questionnaire"),e.qZA()}}let Xt=(()=>{class o extends((0,a.kCV)()){constructor(t,n,i,r,c){super(),this.edfService=t,this.edfStore=n,this.modalRef=i,this.uiService=r,this.edFormsUserStore=c,this.onClose$=new A.x}get fUser(){return this.edFormsUserStore.snapshot}ngOnInit(){this.loader=this.edfService.manageForms(this.fUser.choosenAnnee,!0).pipe((0,Q.K)(t=>this.uiService.notifyErrorThenEmpty(t,!0,"Erreur","icon-ed_edforms"))).subscribe(),this.edfStore.selectSubStore(this.fUser.choosenAnnee).pipe((0,q.b)(t=>{this.fss=t.filter(n=>this.idFS!==n.id&&!n.isActive)}),(0,y.R)(this.componentDestroyed$)).subscribe()}ngOnDestroy(){return this.onClose$.complete(),super.ngOnDestroy()}onSubmit(){this.onClose$.next(this.choosedId),this.close()}close(){this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(a.i4Q),e.Y36(a.GBF),e.Y36(_.UZ),e.Y36(a.VLf),e.Y36(m))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-clone-fs-question"]],inputs:{idFS:"idFS"},features:[e.qOj],decls:17,vars:4,consts:[[1,"modal-header"],[1,"modal-title"],[1,"form-text","modal-subtitle"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body",3,"ngBusy"],["name","cloneQForm","novalidate","",1,"row",3,"ngSubmit"],["cloneQForm","ngForm"],["type","warning",4,"ngIf"],["class","row",4,"ngIf"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["class","btn btn-success float-end","type","button",3,"click",4,"ngIf"],["type","warning"],[1,"row"],["for","choosedId",1,"col-md-2","col-form-label"],[1,"col-md-10"],["name","choosedId","id","choosedId",1,"form-control","form-select",3,"ngModel","ngModelChange"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"btn","btn-success","float-end",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div")(2,"h3",1),e._uU(3,"Choisir le questionnaire o\xf9 dupliquer la question"),e.qZA(),e.TgZ(4,"span",2),e._uU(5,"Seuls les questionnaires non accessibles aux utilisateurs sont disponibles ici."),e.qZA()(),e.TgZ(6,"button",3),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(7,"div",4)(8,"form",5,6),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.YNc(10,Kt,2,0,"alert",7),e.YNc(11,jt,8,6,"div",8),e.qZA()(),e.TgZ(12,"div",9)(13,"div",10)(14,"button",11),e.NdJ("click",function(){return n.close()}),e._uU(15,"Annuler"),e.qZA(),e.YNc(16,zt,2,0,"button",12),e.qZA()()),2&t&&(e.xp6(7),e.Q6J("ngBusy",n.loader),e.xp6(3),e.Q6J("ngIf",!n.fss||0===n.fss.length),e.xp6(1),e.Q6J("ngIf",n.fss&&n.fss.length>0),e.xp6(5),e.Q6J("ngIf",!n.fss||n.fss.length>0))},dependencies:[d.sg,d.O5,l._Y,l.YN,l.Kr,l.EJ,l.JJ,l.JL,l.On,l.F,T.wx,b.DC,h.$],encapsulation:2}),o})();var Wt=u(73219);let en=(()=>{class o{constructor(){this.manageQuestion=new e.vpe}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-fs-questions-globals-actions"]],inputs:{id:"id"},outputs:{manageQuestion:"manageQuestion"},decls:12,vars:1,consts:[[1,"float-start"],[1,"list-inline"],[1,"list-inline-item","mb-2","me-4"],[1,"btn-group"],["type","button","routerLink","../../","title","Retour \xe0 mon questionnaire",1,"btn","btn-secondary",3,"fragment"],["aria-hidden","true",1,"fa","fa-arrow-left"],[1,"list-inline-item","mb-2"],["type","button","title","Nouvelle question",1,"btn","btn-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-plus"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"ul",1)(2,"li",2)(3,"div",3)(4,"button",4),e._UZ(5,"i",5),e._uU(6," Retour \xe0 mon questionnaire "),e.qZA()()(),e.TgZ(7,"li",6)(8,"div",3)(9,"button",7),e.NdJ("click",function(){return n.manageQuestion.emit()}),e._UZ(10,"i",8),e._uU(11," Nouvelle question "),e.qZA()()()()()),2&t&&(e.xp6(4),e.MGl("fragment","fs_",n.id,""))},dependencies:[v.rH],encapsulation:2,changeDetection:0}),o})();function tn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.moveDown.emit())}),e._UZ(1,"i",10),e.qZA()}}function nn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.moveUp.emit())}),e._UZ(1,"i",12),e.qZA()}}let on=(()=>{class o{constructor(){this.manageQuestion=new e.vpe,this.moveDown=new e.vpe,this.moveUp=new e.vpe,this.cloneQuestion=new e.vpe,this.deleteQuestion=new e.vpe}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-une-fs-question-actions"]],inputs:{isFirst:"isFirst",isLast:"isLast"},outputs:{manageQuestion:"manageQuestion",moveDown:"moveDown",moveUp:"moveUp",cloneQuestion:"cloneQuestion",deleteQuestion:"deleteQuestion"},decls:9,vars:2,consts:[[1,"une-question-actions"],["title","Modifier la question","type","button",1,"btn","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-pencil"],["class","btn btn-sm","title","D\xe9placer vers le bas","type","button",3,"click",4,"ngIf"],["class","btn btn-sm","title","D\xe9placer vers le haut","type","button",3,"click",4,"ngIf"],["title","Dupliquer la question","type","button",1,"btn","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-clone"],["title","Supprimer la question","type","button",1,"btn","btn-sm","btn-danger-color",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o"],["title","D\xe9placer vers le bas","type","button",1,"btn","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-chevron-down"],["title","D\xe9placer vers le haut","type","button",1,"btn","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-chevron-up"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return n.manageQuestion.emit()}),e._UZ(2,"i",2),e.qZA(),e.YNc(3,tn,2,0,"button",3),e.YNc(4,nn,2,0,"button",4),e.TgZ(5,"button",5),e.NdJ("click",function(){return n.cloneQuestion.emit()}),e._UZ(6,"i",6),e.qZA(),e.TgZ(7,"button",7),e.NdJ("click",function(){return n.deleteQuestion.emit()}),e._UZ(8,"i",8),e.qZA()()),2&t&&(e.xp6(3),e.Q6J("ngIf",!n.isLast),e.xp6(1),e.Q6J("ngIf",!n.isFirst))},dependencies:[d.O5],encapsulation:2,changeDetection:0}),o})();function sn(o,s){1&o&&(e.TgZ(0,"span",8),e._uU(1,"(requis)"),e.qZA())}function rn(o,s){if(1&o&&(e.TgZ(0,"div",9),e.ALo(1,"filterHtml"),e.ALo(2,"base64"),e._uU(3," enonce\n"),e.qZA()),2&o){const t=e.oxw();e.Q6J("content",t.question.enonce)("innerHTML",e.lcZ(1,2,e.lcZ(2,4,t.question.enonce)),e.oJD)}}function an(o,s){if(1&o&&(e.TgZ(0,"div",12),e._UZ(1,"input",13),e.TgZ(2,"label",14),e._UZ(3,"span",15),e.ALo(4,"filterHtml"),e.ALo(5,"replaceFormulaQuestionProp"),e.ALo(6,"base64"),e.qZA()()),2&o){const t=s.$implicit,n=e.oxw(2);e.xp6(1),e.MGl("name","optionsRadios-",n.question.id,"")("id","btRadioProposition_",t.id,""),e.Q6J("value",t.id)("checked",t.valide),e.xp6(1),e.MGl("for","btRadioProposition_",t.id,""),e.xp6(1),e.Q6J("content",t.enonce)("innerHTML",e.xi3(4,7,e.lcZ(5,10,e.lcZ(6,12,t.enonce)),!0),e.oJD)}}function cn(o,s){if(1&o&&(e.TgZ(0,"div",10),e.YNc(1,an,7,14,"div",11),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.question.propositions)("ngForTrackBy",e.lcZ(2,2,"id"))}}function un(o,s){if(1&o&&(e.TgZ(0,"div",12),e._UZ(1,"input",17),e.TgZ(2,"label",14),e._UZ(3,"span",15),e.ALo(4,"filterHtml"),e.ALo(5,"replaceFormulaQuestionProp"),e.ALo(6,"base64"),e.qZA()()),2&o){const t=s.$implicit;e.xp6(1),e.MGl("name","optionsCheckbox-",t.id,"")("id","check_",t.id,""),e.Q6J("value",t.id)("checked",t.valide),e.xp6(1),e.MGl("for","check_",t.id,""),e.xp6(1),e.Q6J("content",t.enonce)("innerHTML",e.xi3(4,7,e.lcZ(5,10,e.lcZ(6,12,t.enonce)),!0),e.oJD)}}function ln(o,s){if(1&o&&(e.TgZ(0,"div",16),e.YNc(1,un,7,14,"div",11),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.question.propositions)("ngForTrackBy",e.lcZ(2,2,"id"))}}function dn(o,s){if(1&o&&(e.TgZ(0,"div",20),e._UZ(1,"textarea",21),e.qZA()),2&o){const t=s.$implicit;e.xp6(1),e.MGl("name","textarea-",t.id,"")}}function pn(o,s){if(1&o&&(e.TgZ(0,"div",18),e.YNc(1,dn,2,1,"div",19),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.question.propositions)("ngForTrackBy",e.lcZ(2,2,"id"))}}let mn=(()=>{class o{constructor(){this.questionBaseType=a.xq9,this.deleteQuestion=new e.vpe,this.manageQuestion=new e.vpe,this.moveDownQuestion=new e.vpe,this.moveUpQuestion=new e.vpe,this.cloneQuestion=new e.vpe}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-une-fs-question"]],inputs:{idFS:"idFS",question:"question",isFirst:"isFirst",isLast:"isLast"},outputs:{deleteQuestion:"deleteQuestion",manageQuestion:"manageQuestion",moveDownQuestion:"moveDownQuestion",moveUpQuestion:"moveUpQuestion",cloneQuestion:"cloneQuestion"},decls:10,vars:11,consts:[[3,"isFirst","isLast","manageQuestion","moveDown","moveUp","cloneQuestion","deleteQuestion"],[1,"list-group-item-heading"],["class","required",4,"ngIf"],["class","list-group-item-text fs-img-container ed-cke","edMathjax","",3,"content","innerHTML",4,"ngIf"],[1,"une-question-type",3,"ngSwitch"],["class","une-question-type-radio",4,"ngSwitchCase"],["class","une-question-type-checkbox",4,"ngSwitchCase"],["class","une-question-type-textarea",4,"ngSwitchCase"],[1,"required"],["edMathjax","",1,"list-group-item-text","fs-img-container","ed-cke",3,"content","innerHTML"],[1,"une-question-type-radio"],["class","form-check disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-check","disabled"],["type","radio","disabled","",1,"form-check-input",3,"name","id","value","checked"],[1,"form-check-label",3,"for"],["edMathjax","",3,"content","innerHTML"],[1,"une-question-type-checkbox"],["type","checkbox","disabled","",1,"form-check-input",3,"name","value","checked","id"],[1,"une-question-type-textarea"],["class","textarea disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"textarea","disabled"],["rows","3","disabled","",1,"form-control","w-50",3,"name"]],template:function(t,n){1&t&&(e.TgZ(0,"ed-une-fs-question-actions",0),e.NdJ("manageQuestion",function(){return n.manageQuestion.emit()})("moveDown",function(){return n.moveDownQuestion.emit()})("moveUp",function(){return n.moveUpQuestion.emit()})("cloneQuestion",function(){return n.cloneQuestion.emit()})("deleteQuestion",function(){return n.deleteQuestion.emit()}),e.qZA(),e.TgZ(1,"h4",1),e._uU(2),e.ALo(3,"base64"),e.YNc(4,sn,2,0,"span",2),e.qZA(),e.YNc(5,rn,4,6,"div",3),e.TgZ(6,"div",4),e.YNc(7,cn,3,4,"div",5),e.YNc(8,ln,3,4,"div",6),e.YNc(9,pn,3,4,"div",7),e.qZA()),2&t&&(e.Q6J("isFirst",n.isFirst)("isLast",n.isLast),e.xp6(2),e.hij(" ",e.lcZ(3,9,n.question.question)," "),e.xp6(2),e.Q6J("ngIf",n.question.required),e.xp6(1),e.Q6J("ngIf",n.question.enonce),e.xp6(1),e.Q6J("ngSwitch",n.question.typeQ),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.radio.id),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.checkbox.id),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.textarea.id))},dependencies:[d.sg,d.O5,d.RF,d.n9,L.L,on,a.YC,B.w,h.$,R.T],encapsulation:2,changeDetection:0}),o})();function fn(o,s){1&o&&(e.TgZ(0,"alert",10),e._uU(1,"Vous n'avez pas de question pour le moment !"),e.qZA())}function _n(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",11)(1,"div",12)(2,"ed-une-fs-question",13),e.NdJ("deleteQuestion",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onDeleteQuestion(r))})("manageQuestion",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onManageQuestion(r))})("moveDownQuestion",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.OnMoveDownQuestion(r))})("moveUpQuestion",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.OnMoveUpQuestion(r))})("cloneQuestion",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onCloneQuestion(r))}),e.qZA()()()}if(2&o){const t=s.$implicit,n=s.last,i=s.first,r=e.oxw(2);e.xp6(2),e.MGl("id","question_",t.id,""),e.Q6J("idFS",r.fsQ.id)("isFirst",i)("isLast",n)("question",t)}}function gn(o,s){if(1&o&&(e.TgZ(0,"div",6),e.YNc(1,fn,2,0,"alert",7),e.TgZ(2,"div",8),e.YNc(3,_n,3,5,"div",9),e.ALo(4,"trackByProperty"),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",0===t.fsQ.combien),e.xp6(1),e.Q6J("sortablejsOptions",t.sortableConf)("edSortablejs",t.fsQ.questions),e.xp6(1),e.Q6J("ngForOf",t.fsQ.questions)("ngForTrackBy",e.lcZ(4,5,"id"))}}function hn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",14)(1,"div",15)(2,"ed-fs-questions-globals-actions",2),e.NdJ("manageQuestion",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onManageQuestion())}),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("id",null==t.fsQ?null:t.fsQ.id)}}const vn=[{path:"",component:Tt},{path:":idFS",redirectTo:":idFS/questions",pathMatch:"full"},{path:":idFS/questions",component:(()=>{class o{constructor(t,n,i,r,c,p,f){this.activatedRoute=t,this.edFormsUserStore=n,this.loaderService=i,this.modalService=r,this.edfService=c,this.router=p,this.uiService=f,this.sortableConf={onEnd:D=>{this.updateQuestionsOrderNo(D.newIndex)}}}static arrayMove(t,n,i){const r=t[n];t.splice(n,1),t.splice(i,0,r)}ngOnInit(){this.activatedRoute.snapshot.paramMap.has("idFS")?this.getQuestions():this.router.navigate(["../../"],{relativeTo:this.activatedRoute}).catch(()=>console.error("FsQuestionsComponent navigate to ../../"))}getQuestions(){this.loader=this.edfService.getQuestions(+this.activatedRoute.snapshot.paramMap.get("idFS")).subscribe({next:t=>{this.fsQ=new a.yQw(t),this.sortQuestionsByOrderNo()},error:t=>{404===t.status?(this.uiService.notifyEvent(a.DOJ.genericError,"Le questionnaire demand\xe9e est introuvable. Peut-\xeatre l'avez vous pr\xe9alablement supprim\xe9 ?","Erreur","icon-ed_edforms"),this.router.navigate(["../../"],{relativeTo:this.activatedRoute}).catch(()=>console.error("getQuestions navigate to ../../"))):530===t.status?(this.uiService.notifyEvent(a.DOJ.genericError,t.message,"Erreur","icon-ed_edforms"),this.router.navigate(["../../"],{relativeTo:this.activatedRoute}).catch(()=>console.error("getQuestions navigate to ../../"))):this.uiService.notifyEvent(a.DOJ.genericError,"Une erreur s'est produite lors de la r\xe9cup\xe9ration de vos questions.","Erreur","icon-ed_edforms")}})}updateQuestionsOrderNo(t){const n=this.fsQ.questions[t].ordre;this.fsQ.questions[t].ordre=a.woQ.generatePosOrder(this.fsQ.questions,t),this.loader=this.edfService.updateQuestionOrdre(this.fsQ.id,this.fsQ.questions[t]).subscribe({next:i=>this.uiService.notifyEvent(a.DOJ.genericSuccess,"L'ordre a bien \xe9t\xe9 mis \xe0 jour.","Question mise \xe0 jour","icon-ed_edforms"),error:i=>{this.fsQ.questions[t].ordre=n,this.sortQuestionsByOrderNo(),this.uiService.notifyEvent(String(i.status),i.message,"Erreur","icon-ed_edforms")}})}sortQuestionsByOrderNo(){this.fsQ.questions.sort((t,n)=>t.ordre-n.ordre)}onManageQuestion(t){this.modalService.show($t,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,class:"modal-lg",initialState:{idFS:this.fsQ.id,question:Object.isExists(t)?new a.woQ(t):a.woQ.addNewQuestion(this.fsQ.questions)}}).content.onClose$.pipe((0,g.q)(1)).subscribe(i=>{if(Object.isExists(i)&&Object.isExists(i.question)){const r=this.fsQ.questions.findIndex(c=>c.id===i.question.id);-1===r?this.fsQ.questions.push(i.question):this.fsQ.questions[r]=i.question}})}onDeleteQuestion(t){const n={title:"Suppression de la question",message:`\xcates-vous s\xfbr de vouloir supprimer <strong>d\xe9finitivement</strong> la question <strong>${a.YC.base64decode(t.question)}</strong> ?`,warningButton:"OK"},i={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:n};this.modalService.show(w.z,i),this.modalService.onHide.pipe((0,g.q)(1),(0,Z.h)(r=>r===k.G.validation),(0,U.w)(r=>(this.loader=this.loaderService.show(this),this.edfService.supprimerQuestion(this.fsQ.id,t.id))),(0,q.b)(r=>{const c=this.fsQ.questions.findIndex(p=>t.id===p.id);c>-1&&this.fsQ.questions.splice(c,1),this.uiService.notifyEvent(a.DOJ.genericSuccess,"Votre question a bien \xe9t\xe9 supprim\xe9e.","Question supprim\xe9e","icon-ed_edforms")}),(0,x.x)(()=>this.loaderService.hide(this)),(0,Q.K)(r=>(this.uiService.notifyEvent(a.DOJ.genericError,501===r.status?r.message:"Une erreur s'est produite lors de la suppression de la question.","Erreur","icon-ed_edforms"),I.E))).subscribe()}OnMoveDownQuestion(t){const n=this.fsQ.questions.findIndex(r=>t.id===r.id),i=n+1;i<this.fsQ.questions.length&&(o.arrayMove(this.fsQ.questions,n,i),this.updateQuestionsOrderNo(i))}OnMoveUpQuestion(t){const n=this.fsQ.questions.findIndex(r=>t.id===r.id),i=n-1;i>=0&&(o.arrayMove(this.fsQ.questions,n,i),this.updateQuestionsOrderNo(i))}onCloneQuestion(t){Object.isExists(t)&&0!==t.id&&this.modalService.show(Xt,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,class:"modal-lg",initialState:{idFS:this.fsQ.id},providers:[{provide:m,useValue:this.edFormsUserStore}]}).content.onClose$.pipe((0,g.q)(1)).subscribe(i=>{if(i>0){const r=this.fsQ.questions.findIndex(c=>t.id===c.id);r>-1&&(this.loader=this.edfService.getQuestions(i).pipe((0,E.U)(c=>(c.questions.sort((p,f)=>p.ordre-f.ordre),a.woQ.addNewQuestion(c.questions,this.fsQ.questions[r]))),(0,U.w)(c=>this.edfService.saveQuestion(i,c,!0))).subscribe({next:c=>this.uiService.notifyEvent(a.DOJ.genericSuccess,"La question a bien \xe9t\xe9 dupliqu\xe9e.","Formulaires et sondages","icon-ed_edforms"),error:c=>this.uiService.notifyEvent(a.DOJ.genericError,"Une erreur s'est produite lors de la copie de la question.","Erreur","icon-ed_edforms")}))}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(v.gz),e.Y36(m),e.Y36(H.S),e.Y36(_.tT),e.Y36(a.i4Q),e.Y36(v.F0),e.Y36(a.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-fs-questions"]],decls:10,vars:5,consts:[[1,"ed-container","page-fs-questions","double-padding"],[1,"entete-page"],[3,"id","manageQuestion"],[3,"ngBusy"],["class","les-questions margin-top-10",4,"ngIf"],["class","row mt-4",4,"ngIf"],[1,"les-questions","margin-top-10"],["type","info",4,"ngIf"],[1,"list-group","list-group-hover",3,"sortablejsOptions","edSortablejs"],["class","card ed-card with-epingle",4,"ngFor","ngForOf","ngForTrackBy"],["type","info"],[1,"card","ed-card","with-epingle"],[1,"card-body"],[1,"list-group-item","une-question",3,"id","idFS","isFirst","isLast","question","deleteQuestion","manageQuestion","moveDownQuestion","moveUpQuestion","cloneQuestion"],[1,"row","mt-4"],[1,"col-12","globals-actions"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2"),e._uU(3," Les questions de "),e.TgZ(4,"b"),e._uU(5),e.qZA()(),e.TgZ(6,"ed-fs-questions-globals-actions",2),e.NdJ("manageQuestion",function(){return n.onManageQuestion()}),e.qZA()(),e.TgZ(7,"div",3),e.YNc(8,gn,5,7,"div",4),e.qZA(),e.YNc(9,hn,3,1,"div",5),e.qZA()),2&t&&(e.xp6(5),e.Oqu(null==n.fsQ?null:n.fsQ.titre),e.xp6(1),e.Q6J("id",null==n.fsQ?null:n.fsQ.id),e.xp6(1),e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("ngIf",n.fsQ),e.xp6(1),e.Q6J("ngIf",(null==n.fsQ?null:n.fsQ.questions.length)>3))},dependencies:[d.sg,d.O5,T.wx,b.DC,Wt.Q,en,mn,h.$],styles:[".page-fs-questions .entete-page{justify-content:space-between}.page-fs-questions .les-questions .list-group-hover .list-group-item:hover{background-color:var(--menu-hover-color);cursor:move}.page-fs-questions .les-questions .sortable-ghost{opacity:.5;border:2px dotted var(--dark-placeholder-color)!important;background:#C8EBFB}.page-fs-questions .les-questions .une-question{z-index:0;position:relative;border:none;border-radius:0}.page-fs-questions .les-questions .une-question .fs-img-container img{max-width:100%}.page-fs-questions .les-questions .une-question .list-group-item-heading{margin-bottom:15px;white-space:normal;width:70%}.page-fs-questions .les-questions .une-question .list-group-item-text{margin-bottom:15px}.page-fs-questions .les-questions .une-question .list-group-item-text>ol{margin-left:15px}.page-fs-questions .les-questions .une-question .alert{margin-top:15px}.page-fs-questions .les-questions .une-question figure{margin:10px 0;padding-left:5px;border-left:2px solid dimgrey}.page-fs-questions .les-questions .une-question figcaption{font-weight:600}.page-fs-questions .les-questions .une-question .btn-sm{margin:0;padding:5px 10px}.page-fs-questions .les-questions .une-question h4>span.required{color:var(--secondary-color)}.page-fs-questions .les-questions .une-question .une-question-actions{position:absolute;right:0;top:0;padding:8px;opacity:0}.page-fs-questions .les-questions .une-question:hover .une-question-actions{opacity:.6}.page-fs-questions .les-questions .une-question:hover .une-question-actions button{background-color:#e3e4e5;cursor:pointer}.page-fs-questions .les-questions .une-question:hover .une-question-actions button:not(.btn-danger-color){color:#000}.page-fs-questions .les-questions .une-question:hover .une-question-actions:hover{opacity:1}\n"],encapsulation:2}),o})()}];let bn=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[v.Bz.forChild(vn),v.Bz]}),o})();var Fn=u(13666),Cn=u(96272),qn=u(63869);let xn=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[m],imports:[Fn.L,qn.X,$.m,bn,Cn.Q,K.b]}),o})()}}]);