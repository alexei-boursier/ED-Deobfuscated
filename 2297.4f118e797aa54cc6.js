"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[2297],{38198:(S,g,c)=>{c.d(g,{r:()=>ye});var e=c(94650),d=c(18505),v=c(82722),_=c(70262),p=c(28746),s=c(45007),C=c(11302),l=c(24006),h=c(20388),T=c(92635),f=c(36895),x=c(80125),Z=c(75064),A=c(48536);function V(n,o){if(1&n&&(e.TgZ(0,"p",17),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(t.sousTitre)}}function M(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",18)(1,"form",19)(2,"div")(3,"label",20),e._uU(4),e.qZA(),e.TgZ(5,"div"),e._UZ(6,"textarea",21),e.qZA()(),e.TgZ(7,"div")(8,"strong",22),e._uU(9,"Vous pouvez ajouter un justificatif sous forme de fichier"),e.qZA()(),e.TgZ(10,"ed-input-files",23),e.NdJ("successUpload",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.onUploadSuccess(a))})("removedFile",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onRemovedFile())}),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.justificationForm),e.xp6(3),e.hij("Veuillez indiquer le motif ","retard"===t.evenementVs.typeElement?"du retard":"de l'absence",""),e.xp6(6),e.Q6J("config",t.configInputFile)("dropzoneConfig",t.dropzoneConfig)}}let U=(()=>{class n{constructor(t,i,a,r,u,m){this.authStore=t,this.modalRef=i,this._formBuilder=a,this.vieScolaireService=r,this.uiService=u,this.loaderService=m,this.tabContacts=[],this.motifAbsence="",this.justification=new s.FVy}ngOnInit(){this.configInputFile={fromCloudEnabled:!1,keepComplete:!0,dropzoneContainer:".dropzone-container"},this.dropzoneConfig={url:(0,C.Je)()+"/televersement.awp?verbe=post",timeout:3e6,maxFilesize:2e3,maxFiles:1},this.titre="Justification "+("Retard"===this.evenementVs.typeElement?"du retard":"de l'absence"),this.sousTitre=this.evenementVs.displayDate,this.customMessage=`Pour <b>justifier votre <span class="text-lowercase">${"Retard"===this.evenementVs.typeElement?"retard":"absence"}</span></b>,`,this.tabContacts.push({idSignataire:this.authStore.currentUser.id,typeSignataire:this.authStore.currentUser.typeCompte,telephone:this.authStore.currentUser.profile.telPortable}),this.tabContacts.push({idSignataire:this.authStore.currentUser.id,typeSignataire:this.authStore.currentUser.typeCompte,telephone:this.authStore.currentUser.profile.telPortableConjoint}),this.justification.idAbsence=this.evenementVs.id,this.justification.typeAbsence=this.evenementVs.typeElement,this.justification.libelleEnAttente="En attente",this.motifCtrl=this._formBuilder.control("",[l.kI.required]),this.justificationForm=this._formBuilder.group({motif:this.motifCtrl})}submitJustification(t){this.justification.signature.code=t.codeSMS,this.justification.signature.signatureCanvas=t.signataire.signatureCanvas,this.justification.message=this.justificationForm.value.motif,this.justification.date=this.evenementVs.displayDate,this.justification.idEleve=this.idEleve,this.loader=this.loaderService.show(this),this.vieScolaireService.justifierAbsence(this.idEleve,this.justification).pipe((0,d.b)(()=>{this.uiService.notifyEvent(s.DOJ.genericSuccess,"Votre absence a bien \xe9t\xe9 justifi\xe9e","Vie Scolaire","icon-ed_viescolaire"),this.close()}),(0,_.K)(i=>this.uiService.notifyErrorThenEmpty(new s.FwQ("La justification de l'absence \xe0 \xe9chou\xe9, veuillez v\xe9rifier la saisie de votre code re\xe7u par SMS",i.status,i.action),!0,"Vie Scolaire","fa fa-warning")),(0,p.x)(()=>this.loaderService.hide(this))).subscribe()}onCodeSMSLoading(t){t?this.loader=this.loaderService.show(this):this.loaderService.hide(this)}onUploadSuccess(t){this.justification.fichier=t.unc}onRemovedFile(){this.justification.fichier=""}close(){this.modalRef.hide()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(s.CnD),e.Y36(h.UZ),e.Y36(l.qu),e.Y36(s.UmA),e.Y36(s.VLf),e.Y36(T.S))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-modal-confirm-justification-absence"]],inputs:{evenementVs:"evenementVs",idEleve:"idEleve"},decls:26,vars:9,consts:[[1,"modal-header"],[1,"modal-title"],["class","modal-subtitle",4,"ngIf"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"signe",3,"ngBusy"],[1,"modal-body",2,"text-align","justify"],[3,"contacts","avecChangementTelephone","codeSMSChange","codeSMSloading"],["edAuthSecure",""],["id","description",1,"margin-bottom-20"],["descriptionContent",""],[3,"innerHTML"],["id","formButtons",1,"margin-top-20"],[1,"control-group","boutonsJustif"],["id","button1id","type","submit","name","button1id",1,"btn","btn-success","float-end",3,"disabled"],["id","button2id","type","button","name","button2id",1,"btn","btn-danger","float-start",3,"click"],[1,"clearfix"],["id","inputsSpecificsAuthSecure","class","dropzone-container",4,"ngIf"],[1,"modal-subtitle"],["id","inputsSpecificsAuthSecure",1,"dropzone-container"],["method","post","name","justifAbsenceForm","novalidate","",3,"formGroup"],["for","motif",1,"col-form-label"],["formControlName","motif","id","motif","name","motif","rows","5",1,"form-control"],[1,"texte-label"],[3,"config","dropzoneConfig","successUpload","removedFile"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0)(1,"div")(2,"h3",1),e._uU(3),e.qZA(),e.YNc(4,V,2,1,"p",2),e.qZA(),e.TgZ(5,"button",3),e.NdJ("click",function(){return i.close()}),e.qZA()(),e.TgZ(6,"div",4)(7,"div",5)(8,"ed-auth-secure",6,7),e.NdJ("codeSMSChange",function(r){return i.submitJustification(r)})("codeSMSloading",function(r){return i.onCodeSMSLoading(r)}),e.TgZ(10,"div",8,9)(12,"p"),e._UZ(13,"span",10),e._uU(14," nous vous demandons de "),e.TgZ(15,"b"),e._uU(16,"confirmer votre identit\xe9 par SMS"),e.qZA(),e._uU(17," via le bouton 'Authentification' ci-dessous "),e.qZA()(),e.TgZ(18,"div",11)(19,"div",12)(20,"button",13),e._uU(21),e.qZA(),e.TgZ(22,"button",14),e.NdJ("click",function(){return i.close()}),e._uU(23,"Annuler"),e.qZA()(),e._UZ(24,"div",15),e.qZA(),e.YNc(25,M,11,4,"div",16),e.qZA()()()),2&t){const a=e.MAs(9);e.xp6(3),e.hij(" ",i.titre," "),e.xp6(1),e.Q6J("ngIf",""!==i.sousTitre),e.xp6(2),e.Q6J("ngBusy",i.loader),e.xp6(2),e.Q6J("contacts",i.tabContacts)("avecChangementTelephone",!1),e.xp6(5),e.Q6J("innerHTML",i.customMessage,e.oJD),e.xp6(7),e.Q6J("disabled",2===a.etape&&(a.D3SecureForm.invalid||i.justificationForm.invalid)),e.xp6(1),e.hij(" ",1===a.etape?"Authentification":"Confirmer"," "),e.xp6(4),e.Q6J("ngIf",2===a.etape)}},dependencies:[f.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,x.DC,Z.p,A.s]}),n})();var y=c(95715),q=c(93970),J=c(34414),E=c(34331);const I=["tableVs"],O=["tableSanctions"],N=["tableEncouragements"];function Y(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.scrollToElement("tableVs"))}),e.TgZ(2,"div",10)(3,"div",11)(4,"h1"),e._uU(5),e.qZA(),e.TgZ(6,"strong"),e._uU(7,"Absences"),e.qZA(),e._UZ(8,"i",12),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.hYB("title","",t.vsContexte,"  ",t.compteurEvenementAbsence," absence(s)"),e.xp6(4),e.Oqu(t.compteurEvenementAbsence)}}function w(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.scrollToElement("tableVs"))}),e.TgZ(2,"div",13)(3,"div",11)(4,"h1"),e._uU(5),e.qZA(),e.TgZ(6,"strong"),e._uU(7,"Retards"),e.qZA(),e._UZ(8,"i",14),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.hYB("title","",t.vsContexte,"  ",t.compteurEvenementRetard," retard(s)"),e.xp6(4),e.Oqu(t.compteurEvenementRetard)}}function Q(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.scrollToElement("tableVs"))}),e.TgZ(2,"div",15)(3,"div",11)(4,"h1"),e._uU(5),e.qZA(),e.TgZ(6,"strong"),e._uU(7,"Absences restaurant scolaire"),e.qZA(),e._UZ(8,"i",16),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.hYB("title","",t.vsContexte,"  ",t.compteurEvenementRepas," absence(s) repas"),e.xp6(4),e.Oqu(t.compteurEvenementRepas)}}function P(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.scrollToElement("tableVs"))}),e.TgZ(2,"div",17)(3,"div",11)(4,"h1"),e._uU(5),e.qZA(),e.TgZ(6,"strong"),e._uU(7,"Absences internat"),e.qZA(),e._UZ(8,"i",18),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.hYB("title","",t.vsContexte,"  ",t.compteurEvenementInternat," absence(s) internat"),e.xp6(4),e.Oqu(t.compteurEvenementInternat)}}function j(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.scrollToElement("tableSanctions"))}),e.TgZ(2,"div",19)(3,"div",11)(4,"h1"),e._uU(5),e.qZA(),e.TgZ(6,"strong"),e._uU(7,"Sanctions"),e.qZA(),e._UZ(8,"i",20),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.hYB("title","",t.vsContexte,"  ",t.compteurEvenementSanction," punition(s)"),e.xp6(4),e.Oqu(t.compteurEvenementSanction)}}function F(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",8)(1,"button",9),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.scrollToElement("tableEncouragements"))}),e.TgZ(2,"div",21)(3,"div",11)(4,"h1"),e._uU(5),e.qZA(),e.TgZ(6,"strong"),e._uU(7,"Encouragements"),e.qZA(),e._UZ(8,"i",22),e.qZA()()()()}if(2&n){const t=e.oxw(2);e.xp6(1),e.hYB("title","",t.vsContexte," ",t.compteurEvenementEncouragement," f\xe9licitation(s)"),e.xp6(4),e.Oqu(t.compteurEvenementEncouragement)}}function R(n,o){1&n&&(e.TgZ(0,"th",31),e._uU(1,"El\xe8ve"),e.qZA())}function D(n,o){1&n&&(e.TgZ(0,"th"),e._uU(1,"Commentaire"),e.qZA())}function G(n,o){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,R,2,0,"th",27),e.TgZ(2,"th",28),e._uU(3,"Absence / Retard"),e.qZA(),e.TgZ(4,"th"),e._uU(5,"Dur\xe9e"),e.qZA(),e.TgZ(6,"th",29),e._uU(7,"Justifi\xe9e ?"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Motif"),e.qZA(),e.YNc(10,D,2,0,"th",30),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.isVSClasseGroupe),e.xp6(9),e.Q6J("ngIf",t.parametrageVS.absenceCommentaire||t.parametrageVS.retardCommentaire)}}function B(n,o){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).item;e.xp6(1),e.Oqu(t.nomEleve)}}function L(n,o){if(1&n&&(e.TgZ(0,"i"),e._uU(1),e.qZA()),2&n){const t=e.oxw(4).item;e.xp6(1),e.hij("(",t.typeJustification,")")}}function k(n,o){if(1&n&&(e.TgZ(0,"span",37),e._uU(1," Oui "),e.YNc(2,L,2,1,"i",30),e.qZA()),2&n){const t=e.oxw(3).item;e.xp6(2),e.Q6J("ngIf",""!==t.typeJustification)}}function z(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Oui"),e.qZA())}function H(n,o){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,k,3,1,"span",36),e.YNc(2,z,2,0,"span",30),e.qZA()),2&n){const t=e.oxw(2).item;e.xp6(1),e.Q6J("ngIf",t.justifieEd),e.xp6(1),e.Q6J("ngIf",!t.justifieEd)}}function K(n,o){1&n&&(e.TgZ(0,"b",40),e._uU(1,"NON"),e.qZA())}function X(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3).item,r=e.oxw(3);return e.KtG(r.justifier(a))}),e._UZ(1,"i",42),e._uU(2," Justifier "),e.qZA()}}function W(n,o){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw(3).item;e.xp6(1),e.Oqu(t.typeJustification)}}function $(n,o){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,K,2,0,"b",38),e.YNc(2,X,3,0,"button",39),e.YNc(3,W,2,1,"span",30),e.qZA()),2&n){const t=e.oxw(2).item,i=e.oxw(3);e.xp6(1),e.Q6J("ngIf",!t.justifieEd),e.xp6(1),e.Q6J("ngIf",i.parametrageVS.justificationEnLigne&&i.authStore.isFamille()&&!t.justifieEd),e.xp6(1),e.Q6J("ngIf",t.justifieEd)}}function ee(n,o){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).item;e.xp6(1),e.Oqu(t.commentaire)}}const te=function(n){return{"text-danger":n}};function ne(n,o){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,B,2,1,"td",30),e.TgZ(2,"td"),e._UZ(3,"span",33),e.TgZ(4,"span",34),e._uU(5),e.qZA()(),e.TgZ(6,"td",35),e._uU(7),e.qZA(),e.TgZ(8,"td",29),e.YNc(9,H,3,2,"div",30),e.YNc(10,$,4,3,"div",30),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.YNc(13,ee,2,1,"td",30),e.qZA()),2&n){const t=e.oxw().item,i=e.oxw(3);e.Tol(e.VKq(10,te,!t.justifie)),e.xp6(1),e.Q6J("ngIf",i.isVSClasseGroupe),e.xp6(2),e.Q6J("ngClass",t.getIcon()),e.xp6(2),e.Oqu(i.capitalizeFirstLetter(t.displayDate)),e.xp6(2),e.Oqu(t.libelle),e.xp6(2),e.Q6J("ngIf",t.justifie),e.xp6(1),e.Q6J("ngIf",!t.justifie),e.xp6(2),e.Oqu(t.motif),e.xp6(1),e.Q6J("ngIf",i.parametrageVS.absenceCommentaire||i.parametrageVS.retardCommentaire)}}function ie(n,o){if(1&n&&e.YNc(0,ne,14,12,"tr",32),2&n){const t=o.item,i=e.oxw(3);e.Q6J("ngIf",i.visualisationPossible(t))}}const b=function(){return["date|desc"]};function oe(n,o){if(1&n&&(e.TgZ(0,"ed-smart-table",23,24),e.ALo(2,"orderBy"),e.YNc(3,G,11,2,"ng-template",25),e.YNc(4,ie,1,1,"ng-template",26),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("datas",e.xi3(2,2,t.tabAbsencesRetards,e.DdM(5,b)))("pagination",!1)}}function ae(n,o){1&n&&(e.TgZ(0,"th",31),e._uU(1,"El\xe8ve"),e.qZA())}function se(n,o){1&n&&(e.TgZ(0,"th"),e._uU(1,"Sanctionn\xe9 par"),e.qZA())}function ce(n,o){1&n&&(e.TgZ(0,"th"),e._uU(1,"Commentaire"),e.qZA())}function re(n,o){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,ae,2,0,"th",27),e.TgZ(2,"th"),e._uU(3,"Sanction"),e.qZA(),e.TgZ(4,"th",28),e._uU(5,"Date"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Motif"),e.qZA(),e.YNc(8,se,2,0,"th",30),e.YNc(9,ce,2,0,"th",30),e.TgZ(10,"th"),e._uU(11,"Date de d\xe9roulement"),e.qZA()()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.isVSClasseGroupe),e.xp6(7),e.Q6J("ngIf",t.parametrageVS.sanctionParQui),e.xp6(1),e.Q6J("ngIf",t.parametrageVS.sanctionCommentaire)}}function _e(n,o){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).item;e.xp6(1),e.Oqu(t.nomEleve)}}function le(n,o){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).item;e.xp6(1),e.Oqu(t.par)}}function me(n,o){1&n&&e._UZ(0,"br")}function de(n,o){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw(3).item;e.xp6(1),e.hij("Travail \xe0 faire : ",t.aFaire,"")}}function ue(n,o){if(1&n&&(e.TgZ(0,"td",46),e._UZ(1,"span",48),e.YNc(2,me,1,0,"br",30),e.YNc(3,de,2,1,"span",30),e.qZA()),2&n){const t=e.oxw(2).item;e.xp6(1),e.Q6J("innerHTML",t.commentaire,e.oJD),e.xp6(1),e.Q6J("ngIf",t.commentaire),e.xp6(1),e.Q6J("ngIf",t.aFaire)}}function pe(n,o){if(1&n&&e._UZ(0,"span",48),2&n){const t=e.oxw(2).item;e.Q6J("innerHTML",t.dateDeroulement,e.oJD)}}function ge(n,o){if(1&n&&e._UZ(0,"span",48),2&n){const t=e.oxw(2).item;e.Q6J("innerHTML",t.displayDate,e.oJD)}}function ve(n,o){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,_e,2,1,"td",30),e.TgZ(2,"td"),e._UZ(3,"span",33),e.TgZ(4,"span"),e._uU(5),e.qZA()(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"edDate"),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.YNc(11,le,2,1,"td",30),e.YNc(12,ue,4,3,"td",45),e.TgZ(13,"td",46),e.YNc(14,pe,1,1,"span",47),e.YNc(15,ge,1,1,"span",47),e.qZA()()),2&n){const t=e.oxw().item,i=e.oxw(3);e.xp6(1),e.Q6J("ngIf",i.isVSClasseGroupe),e.xp6(2),e.Q6J("ngClass",t.getIcon()),e.xp6(2),e.Oqu(i.capitalizeFirstLetter(t.libelle)),e.xp6(2),e.Oqu(e.xi3(8,9,t.date,"EEEE d MMMM")),e.xp6(3),e.Oqu(t.motif),e.xp6(1),e.Q6J("ngIf",i.parametrageVS.sanctionParQui),e.xp6(1),e.Q6J("ngIf",i.parametrageVS.sanctionCommentaire),e.xp6(2),e.Q6J("ngIf",t.dateDeroulement),e.xp6(1),e.Q6J("ngIf",t.displayDate)}}function fe(n,o){if(1&n&&e.YNc(0,ve,16,12,"tr",30),2&n){const t=o.item,i=e.oxw(3);e.Q6J("ngIf",t.typeElement===i.TYPESVS.SANCTION)}}function be(n,o){if(1&n&&(e.TgZ(0,"ed-smart-table",43,44),e.ALo(2,"orderBy"),e.YNc(3,re,12,3,"ng-template",25),e.YNc(4,fe,1,1,"ng-template",26),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("datas",e.xi3(2,2,t.tabSanctions,e.DdM(5,b)))("pagination",!1)}}function he(n,o){1&n&&(e.TgZ(0,"th",31),e._uU(1,"El\xe8ve"),e.qZA())}function Te(n,o){1&n&&(e.TgZ(0,"th"),e._uU(1,"Encourag\xe9 par"),e.qZA())}function xe(n,o){1&n&&(e.TgZ(0,"th"),e._uU(1,"Commentaire"),e.qZA())}function Ee(n,o){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,he,2,0,"th",27),e.TgZ(2,"th"),e._uU(3,"Encouragement"),e.qZA(),e.TgZ(4,"th",28),e._uU(5,"Date"),e.qZA(),e.TgZ(6,"th"),e._uU(7,"Motif"),e.qZA(),e.YNc(8,Te,2,0,"th",30),e.YNc(9,xe,2,0,"th",30),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.isVSClasseGroupe),e.xp6(7),e.Q6J("ngIf",t.parametrageVS.encouragementParQui),e.xp6(1),e.Q6J("ngIf",t.parametrageVS.encouragementCommentaire)}}function Se(n,o){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).item;e.xp6(1),e.Oqu(t.nomEleve)}}function Ce(n,o){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).item;e.xp6(1),e.Oqu(t.par)}}function Ze(n,o){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const t=e.oxw(2).item;e.xp6(1),e.Oqu(t.commentaire)}}function Ae(n,o){if(1&n&&(e.TgZ(0,"tr"),e.YNc(1,Se,2,1,"td",30),e.TgZ(2,"td"),e._UZ(3,"span",33),e.TgZ(4,"span"),e._uU(5),e.qZA()(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"edDate"),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.YNc(11,Ce,2,1,"td",30),e.YNc(12,Ze,2,1,"td",30),e.qZA()),2&n){const t=e.oxw().item,i=e.oxw(3);e.xp6(1),e.Q6J("ngIf",i.isVSClasseGroupe),e.xp6(2),e.Q6J("ngClass",t.getIcon()),e.xp6(2),e.Oqu(i.capitalizeFirstLetter(t.libelle)),e.xp6(2),e.Oqu(e.xi3(8,7,t.date,"EEEE Do MMMM")),e.xp6(3),e.Oqu(t.motif),e.xp6(1),e.Q6J("ngIf",i.parametrageVS.encouragementParQui),e.xp6(1),e.Q6J("ngIf",i.parametrageVS.encouragementCommentaire)}}function Ve(n,o){if(1&n&&e.YNc(0,Ae,13,10,"tr",30),2&n){const t=o.item,i=e.oxw(3);e.Q6J("ngIf",t.typeElement===i.TYPESVS.ENCOURAGEMENT)}}function Me(n,o){if(1&n&&(e.TgZ(0,"ed-smart-table",49,50),e.ALo(2,"orderBy"),e.YNc(3,Ee,10,3,"ng-template",25),e.YNc(4,Ve,1,1,"ng-template",26),e.qZA()),2&n){const t=e.oxw(2);e.Q6J("datas",e.xi3(2,2,t.tabEncouragements,e.DdM(5,b)))("pagination",!1)}}function Ue(n,o){if(1&n&&(e.TgZ(0,"div",2)(1,"div",3),e.YNc(2,Y,9,3,"div",4),e.YNc(3,w,9,3,"div",4),e.YNc(4,Q,9,3,"div",4),e.YNc(5,P,9,3,"div",4),e.YNc(6,j,9,3,"div",4),e.YNc(7,F,9,3,"div",4),e.qZA(),e.YNc(8,oe,5,6,"ed-smart-table",5),e.YNc(9,be,5,6,"ed-smart-table",6),e.YNc(10,Me,5,6,"ed-smart-table",7),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.compteurEvenementAbsence&&t.visibilite.absenceVisible),e.xp6(1),e.Q6J("ngIf",t.compteurEvenementRetard&&t.visibilite.retardVisible),e.xp6(1),e.Q6J("ngIf",t.compteurEvenementRepas&&t.visibilite.absenceVisible),e.xp6(1),e.Q6J("ngIf",t.compteurEvenementInternat&&t.visibilite.absenceVisible),e.xp6(1),e.Q6J("ngIf",t.compteurEvenementSanction&&t.visibilite.sanctionVisible),e.xp6(1),e.Q6J("ngIf",t.compteurEvenementEncouragement&&t.visibilite.encouragementVisible),e.xp6(1),e.Q6J("ngIf",t.visibilite.absenceVisible||t.visibilite.retardVisible),e.xp6(1),e.Q6J("ngIf",t.visibilite.sanctionVisible),e.xp6(1),e.Q6J("ngIf",t.visibilite.encouragementVisible&&!t.aucunEncouragement)}}let ye=(()=>{class n extends((0,s.kCV)()){constructor(t,i,a,r,u,m,qe,Je){super(),this.authStore=t,this.loaderService=i,this.vieScolaireService=a,this.uiService=r,this.vieScolaireStore=u,this.activatedRoute=m,this.modalService=qe,this.badgesStore=Je,this.loading=new e.vpe,this.tabAbsencesRetards=[],this.tabSanctions=[],this.tabEncouragements=[],this.parametrageVS=new s.GQQ,this.isVSClasseGroupe=!1,this.TYPESVS=s.G7h,this.visibilite=s.aUA.getVisibiliteParametrage(this.authStore.currentUser)}ngOnChanges(t){if(t.idEntity||t.typeEntity){Object.isExists(this.listInfosVieScolaire)&&this.listInfosVieScolaire.unsubscribe(),this.vsContexte="Vous avez",this.authStore.isFamille()&&(this.vsContexte="Votre enfant a"),this.isVSClasseGroupe=this.typeEntity===s.meW.CLASSE||this.typeEntity===s.meW.GROUPE;const i=s.$ej.edDBUserSpecificKey(this.authStore.currentUser.codeOgec,this.typeEntity,this.idEntity);this.initFromStorage(i)}}initFromStorage(t){this.listInfosVieScolaire=this.vieScolaireStore.selectListeInfosVieScolaire(t).pipe((0,d.b)(i=>{Object.isExists(i)&&(this.tabAbsencesRetards=Array.isArray(i.absencesRetards)?i.absencesRetards.map(a=>new s.MBX(a)):[],this.tabSanctions=Array.isArray(i.sanctionsEncouragements)?i.sanctionsEncouragements.filter(a=>a.typeElement===this.TYPESVS.SANCTION).map(a=>new s.MBX(a)):[],this.tabEncouragements=Array.isArray(i.sanctionsEncouragements)?i.sanctionsEncouragements.filter(a=>a.typeElement===this.TYPESVS.ENCOURAGEMENT).map(a=>new s.MBX(a)):[],this.parametrageVS=new s.GQQ(i.parametrage),this.visibilite.sanctionVisible=this.parametrageVS.sanctionsVisible,this.visibilite.encouragementVisible=this.parametrageVS.encouragementsVisible,this.refreshCount())}),(0,v.R)(this.componentDestroyed$)).subscribe(),this.refreshData()}refreshData(){this.loading.emit(!0);let t=0;if(this.authStore.isEntreprise()&&(t=this.authStore.currentUser.id),this.loader=this.loaderService.show(this),this.vieScolaireService.getVieScolaire(this.typeEntity,this.idEntity,t).pipe((0,_.K)(i=>this.uiService.notifyErrorThenEmpty(i,!0,"Vie Scolaire","fa fa-warning")),(0,p.x)(()=>{this.loaderService.hide(this),this.loading.emit(!1)})).subscribe(),this.authStore.isFouE()){let i=this.badgesStore.cloneDeep(),a="E";this.authStore.isFamille()&&(a="FE"),i.getBadgeFromModule(s.qzA.VIE_SCOLAIRE,this.idEntity,s.o2q[a])>0&&(i.updateBadgeForModule(0,s.qzA.VIE_SCOLAIRE,this.idEntity,s.o2q[a]),this.badgesStore.store=i,this.badgesStore.setStorage(i).catch(r=>console.error("TabVieScolaireEvenementsComponent.refreshData badgesStore.setStorage : ",r)))}}refreshCount(){const t=this.tabAbsencesRetards.edGroupBy("typeElement");this.compteurEvenementAbsence=Object.isExists(t.Absence)?t.Absence.length:0,this.compteurEvenementRetard=Object.isExists(t.Retard)?t.Retard.length:0,this.compteurEvenementInternat=Object.isExists(t.Internat)?t.Internat.length:0,this.compteurEvenementRepas=Object.isExists(t.Repas)?t.Repas.length:0,this.compteurEvenementEncouragement=Object.isExists(this.tabEncouragements)?this.tabEncouragements.length:0,this.compteurEvenementSanction=Object.isExists(this.tabSanctions)?this.tabSanctions.length:0,this.aucunEncouragement=0===this.compteurEvenementEncouragement}visualisationPossible(t){let m=!1;return(t.typeElement===s.G7h.ABSENCE||t.typeElement===s.G7h.INTERNAT||t.typeElement===s.G7h.REPAS)&&this.visibilite.absenceVisible&&(m=!0),t.typeElement===s.G7h.RETARD&&this.visibilite.retardVisible&&(m=!0),m}scrollToElement(t){this[t].tableElement.nativeElement.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)}justifier(t){const i={evenementVs:t,idEleve:this.idEntity},a={id:this.modalService.getModalsCount()+1,ignoreBackdropClick:!0,initialState:i};this.modalService.show(U,a)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(s.CnD),e.Y36(T.S),e.Y36(s.UmA),e.Y36(s.VLf),e.Y36(s._bT),e.Y36(y.gz),e.Y36(h.tT),e.Y36(s.et7))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-tab-vie-scolaire-evenements"]],viewQuery:function(t,i){if(1&t&&(e.Gf(I,5),e.Gf(O,5),e.Gf(N,5)),2&t){let a;e.iGM(a=e.CRH())&&(i.tableVs=a.first),e.iGM(a=e.CRH())&&(i.tableSanctions=a.first),e.iGM(a=e.CRH())&&(i.tableEncouragements=a.first)}},inputs:{typeEntity:"typeEntity",idEntity:"idEntity"},outputs:{loading:"loading"},features:[e.qOj,e.TTD],decls:2,vars:2,consts:[[1,"page-vie-scolaire",3,"ngBusy"],["id","evenementsVS",4,"ngIf"],["id","evenementsVS"],[1,"row","d-print-none","compteurs-vs","mt-5"],["class","col text-center gy-3",4,"ngIf"],["noItemText","Aucun \xe9v\xe8nement vie scolaire","id","table-vs","class","consultation-vs",3,"datas","pagination",4,"ngIf"],["noItemText","Aucune sanction","id","sanction","class","consultation-vs",3,"datas","pagination",4,"ngIf"],["noItemText","Aucun encouragement","id","encouragement","class","consultation-vs",3,"datas","pagination",4,"ngIf"],[1,"col","text-center","gy-3"],["type","button",3,"title","click"],[1,"card","text-center","viescolaire","absence"],[1,"card-body"],["aria-hidden","true",1,"icon-ed_absence"],[1,"card","text-center","viescolaire","retard"],["aria-hidden","true",1,"icon-ed_retard"],[1,"card","text-center","viescolaire","cantine"],["aria-hidden","true",1,"fa","fa-cutlery"],[1,"card","text-center","viescolaire","internat"],["aria-hidden","true",1,"fa","fa-home"],[1,"card","text-center","viescolaire","sanction"],["aria-hidden","true",1,"icon-ed_sanction"],[1,"card","text-center","viescolaire","encouragement"],["aria-hidden","true",1,"icon-ed_encouragement"],["noItemText","Aucun \xe9v\xe8nement vie scolaire","id","table-vs",1,"consultation-vs",3,"datas","pagination"],["tableVs",""],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],["class","sortable-header","stSort","nomEleve",4,"ngIf"],["stSort","date",1,"sortable-header"],[1,"text-center"],[4,"ngIf"],["stSort","nomEleve",1,"sortable-header"],[3,"class",4,"ngIf"],[1,"fa",3,"ngClass"],[1,"margin-whitespace"],[1,"text-capitalize-first"],["style","cursor: help",4,"ngIf"],[2,"cursor","help"],["class","text-danger",4,"ngIf"],["type","button","class","btn btn-sm btn-danger margin-whitespace",3,"click",4,"ngIf"],[1,"text-danger"],["type","button",1,"btn","btn-sm","btn-danger","margin-whitespace",3,"click"],["aria-hidden","true",1,"fa","fa-comment"],["noItemText","Aucune sanction","id","sanction",1,"consultation-vs",3,"datas","pagination"],["tableSanctions",""],["class","commentaire-sanction",4,"ngIf"],[1,"commentaire-sanction"],[3,"innerHTML",4,"ngIf"],[3,"innerHTML"],["noItemText","Aucun encouragement","id","encouragement",1,"consultation-vs",3,"datas","pagination"],["tableEncouragements",""]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Ue,11,9,"div",1),e.qZA()),2&t&&(e.Q6J("ngBusy",i.loader),e.xp6(1),e.Q6J("ngIf",i.listInfosVieScolaire))},dependencies:[f.mk,f.O5,x.DC,q.L,J.c,E.r,E.w,s.d0N,s.ifA],styles:['@charset "UTF-8";.page-vie-scolaire[_ngcontent-%COMP%]{padding:1px 20px}.page-vie-scolaire[_ngcontent-%COMP%]     table{margin-bottom:40px;font-weight:400}.page-vie-scolaire[_ngcontent-%COMP%]   .consultation-vs[_ngcontent-%COMP%]  tbody{display:block;max-height:500px;overflow-y:auto}.page-vie-scolaire[_ngcontent-%COMP%]   .consultation-vs[_ngcontent-%COMP%]  thead, .page-vie-scolaire[_ngcontent-%COMP%]   .consultation-vs[_ngcontent-%COMP%]  tbody tr{display:table;width:100%;table-layout:fixed}.page-vie-scolaire[_ngcontent-%COMP%]   .consultation-vs[_ngcontent-%COMP%]  thead{width:calc(100% - 1em)}.page-vie-scolaire[_ngcontent-%COMP%]   .consultation-vs[_ngcontent-%COMP%]  .table-responsive{overflow-x:hidden;margin-top:30px}.viescolaire.card[_ngcontent-%COMP%]{color:#fff;border:0 none}.viescolaire.card[_ngcontent-%COMP%]     .table td, .viescolaire.card[_ngcontent-%COMP%]     .table th{border:none}.viescolaire.card.absence[_ngcontent-%COMP%]{background-color:#2196f3}.viescolaire.card.retard[_ngcontent-%COMP%]{background-color:#ff5d29}.viescolaire.card.cantine[_ngcontent-%COMP%], .viescolaire.card.internat[_ngcontent-%COMP%]{background-color:#ffdc00}.viescolaire.card.sanction[_ngcontent-%COMP%]{background-color:#e20000}.viescolaire.card.encouragement[_ngcontent-%COMP%]{background-color:#63bdff}.viescolaire.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{padding:0 10px 10px;min-height:40px;line-height:1}.viescolaire.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:30px;color:#fff;padding:10px}.viescolaire.card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:block;margin:10px 0 0;text-align:center;font-size:30px}.row.compteurs-vs[_ngcontent-%COMP%]{margin-bottom:40px}.row.compteurs-vs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:0 none;width:100%;max-width:167px}@media print{.page-vie-scolaire[_ngcontent-%COMP%]   .consultation-vs[_ngcontent-%COMP%]  table{max-height:none}}']}),n})()},56190:(S,g,c)=>{c.d(g,{u:()=>v});var e=c(99658),d=c(94650);let v=(()=>{class _{}return _.\u0275fac=function(s){return new(s||_)},_.\u0275mod=d.oAB({type:_}),_.\u0275inj=d.cJS({imports:[e.m]}),_})()}}]);