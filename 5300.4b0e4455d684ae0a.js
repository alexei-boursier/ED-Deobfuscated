"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[5300],{5300:(re,y,r)=>{r.r(y),r.d(y,{EmploiDuTempsModule:()=>ie});var u=r(95715),T=r(54004),S=r(63900),v=r(18505),m=r(70262),A=r(82722),C=r(28746),U=r(95698),n=r(45007),D=r(39646),O=r(87192),M=r(52497),b=r(56038),e=r(94650),_=r(1618),F=r(20388),I=r(92635),Z=r(26140),h=r(36895),g=r(24006),x=r(10137),E=r(59245),w=r(80125),P=r(55423),G=r(4602);function J(s,a){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.AsE(""," ","- ",t.eleve.classe.libelle,")")}}function Y(s,a){if(1&s&&(e.TgZ(0,"small"),e._uU(1),e.YNc(2,J,2,2,"span",2),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" (",t.getlibelle," "),e.xp6(1),e.Q6J("ngIf",t.authStore.isFamille())}}function N(s,a){if(1&s&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.hij(" (",t.classe.classeLibelle?t.classe.classeLibelle:t.classe.libelle,") ")}}function L(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"li",19)(1,"button",20),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.selectGroupOnly())}),e._uU(2,"Le groupe uniquement"),e.qZA()()}}function B(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"li",19)(1,"button",20),e.NdJ("click",function(){const d=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.selectClassForGroupe(d))}),e._uU(2),e.qZA()()}if(2&s){const t=a.$implicit;e.xp6(2),e.Oqu(t.libelle)}}const R=function(){return["code"]};function Q(s,a){if(1&s&&(e.TgZ(0,"ul",16),e.YNc(1,L,3,0,"li",17),e.YNc(2,B,3,1,"li",18),e.ALo(3,"groupBy"),e.ALo(4,"trackByProperty"),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.contexteEnCours.id>0),e.xp6(1),e.Q6J("ngForOf",e.xi3(3,3,t.lesClassesOriginal,e.DdM(8,R)))("ngForTrackBy",e.lcZ(4,6,"code"))}}function z(s,a){if(1&s&&(e.TgZ(0,"div",12)(1,"div",13)(2,"button",14),e._uU(3),e.qZA(),e.YNc(4,Q,5,9,"ul",15),e.qZA()()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("isAnimated",!1)("isOpen",t.STATUS_DROPDOWN.isClassesOpen),e.xp6(2),e.hij(" ",t.contexteEnCours.libelle," ")}}function W(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.openCreateDialog())}),e._UZ(1,"i",22),e._uU(2," Ajouter un \xe9v\xe9nement "),e.qZA()}}function $(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"li")(1,"div",30)(2,"input",31),e.NdJ("change",function(){const d=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.onSelectInscription(d))})("ngModelChange",function(o){const l=e.CHM(t).$implicit;return e.KtG(l.isInscrit=o)}),e.qZA(),e.TgZ(3,"label",32)(4,"span",33),e._uU(5),e._UZ(6,"br"),e._uU(7),e.ALo(8,"edDate"),e.ALo(9,"edDate"),e.qZA()()()()}if(2&s){const t=a.$implicit;e.xp6(2),e.MGl("id","inscription-",t.idPeriode,""),e.Q6J("ngModel",t.isInscrit)("disabled",t.isInscrit||!t.isInscriptionLibre),e.xp6(1),e.s9C("title",t.isInscrit||!t.isInscriptionLibre?"":"Je m'inscris"),e.MGl("for","inscription-",t.idPeriode,""),e.xp6(2),e.hij(" ",t.libelle," "),e.xp6(2),e.AsE(" Du ",e.xi3(8,8,t.dateDebut,"d MMMM")," au ",e.xi3(9,11,t.dateFin,"d MMMM")," ")}}const j=function(){return["dateDebut|desc"]};function H(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"accordion",25)(1,"accordion-group",26),e.NdJ("isOpenChange",function(o){e.CHM(t);const d=e.oxw(2);return e.KtG(d.isOpen=o)}),e.TgZ(2,"div",27),e._uU(3,"Mes inscriptions"),e.qZA(),e.TgZ(4,"div",28)(5,"ul"),e.YNc(6,$,10,14,"li",29),e.ALo(7,"orderBy"),e.ALo(8,"trackByProperty"),e.qZA()()()()}if(2&s){const t=e.oxw().ngIf,i=e.oxw();e.xp6(1),e.Q6J("isOpen",i.isOpen),e.xp6(5),e.Q6J("ngForOf",e.xi3(7,3,t,e.DdM(8,j)))("ngForTrackBy",e.lcZ(8,6,"$index"))}}function K(s,a){if(1&s&&(e.TgZ(0,"div",23),e.YNc(1,H,9,9,"accordion",24),e.qZA()),2&s){const t=a.ngIf;e.xp6(1),e.Q6J("ngIf",t.length>0)}}const V={isClassesOpen:!1},X=[{path:"",component:(()=>{class s extends((0,n.kCV)()){constructor(t,i,o,d,l,p,c,f,ne,se,oe){super(),this.activatedRoute=t,this.authStore=i,this.etablissementService=o,this.uiService=d,this.badgesStore=l,this.filtresAgendaEdtUserStore=p,this.modalService=c,this.groupeFlexibleService=f,this.groupesFlexiblesStore=ne,this.loaderService=se,this.agendaHelperService=oe,this.isAdmin=!1,this.TYPESUSER=n.dcH,this.TYPESENTITY=n.meW,this.TYPESAGENDA=n.eTt,this.STATUS_DROPDOWN=V,this._datePipe=new n.ifA,this.classe=new n.Mn7,this.groupe=new n.zJg,this.eleve=new n.Dfc,this.isOpen=!0}ngOnInit(){const t=n.Kg5.getModuleParams(n.qzA.AGENDA,this.authStore.currentUser);Object.isExists(t)&&"1"===t.admin&&(this.isAdmin=!0),this.activatedRoute.paramMap.pipe((0,T.U)(i=>(this.typeEntity=i.has("idEleve")?n.meW.ELEVE:i.get("typeEntity"),this.idEntity=i.has("idEleve")?+i.get("idEleve"):+i.get("idEntity"),i)),(0,S.w)(()=>{let i;switch((this.typeEntity===n.meW.CLASSE||this.typeEntity===n.meW.GROUPE)&&(i=this.etablissementService.getClasseGroupeById(this.idEntity,this.typeEntity)),this.typeEntity){case n.meW.CLASSE:case n.meW.GROUPE:return i;case n.meW.ELEVE:{const o=this.authStore.isEleve()||this.authStore.isProfOuPersonnel()?0:this.idEntity;return n.Kg5.isModuleEnabled(this.authStore.currentUser,n.qzA.EDT,o)?this.authStore.getEleve(this.idEntity):(0,D.of)(!1)}default:return(0,D.of)(this.authStore.currentUser)}}),(0,v.b)(i=>{if(i instanceof n.Mn7)this.classe=new n.Mn7(i);else if(i instanceof n.zJg)this.contexteOriginal=n.meW.GROUPE,this.idcontexteOriginal=this.idEntity,this.contexteEnCours=new n.zJg(i),this.contexteEnCours.id=0,this.groupe=new n.zJg(i),this.groupeOriginal=new n.zJg(i),this.lesClassesOriginal=this.groupe.classes instanceof Array?this.groupe.classes.map(o=>new n.Mn7(o)):[];else if(i instanceof n.Dfc)this.eleve=new n.Dfc(i);else if(!(this.authStore.isEleve()||i instanceof n.XPO))return;Object.isExists(this.emploiDuTempsSchedulerComponent)&&this.emploiDuTempsSchedulerComponent.schedulerService.setCurrentView(),this.filtresAgendaEdtUserStore.cleanDatas(),this.initFromStorage()}),(0,m.K)(i=>this.uiService.notifyErrorThenEmpty(i,!0,"Erreur","fa fa-warning")),(0,A.R)(this.componentDestroyed$)).subscribe(),this.clearBadge()}ngOnDestroy(){return this.filtresAgendaEdtUserStore.cleanDatas(),super.ngOnDestroy()}get getlibelle(){let t="";return t+=this.eleve.prenom,this.authStore.isFamille()||(t+=")"),t}initFromStorage(){if(this.authStore.isEleve()||this.authStore.isFamille()){let t;this.authStore.isFamille()&&(t=this.idEntity),this.listPeriodesGroupeFlexibles$=this.groupesFlexiblesStore.selectListeGroupesFlexibles(n.$ej.edDBUserSpecificKey(this.authStore.currentUser.codeOgec,this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,typeof t<"u"?[t]:[])).pipe((0,T.U)(o=>this.constructTabPeriodes(Array.isArray(o)?o:[]))),this.refreshGroupesFlexbiles(t)}}refreshGroupesFlexbiles(t){this.loader=this.loaderService.show(this),this.groupeFlexibleService.getGroupesFlexibles(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte,this._datePipe.transform(new Date,"y-MM-dd"),"",t,!1).pipe((0,C.x)(()=>this.loaderService.hide(this)),(0,m.K)(i=>this.uiService.notifyErrorThenEmpty(i,!0,"Erreur","fa fa-warning"))).subscribe()}constructTabPeriodes(t){const i=[];return t.forEach(o=>{o.periodes.forEach(d=>{i.push({idGroupe:o.id,libelle:o.libelle,isInscrit:d.isInscrit,dateDebut:new Date(d.dateDebut),dateFin:new Date(d.dateFin),dateLimiteInscription:new Date(d.dateLimiteInscription),isInscriptionLibre:d.isInscriptionLibre,idPeriode:d.id})})}),i}selectGroupOnly(){this.contexteEnCours=new n.zJg(this.groupeOriginal),this.classe=void 0,this.groupe=new n.zJg(this.groupeOriginal),this.typeEntity=n.meW.GROUPE,this.idEntity=this.idcontexteOriginal,this.STATUS_DROPDOWN.isClassesOpen=!1;const t=this.filtresAgendaEdtUserStore.getTabAgendaEdtToDisplay().map(o=>new n.b9O(o)),i=this.filtresAgendaEdtUserStore.getIndexEdtCourant();i>-1&&(t[i].typeEntity=this.typeEntity,t[i].idEntity=this.idEntity),this.filtresAgendaEdtUserStore.tabAgendaEdtToDisplay=t}selectClassForGroupe(t){this.contexteEnCours=new n.Mn7(t),this.classe=new n.Mn7(t),this.typeEntity=n.meW.CLASSE,this.idEntity=t.id,this.STATUS_DROPDOWN.isClassesOpen=!1;const i=this.filtresAgendaEdtUserStore.getTabAgendaEdtToDisplay().map(d=>new n.b9O(d)),o=this.filtresAgendaEdtUserStore.getIndexEdtCourant();o>-1&&(i[o].typeEntity=this.typeEntity,i[o].idEntity=this.idEntity),this.filtresAgendaEdtUserStore.tabAgendaEdtToDisplay=i}onSelectInscription(t){const i=`Confirmer l'inscription au groupe <strong>${t.libelle}</strong> du <strong>${this._datePipe.transform(t.dateDebut,"EEEE d MMMM")} au ${this._datePipe.transform(t.dateFin,"EEEE d MMMM")}</strong> ?`,o={id:this.modalService.getModalsCount()+1,initialState:{title:"Nouvelle inscription",message:i,btnConfirm:"Oui, je m'inscris",btnCancel:"Non"}};this.modalService.show(O.z,o),this.modalService.onHide.pipe((0,U.q)(1)).subscribe(d=>{switch(d){case M.G.validation:{if(!this.authStore.isEleve()&&!this.authStore.isFamille())return;const l=new n.bqC;if(this.authStore.isEleve())l.id=this.authStore.currentUser.id,l.classeCode=this.authStore.currentUser.profile.classe.code,l.classeId=this.authStore.currentUser.profile.classe.id,l.classeLibelle=this.authStore.currentUser.profile.classe.libelle,l.nom=this.authStore.currentUser.nom,l.prenom=this.authStore.currentUser.prenom,l.photo=this.authStore.currentUser.profile.photo;else if(this.authStore.isFamille()){const p=this.authStore.currentUser.profile.eleves.findIndex(f=>f.id===this.idEntity),c=new n.Dfc(this.authStore.currentUser.profile.eleves[p]);l.id=c.id,l.classeCode=c.classe.code,l.classeId=c.classe.id,l.classeLibelle=c.classe.libelle,l.nom=c.nom,l.prenom=c.prenom,l.photo=c.photo}this.loader=this.loaderService.show(this),this.groupeFlexibleService.inscrireEleve(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte,l,t.idPeriode,t.idGroupe).pipe((0,S.w)(()=>this.agendaHelperService.refreshAgendaEDTEntity(n.meW.ELEVE,l.id,this.emploiDuTempsSchedulerComponent.periode,n.eTt.EDT)),(0,v.b)(()=>{this.uiService.notifyEvent(n.DOJ.genericSuccess,"Votre inscription a bien \xe9t\xe9 prise en compte","Inscription groupe","icon-ed_edt")}),(0,C.x)(()=>{this.loaderService.hide(this)}),(0,m.K)(p=>this.uiService.notifyErrorThenEmpty(p,!0,"Inscription groupe","fa fa-warning"))).subscribe();break}default:t.isInscrit=!1}})}clearBadge(){const t=this.badgesStore.cloneDeep();t.getBadgeFromModule(n.qzA.EDT,this.idEntity,n.o2q[this.typeEntity])>0&&(t.updateBadgeForModule(0,n.qzA.EDT,this.idEntity,n.o2q[this.typeEntity]),this.badgesStore.store=t,this.badgesStore.setStorage(t).catch(i=>console.error("EmploiDuTempsComponent.clearBadge badgesStore.setStorage : ",i)))}openCreateDialog(){this.agendaHelperService.openCreateDialog(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte)}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(u.gz),e.Y36(n.CnD),e.Y36(n.Xmb),e.Y36(n.VLf),e.Y36(n.et7),e.Y36(_.c),e.Y36(F.tT),e.Y36(n.K6q),e.Y36(n.WME),e.Y36(I.S),e.Y36(Z.U))},s.\u0275cmp=e.Xpm({type:s,selectors:[["ed-emploi-du-temps"]],viewQuery:function(t,i){if(1&t&&e.Gf(b.R,5),2&t){let o;e.iGM(o=e.CRH())&&(i.emploiDuTempsSchedulerComponent=o.first)}},features:[e.qOj],decls:16,vars:14,consts:[[1,"ed-container","double-padding","emploidutemps",3,"ngBusy"],[1,"entete-page"],[4,"ngIf"],["style","display: inline",4,"ngIf"],["type","button","id","btn-ajouter-event-agenda","class","btn btn-primary",3,"click",4,"ngIf"],[1,"container-bg","simple-padding"],[1,"row"],[1,"col-lg-3","liste-agendas"],[3,"typeEntitySelected","idEntitySelected","moduleCurrent"],["class","mt-3",4,"ngIf"],[1,"col-lg-9"],[3,"idEntity","typeEntity","resetPeriode"],[2,"display","inline"],["dropdown","",1,"btn-group",3,"isAnimated","isOpen"],["id","dropDownClasse","dropdownToggle","","type","button","aria-controls","dropdown-classe",1,"btn","btn-secondary","dropdown-toggle"],["class","dropdown-menu","role","menu","aria-labelledby","dropDownClasse","id","dropdown-classe",4,"dropdownMenu"],["role","menu","aria-labelledby","dropDownClasse","id","dropdown-classe",1,"dropdown-menu"],["role","menuitem",4,"ngIf"],["role","menuitem",4,"ngFor","ngForOf","ngForTrackBy"],["role","menuitem"],["type","button",1,"dropdown-item",3,"click"],["type","button","id","btn-ajouter-event-agenda",1,"btn","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-plus"],[1,"mt-3"],["class","mes-inscriptions",4,"ngIf"],[1,"mes-inscriptions"],[1,"d-print-none",3,"isOpen","isOpenChange"],["accordion-heading",""],["accordion-body",""],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-check"],["type","checkbox","name","inscription",1,"form-check-input",3,"id","ngModel","disabled","change","ngModelChange"],[1,"form-check-label",3,"title","for"],[1,"fw-normal"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"header",1)(2,"h2"),e._uU(3," Emploi du temps "),e.YNc(4,Y,3,2,"small",2),e.YNc(5,N,2,1,"small",2),e.YNc(6,z,5,3,"div",3),e.qZA(),e.YNc(7,W,3,0,"button",4),e.qZA(),e.TgZ(8,"div",5)(9,"div",6)(10,"div",7),e._UZ(11,"ed-select-agendas",8),e.YNc(12,K,2,1,"div",9),e.ALo(13,"async"),e.qZA(),e.TgZ(14,"div",10),e._UZ(15,"ed-emploi-du-temps-scheduler",11),e.qZA()()()()),2&t&&(e.Q6J("ngBusy",i.loader),e.xp6(4),e.Q6J("ngIf",!i.authStore.isEleve()&&i.typeEntity===i.TYPESUSER.ELEVE),e.xp6(1),e.Q6J("ngIf",i.typeEntity===i.TYPESENTITY.CLASSE&&i.contexteOriginal!==i.TYPESENTITY.GROUPE),e.xp6(1),e.Q6J("ngIf",i.contexteOriginal===i.TYPESENTITY.GROUPE),e.xp6(1),e.Q6J("ngIf",i.isAdmin),e.xp6(4),e.Q6J("typeEntitySelected",i.typeEntity)("idEntitySelected",i.idEntity)("moduleCurrent",i.TYPESAGENDA.EDT),e.xp6(1),e.Q6J("ngIf",e.lcZ(13,12,i.listPeriodesGroupeFlexibles$)),e.xp6(3),e.Q6J("idEntity",i.idEntity)("typeEntity",i.typeEntity)("resetPeriode",!0))},dependencies:[h.sg,h.O5,g.Wl,g.JJ,g.On,x.Zf,x.U_,E.Hz,E.Mq,E.TO,w.DC,P.$,b.R,h.Ov,n.d0N,n.ifA,n.lfJ,G.$],styles:[".emploidutemps .entete-page h2{flex:1}.emploidutemps .liste-agendas{margin:35px 0}.emploidutemps accordion.mes-inscriptions{margin-top:5px}.emploidutemps accordion.mes-inscriptions li{padding:10px 0}\n"],encapsulation:2}),s})()}];let q=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[u.Bz.forChild(X),u.Bz]}),s})();var k=r(99658),ee=r(23131),te=r(6079);let ie=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[k.m,ee.N,te.A,q]}),s})()}}]);