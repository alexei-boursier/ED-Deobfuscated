"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[8238],{58238:(Ke,S,a)=>{a.r(S),a.d(S,{DocumentsModule:()=>ze});var D=a(95715),r=a(45007),v=a(28746),m=a(70262),p=a(18505),g=a(82722),e=a(94650),b=a(92635),u=a(36895),x=a(80125),A=a(59241),M=a(34420),F=a(25759);function O(i,o){if(1&i&&e._UZ(0,"tab",7,8),2&i){const t=e.MAs(1);e.Q6J("active",t.active)}}function U(i,o){if(1&i&&(e.TgZ(0,"tabset",3),e._UZ(1,"tab",4,5),e.YNc(3,O,2,1,"tab",6),e.qZA()),2&i){const t=e.MAs(2),n=e.oxw();e.xp6(1),e.Q6J("active",t.active),e.xp6(2),e.Q6J("ngIf",(null==n.documents||null==n.documents.listesPiecesAVerser?null:n.documents.listesPiecesAVerser.listesPieces.length)>0)}}const w=function(i,o){return{"container-bg":i,"double-padding":o}};let L=(()=>{class i extends((0,r.kCV)()){constructor(t,n,s,c,l){super(),this.authStore=t,this.documentsService=n,this.loaderService=s,this.uiService=c,this.documentsStore=l,this._variant=r.$ej.edDBUserSpecificKeyFromUser(this.authStore.currentUser)}ngOnInit(){let t;t=this.authStore.isEleve()?this.documentsService.elevesDocuments(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte):this.authStore.isFamille()?this.documentsService.familleDocuments(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte):this.documentsService.adultesDocuments(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte),this.loader=this.loaderService.show(this),t.pipe((0,v.x)(()=>this.loaderService.hide(this)),(0,m.K)(n=>this.uiService.notifyErrorThenEmpty(n,!0,"Erreur","fa fa-warning"))).subscribe(),this.documentsStore.select$().pipe((0,p.b)(n=>{const s=Object.getEntity(n,this._variant);Object.isExpired(s)||(this.documents=new r.rRz(s))}),(0,m.K)(n=>this.uiService.notifyErrorThenEmpty(n,!0,"Erreur","fa fa-warning")),(0,g.R)(this.componentDestroyed$)).subscribe()}getTitle(){let t="";return t=this.authStore.isEleve()?"Les documents \xe0 t\xe9l\xe9charger":"Vos documents",t}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(r.CnD),e.Y36(r.SRx),e.Y36(b.S),e.Y36(r.VLf),e.Y36(r.e1M))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-documents"]],features:[e.qOj],decls:7,vars:8,consts:[[1,"ed-container","documents-a-telecharger","double-padding",3,"ngBusy"],["class","nav-tabs-container-bg",4,"ngIf"],[1,"clearfix"],[1,"nav-tabs-container-bg"],["heading","Documents \xe0 t\xe9l\xe9charger","edTabRouterLink","telechargements","edTabOrder","1",3,"active"],["c","tab"],["heading","Documents \xe0 t\xe9l\xe9verser","edTabRouterLink","televersements","edTabOrder","2",3,"active",4,"ngIf"],["heading","Documents \xe0 t\xe9l\xe9verser","edTabRouterLink","televersements","edTabOrder","2",3,"active"],["ra","tab"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h2"),e._uU(2),e.qZA(),e.YNc(3,U,4,2,"tabset",1),e._UZ(4,"div",2),e.TgZ(5,"div"),e._UZ(6,"router-outlet"),e.qZA()()),2&t&&(e.Q6J("ngBusy",n.loader),e.xp6(2),e.Oqu(n.getTitle()),e.xp6(1),e.Q6J("ngIf",!n.authStore.isEleve()),e.xp6(2),e.Tol(e.WLB(5,w,!n.authStore.isEleve(),!n.authStore.isEleve())))},dependencies:[D.lC,u.O5,x.DC,A.wW,A.AH,M.v,F.t],styles:[".documents-a-telecharger[_ngcontent-%COMP%]   .entete-page[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{flex:1}.documents-a-telecharger[_ngcontent-%COMP%]   #docsATelcharger[_ngcontent-%COMP%]{margin:0 -20px}.documents-a-telecharger[_ngcontent-%COMP%]   #docsATelcharger[_ngcontent-%COMP%]   .liste-docs[_ngcontent-%COMP%]{position:relative;margin-bottom:40px}.documents-a-telecharger[_ngcontent-%COMP%]   .liste-destinataires[_ngcontent-%COMP%]{margin:0 0 40px}.documents-a-telecharger[_ngcontent-%COMP%]   .destinataire[_ngcontent-%COMP%]{padding:1px 0}.documents-a-telecharger.prof[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin:40px 0}.documents-a-telecharger.prof[_ngcontent-%COMP%]   div.archives[_ngcontent-%COMP%]{margin-right:47px}"]}),i})();var T=a(46590),h=a(59245),y=a(43422),f=a(4602);function q(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"li",14)(1,"button",15),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.loadArchives(""))}),e._uU(2,"Ann\xe9e en cours"),e.qZA()()}}function I(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"li",14)(1,"button",15),e.NdJ("click",function(){const c=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.loadArchives(c))}),e._uU(2),e.qZA()()}if(2&i){const t=o.$implicit;e.xp6(2),e.Oqu(t)}}function k(i,o){if(1&i&&(e.TgZ(0,"ul",11),e.YNc(1,q,3,0,"li",12),e.YNc(2,I,3,1,"li",13),e.ALo(3,"trackByProperty"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",""!==t.anneeSelected),e.xp6(1),e.Q6J("ngForOf",t.tabAnneesArchives)("ngForTrackBy",e.lcZ(3,3,"$index"))}}const J=function(i,o){return{archive:i,anneeArchive:o}};function Y(i,o){if(1&i&&(e.TgZ(0,"tr")(1,"td",18)(2,"button",19),e._UZ(3,"span",20),e._uU(4),e.qZA()(),e.TgZ(5,"td",21),e._uU(6),e.ALo(7,"edDate"),e.qZA()()),2&i){const t=o.$implicit,n=e.oxw(2);e.xp6(2),e.Q6J("additionalData",e.WLB(10,J,""!==n.anneeSelected,n.anneeSelected))("file",t)("typeFichier",t.type)("canExportToCloud",!0)("typeModule",n.moduleCodes.DOCUMENTS),e.xp6(2),e.hij(" ",t.libelle," "),e.xp6(2),e.Oqu(e.xi3(7,7,t.date,"fullDate"))}}function N(i,o){if(1&i&&(e.TgZ(0,"table",16)(1,"thead")(2,"tr")(3,"th"),e._uU(4,"Document"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Date de mise en ligne"),e.qZA()()(),e.TgZ(7,"tbody"),e.YNc(8,Y,8,13,"tr",17),e.ALo(9,"trackByProperty"),e.qZA()()),2&i){const t=e.oxw();e.xp6(8),e.Q6J("ngForOf",t.tabDocuments[t.typeModule])("ngForTrackBy",e.lcZ(9,2,"id"))}}function B(i,o){if(1&i&&(e.TgZ(0,"div",22)(1,"h3"),e._uU(2),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.placeHolderAucunDoc)}}let Q=(()=>{class i extends((0,r.kCV)()){constructor(t,n,s,c,l,d){super(),this.uiService=t,this.documentsStore=n,this.authStore=s,this.documentsService=c,this.cd=l,this.loaderService=d,this.tabAnneesArchives=[],this.placeHolderAucunDoc="Aucun document",this.anneeSelected="",this.moduleCodes=r.qzA,this._variant=r.$ej.edDBUserSpecificKeyFromUser(this.authStore.currentUser)}ngOnInit(){this.documentsStore.select$().pipe((0,p.b)(t=>{const n=Object.getEntity(t,this._variant);Object.isExpired(n)||(this.tabDocuments=new r.rRz(n),this.cd.markForCheck())}),(0,m.K)(t=>this.uiService.notifyErrorThenEmpty(t,!0,"Erreur","fa fa-warning")),(0,g.R)(this.componentDestroyed$)).subscribe()}loadArchives(t){this.anneeSelected=t,this._variant=r.$ej.edDBUserSpecificKeyFromUser(this.authStore.currentUser,[this.anneeSelected]),this.loader=this.loaderService.show(this),this.documentsService.adultesDocuments(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte,this.anneeSelected).pipe((0,T.d)((()=>Object.getEntity(this.documentsStore.snapshot,this._variant))()),(0,p.b)(n=>{Object.isExpired(n)||(this.tabDocuments=new r.rRz(n),this.cd.markForCheck())}),(0,v.x)(()=>this.loaderService.hide(this)),(0,m.K)(n=>(this.tabDocuments=new r.rRz,this.uiService.notifyErrorThenEmpty(n,!0,"Erreur","fa fa-warning")))).subscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(r.VLf),e.Y36(r.e1M),e.Y36(r.CnD),e.Y36(r.SRx),e.Y36(e.sBO),e.Y36(b.S))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-documents-adulte"]],inputs:{tabAnneesArchives:"tabAnneesArchives",placeHolderAucunDoc:"placeHolderAucunDoc",typeModule:"typeModule",libelleModule:"libelleModule"},features:[e.qOj],decls:13,vars:7,consts:[[1,"ed-card","card","with-epingle","ed-documents-adulte",3,"ngBusy"],[1,"card-header","pb-0","d-flex","align-items-center","justify-content-between"],[1,"m-0"],[3,"hidden"],["dropdown","",1,"btn-group",3,"isAnimated"],["dropdownToggle","","id","dropdownMenu11","aria-controls","dropdown-annee-scolaire",1,"btn","btn-secondary","dropdown-toggle"],["aria-labelledby","dropdownMenu11","id","dropdown-annee-scolaire","class","dropdown-menu","role","menu",4,"dropdownMenu"],[1,"card-body","pt-0"],[1,"liste-destinataires"],["class","table table-hover table-sm ed-table margin-top-10",4,"ngIf"],["class","jumbotron",4,"ngIf"],["aria-labelledby","dropdownMenu11","id","dropdown-annee-scolaire","role","menu",1,"dropdown-menu"],["class","list-elem-cours","role","menuitem",4,"ngIf"],["class","list-elem-cours","role","menuitem",4,"ngFor","ngForOf","ngForTrackBy"],["role","menuitem",1,"list-elem-cours"],["type","button",1,"dropdown-item",3,"click"],[1,"table","table-hover","table-sm","ed-table","margin-top-10"],[4,"ngFor","ngForOf","ngForTrackBy"],[2,"width","50%"],["edLightbox","","type","button","title","Pr\xe9visualiser",1,"btn","btn-link",3,"additionalData","file","typeFichier","canExportToCloud","typeModule"],[1,"fa","fa-file-pdf-o"],[1,""],[1,"jumbotron"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3)(5,"div",4)(6,"button",5),e._uU(7),e.qZA(),e.YNc(8,k,4,5,"ul",6),e.qZA()()(),e.TgZ(9,"div",7)(10,"div",8),e.YNc(11,N,10,4,"table",9),e.YNc(12,B,3,1,"div",10),e.qZA()()()),2&t&&(e.Q6J("ngBusy",n.loader),e.xp6(3),e.Oqu(n.libelleModule),e.xp6(1),e.Q6J("hidden",0===n.tabAnneesArchives.length),e.xp6(1),e.Q6J("isAnimated",!1),e.xp6(2),e.hij(" ",""===n.anneeSelected?"Acc\xe8s aux archives":n.anneeSelected," "),e.xp6(4),e.Q6J("ngIf",n.tabDocuments[n.typeModule]),e.xp6(1),e.Q6J("ngIf",!n.tabDocuments[n.typeModule]||n.tabDocuments[n.typeModule].length<=0))},dependencies:[u.sg,u.O5,h.Hz,h.Mq,h.TO,x.DC,y.l,r.ifA,f.$],encapsulation:2,changeDetection:0}),i})();function j(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"li",15)(1,"button",16),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.loadArchives(""))}),e._uU(2,"Ann\xe9e en cours"),e.qZA()()}}function $(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"li",15)(1,"button",16),e.NdJ("click",function(){const c=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.loadArchives(c))}),e._uU(2),e.qZA()()}if(2&i){const t=o.$implicit;e.xp6(2),e.Oqu(t)}}function V(i,o){if(1&i&&(e.TgZ(0,"ul",12),e.YNc(1,j,3,0,"li",13),e.YNc(2,$,3,1,"li",14),e.ALo(3,"trackByProperty"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",""!==t.anneeSelected),e.xp6(1),e.Q6J("ngForOf",t.tabAnneesArchives)("ngForTrackBy",e.lcZ(3,3,"$index"))}}function z(i,o){if(1&i&&(e.TgZ(0,"div",8)(1,"div",9)(2,"button",10),e._uU(3),e.qZA(),e.YNc(4,V,4,5,"ul",11),e.qZA()()),2&i){const t=e.oxw();e.Q6J("hidden",0===t.tabAnneesArchives.length),e.xp6(1),e.Q6J("isAnimated",!1),e.xp6(2),e.hij(" ",""===t.anneeSelected?"Acc\xe8s aux archives":t.anneeSelected," ")}}function K(i,o){1&i&&(e.TgZ(0,"th"),e._uU(1,"Signature"),e.qZA())}const R=function(){return{archive:!1,anneeArchive:""}};function H(i,o){if(1&i&&(e.TgZ(0,"button",27),e._uU(1," Signer le document "),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.Q6J("additionalData",e.DdM(3,R))("file",t)("typeFichier",t.type)}}function G(i,o){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.ALo(2,"edDate"),e._UZ(3,"br"),e._uU(4," Code envoy\xe9 au "),e.TgZ(5,"strong"),e._uU(6),e.qZA()()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" Sign\xe9 le ",e.xi3(2,2,t.signature.dateValidation,"d MMMM y \xe0 HH:mm")," "),e.xp6(5),e.Oqu(t.signature.tel)}}function W(i,o){if(1&i&&(e.TgZ(0,"td",24),e.YNc(1,H,2,4,"button",26),e.YNc(2,G,7,5,"div",6),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(3);e.xp6(1),e.Q6J("ngIf",""===n.anneeSelected&&t.signatureDemandee&&!t.signature.dateValidation),e.xp6(1),e.Q6J("ngIf",t.signature.dateValidation)}}const P=function(i,o){return{archive:i,anneeArchive:o}};function X(i,o){if(1&i&&(e.TgZ(0,"tr")(1,"td",21)(2,"button",22),e._UZ(3,"span",23),e._uU(4),e.qZA()(),e.TgZ(5,"td",24),e._uU(6),e.ALo(7,"edDate"),e.qZA(),e.YNc(8,W,3,2,"td",25),e.qZA()),2&i){const t=o.$implicit,n=e.oxw(3);e.xp6(2),e.Q6J("additionalData",e.WLB(11,P,""!==n.anneeSelected,n.anneeSelected))("file",t)("typeFichier",t.type)("canExportToCloud",!0)("typeModule",n.moduleCodes.DOCUMENTS),e.xp6(2),e.hij(" ",t.libelle," "),e.xp6(2),e.Oqu(e.xi3(7,8,t.date,"fullDate")),e.xp6(2),e.Q6J("ngIf",n.afficherSignatures)}}function ee(i,o){if(1&i&&(e.TgZ(0,"div",18)(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"table",19)(4,"thead")(5,"tr")(6,"th"),e._uU(7,"Document"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Date de mise en ligne"),e.qZA(),e.YNc(10,K,2,0,"th",6),e.qZA()(),e.TgZ(11,"tbody"),e.YNc(12,X,9,14,"tr",20),e.ALo(13,"trackByProperty"),e.qZA()()()),2&i){const t=o.$implicit,n=e.oxw(2);e.xp6(2),e.hij("Pour ",n.tabPrenomsEleves[t],""),e.xp6(8),e.Q6J("ngIf",n.afficherSignatures),e.xp6(2),e.Q6J("ngForOf",n.tabDocumentsVentiles[t])("ngForTrackBy",e.lcZ(13,4,"id"))}}const te=function(){return["|asc"]};function ne(i,o){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,ee,14,6,"div",17),e.ALo(2,"orderBy"),e.ALo(3,"keys"),e.ALo(4,"trackByProperty"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",e.xi3(2,2,e.lcZ(3,5,t.tabDocumentsVentiles),e.DdM(9,te)))("ngForTrackBy",e.lcZ(4,7,"$index"))}}function ie(i,o){if(1&i&&(e.TgZ(0,"tr")(1,"td",21)(2,"button",28),e._UZ(3,"span",23),e._uU(4),e.qZA()(),e.TgZ(5,"td",24)(6,"div"),e._uU(7),e.ALo(8,"edDate"),e._UZ(9,"br"),e._uU(10," Code envoy\xe9 au "),e.TgZ(11,"strong"),e._uU(12),e.qZA()()()()),2&i){const t=o.$implicit,n=e.oxw(3);e.xp6(2),e.Q6J("additionalData",e.WLB(9,P,""!==n.anneeSelected,n.anneeSelected))("file",t)("typeFichier",t.type),e.xp6(2),e.hij(" ",t.libelle," "),e.xp6(3),e.hij(" Sign\xe9 le ",e.xi3(8,6,t.signature.dateValidation,"d MMMM y \xe0 HH:mm")," "),e.xp6(5),e.Oqu(t.signature.tel)}}function se(i,o){if(1&i&&(e.ynx(0),e.YNc(1,ie,13,12,"tr",20),e.ALo(2,"trackByProperty"),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.tabDocuments[t.typeModule])("ngForTrackBy",e.lcZ(2,2,"id"))}}function oe(i,o){if(1&i&&(e.TgZ(0,"div")(1,"h4"),e._uU(2),e.qZA(),e.TgZ(3,"table",19)(4,"thead")(5,"tr")(6,"th"),e._uU(7,"Document"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"Date de signature"),e.qZA()()(),e.TgZ(10,"tbody"),e.YNc(11,se,3,4,"ng-container",6),e.qZA()()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.anneScolairePrec),e.xp6(9),e.Q6J("ngIf",(null==t.tabDocuments[t.typeModule]?null:t.tabDocuments[t.typeModule].length)>0)}}function re(i,o){if(1&i&&(e.TgZ(0,"tr")(1,"td",21)(2,"button",28),e._UZ(3,"span",23),e._uU(4),e.qZA()(),e.TgZ(5,"td",24),e._uU(6),e.ALo(7,"edDate"),e.qZA()()),2&i){const t=o.$implicit,n=e.oxw(3);e.xp6(2),e.Q6J("additionalData",e.WLB(8,P,""!==n.anneeSelected,n.anneeSelected))("file",t)("typeFichier",t.type),e.xp6(2),e.hij(" ",t.libelle," "),e.xp6(2),e.Oqu(e.xi3(7,5,t.date,"fullDate"))}}function ce(i,o){if(1&i&&(e.TgZ(0,"table",19)(1,"thead")(2,"tr")(3,"th"),e._uU(4,"Document"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Date de mise en ligne"),e.qZA()()(),e.TgZ(7,"tbody"),e.YNc(8,re,8,11,"tr",20),e.ALo(9,"trackByProperty"),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(8),e.Q6J("ngForOf",t.tabDocuments[t.typeModule])("ngForTrackBy",e.lcZ(9,2,"$index"))}}function le(i,o){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,ce,10,4,"table",29),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.tabDocuments[t.typeModule])}}function ae(i,o){if(1&i&&(e.TgZ(0,"div",30)(1,"h3"),e._uU(2),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.placeHolderAucunDoc)}}let de=(()=>{class i extends((0,r.kCV)()){constructor(t,n,s,c,l,d){super(),this.documentsStore=t,this.authStore=n,this.documentsService=s,this.cd=c,this.loaderService=l,this.uiService=d,this.tabAnneesArchives=[],this.withEleves=!1,this.placeHolderAucunDoc="Aucun document",this.tabDocumentsVentiles={},this.anneeSelected="",this.afficherSignatures=!1,this.anneScolairePrec="Rentr\xe9e ",this.moduleCodes=r.qzA,this._variant=r.$ej.edDBUserSpecificKeyFromUser(this.authStore.currentUser)}ngOnInit(){this.parametresDoc=r.Kg5.getModuleParams(r.qzA.DOCUMENTS,this.authStore.currentUser);const t=this.authStore.currentUser.anneeScolaireCourante.split("-");this.anneScolairePrec+=t[0],this.documentsStore.select$().pipe((0,p.b)(n=>{const s=Object.getEntity(n,this._variant);Object.isExpired(s)||this.updateDocuments(s)}),(0,m.K)(n=>this.uiService.notifyErrorThenEmpty(n,!0,"Erreur","fa fa-warning")),(0,g.R)(this.componentDestroyed$)).subscribe()}presenceTypeDocument(){return Object.isExists(this.tabDocumentsVentiles)&&Object.keys(this.tabDocumentsVentiles)?.length>0}loadArchives(t){let n;this.anneeSelected=t,this._variant=r.$ej.edDBUserSpecificKeyFromUser(this.authStore.currentUser,[this.anneeSelected]),n=this.authStore.isEleve()?this.documentsService.elevesDocuments(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte,this.anneeSelected):this.documentsService.familleDocuments(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte,this.anneeSelected),this.loader=this.loaderService.show(this),n.pipe((0,T.d)((()=>Object.getEntity(this.documentsStore.snapshot,this._variant))()),(0,p.b)(s=>{Object.isExpired(s)||this.updateDocuments(s)}),(0,v.x)(()=>this.loaderService.hide(this)),(0,m.K)(s=>(this.tabDocumentsVentiles={},this.tabDocuments=new r.rRz,this.uiService.notifyErrorThenEmpty(s,!0,"Erreur","fa fa-warning")))).subscribe()}ventilerDocuments(){let t;const n=this.tabDocuments[this.typeModule];let s;this.tabDocumentsVentiles={};for(let c=0;c<n.length;c++)t=n[c],s=Object.isExists(t.idEleve)?t.idEleve:0,Object.isExists(this.tabDocumentsVentiles[s])||(this.tabDocumentsVentiles[s]=[]),this.tabDocumentsVentiles[s].push(t)}updateDocuments(t){this.tabDocuments=new r.rRz(t),this.afficherSignatures=this.tabDocuments[this.typeModule].findIndex(n=>!0===n.signatureDemandee)>-1,this.ventilerDocuments(),this.cd.markForCheck()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(r.e1M),e.Y36(r.CnD),e.Y36(r.SRx),e.Y36(e.sBO),e.Y36(b.S),e.Y36(r.VLf))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-documents-famille-eleve"]],inputs:{tabAnneesArchives:"tabAnneesArchives",withEleves:"withEleves",tabPrenomsEleves:"tabPrenomsEleves",typeModule:"typeModule",placeHolderAucunDoc:"placeHolderAucunDoc",libelleModule:"libelleModule"},features:[e.qOj],decls:11,vars:7,consts:[[1,"ed-card","card","with-epingle","ed-documents-famille-eleve",3,"ngBusy"],[1,"card-header","pb-0","d-flex","align-items-center","justify-content-between"],[1,"m-0"],[3,"hidden",4,"ngIf"],[1,"card-body","pt-0"],[1,"liste-destinataires"],[4,"ngIf"],["class","jumbotron",4,"ngIf"],[3,"hidden"],["dropdown","",1,"btn-group",3,"isAnimated"],["dropdownToggle","","id","dropdownMenu11","aria-controls","dropdown-annee",1,"btn","btn-secondary","dropdown-toggle"],["aria-labelledby","dropdownMenu11","id","dropdown-annee","class","dropdown-menu","role","menu",4,"dropdownMenu"],["aria-labelledby","dropdownMenu11","id","dropdown-annee","role","menu",1,"dropdown-menu"],["class","list-elem-cours","role","menuitem",4,"ngIf"],["class","list-elem-cours","role","menuitem",4,"ngFor","ngForOf","ngForTrackBy"],["role","menuitem",1,"list-elem-cours"],["type","button",1,"dropdown-item",3,"click"],["class","destinataire",4,"ngFor","ngForOf","ngForTrackBy"],[1,"destinataire"],[1,"table","table-hover","table-sm","ed-table","margin-top-10"],[4,"ngFor","ngForOf","ngForTrackBy"],[2,"width","50%"],["edLightbox","","type","button","title","Pr\xe9visualiser",1,"btn","btn-link",3,"additionalData","file","typeFichier","canExportToCloud","typeModule"],[1,"fa","fa-file-pdf-o"],[1,"text-center"],["class","text-center",4,"ngIf"],["type","button","class","btn btn-primary","edLightbox","",3,"additionalData","file","typeFichier",4,"ngIf"],["type","button","edLightbox","",1,"btn","btn-primary",3,"additionalData","file","typeFichier"],["edLightbox","","type","button","title","Pr\xe9visualiser",1,"btn","btn-link",3,"additionalData","file","typeFichier"],["class","table table-hover table-sm ed-table margin-top-10",4,"ngIf"],[1,"jumbotron"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),e._uU(3),e.qZA(),e.YNc(4,z,5,3,"div",3),e.qZA(),e.TgZ(5,"div",4)(6,"div",5),e.YNc(7,ne,5,10,"div",6),e.YNc(8,oe,12,2,"div",6),e.YNc(9,le,2,1,"div",6),e.YNc(10,ae,3,1,"div",7),e.qZA()()()),2&t&&(e.Q6J("ngBusy",n.loader),e.xp6(3),e.Oqu(n.libelleModule),e.xp6(1),e.Q6J("ngIf","inscriptions"!==n.typeModule),e.xp6(3),e.Q6J("ngIf",n.withEleves&&"inscriptions"!==n.typeModule),e.xp6(1),e.Q6J("ngIf","inscriptions"===n.typeModule),e.xp6(1),e.Q6J("ngIf",!n.withEleves),e.xp6(1),e.Q6J("ngIf",!n.tabDocuments[n.typeModule]||n.tabDocuments[n.typeModule].length<=0||!n.presenceTypeDocument()))},dependencies:[u.sg,u.O5,h.Hz,h.Mq,h.TO,x.DC,y.l,r.d0N,r.ifA,r.VOG,f.$],styles:[".ed-documents-famille-eleve[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:10px -42px 0;padding:5px 40px;background:var(--smalldark-placeholder-color);font-size:14px;font-style:italic;clear:right}.ed-documents-famille-eleve[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .liste-destinataires[_ngcontent-%COMP%]{margin:0 0 40px}.ed-documents-famille-eleve[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   .libelleModule[_ngcontent-%COMP%]{color:var(--light-primary-color)}.ed-documents-telechargements[_ngcontent-%COMP%]   .docsATelcharger[_ngcontent-%COMP%]{padding:20px}"],changeDetection:0}),i})();function ue(i,o){if(1&i&&e._UZ(0,"ed-documents-famille-eleve",8),2&i){const t=e.oxw(2).$implicit,n=e.oxw(2);e.Q6J("withEleves",n.authStore.isFamille())("typeModule",t)("tabPrenomsEleves",n.tabPrenomsEleves)("libelleModule",n.libellesTypeModule[t])("tabAnneesArchives",n.tabAnneesArchives)}}function me(i,o){if(1&i&&e._UZ(0,"ed-documents-adulte",9),2&i){const t=e.oxw(2).$implicit,n=e.oxw(2);e.Q6J("typeModule",t)("libelleModule",n.libellesTypeModule[t])("tabAnneesArchives",n.tabAnneesArchives)}}const pe=function(i){return{"col-xl-6":i}};function he(i,o){if(1&i&&(e.TgZ(0,"div",5),e.YNc(1,ue,1,5,"ed-documents-famille-eleve",6),e.YNc(2,me,1,3,"ed-documents-adulte",7),e.qZA()),2&i){const t=e.oxw(3);e.Q6J("ngClass",e.VKq(3,pe,t.typesModules.length>1)),e.xp6(1),e.Q6J("ngIf",t.authStore.isEleve()||t.authStore.isFamille()),e.xp6(1),e.Q6J("ngIf",t.authStore.isProfOuPersonnel()||t.authStore.isEntreprise())}}function ge(i,o){if(1&i&&(e.ynx(0),e.YNc(1,he,3,5,"div",4),e.BQk()),2&i){const t=o.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",n.documents[t])}}function fe(i,o){1&i&&(e.TgZ(0,"div",10),e._uU(1," Pour lire les documents PDF, vous pouvez utiliser le logiciel "),e.TgZ(2,"a",11),e._uU(3,"Adobe Acrobat Reader"),e.qZA()())}function _e(i,o){if(1&i&&(e.ynx(0),e.YNc(1,ge,2,1,"ng-container",2),e.ALo(2,"trackByProperty"),e.YNc(3,fe,4,0,"div",3),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.typesModules)("ngForTrackBy",e.lcZ(2,3,"$index")),e.xp6(2),e.Q6J("ngIf",t.authStore.isFamille())}}let ve=(()=>{class i extends((0,r.kCV)()){constructor(t,n,s,c){super(),this.badgesStore=t,this.uiService=n,this.authStore=s,this.documentsStore=c,this.libellesTypeModule={},this.typesModules=[],this.tabAnneesArchives=[],this.tabPrenomsEleves={0:"la famille"},this._variant=r.$ej.edDBUserSpecificKeyFromUser(this.authStore.currentUser),this.parametresDoc=r.Kg5.getModuleParams(this.authStore.isEleve()?r.qzA.DOCUMENTS_ELEVE:r.qzA.DOCUMENTS,s.currentUser),this.tabAnneesArchives=Object.isExists(this.parametresDoc.AnneeArchive)?this.parametresDoc.AnneeArchive.split(","):[],this.authStore.isFamille()?("1"===this.parametresDoc.DocumentsAdministratifActif&&(this.libellesTypeModule.administratifs="Administratif"),"1"===this.parametresDoc.DocumentsVSActif&&(this.libellesTypeModule.viescolaire="Vie Scolaire"),"1"===this.parametresDoc.DocumentsNotesActif&&(this.libellesTypeModule.notes="Notes"),"1"===this.parametresDoc.DocumentsFactureActif&&(this.libellesTypeModule.factures="Factures"),"1"===this.parametresDoc.DocumentsInsReinsActif&&(this.libellesTypeModule.inscriptions="Inscription / R\xe9-inscription")):this.authStore.isEleve()?("1"===this.parametresDoc.DocumentsAdministratifActif&&(this.libellesTypeModule.administratifs="Administratif"),"1"===this.parametresDoc.DocumentsNotesActif&&(this.libellesTypeModule.notes="Notes"),"1"===this.parametresDoc.DocumentsVSActif&&(this.libellesTypeModule.viescolaire="Vie Scolaire")):this.libellesTypeModule={adultes:""},this.typesModules=Object.keys(this.libellesTypeModule)}ngOnInit(){this.authStore.isFamille()&&this.authStore.currentUser.profile.eleves.forEach(t=>this.tabPrenomsEleves[t.id]=t.prenom),this.documentsStore.select$().pipe((0,p.b)(t=>{const n=Object.getEntity(t,this._variant);Object.isExpired(n)||(this.documents=new r.rRz(n)),this.documents?.listesPiecesAVerser.personnes?.length>0&&this.authStore.isFamille()&&this.documents.listesPiecesAVerser.personnes.forEach(s=>{"E"===s.type&&0===Object.keys(this.tabPrenomsEleves).filter(d=>+d===s.id).length&&(this.tabPrenomsEleves[s.id]=s.prenom)})}),(0,m.K)(t=>this.uiService.notifyErrorThenEmpty(t,!0,"Erreur","fa fa-warning")),(0,g.R)(this.componentDestroyed$)).subscribe(),this.clearBadge()}clearBadge(){const t=this.badgesStore.cloneDeep();t.getBadgeFromModule(r.qzA.DOCUMENTS,this.authStore.currentUser.id,r.o2q[this.authStore.currentUser.typeCompte])>0&&(t.updateBadgeForModule(0,r.qzA.DOCUMENTS,this.authStore.currentUser.id,r.o2q[this.authStore.currentUser.typeCompte]),this.badgesStore.store=t,this.badgesStore.setStorage(t).catch(n=>console.error("DocumentsTelechargementsComponent.clearBadge badgesStore.setStorage : ",n)))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(r.et7),e.Y36(r.VLf),e.Y36(r.CnD),e.Y36(r.e1M))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-documents-telechargements"]],features:[e.qOj],decls:2,vars:1,consts:[[1,"ed-documents-telechargements","row"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","col-xl-12 text-center",4,"ngIf"],["class","docsATelcharger",3,"ngClass",4,"ngIf"],[1,"docsATelcharger",3,"ngClass"],[3,"withEleves","typeModule","tabPrenomsEleves","libelleModule","tabAnneesArchives",4,"ngIf"],[3,"typeModule","libelleModule","tabAnneesArchives",4,"ngIf"],[3,"withEleves","typeModule","tabPrenomsEleves","libelleModule","tabAnneesArchives"],[3,"typeModule","libelleModule","tabAnneesArchives"],[1,"col-xl-12","text-center"],["href","https://get.adobe.com/fr/reader/"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,_e,4,5,"ng-container",1),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.documents))},dependencies:[u.mk,u.sg,u.O5,Q,de,f.$],styles:[".ed-documents-telechargements[_ngcontent-%COMP%]   .docsATelcharger[_ngcontent-%COMP%]{padding:20px}"]}),i})();var C=a(60515),E=a(39646),Z=a(95698),be=a(63900),xe=a(11302),De=a(87192),ye=a(52497),Pe=a(94359),Se=a(20388),Ae=a(48536);function Te(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.openSignatureListePiece())}),e._UZ(1,"i",10),e.TgZ(2,"span",11),e._uU(3,"Signer la liste des documents"),e.qZA()()}}function Ce(i,o){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.listePiece.description)}}function Ee(i,o){if(1&i&&(e.TgZ(0,"h4"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.hij("Pour ",n.tabPrenomsEleves[t],"")}}function Ze(i,o){if(1&i&&(e.TgZ(0,"legend"),e._UZ(1,"i",20),e.TgZ(2,"span",11),e._uU(3),e.qZA()()),2&i){const t=e.oxw().$implicit;e.xp6(3),e.Oqu(t.libelle)}}function Me(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2).$implicit,c=e.oxw().$implicit,l=e.oxw(2);return e.KtG(l.openModalDeletePiece(l.getTeleversement(c,s.id)))}),e._UZ(1,"i",26),e.qZA()}}function Fe(i,o){if(1&i&&(e.TgZ(0,"legend")(1,"button",21),e._UZ(2,"i",22),e.TgZ(3,"span",11),e._uU(4),e.qZA()(),e.YNc(5,Me,2,0,"button",23),e._UZ(6,"i",24),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw().$implicit,s=e.oxw(2);e.xp6(1),e.Q6J("file",s.getFile(t,n))("typeFichier",s.typeFichierTelechargement.LISTE_PIECE)("additionalData",s.additionalDataTelechargement(n,t.id)),e.xp6(3),e.Oqu(t.libelle),e.xp6(1),e.Q6J("ngIf",!s.isPieceLocked(n,t.id))}}function Oe(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",27)(1,"ed-input-files",28),e.NdJ("successUpload",function(s){e.CHM(t);const c=e.oxw().$implicit,l=e.oxw().$implicit,d=e.oxw(2);return e.KtG(d.onUploadSuccess(s,l,c.id))}),e.qZA()()}if(2&i){const t=e.oxw().$implicit,n=e.oxw().$implicit,s=e.oxw(2);e.xp6(1),e.Q6J("dropzoneConfig",s.dropZoneConfigParPiece[n][t.id])("config",s.inputFilesConfigParPiece[n][t.id])}}function Ue(i,o){if(1&i&&(e.TgZ(0,"div"),e._uU(1),e.ALo(2,"edDate"),e._UZ(3,"br"),e._uU(4," Code envoy\xe9 au "),e.TgZ(5,"strong"),e._uU(6),e.qZA()()),2&i){const t=e.oxw().$implicit,n=e.oxw().$implicit,s=e.oxw(2);e.xp6(1),e.hij(" Sign\xe9 le ",e.xi3(2,2,s.getSignatureOfDoc(t.id,n).dateValidation,"d MMMM y \xe0 HH:mm")," "),e.xp6(5),e.Oqu(s.getSignatureOfDoc(t.id,n).tel)}}function we(i,o){if(1&i&&(e.TgZ(0,"fieldset",16),e.YNc(1,Ze,4,1,"legend",17),e.YNc(2,Fe,7,5,"ng-template",null,18,e.W1O),e.YNc(4,Oe,2,2,"div",19),e.YNc(5,Ue,7,5,"div",6),e.qZA()),2&i){const t=o.$implicit,n=e.MAs(3),s=e.oxw().$implicit,c=e.oxw(2);let l,d;e.cQ8("id","dropzone-piece-",c.listePiece.id,"-",s,"-",t.id,""),e.xp6(1),e.Q6J("ngIf",!c.isPieceTeleversee(s,t.id))("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",!(c.isPieceLocked(s,t.id)||void 0!==c.getSignatureOfDoc(t.id,s).id&&0!==(null==(l=c.getSignatureOfDoc(t.id,s))?null:l.id))),e.xp6(1),e.Q6J("ngIf",void 0!==c.getSignatureOfDoc(t.id,s).id&&0!==(null==(d=c.getSignatureOfDoc(t.id,s))?null:d.id))}}function Le(i,o){if(1&i&&(e.TgZ(0,"div",13),e.YNc(1,Ee,2,1,"h4",6),e.TgZ(2,"div",14),e.YNc(3,we,6,7,"fieldset",15),e.ALo(4,"trackByProperty"),e.qZA()()),2&i){const t=o.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngIf",n.tabPrenomsEleves[t]),e.xp6(2),e.Q6J("ngForOf",n.pieces)("ngForTrackBy",e.lcZ(4,3,"$index"))}}function qe(i,o){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,Le,5,5,"div",12),e.ALo(2,"trackByProperty"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.listePiece.personnes)("ngForTrackBy",e.lcZ(2,2,"$index"))}}const Ie=`${(0,xe.Je)()}/televersement.awp?verbe=post&mode=${r.qt_.DOCUMENTS}`;let ke=(()=>{class i{constructor(t,n,s,c,l,d,_){this.authStore=t,this.documentsStore=n,this.documentsService=s,this.uiService=c,this.modalService=l,this.loaderService=d,this.cd=_,this.tabPrenomsEleves={0:"la famille"},this.typeFichierTelechargement=r.Y9E,this.inputFilesConfigParPiece={},this.dropZoneConfigParPiece={},this._inputFilesConfig={fromCloudEnabled:!1,keepComplete:!0,dropzoneContainer:"#dropzoneContainer",canMergeFiles:!0},this._dropZoneConfig={parallelUploads:3,maxFiles:1,previewsContainer:!1,acceptedFiles:"application/pdf,image/jpeg,image/png",dictResponseError:"Une erreur s'est produite",dictInvalidFileType:"Vous ne pouvez envoyer que des fichiers ayant l'extension <strong>.png</strong>, <strong>.jpeg</strong> et <strong>.pdf</strong>",url:Ie,params:{}},this.allSigned=!1,this.listepiecesNoSigned=[],this._variant=r.$ej.edDBUserSpecificKeyFromUser(this.authStore.currentUser)}ngOnInit(){this.authStore.isFamille()&&this.authStore.currentUser.profile.eleves.forEach(n=>this.tabPrenomsEleves[n.id]=n.prenom),this.listePiece.personnes.forEach(n=>{this.dropZoneConfigParPiece[n]={},this.inputFilesConfigParPiece[n]={},this.pieces.forEach(s=>{const c="#dropzone-piece-"+this.listePiece.id+"-"+n+"-"+s.id;this.dropZoneConfigParPiece[n][s.id]={...this._dropZoneConfig,params:{}},this.dropZoneConfigParPiece[n][s.id].params.idListePiece=this.listePiece.id,this.dropZoneConfigParPiece[n][s.id].params.idPiece=s.id,this.dropZoneConfigParPiece[n][s.id].params.idPersonne=n,this.dropZoneConfigParPiece[n][s.id].clickable=c+" .fileinput-button",this.inputFilesConfigParPiece[n][s.id]={...this._inputFilesConfig,dropzoneContainer:c,tabFilesMerged:[]}})});const t=[];this.listePiece.personnes.forEach(n=>{this.listePiece.pieces.forEach(s=>{const c=this.docsAverser.televersements.find(l=>l.idListePiece===this.listePiece.id&&l.idPiece===s&&l.idPersonne===n);Object.isExists(c)&&c.signature?.id>0&&t.push(c)})}),this.allSigned=t.length===this.listePiece.pieces.length*this.listePiece.personnes.length}openModalDeletePiece(t){if(!Object.isExists(t))return void this.uiService.notifyEvent(r.DOJ.genericError,"Suppression impossible","Erreur","fa fa-warning");const n={id:this.modalService.getModalsCount()+1,initialState:{title:"Suppression d'\xe9l\xe9ment",message:"Souhaitez vous vraiment <strong>supprimer</strong> ce document ?",btnConfirm:"Valider"}};this.modalService.show(De.z,n),this.modalService.onHide.pipe((0,Z.q)(1),(0,p.b)(s=>{s===ye.G.validation&&(this.loader=this.loaderService.show(this),this.documentsService.deleteDocumentTeleverse(t).pipe((0,p.b)(()=>{this.uiService.notifyEvent(r.DOJ.genericSuccess,"Votre document a \xe9t\xe9 supprim\xe9","Documents","icon-ed_documents","DocumentsListePieceComponent"),this.inputFilesConfigParPiece[t.idPersonne][t.idPiece]={...this.inputFilesConfigParPiece[t.idPersonne][t.idPiece],tabFilesMerged:[]},this.cd.markForCheck()}),(0,m.K)(()=>(this.uiService.notifyEvent(r.DOJ.genericError,"La suppression de votre document a \xe9chou\xe9.","Documents","fa fa-warning"),C.E)),(0,v.x)(()=>this.loaderService.hide(this)),(0,m.K)(c=>this.uiService.notifyErrorThenEmpty(c,!0,"Erreur","fa fa-warning"))).subscribe())})).subscribe()}getTeleversement(t,n){return this.televersements.find(s=>s.idListePiece===this.listePiece.id&&s.idPiece===n&&s.idPersonne===t)}isPieceTeleversee(t,n){return this.televersements.findIndex(s=>s.idListePiece===this.listePiece.id&&s.idPiece===n&&s.idPersonne===t)>-1}isPieceLocked(t,n){return this.televersements.findIndex(s=>s.idListePiece===this.listePiece.id&&s.idPiece===n&&s.idPersonne===t&&s.isLock)>-1}additionalDataTelechargement(t,n){return{data:JSON.stringify({idListePiece:this.listePiece.id,idPersonne:t,idPiece:n})}}onUploadSuccess(t,n,s){this.documentsStore.updateDocumentsStore(new r.fuR({idPersonne:n,idPiece:s,idListePiece:this.listePiece.id,date:t.date,libelle:t.libelle}),r.$ej.edDBUserSpecificKeyFromUser(this.authStore.currentUser),"televersementListePiece")}openSignatureListePiece(){if(this.authStore.isModeSupervision()||this.authStore.isEphemere())return void this.uiService.notifyEvent(r.DOJ.genericError,"En mode supervision, cette action n'est pas disponible !","Dossier d'inscription");this.listepiecesNoSigned=[],this.listePiece.personnes.forEach(c=>{this.listePiece.pieces.forEach(l=>{const d=this.docsAverser.televersements.find(_=>_.idListePiece===this.listePiece.id&&_.idPiece===l&&_.idPersonne===c);Object.isExists(d)&&void 0===d.signature?.id&&this.listepiecesNoSigned.push(d)})});const n={titre:"Signature des pi\xe8ces t\xe9l\xe9vers\xe9es",customMessage:"Pour certifier que vous avez bien <b>t\xe9l\xe9verser les documents ci-dessus:</b>",piecesNoSigned:this.listepiecesNoSigned,pieces:this.docsAverser.pieces,personnes:this.docsAverser.personnes,send3DSecureAuth:(c,l)=>c?this.documentsService.signerLesDocumentsParIdListePiece(this.listePiece.id,c,l.signatureCanvas,this.listePiece.libelle).pipe((0,be.w)(()=>(this.uiService.notifyEvent(r.DOJ.genericSuccess,"Votre signature a bien \xe9t\xe9 prise en compte","Documents"),this.cd.markForCheck(),(0,E.of)(!0))),(0,m.K)(d=>(this.uiService.notifyEvent(r.DOJ.genericError,r.FSr.isNotEmptyString(d.message)?d.message:"Signature impossible","Documents"),C.E))):(0,E.of)(!1)};this.modalService.show(Pe.a,{id:this.modalService.getModalsCount()+1,ignoreBackdropClick:!0,initialState:n}).content.onClose$.pipe((0,Z.q)(1)).subscribe()}getSignatureOfDoc(t,n){let s=new r.Sej;const c=this.docsAverser.televersements.find(l=>l.idPiece===t&&n===l.idPersonne&&l.idListePiece===this.listePiece.id);return Object.isExists(c)&&Object.isExists(c.signature)&&(s=new r.Sej(c.signature)),s}checkListePieceNoSigned(){return this.listepiecesNoSigned=[],this.listePiece.personnes.forEach(t=>{this.listePiece.pieces.forEach(n=>{const s=this.docsAverser.televersements.find(c=>c.idListePiece===this.listePiece.id&&c.idPiece===n&&c.idPersonne===t);Object.isExists(s)&&void 0===s.signature?.id&&this.listepiecesNoSigned.push(s)})}),this.cd.markForCheck(),this.listepiecesNoSigned.length>0}getFile(t,n){const s=this.getTeleversement(n,t.id);let c="";return Object.isExists(s?.libelle)&&(c=s.libelle),new r.eD9({id:c,type:r.Y9E.LISTE_PIECE,displayText:t.libelle,libelle:t.libelle,url:c})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(r.CnD),e.Y36(r.e1M),e.Y36(r.SRx),e.Y36(r.VLf),e.Y36(Se.tT),e.Y36(b.S),e.Y36(e.sBO))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-documents-liste-piece"]],inputs:{listePiece:"listePiece",tabPrenomsEleves:"tabPrenomsEleves",pieces:"pieces",docsAverser:"docsAverser",televersements:"televersements"},decls:13,vars:9,consts:[[1,"ed-card","card","with-epingle","liste-documents-televersement","liste-docs",3,"ngBusy"],[1,"card-header","pb-0"],[1,"m-0"],[1,"alert","alert-info"],["class","btn btn-primary white float-end","type","button",3,"click",4,"ngIf"],[1,"text-bold"],[4,"ngIf"],[1,"clearfix"],[1,"card-body","pt-0"],["type","button",1,"btn","btn-primary","white","float-end",3,"click"],["aria-hidden","true",1,"fa","fa-download"],[1,"margin-whitespace"],["class","destinataire",4,"ngFor","ngForOf","ngForTrackBy"],[1,"destinataire"],[1,"liste-pieces","row"],["class","dropzone-container col-lg-4",3,"id",4,"ngFor","ngForOf","ngForTrackBy"],[1,"dropzone-container","col-lg-4",3,"id"],[4,"ngIf","ngIfElse"],["legendTelechargeable",""],["class","contenu",4,"ngIf"],["aria-hidden","true",1,"fa","fa-file-o"],["edLightbox","","type","button",1,"btn","btn-link",3,"file","typeFichier","additionalData"],["aria-hidden","true",1,"i-small","fa","fa-file-o"],["class","margin-whitespace btn btn-danger-color no-background no-padding","title","Supprimer ce fichier",3,"click",4,"ngIf"],["aria-hidden","true",1,"fa","fa-check-square","i-small","text-success","align-middle","margin-whitespace"],["title","Supprimer ce fichier",1,"margin-whitespace","btn","btn-danger-color","no-background","no-padding",3,"click"],["aria-hidden","true",1,"fa","fa-trash","i-small"],[1,"contenu"],[3,"dropzoneConfig","config","successUpload"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),e._uU(3),e.qZA(),e.TgZ(4,"div",3),e.YNc(5,Te,4,0,"button",4),e.TgZ(6,"p",5),e._uU(7),e.ALo(8,"edDate"),e.qZA(),e.YNc(9,Ce,2,1,"p",6),e._UZ(10,"div",7),e.qZA()(),e.TgZ(11,"div",8),e.YNc(12,qe,3,4,"div",6),e.qZA()()),2&t&&(e.Q6J("ngBusy",n.loader),e.xp6(3),e.Oqu(n.listePiece.libelle),e.xp6(2),e.Q6J("ngIf",n.listePiece.signature_demandee&&!n.allSigned&&n.checkListePieceNoSigned()&&n.authStore.isFamille()),e.xp6(2),e.hij("Date limite de t\xe9l\xe9versement : ",e.xi3(8,6,n.listePiece.dateLimiteTeleversement,"fullDate"),""),e.xp6(2),e.Q6J("ngIf",""!==n.listePiece.description),e.xp6(3),e.Q6J("ngIf",n.listePiece.personnes))},dependencies:[u.sg,u.O5,x.DC,Ae.s,y.l,r.ifA,f.$],styles:[".liste-documents-televersement[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .liste-pieces[_ngcontent-%COMP%]{margin:40px -20px 0}.liste-documents-televersement[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .liste-pieces[_ngcontent-%COMP%]   fieldset[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{color:#000;font-size:12px;font-weight:700;text-transform:uppercase;border:none}.liste-documents-televersement[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .liste-pieces[_ngcontent-%COMP%]   fieldset[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]   button.btn-link[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;text-transform:inherit}.liste-documents-televersement[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .liste-pieces[_ngcontent-%COMP%]   fieldset[_ngcontent-%COMP%]   .dropzone-ed-overlay[_ngcontent-%COMP%]{background:#fff}.liste-documents-televersement[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:10px -42px 0;padding:5px 40px;background:var(--smalldark-placeholder-color);font-size:14px;font-style:italic;clear:right}"],changeDetection:0}),i})();function Je(i,o){1&i&&(e.TgZ(0,"div",5)(1,"h3"),e._uU(2,"Aucun document \xe0 t\xe9l\xe9verser"),e.qZA()())}function Ye(i,o){if(1&i&&e._UZ(0,"ed-documents-liste-piece",7),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.Q6J("docsAverser",n.documentsAFournir)("listePiece",t)("pieces",n.piecesParListePiece[t.id])("tabPrenomsEleves",n.tabPrenomsEleves)("televersements",n.televersementsParListePiece[t.id])}}function Ne(i,o){if(1&i&&(e.ynx(0),e.YNc(1,Ye,1,5,"ed-documents-liste-piece",6),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",t.authStore.isProfOuPersonnel()||t.authStore.isFamille())}}function Be(i,o){if(1&i&&(e.TgZ(0,"div",2),e.YNc(1,Je,3,0,"div",3),e.YNc(2,Ne,2,1,"ng-container",4),e.ALo(3,"trackByProperty"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",0===t.documentsAFournir.listesPieces.length),e.xp6(1),e.Q6J("ngForOf",t.documentsAFournir.listesPieces)("ngForTrackBy",e.lcZ(3,3,"id"))}}const Qe=[{path:"",component:L,children:[{path:"",redirectTo:"telechargements",pathMatch:"full"},{path:"telechargements",component:ve},{path:"televersements",component:(()=>{class i extends((0,r.kCV)()){constructor(t,n,s,c){super(),this.uiService=t,this.authStore=n,this.documentsService=s,this.documentsStore=c,this.tabPrenomsEleves={0:"la famille"},this.piecesParListePiece={},this.televersementsParListePiece={},this._variant=r.$ej.edDBUserSpecificKeyFromUser(this.authStore.currentUser)}get documentsAFournir(){return this._documentsAFournir}set documentsAFournir(t){this._documentsAFournir=new r.S$e(t),this.ventilerDocumentsAFournir()}ngOnInit(){this.documentsStore.select$().pipe((0,p.b)(t=>{const n=Object.getEntity(t,this._variant);Object.isExpired(n)||(this.documentsAFournir=n.listesPiecesAVerser)}),(0,m.K)(t=>this.uiService.notifyErrorThenEmpty(t,!0,"Erreur","fa fa-warning")),(0,g.R)(this.componentDestroyed$)).subscribe()}ventilerDocumentsAFournir(){this.documentsAFournir.listesPieces.forEach(t=>{this.piecesParListePiece[t.id]=this.documentsAFournir.pieces.filter(n=>t.pieces.findIndex(s=>s===n.id)>-1),this.televersementsParListePiece[t.id]=this.documentsAFournir.televersements.filter(n=>t.pieces.findIndex(s=>n.idPiece===s)>-1&&n.idListePiece===t.id)}),this.authStore.isFamille()&&this.documentsAFournir.listesPieces.edPluckFlatten("personnes").filter(t=>t!==this.authStore.currentUser.id).forEach(t=>{Object.isExists(this.tabPrenomsEleves[t])||this.documentsAFournir.personnes.filter(n=>n.type===r.dcH.ELEVE&&n.id===t).forEach(n=>this.tabPrenomsEleves[t]=n.prenom)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(r.VLf),e.Y36(r.CnD),e.Y36(r.SRx),e.Y36(r.e1M))},i.\u0275cmp=e.Xpm({type:i,selectors:[["ed-documents-televersements"]],features:[e.qOj],decls:2,vars:1,consts:[[1,"ed-documents-televersements"],["class","detail-tab","id","docsATeleverser",4,"ngIf"],["id","docsATeleverser",1,"detail-tab"],["class","jumbotron",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"jumbotron"],[3,"docsAverser","listePiece","pieces","tabPrenomsEleves","televersements",4,"ngIf"],[3,"docsAverser","listePiece","pieces","tabPrenomsEleves","televersements"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Be,4,5,"div",1),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.documentsAFournir))},dependencies:[u.sg,u.O5,ke,f.$],styles:["#docsATeleverser[_ngcontent-%COMP%]{padding:20px 2px}"]}),i})()}]}];let je=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[D.Bz.forChild(Qe),D.Bz]}),i})();var $e=a(99658),Ve=a(96272);let ze=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[je,$e.m,Ve.Q]}),i})()}}]);