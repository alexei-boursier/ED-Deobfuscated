"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[3374],{3374:(M,C,r)=>{r.d(C,{w:()=>q});var p=r(24006),l=r(45007),f=r(77579),v=r(39646),m=r(78372),E=r(71884),g=r(82722),u=r(54004),h=r(28746),e=r(94650),T=r(20388),y=r(92635),S=r(36895),D=r(80125),O=r(93970),P=r(34414),A=r(34331),x=r(82945),Z=r(4602);function I(n,a){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",8)(2,"input",27),e.NdJ("ngModelChange",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.isDisplayAllClasses=o)})("change",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.displayAllClasses())}),e.qZA(),e.TgZ(3,"label",28),e._uU(4,"Afficher toutes les classes"),e.qZA()(),e._UZ(5,"div",11),e.BQk()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngModel",t.isDisplayAllClasses)}}function U(n,a){if(1&n&&(e.TgZ(0,"option",31),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.s9C("title",t.code),e.Q6J("ngValue",t),e.xp6(1),e.hij(" ",t.libelle," ")}}function B(n,a){if(1&n&&(e.TgZ(0,"optgroup",29),e.YNc(1,U,2,3,"option",30),e.ALo(2,"trackByProperty"),e.qZA()),2&n){const t=a.$implicit;e.s9C("label",t.etabLibelle),e.xp6(1),e.Q6J("ngForOf",t.classes)("ngForTrackBy",e.lcZ(2,3,"uniqueID"))}}function L(n,a){if(1&n&&(e.TgZ(0,"option",31),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.s9C("title",t.code),e.Q6J("ngValue",t),e.xp6(1),e.Oqu(t.libelle)}}function R(n,a){if(1&n&&(e.TgZ(0,"optgroup",32),e.YNc(1,L,2,3,"option",30),e.ALo(2,"trackByProperty"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.cg.groupes)("ngForTrackBy",e.lcZ(2,2,"uniqueID"))}}function J(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"th",36)(2,"div")(3,"label")(4,"input",37),e.NdJ("change",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.selectAll())})("ngModelChange",function(o){e.CHM(t);const i=e.oxw(2);return e.KtG(i.isSelectAll=o)}),e.qZA()()()(),e.TgZ(5,"th",38),e._uU(6,"Nom"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Classe"),e.qZA()()}if(2&n){const t=e.oxw(2);e.xp6(4),e.Q6J("ngModel",t.isSelectAll)}}const N=function(n){return{info:n}};function F(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"tr",39),e.NdJ("click",function(o){const _=e.CHM(t).item,c=e.oxw(2);return e.KtG(c.selectDestinataire(_,o))}),e.TgZ(1,"td")(2,"div")(3,"label"),e._UZ(4,"input",40),e.ALo(5,"displayNom"),e.qZA()()(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"displayNom"),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA()()}if(2&n){const t=a.item;e.Q6J("ngClass",e.VKq(10,N,t.isSelected)),e.xp6(4),e.Q6J("checked",t.isSelected),e.uIk("name","isSelected"+t.uniqID)("aria-label","S\xe9lectionner le destinataire "+e.lcZ(5,6,t)),e.xp6(3),e.Oqu(e.lcZ(8,8,t)),e.xp6(3),e.Oqu(t.classe.libelle)}}function k(n,a){if(1&n&&(e.TgZ(0,"ed-smart-table",33),e.YNc(1,J,9,1,"ng-template",34),e.YNc(2,F,11,12,"ng-template",35),e.qZA()),2&n){const t=e.oxw();e.Q6J("datas",t.listeElevesSearch)("stNBItemsPagination",3)("pagination",!0)}}function K(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.addListesContactsToMessage())}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.hij(" Ajouter ",1===t.getSelectionnes().length?"la personne s\xe9lectionn\xe9e":"les "+t.getSelectionnes().length+" personnes s\xe9lectionn\xe9es"," ")}}function W(n,a){1&n&&(e.TgZ(0,"div",42),e._uU(1,"Aucun contact trouv\xe9 !"),e.qZA())}let q=(()=>{class n extends((0,l.kCV)()){constructor(t,s,o,i,_,c,d,b){super(),this.authStore=t,this.etablissementStore=s,this.etablissementService=o,this.messagerieStore=i,this.messagerieService=_,this.modalRef=c,this.uiService=d,this.loaderService=b,this.onClose$=new f.x,this.cg={classes:[],groupes:[]},this.isDisplayAllClasses=!1,this.onlyPresents=!1,this.searchClassesGroupes=[],this.listeEleves=[],this.listeElevesSearch=[],this.searchNom=new p.NI("")}ngOnInit(){this.parametrage=new l.aA2(this.messagerieStore.getMessagerieParametrage(this.authStore.variantForCurrentUser)),this.getClasses(),this.searchNom.valueChanges.pipe((0,m.b)(500),(0,E.x)(),(0,g.R)(this.componentDestroyed$)).subscribe(t=>this.getContacts())}ngOnDestroy(){return this.onClose$.complete(),super.ngOnDestroy()}getContacts(t=!1){const s=this.searchNom.value;if(0===this.searchClassesGroupes.length&&!l.FSr.isNotEmptyString(s,!0))return;const o=this.sourceModule===l.lFO.ESPACE_DE_TRAVAIL?this.idEspaceTravail:0;this.loader=this.loaderService.show(this),this.messagerieService.getElevesContacts({idClasse:0,idGroupe:0,idMatiere:0,nom:s,recupAll:this.isDisplayAllClasses?1:0,idEspace:o,onlyPresents:this.onlyPresents?1:0},this.sourceModule,t).pipe((0,u.U)(i=>new l.b0J(i).contacts.edSortBy("nom")),(0,h.x)(()=>this.loaderService.hide(this))).subscribe({next:i=>{this.loadResultats(i,s),this.listeElevesSearch.forEach(_=>{const c=this.listeEleves.find(d=>_.id===d.id);Object.isExists(c)&&(_.isSelected=c.isSelected)})},error:i=>this.uiService.notifyEvent(i.action,i.message,"Erreur","fa fa-envelope")})}loadResultats(t,s){const o=Array.isArray(t)?t.map(i=>new l.iJ0(i)):[];if(this.searchClassesGroupes.length>0){const i=this.searchClassesGroupes.filter(c=>c.typeEntity===l.meW.CLASSE).edPluckFlatten("id"),_=this.searchClassesGroupes.filter(c=>c.typeEntity===l.meW.GROUPE).edPluckFlatten("id");t=(t=t.filter(c=>i.findIndex(d=>d===c.classe.id)>-1)).concat(o.filter(c=>c.groupes?.edPluckFlatten("id").edIntersect(_).length>0))}if(l.FSr.isNotEmptyString(s,!0)){l.dR7.calculateDiacriticsMap();const i=new RegExp(`${l.dR7.replaceDiacritics(s)}`,"mi");t=t.filter(_=>l.dR7.replaceDiacritics(_.prenom).search(i)>-1||l.dR7.replaceDiacritics(_.nom).search(i)>-1)}this.isSelectAll=!1,this.listeElevesSearch=Array.isArray(t)?t.map(i=>new l.iJ0(i)):[]}getClasses(){this.loader=this.loaderService.show(this),(!0===this.isDisplayAllClasses||this.authStore.isProfesseur()&&this.sourceModule===l.lFO.ESPACE_DE_TRAVAIL?this.etablissementService.getNiveauxListeAll():(0,v.of)(this.etablissementStore.snapshot)).pipe((0,h.x)(()=>this.loaderService.hide(this))).subscribe(s=>{this.cg=this.getCGForMenu(s)})}getCGForMenu(t){if(!Object.isExists(this.authStore.currentUser))return{classes:[],groupes:[]};const s=l.uKw.getProfClassesGroupesTree(t),o=s.classes.edUniq("uniqueID").edSortBy("etabLibelle"),i=s.groupes.edUniq("uniqueID").edSortBy("libelle");return o.reduce((_,c)=>{const d=_.classes.findIndex(b=>c.etabLibelle===b.etabLibelle);return d>-1?_.classes[d].classes.push(c):_.classes.push({etabLibelle:c.etabLibelle,classes:[c]}),_},{classes:[],groupes:i})}displayAllClasses(){this.getClasses(),this.getContacts()}refresh(){this.getContacts(!0)}selectAll(){this.listeElevesSearch.forEach(t=>{t.isSelected=!0===this.isSelectAll;const s=this.listeEleves.find(o=>t.id===o.id);Object.isExists(s)?s.isSelected=!0===this.isSelectAll:this.listeEleves.push(new l.iJ0(t))})}oneIsSelected(){return Object.isExists(this.listeEleves)&&this.listeEleves.some(t=>!0===t.isSelected)}addListesContactsToMessage(){const t=this.getSelectionnes().map(s=>(s.to_cc_cci=this.toCcCci,s.type=l.dcH.ELEVE,s));this.onClose$.next(t),this.close()}getSelectionnes(){return this.listeEleves.filter(t=>!0===t.isSelected)}close(){this.modalRef.hide()}selectDestinataire(t,s){s.stopPropagation(),t.isSelected=!t.isSelected;const o=this.listeEleves.find(i=>t.id===i.id);Object.isExists(o)?o.isSelected=!o.isSelected:this.listeEleves.push(new l.iJ0(t))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(l.CnD),e.Y36(l.VD2),e.Y36(l.Xmb),e.Y36(l.q0O),e.Y36(l.KRh),e.Y36(T.UZ),e.Y36(l.VLf),e.Y36(y.S))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ed-compose-selection-eleve-eag"]],inputs:{toCcCci:"toCcCci",sourceModule:"sourceModule",idEspaceTravail:"idEspaceTravail"},features:[e.qOj],decls:38,vars:14,consts:[[1,"modal-header"],[1,"modal-title"],["title","Rafra\xeechir les contacts","type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body","selectDestinataires",3,"ngBusy"],["name","selectDestinataires","novalidate",""],["for","nom","aria-label","Saisissez le nom de l'\xe9l\xe8ve \xe0 rechercher",1,"form-label"],[1,"form-check","float-end"],["type","checkbox","name","onlyPresents","id","onlyPresents",1,"form-check-input",3,"ngModel","ngModelChange","change"],["for","onlyPresents",1,"form-check-label","fw-normal"],[1,"clearfix"],["name","nom","id","nom","type","search","edAutofocus","",1,"form-control","floating-label",3,"formControl"],[1,"mt-3"],["for","classeByEtab",1,"form-label"],[4,"ngIf"],["name","classeByEtab","id","classeByEtab","multiple","",1,"form-control","form-select",3,"ngModel","ngModelChange","change"],["disabled","",3,"ngValue"],[3,"label",4,"ngFor","ngForOf","ngForTrackBy"],["label","Groupes",4,"ngIf"],["role","separator",1,"margin-top-10"],[3,"datas","stNBItemsPagination","pagination",4,"ngIf","ngIfElse"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","button","class","btn btn-primary float-end",3,"click",4,"ngIf"],["nolistescontacts",""],["type","checkbox","name","selectAllClasses","id","selectAllClasses",1,"form-check-input",3,"ngModel","ngModelChange","change"],["for","selectAllClasses",1,"form-check-label","fw-normal"],[3,"label"],[3,"ngValue","title",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngValue","title"],["label","Groupes"],[3,"datas","stNBItemsPagination","pagination"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],[1,"col-lg-1"],["type","checkbox","name","isSelectAll",1,"form-check-input",3,"ngModel","change","ngModelChange"],["stSort","nom",1,"cliquable","sortable-header"],[1,"cliquable","text-center",3,"ngClass","click"],["type","checkbox",1,"form-check-input",3,"checked"],["type","button",1,"btn","btn-primary","float-end",3,"click"],[1,"alert","alert-dark"]],template:function(t,s){if(1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2," Recherchez des \xe9l\xe8ves "),e.TgZ(3,"button",2),e.NdJ("click",function(){return s.refresh()}),e._UZ(4,"i",3),e.qZA()(),e.TgZ(5,"button",4),e.NdJ("click",function(){return s.close()}),e.qZA()(),e.TgZ(6,"div",5)(7,"form",6)(8,"div")(9,"label",7),e._uU(10,"Nom"),e.qZA(),e.TgZ(11,"div",8)(12,"input",9),e.NdJ("ngModelChange",function(i){return s.onlyPresents=i})("change",function(){return s.getContacts(!0)}),e.qZA(),e.TgZ(13,"label",10),e._uU(14,"Uniquement les pr\xe9sents"),e.qZA()(),e._UZ(15,"div",11)(16,"input",12),e.qZA(),e.TgZ(17,"div",13)(18,"label",14),e._uU(19,"Classe"),e.qZA(),e.YNc(20,I,6,1,"ng-container",15),e.TgZ(21,"select",16),e.NdJ("ngModelChange",function(i){return s.searchClassesGroupes=i})("change",function(){return s.getContacts()}),e.TgZ(22,"option",17),e._uU(23,"S\xe9lectionnez une classe"),e.qZA(),e.YNc(24,B,3,5,"optgroup",18),e.ALo(25,"trackByProperty"),e.YNc(26,R,3,4,"optgroup",19),e.qZA()(),e._UZ(27,"hr",20),e.TgZ(28,"h3"),e._uU(29,"S\xe9lectionnez des \xe9l\xe8ves"),e.qZA(),e.YNc(30,k,3,3,"ed-smart-table",21),e.qZA()(),e.TgZ(31,"div",22)(32,"div",23)(33,"button",24),e.NdJ("click",function(){return s.close()}),e._uU(34,"Fermer"),e.qZA(),e.YNc(35,K,2,1,"button",25),e.qZA()(),e.YNc(36,W,2,0,"ng-template",null,26,e.W1O)),2&t){const o=e.MAs(37);e.xp6(6),e.Q6J("ngBusy",s.loader),e.xp6(6),e.Q6J("ngModel",s.onlyPresents),e.xp6(4),e.Q6J("formControl",s.searchNom),e.xp6(4),e.Q6J("ngIf",s.parametrage.afficherToutesLesClasses),e.xp6(1),e.Q6J("ngModel",s.searchClassesGroupes),e.xp6(1),e.Q6J("ngValue",null),e.xp6(2),e.Q6J("ngForOf",s.cg.classes)("ngForTrackBy",e.lcZ(25,12,"$index")),e.xp6(2),e.Q6J("ngIf",s.cg.groupes.length),e.xp6(4),e.Q6J("ngIf",s.listeElevesSearch.length)("ngIfElse",o),e.xp6(5),e.Q6J("ngIf",s.oneIsSelected())}},dependencies:[S.mk,S.sg,S.O5,p._Y,p.YN,p.Kr,p.Fj,p.Wl,p.K7,p.JJ,p.JL,p.On,p.F,p.oH,D.DC,O.L,P.c,A.r,A.w,x.U,l.$t3,Z.$],styles:[".selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   optgroup[_ngcontent-%COMP%]{color:var(--light-primary-color)}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   optgroup[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{color:initial}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   select[name=classeByEtab][_ngcontent-%COMP%]{height:150px}"]}),n})()},34414:(M,C,r)=>{r.d(C,{c:()=>v});var p=r(86852),l=r(94650),f=r(29402);let v=(()=>{class m{constructor(g,u){this.table=g,this._el=u,this.currentSortDirection="none",this.delay=0,this.cycle=!1}get isAsc(){return"asc"===this.currentSortDirection}get isDesc(){return"desc"===this.currentSortDirection}toggle(){this._directive.toggle()}ngOnInit(){this._directive=(0,p.W1)({table:this.table,pointer:this.pointer,cycle:!0===this.cycle||"true"===this.cycle,debounceTime:this.delay}),this._directive.onSortToggle(({direction:u,pointer:h})=>{this.currentSortDirection=h===this.pointer?u:"none"});const g=this._directive.state();this.currentSortDirection=g.pointer===this.pointer?g.direction||"asc":"none"}ngOnDestroy(){this._directive.off()}}return m.\u0275fac=function(g){return new(g||m)(l.Y36(f.I),l.Y36(l.SBq))},m.\u0275dir=l.lG2({type:m,selectors:[["","stSort",""]],hostVars:4,hostBindings:function(g,u){1&g&&l.NdJ("click",function(){return u.toggle()}),2&g&&l.ekj("st-sort-asc",u.isAsc)("st-sort-desc",u.isDesc)},inputs:{delay:["stDebounceTime","delay"],pointer:["stSort","pointer"],cycle:["stSortCycle","cycle"]},exportAs:["stSort"]}),m})()}}]);