"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[5887],{13666:(R,h,i)=>{i.d(h,{L:()=>E});var _=i(99658),C=i(94650);let E=(()=>{class e{}return e.\u0275fac=function(u){return new(u||e)},e.\u0275mod=C.oAB({type:e}),e.\u0275inj=C.cJS({imports:[_.m]}),e})()},17124:(R,h,i)=>{i.d(h,{L:()=>n});var _=i(45007),C=i(87192),E=i(52497),e=i(77579),f=i(95698),u=i(39300),d=i(63900),A=i(18505),x=i(28746),O=i(70262),t=i(94650),P=i(92635),S=i(20388),v=i(36895),g=i(24006),D=i(80125),Z=i(93970),y=i(34414),M=i(34331);function U(o,a){if(1&o){const s=t.EpF();t.TgZ(0,"tr")(1,"th",16)(2,"div")(3,"label")(4,"input",17),t.NdJ("change",function(){t.CHM(s);const r=t.oxw(2);return t.KtG(r.selectAll())})("ngModelChange",function(r){t.CHM(s);const m=t.oxw(2);return t.KtG(m.isSelectAll=r)}),t.qZA()()()(),t.TgZ(5,"th",18),t._uU(6,"Libelle"),t.qZA(),t.TgZ(7,"th",19),t._uU(8,"Nombre de contacts"),t.qZA(),t._UZ(9,"th",16),t.qZA()}if(2&o){const s=t.oxw(2);t.xp6(3),t.uIk("aria-label",s.isSelectAll?"Retirer l'ensemble des listes de contacts de la s\xe9lection":"S\xe9lectionner toutes les listes de contacts"),t.xp6(1),t.Q6J("ngModel",s.isSelectAll)}}const L=function(o){return{info:o}};function I(o,a){if(1&o){const s=t.EpF();t.TgZ(0,"tr",20),t.NdJ("click",function(r){const T=t.CHM(s).item,b=t.oxw(2);return t.KtG(b.selectDestinataire(T,r))}),t.TgZ(1,"td",21)(2,"div")(3,"label"),t._UZ(4,"input",22),t.qZA()()(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",23),t._uU(8),t.qZA(),t.TgZ(9,"td",23)(10,"button",24),t.NdJ("click",function(r){const T=t.CHM(s).item,b=t.oxw(2);return t.KtG(b.showConfirmDeleteListeContacts(T,r))}),t._UZ(11,"i",25),t.qZA()()()}if(2&o){const s=a.item;t.Q6J("ngClass",t.VKq(6,L,s.isSelected)),t.xp6(4),t.Q6J("checked",s.isSelected),t.uIk("name","isSelected"+s.id)("aria-label",s.isSelected?"Retirer la liste de contacts "+s.libelle+"  de la s\xe9lection":"S\xe9lectionner la liste de contacts "+s.libelle),t.xp6(2),t.Oqu(s.libelle),t.xp6(2),t.Oqu(s.combien)}}function W(o,a){if(1&o&&(t.TgZ(0,"form",12)(1,"ed-smart-table",13),t.YNc(2,U,10,2,"ng-template",14),t.YNc(3,I,12,8,"ng-template",15),t.qZA()()),2&o){const s=t.oxw();t.xp6(1),t.Q6J("datas",s.listeContacts)("pagination",!0)("stNBItemsPagination",3)}}function c(o,a){if(1&o){const s=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(s);const r=t.oxw();return t.KtG(r.addListesContactsToMessage())}),t._uU(1,"Ajouter les destinataires s\xe9lectionn\xe9s"),t.qZA()}}function p(o,a){1&o&&(t.TgZ(0,"div",27)(1,"h3"),t._uU(2,"Aucune liste de contacts."),t.qZA()())}let n=(()=>{class o{constructor(s,l,r,m,T,b){this.authStore=s,this.loaderService=l,this.messagerieService=r,this.modalRef=m,this.modalService=T,this.uiService=b,this.onClose$=new e.x,this.listeContacts=[]}ngAfterViewInit(){this.refresh(!1)}ngOnDestroy(){this.onClose$.complete()}refresh(s=!0){this.promiseContents=this.messagerieService.getListesContacts(s).subscribe({next:l=>{this.listeContacts=Array.isArray(l.contacts)?l.contacts.map(r=>({isSelected:r.isSelected,contacts:r.contacts,combien:r.combien,libelle:r.libelle,id:r.id})):[]},error:l=>this.uiService.notifyEvent(l.action,"Une erreur est survenue lors de la r\xe9cup\xe9ration des listes de contacts","Erreur","fa fa-envelope")})}selectAll(){this.listeContacts.forEach(s=>{s.isSelected=!0===this.isSelectAll})}oneIsSelected(){return Array.isArray(this.listeContacts)&&this.listeContacts.some(s=>!0===s.isSelected)}showConfirmDeleteListeContacts(s,l){const r={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:"Suppression de la liste de contacts",message:`\xcates-vous s\xfbr de vouloir supprimer la liste de contacts <b>${s.libelle}</b> ?`,btnConfirm:"Supprimer",btnCancel:"Non"}};l.stopPropagation(),this.modalService.show(C.z,r),this.modalService.onHide.pipe((0,f.q)(1),(0,u.h)(m=>m===E.G.validation),(0,d.w)(m=>(this.promiseContents=this.loaderService.show(this),this.messagerieService.deleteListeContacts(s.id))),(0,A.b)(m=>{this.uiService.notifyEvent(_.DOJ.genericSuccess,"La liste de contacts a \xe9t\xe9 supprim\xe9e avec succ\xe8s !","Messagerie","fa fa-envelope"),this.refresh(!0)}),(0,x.x)(()=>this.loaderService.hide(this)),(0,O.K)(m=>this.uiService.notifyErrorThenEmpty(m,!0,"Erreur","fa fa-envelope"))).subscribe()}addListesContactsToMessage(){const s=this.listeContacts.map(l=>l).filter(l=>!0===l.isSelected).edPluckFlatten("contacts");s.forEach(l=>{l.destinataires.forEach(r=>r.to_cc_cci=this.toCcCci)}),this.onClose$.next(s),this.close()}close(){this.modalRef.hide()}selectDestinataire(s,l){l.stopPropagation(),s.isSelected=!s.isSelected}}return o.\u0275fac=function(s){return new(s||o)(t.Y36(_.CnD),t.Y36(P.S),t.Y36(_.KRh),t.Y36(S.UZ),t.Y36(S.tT),t.Y36(_.VLf))},o.\u0275cmp=t.Xpm({type:o,selectors:[["ed-compose-selection-liste-contacts-eag"]],inputs:{toCcCci:"toCcCci"},decls:15,vars:4,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","title","Rafra\xeechir les listes de contacts",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body","selectDestinataires",3,"ngBusy"],["name","formContacts","class","listesContacts","novalidate","",4,"ngIf","ngIfElse"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","button","class","btn btn-primary float-end",3,"click",4,"ngIf"],["nolistescontacts",""],["name","formContacts","novalidate","",1,"listesContacts"],[3,"datas","pagination","stNBItemsPagination"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],[1,"col-lg-1"],["type","checkbox","name","isSelectAll",1,"form-check-input",3,"ngModel","change","ngModelChange"],["stSort","libelle",1,"cliquable","sortable-header"],[1,"col-lg-3","text-center"],[1,"cliquable","text-center",3,"ngClass","click"],[1,"col-md-1","vert-align"],["type","checkbox",1,"form-check-input",3,"checked"],[1,"vert-align"],["type","button","title","Supprimer la liste de contacts",1,"btn","btn-danger",3,"click"],[1,"fa","fa-trash"],["type","button",1,"btn","btn-primary","float-end",3,"click"],[1,"jumbotron"]],template:function(s,l){if(1&s&&(t.TgZ(0,"div",0)(1,"h3",1),t._uU(2," S\xe9lectionnez des listes de contacts "),t.TgZ(3,"button",2),t.NdJ("click",function(){return l.refresh()}),t._UZ(4,"i",3),t.qZA()(),t.TgZ(5,"button",4),t.NdJ("click",function(){return l.close()}),t.qZA()(),t.TgZ(6,"div",5),t.YNc(7,W,4,3,"form",6),t.qZA(),t.TgZ(8,"div",7)(9,"div",8)(10,"button",9),t.NdJ("click",function(){return l.close()}),t._uU(11,"Fermer"),t.qZA(),t.YNc(12,c,2,0,"button",10),t.qZA()(),t.YNc(13,p,3,0,"ng-template",null,11,t.W1O)),2&s){const r=t.MAs(14);t.xp6(6),t.Q6J("ngBusy",l.promiseContents),t.xp6(1),t.Q6J("ngIf",l.listeContacts.length)("ngIfElse",r),t.xp6(5),t.Q6J("ngIf",l.oneIsSelected())}},dependencies:[v.mk,v.O5,g._Y,g.Wl,g.JJ,g.JL,g.On,g.F,D.DC,Z.L,y.c,M.r,M.w],styles:['.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .sortable-header[_ngcontent-%COMP%]:before{content:"\\f0dc";display:inline-block;font: 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transform:translate(0);margin-right:5px}']}),o})()},4714:(R,h,i)=>{i.d(h,{O:()=>W});var _=i(45007),C=i(77579),E=i(54004),e=i(94650),f=i(20388),u=i(36895),d=i(24006),A=i(80125),x=i(93970),O=i(34414),t=i(34331),P=i(4602);function S(c,p){1&c&&(e.TgZ(0,"option",20),e._uU(1,"Aucun espace de travail"),e.qZA())}function v(c,p){if(1&c&&(e.TgZ(0,"option",9),e._uU(1),e.qZA()),2&c){const n=p.$implicit;e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.titre)}}function g(c,p){if(1&c){const n=e.EpF();e.TgZ(0,"tr")(1,"th",24)(2,"div")(3,"label")(4,"input",25),e.NdJ("change",function(){e.CHM(n);const a=e.oxw(2);return e.KtG(a.selectAll())})("ngModelChange",function(a){e.CHM(n);const s=e.oxw(2);return e.KtG(s.isSelectAll=a)}),e.qZA()()()(),e.TgZ(5,"th",26),e._uU(6,"Type"),e.qZA(),e.TgZ(7,"th",27),e._uU(8,"Nom"),e.qZA()()}if(2&c){const n=e.oxw(2);e.xp6(3),e.uIk("aria-label",n.isSelectAll?"Retirer l'ensemble des contacts de la s\xe9lection":"S\xe9lectionner tous les contacts"),e.xp6(1),e.Q6J("ngModel",n.isSelectAll)}}function D(c,p){if(1&c&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&c){const n=e.oxw().item;e.xp6(1),e.hij("(",n.classe.libelle,")")}}function Z(c,p){if(1&c&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&c){const n=e.oxw().item;e.xp6(1),e.hij("(",n.fonction.libelle,")")}}const y=function(c){return{info:c}};function M(c,p){if(1&c){const n=e.EpF();e.TgZ(0,"tr",28),e.NdJ("click",function(a){const l=e.CHM(n).item,r=e.oxw(2);return e.KtG(r.selectDestinataire(l,a))}),e.TgZ(1,"td")(2,"div")(3,"label"),e.ALo(4,"displayNom"),e.ALo(5,"displayNom"),e._UZ(6,"input",29),e.qZA()()(),e.TgZ(7,"td")(8,"span"),e._UZ(9,"i",30),e.qZA()(),e.TgZ(10,"td"),e._uU(11),e.ALo(12,"displayNom"),e.YNc(13,D,2,1,"span",31),e.YNc(14,Z,2,1,"span",31),e.qZA()()}if(2&c){const n=p.item,o=e.oxw(2);e.Q6J("ngClass",e.VKq(25,y,n.isSelected)),e.xp6(3),e.uIk("aria-label",n.isSelected?"Retirer le contact "+e.gM2(4,10,n,!0,!0,o.authStore.isFouE())+"  de la s\xe9lection":"S\xe9lectionner le contact "+e.gM2(5,15,n,!0,!0,o.authStore.isFouE())),e.xp6(3),e.Q6J("checked",n.isSelected),e.uIk("name","isSelected"+n.uniqID),e.xp6(3),e.Tol(o.getIconTypeUser(n.type)),e.s9C("title",o.getTypePersonne(n.type)),e.xp6(2),e.hij(" ",e.gM2(12,20,n,!0,!0,o.authStore.isFouE())," "),e.xp6(2),e.Q6J("ngIf",n.type===o.ED_TYPE_USER.ELEVE),e.xp6(1),e.Q6J("ngIf",n.type===o.ED_TYPE_USER.PERSONNEL&&""!==n.fonction.libelle)}}function U(c,p){if(1&c&&(e.TgZ(0,"ed-smart-table",21),e.YNc(1,g,9,2,"ng-template",22),e.YNc(2,M,15,27,"ng-template",23),e.qZA()),2&c){const n=e.oxw();e.Q6J("datas",n.listeContacts)("pagination",!0)("stNBItemsPagination",3)}}function L(c,p){if(1&c){const n=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(n);const a=e.oxw();return e.KtG(a.addListesContactsToMessage())}),e._uU(1),e.qZA()}if(2&c){const n=e.oxw();e.xp6(1),e.hij(" Ajouter ",1===n.getSelectionnes().length?"la personne s\xe9lectionn\xe9e":"les "+n.getSelectionnes().length+" personnes s\xe9lectionn\xe9es"," ")}}function I(c,p){1&c&&(e.TgZ(0,"div",33),e._uU(1,"Aucun contact trouv\xe9 !"),e.qZA())}let W=(()=>{class c{constructor(n,o,a,s,l){this.authStore=n,this.espaceDeTravailService=o,this.messagerieService=a,this.modalRef=s,this.uiService=l,this.ED_TYPE_USER=_.dcH,this.getTypePersonne=_.FSr.getTypePersonne,this.onClose$=new C.x,this.espacesTravail=[],this.listeContacts=[],this.listeContactsFinal=[]}ngOnInit(){this.refresh(!1)}ngOnDestroy(){this.onClose$.complete()}refresh(n=!0){this.promiseContents=this.espaceDeTravailService.listeEspacesTravail(this.authStore.currentUser.id,this.authStore.currentUser.typeCompte,n,!0).pipe((0,E.U)(o=>o.filter(a=>a.estMembre))).subscribe({next:o=>{this.espacesTravail=o},error:o=>this.uiService.notifyEvent(o.action,"Une erreur est survenue lors de la r\xe9cup\xe9ration des contacts","Erreur","fa fa-envelope")})}onChangeW(){Object.isExists(this.searchW)&&this.searchW.id>0?this.promiseContents=this.messagerieService.getEspaceTravailContacts(this.searchW.id).pipe((0,E.U)(n=>new _.b0J(n).contacts)).subscribe({next:n=>{this.listeContacts=Array.isArray(n)?n.map(o=>new _.iJ0(o)):[],this.isSelectAll=!1,this.listeContacts.forEach(o=>{const a=this.listeContactsFinal.find(s=>o.id===s.id);Object.isExists(a)&&(o.isSelected=a.isSelected)})},error:n=>this.uiService.notifyEvent(n.action,n.message,"Erreur","fa fa-envelope")}):this.listeContacts=[]}selectAll(){this.listeContacts.forEach(n=>{n.isSelected=!0===this.isSelectAll;const o=this.listeContactsFinal.find(a=>n.id===a.id);Object.isExists(o)?o.isSelected=!0===this.isSelectAll:this.listeContactsFinal.push(new _.iJ0(n))})}oneIsSelected(){return Object.isExists(this.listeContactsFinal)&&this.listeContactsFinal.some(n=>!0===n.isSelected)}addListesContactsToMessage(){const n=this.getSelectionnes().map(o=>(o.to_cc_cci=this.toCcCci,o));this.onClose$.next(n),this.close()}getSelectionnes(){return this.listeContactsFinal.filter(n=>!0===n.isSelected)}close(){this.modalRef.hide()}getIconTypeUser(n){const o=_.FSr.getIconTypePersonne(n);return`icon-ed_${o} text-${o}`}selectDestinataire(n,o){o.stopPropagation(),n.isSelected=!n.isSelected;const a=this.listeContactsFinal.find(s=>n.id===s.id);Object.isExists(a)?a.isSelected=!a.isSelected:this.listeContactsFinal.push(new _.iJ0(n))}}return c.\u0275fac=function(n){return new(n||c)(e.Y36(_.CnD),e.Y36(_.AUs),e.Y36(_.KRh),e.Y36(f.UZ),e.Y36(_.VLf))},c.\u0275cmp=e.Xpm({type:c,selectors:[["ed-compose-selection-w-eag"]],inputs:{toCcCci:"toCcCci"},decls:29,vars:11,consts:[[1,"modal-header"],[1,"modal-title"],["title","Rafra\xeechir les espaces","type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body","selectDestinataires","dialog-compose-espTravail",3,"ngBusy"],["name","selectDestinataires","novalidate",""],["for","selectEspaceTravail",1,"form-label"],["name","selectEspaceTravail","id","selectEspaceTravail",1,"form-control","form-select",3,"ngModel","ngModelChange","change"],[3,"ngValue"],["disabled","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf","ngForTrackBy"],[1,"clearfix"],["role","separator",1,"margin-top-10"],[3,"datas","pagination","stNBItemsPagination",4,"ngIf","ngIfElse"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","button","class","btn btn-primary float-end",3,"click",4,"ngIf"],["nolistescontacts",""],["disabled",""],[3,"datas","pagination","stNBItemsPagination"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],[1,"col-lg-1"],["type","checkbox","name","isSelectAll",1,"form-check-input",3,"ngModel","change","ngModelChange"],["stSort","type",1,"cliquable","sortable-header"],["stSort","nom",1,"cliquable","sortable-header"],[1,"cliquable","text-center",3,"ngClass","click"],["type","checkbox",1,"form-check-input",3,"checked"],[3,"title"],[4,"ngIf"],["type","button",1,"btn","btn-primary","float-end",3,"click"],[1,"alert","alert-dark"]],template:function(n,o){if(1&n&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2," Recherchez des espaces de travail "),e.TgZ(3,"button",2),e.NdJ("click",function(){return o.refresh()}),e._UZ(4,"i",3),e.qZA()(),e.TgZ(5,"button",4),e.NdJ("click",function(){return o.close()}),e.qZA()(),e.TgZ(6,"div",5)(7,"form",6)(8,"div")(9,"label",7),e._uU(10,"Espace de travail"),e.qZA(),e.TgZ(11,"select",8),e.NdJ("ngModelChange",function(s){return o.searchW=s})("change",function(){return o.onChangeW()}),e.TgZ(12,"option",9),e._uU(13,"S\xe9lectionnez un espace"),e.qZA(),e.YNc(14,S,2,0,"option",10),e.YNc(15,v,2,2,"option",11),e.ALo(16,"trackByProperty"),e.qZA()(),e._UZ(17,"div",12)(18,"hr",13),e.TgZ(19,"h3"),e._uU(20,"S\xe9lectionnez des membres"),e.qZA(),e.YNc(21,U,3,3,"ed-smart-table",14),e.qZA()(),e.TgZ(22,"div",15)(23,"div",16)(24,"button",17),e.NdJ("click",function(){return o.close()}),e._uU(25,"Fermer"),e.qZA(),e.YNc(26,L,2,1,"button",18),e.qZA()(),e.YNc(27,I,2,0,"ng-template",null,19,e.W1O)),2&n){const a=e.MAs(28);e.xp6(6),e.Q6J("ngBusy",o.promiseContents),e.xp6(5),e.Q6J("ngModel",o.searchW),e.xp6(1),e.Q6J("ngValue",null),e.xp6(2),e.Q6J("ngIf",0===o.espacesTravail.length),e.xp6(1),e.Q6J("ngForOf",o.espacesTravail)("ngForTrackBy",e.lcZ(16,9,"id")),e.xp6(6),e.Q6J("ngIf",o.listeContacts.length)("ngIfElse",a),e.xp6(5),e.Q6J("ngIf",o.oneIsSelected())}},dependencies:[u.mk,u.sg,u.O5,d._Y,d.YN,d.Kr,d.Wl,d.EJ,d.JJ,d.JL,d.On,d.F,A.DC,x.L,O.c,t.r,t.w,_.$t3,P.$],styles:['.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .sortable-header[_ngcontent-%COMP%]:before{content:"\\f0dc";display:inline-block;font: 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transform:translate(0);margin-right:5px}.selectDestinataires.dialog-compose-espTravail[_ngcontent-%COMP%]   .icon-ed_personnel[_ngcontent-%COMP%], .selectDestinataires.dialog-compose-espTravail[_ngcontent-%COMP%]   .icon-ed_enseignant[_ngcontent-%COMP%], .selectDestinataires.dialog-compose-espTravail[_ngcontent-%COMP%]   .icon-ed_eleve[_ngcontent-%COMP%], .selectDestinataires.dialog-compose-espTravail[_ngcontent-%COMP%]   .icon-ed_famille[_ngcontent-%COMP%]{font-size:20px}']}),c})()}}]);