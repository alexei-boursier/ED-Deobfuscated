"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[9586],{48693:(Y,P,p)=>{p.d(P,{u:()=>H});var g=p(24006),r=p(45007),Z=p(77579),F=p(39646),O=p(78372),y=p(71884),v=p(82722),t=p(54004),M=p(28746),e=p(94650),D=p(20388),U=p(92635),T=p(36895),S=p(80125),I=p(93970),k=p(34414),x=p(34331),B=p(82945),J=p(4602);function R(l,u){if(1&l){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",8)(2,"input",30),e.NdJ("ngModelChange",function(i){e.CHM(n);const _=e.oxw();return e.KtG(_.isDisplayAllClasses=i)})("change",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.displayAllClasses())}),e.qZA(),e.TgZ(3,"label",31),e._uU(4," Afficher toutes les classes "),e.qZA()(),e._UZ(5,"div",11),e.BQk()}if(2&l){const n=e.oxw();e.xp6(2),e.Q6J("ngModel",n.isDisplayAllClasses),e.xp6(1),e.uIk("aria-label",n.isDisplayAllClasses?"Afficher seulement mes classes et mes groupes":"Afficher toutes les classes et tous les groupes de l'\xe9tablissement")}}function N(l,u){if(1&l&&(e.TgZ(0,"option",34),e._uU(1),e.qZA()),2&l){const n=u.$implicit;e.s9C("title",n.code),e.Q6J("ngValue",n),e.xp6(1),e.hij(" ",n.libelle," ")}}function L(l,u){if(1&l&&(e.TgZ(0,"optgroup",32),e.YNc(1,N,2,3,"option",33),e.ALo(2,"trackByProperty"),e.qZA()),2&l){const n=u.$implicit;e.s9C("label",n.etabLibelle),e.xp6(1),e.Q6J("ngForOf",n.classes)("ngForTrackBy",e.lcZ(2,3,"uniqueID"))}}function q(l,u){if(1&l&&(e.TgZ(0,"option",34),e._uU(1),e.qZA()),2&l){const n=u.$implicit;e.s9C("title",n.code),e.Q6J("ngValue",n),e.xp6(1),e.Oqu(n.libelle)}}function K(l,u){if(1&l&&(e.TgZ(0,"optgroup",35),e.YNc(1,q,2,3,"option",33),e.ALo(2,"trackByProperty"),e.qZA()),2&l){const n=e.oxw();e.xp6(1),e.Q6J("ngForOf",n.cg.groupes)("ngForTrackBy",e.lcZ(2,2,"uniqueID"))}}function Q(l,u){if(1&l&&(e.TgZ(0,"option",40),e._uU(1),e.qZA()),2&l){const n=u.$implicit;e.Q6J("value",n.code),e.xp6(1),e.Oqu(n.libelle)}}function m(l,u){if(1&l){const n=e.EpF();e.TgZ(0,"div",13)(1,"label",36),e._uU(2,"Mati\xe8re"),e.qZA(),e.TgZ(3,"select",37),e.NdJ("ngModelChange",function(i){e.CHM(n);const _=e.oxw();return e.KtG(_.searchMatiere=i)})("change",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.getContacts())}),e.TgZ(4,"option",38),e._uU(5,"S\xe9lectionnez une mati\xe8re"),e.qZA(),e.YNc(6,Q,2,2,"option",39),e.ALo(7,"trackByProperty"),e.qZA()()}if(2&l){const n=e.oxw();e.xp6(3),e.Q6J("ngModel",n.searchMatiere),e.xp6(3),e.Q6J("ngForOf",n.matieres)("ngForTrackBy",e.lcZ(7,3,"code"))}}function C(l,u){if(1&l){const n=e.EpF();e.TgZ(0,"div",41)(1,"input",42),e.NdJ("ngModelChange",function(i){const d=e.CHM(n).$implicit;return e.KtG(d.checked=i)})("change",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.getContacts())}),e.qZA(),e.TgZ(2,"label",43),e._uU(3),e.qZA()()}if(2&l){const n=u.$implicit;e.xp6(1),e.s9C("id",n.value),e.MGl("name","option",n.value,""),e.Q6J("ngModel",n.checked),e.xp6(1),e.s9C("for",n.value),e.uIk("aria-label",n.checked?"Enlever le filtre sur les "+n.name:"Filtrer sur les "+n.name),e.xp6(1),e.hij(" ",n.name," ")}}function o(l,u){if(1&l){const n=e.EpF();e.TgZ(0,"tr")(1,"th",47)(2,"div")(3,"label")(4,"input",48),e.NdJ("change",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.selectAll())})("ngModelChange",function(i){e.CHM(n);const _=e.oxw(2);return e.KtG(_.isSelectAll=i)}),e.qZA()()()(),e.TgZ(5,"th",49),e._uU(6,"\xc9l\xe8ve"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Responsables"),e.qZA(),e.TgZ(9,"th",50),e._uU(10,"Classe"),e.qZA(),e.TgZ(11,"th"),e._uU(12,"Responsable principal"),e.qZA(),e.TgZ(13,"th"),e._uU(14,"Autorit\xe9 parentale"),e.qZA(),e.TgZ(15,"th"),e._uU(16,"Autre"),e.qZA()()}if(2&l){const n=e.oxw(2);e.xp6(4),e.Q6J("ngModel",n.isSelectAll)}}function a(l,u){if(1&l&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&l){const n=u.$implicit;e.xp6(1),e.Oqu(n)}}function c(l,u){if(1&l&&e._UZ(0,"i",56),2&l){const n=e.oxw().item,s=e.oxw(2);e.uIk("aria-label",s.getLibelleResponsable(n)+" est responsable principal")}}function f(l,u){if(1&l&&e._UZ(0,"i",56),2&l){const n=e.oxw().item,s=e.oxw(2);e.uIk("aria-label",s.getLibelleResponsable(n)+" est autorit\xe9 principal")}}function E(l,u){if(1&l&&e._UZ(0,"i",56),2&l){const n=e.oxw().item,s=e.oxw(2);e.uIk("aria-label",s.getLibelleResponsable(n)+" a un autre lien avec l'\xe9l\xe8ve")}}const A=function(l){return{info:l}};function w(l,u){if(1&l){const n=e.EpF();e.TgZ(0,"tr",51),e.NdJ("click",function(i){const d=e.CHM(n).item,h=e.oxw(2);return e.KtG(h.selectDestinataire(d,i))}),e.TgZ(1,"td")(2,"div")(3,"label"),e._UZ(4,"input",52),e.ALo(5,"displayNom"),e.qZA()()(),e.TgZ(6,"td"),e._uU(7),e.ALo(8,"displayNom"),e.qZA(),e.TgZ(9,"td")(10,"ul"),e.YNc(11,a,2,1,"li",53),e.ALo(12,"trackByProperty"),e.qZA()(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td",54),e.YNc(16,c,1,1,"i",55),e.qZA(),e.TgZ(17,"td",54),e.YNc(18,f,1,1,"i",55),e.qZA(),e.TgZ(19,"td",54),e.YNc(20,E,1,1,"i",55),e.qZA()()}if(2&l){const n=u.item;e.Q6J("ngClass",e.VKq(17,A,n.isSelected)),e.xp6(4),e.Q6J("checked",n.isSelected),e.uIk("name","isSelected"+n.uniqID)("aria-label","S\xe9lectionner le destinataire "+e.lcZ(5,11,n)),e.xp6(3),e.Oqu(e.lcZ(8,13,n)),e.xp6(4),e.Q6J("ngForOf",n.responsable.contacts)("ngForTrackBy",e.lcZ(12,15,"id")),e.xp6(3),e.Oqu(n.classe.libelle),e.xp6(2),e.Q6J("ngIf","1"===n.responsable.typeResp),e.xp6(2),e.Q6J("ngIf","2"===n.responsable.typeResp),e.xp6(2),e.Q6J("ngIf","3"===n.responsable.typeResp)}}function j(l,u){if(1&l&&(e.TgZ(0,"ed-smart-table",44),e.YNc(1,o,17,1,"ng-template",45),e.YNc(2,w,21,19,"ng-template",46),e.qZA()),2&l){const n=e.oxw();e.Q6J("datas",n.listeFamillesSearch)("stNBItemsPagination",3)("pagination",!0)}}function G(l,u){if(1&l){const n=e.EpF();e.TgZ(0,"button",57),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.addListesContactsToMessage())}),e._uU(1),e.qZA()}if(2&l){const n=e.oxw();e.xp6(1),e.hij(" Ajouter ",1===n.getSelectionnes().length?"la personne s\xe9lectionn\xe9e":"les "+n.getSelectionnes().length+" personnes s\xe9lectionn\xe9es"," ")}}function $(l,u){1&l&&(e.TgZ(0,"div",58),e._uU(1,"Aucun contact trouv\xe9 !"),e.qZA())}let H=(()=>{class l extends((0,r.kCV)()){constructor(n,s,i,_,d,h,b,W){super(),this.authStore=n,this.etablissementStore=s,this.etablissementService=i,this.messagerieStore=_,this.messagerieService=d,this.modalRef=h,this.uiService=b,this.loaderService=W,this.onClose$=new Z.x,this.matieres=[],this.cg={classes:[],groupes:[]},this.isDisplayAllClasses=!1,this.onlyPresents=!1,this.searchClassesGroupes=[],this.searchMatiere="",this.listeFamilles=[],this.listeFamillesSearch=[],this.searchNom=new g.NI(""),this.searchCategorie=[{name:"Responsable",value:1,checked:!1},{name:"Autorit\xe9 parentale",value:2,checked:!1},{name:"Autres",value:3,checked:!1}]}ngOnInit(){this.parametrage=new r.aA2(this.messagerieStore.getMessagerieParametrage(this.authStore.variantForCurrentUser)),this.getClasses(),this.searchNom.valueChanges.pipe((0,O.b)(500),(0,y.x)(),(0,v.R)(this.componentDestroyed$)).subscribe(n=>this.getContacts())}ngOnDestroy(){return this.onClose$.complete(),super.ngOnDestroy()}getContacts(n=!1){const s=this.searchNom.value;this.authStore.isProfesseur()&&0===this.searchClassesGroupes.length&&!r.FSr.isNotEmptyString(this.searchMatiere,!0)&&!r.FSr.isNotEmptyString(s,!0)||!Array.isArray(this.searchClassesGroupes)&&!r.FSr.isNotEmptyString(s,!0)||(this.loader=this.loaderService.show(this),this.messagerieService.getFamillesContacts({idClasse:0,idGroupe:0,idMatiere:0,nom:s,codeMatiere:this.searchMatiere?this.searchMatiere:"",recupAll:this.isDisplayAllClasses?1:0,onlyPresents:this.onlyPresents?1:0},this.sourceModule,n).pipe((0,t.U)(i=>new r.b0J(i).contacts.edSortBy("nom")),(0,M.x)(()=>this.loaderService.hide(this))).subscribe({next:i=>{this.loadResultats(i,s),this.listeFamillesSearch.forEach(_=>{const d=this.listeFamilles.find(h=>_.id===h.id&&_.responsable.id===h.responsable.id);Object.isExists(d)&&(_.isSelected=d.isSelected)})},error:i=>this.uiService.notifyEvent(i.action,i.message,"Erreur","fa fa-envelope")}))}loadResultats(n,s){const i=Array.isArray(n)?n.map(_=>new r.iJ0(_)):[];if(this.searchClassesGroupes.length>0){const _=this.searchClassesGroupes.filter(h=>h.typeEntity===r.meW.CLASSE).edPluckFlatten("id"),d=this.searchClassesGroupes.filter(h=>h.typeEntity===r.meW.GROUPE).edPluckFlatten("id");n=(n=n.filter(h=>_.findIndex(b=>b===h.classe.id)>-1)).concat(i.filter(h=>h.groupes?.edPluckFlatten("id").edIntersect(d).length>0))}if(this.searchCategorie.some(_=>_.checked)){const _=this.searchCategorie.filter(d=>d.checked).edPluck("value");n=n.filter(d=>_.indexOf(+d.responsable.typeResp)>-1)}if(r.FSr.isNotEmptyString(s,!0)){r.dR7.calculateDiacriticsMap();const _=new RegExp(`${r.dR7.replaceDiacritics(s)}`,"mi");n=n.filter(d=>r.dR7.replaceDiacritics(d.prenom).search(_)>-1||r.dR7.replaceDiacritics(d.nom).search(_)>-1)}this.isSelectAll=!1,this.listeFamillesSearch=Array.isArray(n)?n.map(_=>new r.iJ0(_)):[]}getClasses(){this.loader=this.loaderService.show(this),(!0===this.isDisplayAllClasses||this.authStore.isProfesseur()&&this.sourceModule===r.lFO.ESPACE_DE_TRAVAIL?this.etablissementService.getNiveauxListeAll():(0,F.of)(this.etablissementStore.snapshot)).pipe((0,M.x)(()=>this.loaderService.hide(this))).subscribe(s=>{this.cg=this.getCGForMenu(s),this.matieres=this.listeMatieres([...this.cg.classes.edPluck("classes").edFlatten(),...this.cg.groupes])})}getCGForMenu(n){if(!Object.isExists(this.authStore.currentUser))return{classes:[],groupes:[]};const s=r.uKw.getProfClassesGroupesTree(n),i=s.classes.edUniq("uniqueID").edSortBy("etabLibelle"),_=s.groupes.edUniq("uniqueID").edSortBy("libelle");return i.reduce((d,h)=>{const b=d.classes.findIndex(W=>h.etabLibelle===W.etabLibelle);return b>-1?d.classes[b].classes.push(h):d.classes.push({etabLibelle:h.etabLibelle,classes:[h]}),d},{classes:[],groupes:_})}displayAllClasses(){this.getClasses(),this.getContacts()}refresh(){this.getContacts(!0)}selectAll(){this.listeFamillesSearch.forEach(n=>{n.isSelected=!0===this.isSelectAll;const s=this.listeFamilles.find(i=>n.id===i.id&&n.responsable.id===i.responsable.id);Object.isExists(s)?s.isSelected=!0===this.isSelectAll:this.listeFamilles.push(new r.iJ0(n))})}listeMatieres(n){let s=[];for(const i of n){let _=i.periodes.edPluckFlatten("matieres").edUniq("code");_=_.filter(d=>""===d.codeSSMatiere),s=s.concat(_)}return s.edUniq("code")}oneIsSelected(){return Object.isExists(this.listeFamilles)&&this.listeFamilles.some(n=>!0===n.isSelected)}addListesContactsToMessage(){const n=this.getSelectionnes().map(s=>(s.to_cc_cci=this.toCcCci,s.type=r.dcH.FAMILLE_RESPONSABLE,s));this.onClose$.next(n),this.close()}getSelectionnes(){return this.listeFamilles.filter(n=>!0===n.isSelected)}getLibelleResponsable(n){let s="";for(const i of n.responsable.contacts)s+=i+" ";return s.trim()}close(){this.modalRef.hide()}selectDestinataire(n,s){s.stopPropagation(),n.isSelected=!n.isSelected;const i=this.listeFamilles.find(_=>n.id===_.id&&n.responsable.id===_.responsable.id);Object.isExists(i)?i.isSelected=!i.isSelected:this.listeFamilles.push(new r.iJ0(n))}}return l.\u0275fac=function(n){return new(n||l)(e.Y36(r.CnD),e.Y36(r.VD2),e.Y36(r.Xmb),e.Y36(r.q0O),e.Y36(r.KRh),e.Y36(D.UZ),e.Y36(r.VLf),e.Y36(U.S))},l.\u0275cmp=e.Xpm({type:l,selectors:[["ed-compose-selection-famille-eag"]],inputs:{toCcCci:"toCcCci",sourceModule:"sourceModule"},features:[e.qOj],decls:42,vars:19,consts:[[1,"modal-header"],[1,"modal-title"],["title","Rafra\xeechir les contacts","type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body","selectDestinataires",3,"ngBusy"],["name","selectDestinataires","novalidate",""],["for","nom",1,"form-label"],[1,"form-check","float-end"],["type","checkbox","name","onlyPresents","id","onlyPresents",1,"form-check-input",3,"ngModel","ngModelChange","change"],["for","onlyPresents",1,"form-check-label","fw-normal"],[1,"clearfix"],["name","nom","id","nom","type","search","edAutofocus","",1,"form-control","floating-label",3,"formControl"],[1,"mt-2"],["for","classeByEtab",1,"form-label"],[4,"ngIf"],["name","classeByEtab","id","classeByEtab","multiple","",1,"form-control","form-select",3,"ngModel","ngModelChange","change"],["disabled","",3,"ngValue"],[3,"label",4,"ngFor","ngForOf","ngForTrackBy"],["label","Groupes",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"mt-3"],["class","form-check form-check-inline",4,"ngFor","ngForOf","ngForTrackBy"],["role","separator",1,"margin-top-10"],[3,"datas","stNBItemsPagination","pagination",4,"ngIf","ngIfElse"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["class","btn btn-primary float-end","type","button",3,"click",4,"ngIf"],["nolistescontacts",""],["type","checkbox","name","selectAllClasses","id","selectAllClasses",1,"form-check-input",3,"ngModel","ngModelChange","change"],["for","selectAllClasses",1,"form-check-label","fw-normal"],[3,"label"],[3,"ngValue","title",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngValue","title"],["label","Groupes"],["for","matiere",1,"form-label"],["id","matiere","name","searchMatiere",1,"form-control","form-select",3,"ngModel","ngModelChange","change"],["value",""],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[3,"value"],[1,"form-check","form-check-inline"],["type","checkbox",1,"form-check-input",3,"id","name","ngModel","ngModelChange","change"],[1,"form-check-label","fw-normal",3,"for"],[3,"datas","stNBItemsPagination","pagination"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],[1,"col-lg-1"],["type","checkbox","name","isSelectAll",1,"form-check-input",3,"ngModel","change","ngModelChange"],["stSort","nom",1,"cliquable","sortable-header"],["stSort","classe.libelle",1,"cliquable","sortable-header"],[1,"cliquable","text-center",3,"ngClass","click"],["type","checkbox",1,"form-check-input",3,"checked"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-center"],["class","fa fa-check",4,"ngIf"],[1,"fa","fa-check"],["type","button",1,"btn","btn-primary","float-end",3,"click"],[1,"alert","alert-dark"]],template:function(n,s){if(1&n&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2," Recherchez des familles "),e.TgZ(3,"button",2),e.NdJ("click",function(){return s.refresh()}),e._UZ(4,"i",3),e.qZA()(),e.TgZ(5,"button",4),e.NdJ("click",function(){return s.close()}),e.qZA()(),e.TgZ(6,"div",5)(7,"form",6)(8,"div")(9,"label",7),e._uU(10,"Nom de l'\xe9l\xe8ve"),e.qZA(),e.TgZ(11,"div",8)(12,"input",9),e.NdJ("ngModelChange",function(_){return s.onlyPresents=_})("change",function(){return s.getContacts(!0)}),e.qZA(),e.TgZ(13,"label",10),e._uU(14,"Uniquement les pr\xe9sents"),e.qZA()(),e._UZ(15,"div",11)(16,"input",12),e.qZA(),e.TgZ(17,"div",13)(18,"label",14),e._uU(19,"Classe"),e.qZA(),e.YNc(20,R,6,2,"ng-container",15),e.TgZ(21,"select",16),e.NdJ("ngModelChange",function(_){return s.searchClassesGroupes=_})("change",function(){return s.getContacts()}),e.TgZ(22,"option",17),e._uU(23,"S\xe9lectionnez une classe"),e.qZA(),e.YNc(24,L,3,5,"optgroup",18),e.ALo(25,"trackByProperty"),e.YNc(26,K,3,4,"optgroup",19),e.qZA()(),e.YNc(27,m,8,5,"div",20),e.TgZ(28,"div",21),e.YNc(29,C,4,6,"div",22),e.ALo(30,"trackByProperty"),e.qZA(),e._UZ(31,"hr",23),e.TgZ(32,"h3"),e._uU(33,"S\xe9lectionnez des familles"),e.qZA(),e.YNc(34,j,3,3,"ed-smart-table",24),e.qZA()(),e.TgZ(35,"div",25)(36,"div",26)(37,"button",27),e.NdJ("click",function(){return s.close()}),e._uU(38,"Fermer"),e.qZA(),e.YNc(39,G,2,1,"button",28),e.qZA()(),e.YNc(40,$,2,0,"ng-template",null,29,e.W1O)),2&n){const i=e.MAs(41);e.xp6(6),e.Q6J("ngBusy",s.loader),e.xp6(6),e.Q6J("ngModel",s.onlyPresents),e.xp6(4),e.Q6J("formControl",s.searchNom),e.xp6(4),e.Q6J("ngIf",s.parametrage.afficherToutesLesClasses),e.xp6(1),e.Q6J("ngModel",s.searchClassesGroupes),e.xp6(1),e.Q6J("ngValue",null),e.xp6(2),e.Q6J("ngForOf",s.cg.classes)("ngForTrackBy",e.lcZ(25,15,"$index")),e.xp6(2),e.Q6J("ngIf",s.cg.groupes.length),e.xp6(1),e.Q6J("ngIf",s.authStore.isProfesseur()&&!s.isDisplayAllClasses),e.xp6(2),e.Q6J("ngForOf",s.searchCategorie)("ngForTrackBy",e.lcZ(30,17,"$index")),e.xp6(5),e.Q6J("ngIf",s.listeFamillesSearch.length)("ngIfElse",i),e.xp6(5),e.Q6J("ngIf",s.oneIsSelected())}},dependencies:[T.mk,T.sg,T.O5,g._Y,g.YN,g.Kr,g.Fj,g.Wl,g.EJ,g.K7,g.JJ,g.JL,g.On,g.F,g.oH,S.DC,I.L,k.c,x.r,x.w,B.U,r.$t3,J.$],styles:['.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .sortable-header[_ngcontent-%COMP%]:before{content:"\\f0dc";display:inline-block;font: 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transform:translate(0);margin-right:5px}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   optgroup[_ngcontent-%COMP%]{color:var(--light-primary-color)}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   optgroup[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{color:initial}.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   select[name=classeByEtab][_ngcontent-%COMP%]{height:150px}']}),l})()},94024:(Y,P,p)=>{p.d(P,{w:()=>Q});var g=p(24006),r=p(45007),Z=p(77579),F=p(78372),O=p(71884),y=p(82722),v=p(54004),t=p(94650),M=p(20388),e=p(36895),D=p(80125),U=p(93970),T=p(34414),S=p(34331),I=p(82945),k=p(4602);function x(m,C){1&m&&(t.TgZ(0,"option",22),t._uU(1,"Aucune fonction disponible"),t.qZA())}function B(m,C){if(1&m&&(t.TgZ(0,"option",12),t._uU(1),t.qZA()),2&m){const o=C.$implicit;t.Q6J("ngValue",o),t.xp6(1),t.Oqu(o.libelle)}}function J(m,C){if(1&m){const o=t.EpF();t.TgZ(0,"tr")(1,"th",26)(2,"div")(3,"label")(4,"input",27),t.NdJ("change",function(){t.CHM(o);const c=t.oxw(2);return t.KtG(c.selectAll())})("ngModelChange",function(c){t.CHM(o);const f=t.oxw(2);return t.KtG(f.isSelectAll=c)}),t.qZA()()()(),t.TgZ(5,"th",28),t._uU(6,"Nom"),t.qZA(),t.TgZ(7,"th",29),t._uU(8,"Fonction"),t.qZA()()}if(2&m){const o=t.oxw(2);t.xp6(4),t.Q6J("ngModel",o.isSelectAll)}}const R=function(m){return{info:m}};function N(m,C){if(1&m){const o=t.EpF();t.TgZ(0,"tr",30),t.NdJ("click",function(c){const E=t.CHM(o).item,A=t.oxw(2);return t.KtG(A.selectDestinataire(E,c))}),t.TgZ(1,"td",31)(2,"div")(3,"label"),t._UZ(4,"input",32),t.ALo(5,"displayNom"),t.qZA()()(),t.TgZ(6,"td",33),t._uU(7),t.ALo(8,"displayNom"),t.qZA(),t.TgZ(9,"td",33),t._uU(10),t.qZA()()}if(2&m){const o=C.item,a=t.oxw(2);t.Q6J("ngClass",t.VKq(13,R,o.isSelected)),t.xp6(4),t.Q6J("checked",o.isSelected),t.uIk("name","isSelected"+o.uniqID)("aria-label","S\xe9lectionner le destinataire "+t.lcZ(5,6,o)),t.xp6(3),t.Oqu(t.gM2(8,8,o,!0,!0,a.authStore.isFouE())),t.xp6(3),t.Oqu(o.fonction.libelle)}}function L(m,C){if(1&m&&(t.TgZ(0,"ed-smart-table",23),t.YNc(1,J,9,1,"ng-template",24),t.YNc(2,N,11,15,"ng-template",25),t.qZA()),2&m){const o=t.oxw();t.Q6J("datas",o.listePersonnelsSearch)("stNBItemsPagination",3)("pagination",!0)}}function q(m,C){if(1&m){const o=t.EpF();t.TgZ(0,"button",34),t.NdJ("click",function(){t.CHM(o);const c=t.oxw();return t.KtG(c.addListesContactsToMessage())}),t._uU(1),t.qZA()}if(2&m){const o=t.oxw();t.xp6(1),t.hij(" Ajouter ",1===o.getSelectionnes().length?"la personne s\xe9lectionn\xe9e":"les "+o.getSelectionnes().length+" personnes s\xe9lectionn\xe9es"," ")}}function K(m,C){1&m&&(t.TgZ(0,"div",35),t._uU(1,"Aucun contact trouv\xe9 !"),t.qZA())}let Q=(()=>{class m extends((0,r.kCV)()){constructor(o,a,c,f){super(),this.authStore=o,this.messagerieService=a,this.modalRef=c,this.uiService=f,this.onClose$=new Z.x,this.fonctions=[],this.listePersonnels=[],this.listePersonnelsSearch=[],this.searchNom=new g.NI("")}ngAfterViewInit(){this.refresh(!1),this.searchNom.valueChanges.pipe((0,F.b)(500),(0,O.x)(),(0,y.R)(this.componentDestroyed$)).subscribe(o=>this.refresh())}ngOnDestroy(){return this.onClose$.complete(),super.ngOnDestroy()}refresh(o=!0){const a=this.searchNom.value;this.promiseContents=this.messagerieService.getPersonnelsContacts(this.sourceModule,o).pipe((0,v.U)(c=>new r.b0J(c).contacts)).subscribe({next:c=>{this.loadResultats(c,a),this.fonctions=this.listeFonctions(c),this.listePersonnelsSearch.forEach(f=>{const E=this.listePersonnels.find(A=>f.uniqID===A.uniqID);Object.isExists(E)&&(f.isSelected=E.isSelected)})},error:c=>this.uiService.notifyEvent(c.action,c.message,"Erreur","fa fa-envelope")})}loadResultats(o,a){if(this.searchFonction&&this.searchFonction.id>0&&(o=o.filter(c=>c.fonction.id===this.searchFonction.id)),r.FSr.isNotEmptyString(a,!0)){r.dR7.calculateDiacriticsMap();const c=new RegExp(`${r.dR7.replaceDiacritics(a)}`,"mi");o=o.filter(f=>r.dR7.replaceDiacritics(f.prenom).search(c)>-1||r.dR7.replaceDiacritics(f.nom).search(c)>-1)}this.listePersonnelsSearch=Array.isArray(o)?o.map(c=>new r.iJ0(c)):[],this.isSelectAll=!1}listeFonctions(o){return o.edPluckFlatten("fonction").edUniq("libelle").edSortBy("libelle").filter(a=>""!==a.libelle)}selectAll(){this.listePersonnelsSearch.forEach(o=>{o.isSelected=!0===this.isSelectAll;const a=this.listePersonnels.find(c=>o.uniqID===c.uniqID);Object.isExists(a)?a.isSelected=!0===this.isSelectAll:this.listePersonnels.push(new r.iJ0(o))})}oneIsSelected(){return Object.isExists(this.listePersonnels)&&this.listePersonnels.some(o=>!0===o.isSelected)}addListesContactsToMessage(){const o=this.getSelectionnes().map(a=>(a.to_cc_cci=this.toCcCci,a));this.onClose$.next(o),this.close()}getSelectionnes(){return this.listePersonnels.filter(o=>!0===o.isSelected)}close(){this.modalRef.hide()}selectDestinataire(o,a){a.stopPropagation(),o.isSelected=!o.isSelected;const c=this.listePersonnels.find(f=>o.uniqID===f.uniqID);Object.isExists(c)?c.isSelected=!c.isSelected:this.listePersonnels.push(new r.iJ0(o))}compareFonction(o,a){return Object.isExists(o)&&Object.isExists(a)&&(o===a||o.id===a.id)||!Object.isExists(o)&&!Object.isExists(a)}}return m.\u0275fac=function(o){return new(o||m)(t.Y36(r.CnD),t.Y36(r.KRh),t.Y36(M.UZ),t.Y36(r.VLf))},m.\u0275cmp=t.Xpm({type:m,selectors:[["ed-compose-selection-personnel-eag"]],inputs:{toCcCci:"toCcCci",sourceModule:"sourceModule"},features:[t.qOj],decls:32,vars:13,consts:[[1,"modal-header"],[1,"modal-title"],["title","Rafra\xeechir les contacts","type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body","selectDestinataires",3,"ngBusy"],["name","selectDestinataires","novalidate",""],["aria-label","Saisissez le nom du personnel \xe0 rechercher","for","nom",1,"form-label"],["name","nom","id","nom","type","search","edAutofocus","",1,"form-control","floating-label",3,"formControl"],[1,"mt-2"],["for","selectFonction",1,"form-label"],["name","fonction","id","selectFonction",1,"form-control","form-select",3,"ngModel","compareWith","ngModelChange","change"],[3,"ngValue"],["disabled","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf","ngForTrackBy"],["role","separator",1,"margin-top-10"],[3,"datas","stNBItemsPagination","pagination",4,"ngIf","ngIfElse"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["class","btn btn-primary float-end","type","button",3,"click",4,"ngIf"],["nolistescontacts",""],["disabled",""],[3,"datas","stNBItemsPagination","pagination"],["edSmartTableHeaderTmp",""],["edSmartTableBodyTmp",""],[1,"col-lg-1"],["type","checkbox","name","isSelectAll",1,"form-check-input",3,"ngModel","change","ngModelChange"],["stSort","nom",1,"cliquable","sortable-header"],["stSort","fonction.libelle",1,"cliquable","sortable-header"],[1,"cliquable","text-center",3,"ngClass","click"],[1,"col-lg-1","vert-align"],["type","checkbox",1,"form-check-input",3,"checked"],[1,"vert-align"],["type","button",1,"btn","btn-primary","float-end",3,"click"],[1,"alert","alert-dark"]],template:function(o,a){if(1&o&&(t.TgZ(0,"div",0)(1,"h3",1),t._uU(2," Recherchez des personnels "),t.TgZ(3,"button",2),t.NdJ("click",function(){return a.refresh()}),t._UZ(4,"i",3),t.qZA()(),t.TgZ(5,"button",4),t.NdJ("click",function(){return a.close()}),t.qZA()(),t.TgZ(6,"div",5)(7,"form",6)(8,"div")(9,"label",7),t._uU(10,"Nom"),t.qZA(),t._UZ(11,"input",8),t.qZA(),t.TgZ(12,"div",9)(13,"label",10),t._uU(14,"Fonction"),t.qZA(),t.TgZ(15,"select",11),t.NdJ("ngModelChange",function(f){return a.searchFonction=f})("change",function(){return a.refresh()}),t.TgZ(16,"option",12),t._uU(17,"S\xe9lectionnez une fonction"),t.qZA(),t.YNc(18,x,2,0,"option",13),t.YNc(19,B,2,2,"option",14),t.ALo(20,"trackByProperty"),t.qZA()(),t._UZ(21,"hr",15),t.TgZ(22,"h3"),t._uU(23,"S\xe9lectionnez des personnels"),t.qZA(),t.YNc(24,L,3,3,"ed-smart-table",16),t.qZA()(),t.TgZ(25,"div",17)(26,"div",18)(27,"button",19),t.NdJ("click",function(){return a.close()}),t._uU(28,"Fermer"),t.qZA(),t.YNc(29,q,2,1,"button",20),t.qZA()(),t.YNc(30,K,2,0,"ng-template",null,21,t.W1O)),2&o){const c=t.MAs(31);t.xp6(6),t.Q6J("ngBusy",a.promiseContents),t.xp6(5),t.Q6J("formControl",a.searchNom),t.xp6(4),t.Q6J("ngModel",a.searchFonction)("compareWith",a.compareFonction),t.xp6(1),t.Q6J("ngValue",null),t.xp6(2),t.Q6J("ngIf",0===a.fonctions.length),t.xp6(1),t.Q6J("ngForOf",a.fonctions)("ngForTrackBy",t.lcZ(20,11,"id")),t.xp6(5),t.Q6J("ngIf",a.listePersonnelsSearch.length)("ngIfElse",c),t.xp6(5),t.Q6J("ngIf",a.oneIsSelected())}},dependencies:[e.mk,e.sg,e.O5,g._Y,g.YN,g.Kr,g.Fj,g.Wl,g.EJ,g.JJ,g.JL,g.On,g.F,g.oH,D.DC,U.L,T.c,S.r,S.w,I.U,r.$t3,k.$],styles:['.selectDestinataires[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .sortable-header[_ngcontent-%COMP%]:before{content:"\\f0dc";display:inline-block;font: 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;transform:translate(0);margin-right:5px}']}),m})()}}]);