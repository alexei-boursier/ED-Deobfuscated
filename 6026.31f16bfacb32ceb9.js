"use strict";(self.webpackChunked_web=self.webpackChunked_web||[]).push([[6026],{46026:(xi,$,u)=>{u.r($),u.d($,{QCMModule:()=>bi});var ue=u(99658),de=u(38804),M=u(95715),me=u(27574),c=u(45007),U=u(60515),D=u(39646),C=u(95698),F=u(39300),Z=u(63900),x=u(18505),y=u(28746),T=u(70262),P=u(54004),Y=u(77579),k=u(11302),K=u(34813),e=u(94650),g=u(20388),m=u(36895),l=u(24006),A=u(4358),j=u(91752),b=u(80125),pe=u(48536),q=u(4602);function _e(o,s){1&o&&e._UZ(0,"i",17)}function ge(o,s){1&o&&e._UZ(0,"i",18)}function he(o,s){1&o&&e._UZ(0,"i",19)}function fe(o,s){1&o&&e._UZ(0,"i",20)}const qe=function(o){return{"proposition-success":o}};function Ce(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",7)(1,"button",8),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.checkOrNot(r))}),e.YNc(2,_e,1,0,"i",9),e.YNc(3,ge,1,0,"i",10),e.YNc(4,he,1,0,"i",11),e.YNc(5,fe,1,0,"i",12),e.qZA(),e.TgZ(6,"div",13)(7,"input",14),e.NdJ("ngModelChange",function(i){const a=e.CHM(t).$implicit;return e.KtG(a.enonceDecode=i)})("ngModelChange",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.checkErrors())}),e.qZA()(),e.TgZ(8,"button",15),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.removeProposition(r))}),e._UZ(9,"i",16),e.qZA()()}if(2&o){const t=s.$implicit,n=s.index,i=e.oxw();e.Q6J("ngClass",e.VKq(7,qe,!0===t.valide)),e.xp6(2),e.Q6J("ngIf",i.question.typeQ===i.questionBaseType.radio.id&&!0!==t.valide),e.xp6(1),e.Q6J("ngIf",i.question.typeQ===i.questionBaseType.radio.id&&!0===t.valide),e.xp6(1),e.Q6J("ngIf",i.question.typeQ===i.questionBaseType.checkbox.id&&!0!==t.valide),e.xp6(1),e.Q6J("ngIf",i.question.typeQ===i.questionBaseType.checkbox.id&&!0===t.valide),e.xp6(2),e.MGl("name","proposition",n,""),e.Q6J("ngModel",t.enonceDecode)}}function ve(o,s){1&o&&e._UZ(0,"i",21)}function be(o,s){1&o&&e._UZ(0,"i",22)}function Qe(o,s){1&o&&(e.TgZ(0,"span",23),e._uU(1," Vous devez s\xe9lectionner les bonnes r\xe9ponses pour le correctif (1 seule pour un choix unique !).\n"),e.qZA())}function xe(o,s){1&o&&(e.TgZ(0,"span",23),e._uU(1,"Vous devez saisir un texte pour chaque proposition."),e.qZA())}let Te=(()=>{class o{constructor(){this.questionBaseType=c.xq9}ngOnChanges(t){t.question&&this.checkErrors()}checkErrors(){this.validateHasEnoughGoodPropositions(),this.validateHasEnoughGoodPropositionsRequired()}removeFormError(t,n){t.hasError(n)&&(delete t.errors[n],t.updateValueAndValidity())}addFormError(t,n){t.hasError(n)||t.setErrors({...t.errors,[n]:!0},{emitEvent:!0})}validateHasEnoughGoodPropositions(){const t=this.question.propositions.filter(n=>n.valide).length;0===t||t>this.max?this.addFormError(this.errorChamp.control,"hasEnoughGoodPropositions"):this.removeFormError(this.errorChamp.control,"hasEnoughGoodPropositions")}validateHasEnoughGoodPropositionsRequired(){this.question.propositions.filter(n=>!c.FSr.isNotEmptyString(n.enonceDecode,!0)).length>0?this.addFormError(this.errorChamp.control,"hasEnoughGoodPropositionsRequired"):this.removeFormError(this.errorChamp.control,"hasEnoughGoodPropositionsRequired")}checkOrNot(t){t.valide=!Object.isExists(t.valide)||!t.valide,this.checkErrors()}removeProposition(t){const n=this.question.propositions.indexOf(t);-1!==n&&(this.question.propositions.splice(n,1),this.checkErrors())}addNewProposition(){this.question.propositions.push(new c.Iil),this.checkErrors()}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-question-type-choice"]],inputs:{question:"question",idQCM:"idQCM",max:"max",errorChamp:"errorChamp"},features:[e.TTD],decls:10,vars:8,consts:[["class","question-proposition",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"question-proposition","add-new-question-proposition"],[1,"question-proposition-type-indicator"],["class","fa fa-fw fa-circle-thin","aria-label","ic\xf4ne question avec choix unique",4,"ngIf"],["class","fa fa-fw fa-square-o","aria-label","ic\xf4ne question avec choix multiple",4,"ngIf"],["type","button",1,"btn","active","no-background","no-padding",3,"click"],["class","text-danger",4,"ngIf"],[1,"question-proposition",3,"ngClass"],["type","button",1,"question-proposition-type-indicator","btn","active","no-background","no-padding",3,"click"],["class","fa fa-fw fa-circle-thin","aria-label","ic\xf4ne proposition pour question choix unique incorrecte",4,"ngIf"],["class","fa fa-fw fa-check-circle-o","aria-label","ic\xf4ne proposition pour question choix unique correcte",4,"ngIf"],["class","fa fa-fw fa-square-o","aria-label","ic\xf4ne proposition pour question choix multiple incorrecte",4,"ngIf"],["class","fa fa-fw fa-check-square-o","aria-label","ic\xf4ne proposition pour question choix multiple correcte",4,"ngIf"],[1,"form-control-wrapper"],["type","text","maxlength","2000","required","",1,"form-control","circle",3,"name","ngModel","ngModelChange"],["type","button","title","Supprimer la proposition",1,"btn","btn-secondary","proposition-remove",3,"click"],["aria-hidden","true",1,"fa","fa-close"],["aria-label","ic\xf4ne proposition pour question choix unique incorrecte",1,"fa","fa-fw","fa-circle-thin"],["aria-label","ic\xf4ne proposition pour question choix unique correcte",1,"fa","fa-fw","fa-check-circle-o"],["aria-label","ic\xf4ne proposition pour question choix multiple incorrecte",1,"fa","fa-fw","fa-square-o"],["aria-label","ic\xf4ne proposition pour question choix multiple correcte",1,"fa","fa-fw","fa-check-square-o"],["aria-label","ic\xf4ne question avec choix unique",1,"fa","fa-fw","fa-circle-thin"],["aria-label","ic\xf4ne question avec choix multiple",1,"fa","fa-fw","fa-square-o"],[1,"text-danger"]],template:function(t,n){1&t&&(e.YNc(0,Ce,10,9,"div",0),e.ALo(1,"trackByProperty"),e.TgZ(2,"div",1)(3,"div",2),e.YNc(4,ve,1,0,"i",3),e.YNc(5,be,1,0,"i",4),e.qZA(),e.TgZ(6,"button",5),e.NdJ("click",function(){return n.addNewProposition()}),e._uU(7,"cliquez ici pour ajouter une proposition"),e.qZA()(),e.YNc(8,Qe,2,0,"span",6),e.YNc(9,xe,2,0,"span",6)),2&t&&(e.Q6J("ngForOf",n.question.propositions)("ngForTrackBy",e.lcZ(1,6,"id")),e.xp6(4),e.Q6J("ngIf",n.question.typeQ===n.questionBaseType.radio.id),e.xp6(1),e.Q6J("ngIf",n.question.typeQ===n.questionBaseType.checkbox.id),e.xp6(3),e.Q6J("ngIf",null==n.errorChamp||null==n.errorChamp.errors?null:n.errorChamp.errors.hasEnoughGoodPropositions),e.xp6(1),e.Q6J("ngIf",null==n.errorChamp||null==n.errorChamp.errors?null:n.errorChamp.errors.hasEnoughGoodPropositionsRequired))},dependencies:[m.mk,m.sg,m.O5,l.Fj,l.JJ,l.Q7,l.nD,l.On,q.$],styles:[".question-proposition[_ngcontent-%COMP%]{margin-top:4px}.question-proposition.proposition-success[_ngcontent-%COMP%]{color:#0f9d58}.question-proposition.proposition-success[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-color:#0f9d58}.question-proposition[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:18px}.question-proposition[_ngcontent-%COMP%]   .question-proposition-type-indicator[_ngcontent-%COMP%]{display:inline-block;margin-right:5px;cursor:pointer}.question-proposition[_ngcontent-%COMP%]   .form-control-wrapper[_ngcontent-%COMP%]{display:inline-block;width:300px}.question-proposition[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]{border:none;padding:6px;opacity:.5}.question-proposition[_ngcontent-%COMP%]   .btn.btn-secondary[_ngcontent-%COMP%]:hover{opacity:1}.question-proposition[_ngcontent-%COMP%]   .proposition-remove[_ngcontent-%COMP%]{color:red}.question-proposition.add-new-question-proposition[_ngcontent-%COMP%]{opacity:.5;margin-bottom:5px}.question-proposition.add-new-question-proposition[_ngcontent-%COMP%]   .question-proposition-type-indicator[_ngcontent-%COMP%]{cursor:default}.question-proposition.add-new-question-proposition[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:inline-block;cursor:pointer;border:1px dashed #757575;width:300px;height:28px;padding:2px 5px 0;font-size:14px}"],changeDetection:0}),o})();var Q=u(52497),z=u(81058),Me=u(74344);function Ze(o,s){if(1&o&&(e.TgZ(0,"span",13),e._uU(1),e.qZA()),2&o){const t=s.error;e.xp6(1),e.Oqu(t)}}let ye=(()=>{class o{constructor(t,n,i){this.modalService=t,this.modalRef=n,this.fb=i,this.title="Les propositions",this.label="Saisissez les diff\xe9rentes valeurs"}ngOnInit(){let t=[];c.FSr.isNotEmptyString(this.trou,!0)&&(t=this.trou.trim().split("|").map(n=>n.trim())),this.promptForm=this.fb.group({tags:[t]})}okFn(){this.modalService.setDismissReason(JSON.stringify({reason:Q.G.validation,data:this.promptForm.value})),this.modalRef.hide()}cancelFn(){this.modalService.setDismissReason(JSON.stringify({reason:Q.G.cancel})),this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.tT),e.Y36(g.UZ),e.Y36(l.qu))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-prompt-modal"]],inputs:{trou:"trou",title:"title",label:"label"},decls:17,vars:7,consts:[["novalidate","",3,"formGroup","ngSubmit"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body"],["for","mots",1,"form-label"],["formControlName","tags","id","mots",3,"maxTagLength","maxNumberOfTags"],[3,"control"],["valError","message"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","submit",1,"btn","btn-primary","float-end",3,"disabled"],[1,"form-text","text-danger"]],template:function(t,n){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return n.okFn()}),e.TgZ(1,"div",1)(2,"h3",2),e._uU(3),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return n.modalRef.hide()}),e.qZA()(),e.TgZ(5,"div",4)(6,"label",5),e._uU(7),e.qZA(),e._UZ(8,"ed-input-tags",6),e.TgZ(9,"val-errors",7),e.YNc(10,Ze,2,1,"ng-template",8),e.qZA()(),e.TgZ(11,"div",9)(12,"div",10)(13,"button",11),e.NdJ("click",function(){return n.cancelFn()}),e._uU(14,"Annuler"),e.qZA(),e.TgZ(15,"button",12),e._uU(16,"Valider"),e.qZA()()()()),2&t&&(e.Q6J("formGroup",n.promptForm),e.xp6(3),e.Oqu(n.title),e.xp6(4),e.Oqu(n.label),e.xp6(1),e.Q6J("maxTagLength",100)("maxNumberOfTags",40),e.xp6(1),e.Q6J("control",n.promptForm.controls.tags),e.xp6(6),e.Q6J("disabled",!n.promptForm.valid))},dependencies:[l._Y,l.JJ,l.JL,l.sg,l.u,z.tM,z.HY,Me.$],encapsulation:2}),o})();var Ae=u(7574);let Ee=(()=>{class o{constructor(t){this.elementRef=t}static processValue(t){const i=(t||"").trim();return"<br>"===i||"<br/>"===i||"<br />"===i?{newValue:"",hasChanged:!0}:{hasChanged:!1}}validateHasTextehole(){const t=this.elementRef.nativeElement,n=t.querySelectorAll("strong"),i=t.querySelectorAll("b");n.length+i.length>0?this.errorChamp.control.hasError("hasTexthole")&&(delete this.errorChamp.control.errors.hasTexthole,this.errorChamp.control.updateValueAndValidity()):this.errorChamp.control.setErrors({...this.errorChamp.errors,hasTexthole:!0},{emitEvent:!0})}onInput(){if(this.stripBr){const n=o.processValue(this.elementRef.nativeElement.innerHTML);n.hasChanged&&(this.elementRef.nativeElement.innerHTML=n.newValue)}this.validateHasTextehole()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.SBq))},o.\u0275dir=e.lG2({type:o,selectors:[["","edTextholeEditable","","ngModel",""]],hostBindings:function(t,n){1&t&&e.NdJ("input",function(){return n.onInput()})},inputs:{stripBr:"stripBr",errorChamp:"errorChamp"}}),o})();function Se(o,s){1&o&&(e.TgZ(0,"span",8),e._uU(1,"Vous devez avoir au moins une variable !"),e.qZA())}const X=function(o){return{"has-error":o}};function we(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"button",3),e.NdJ("click",function(i){const a=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.formatDoc(i,a.id))}),e.TgZ(3,"span",4),e._uU(4,"\xa0"),e.qZA()()(),e.TgZ(5,"div",5),e.NdJ("ngModelChange",function(i){const a=e.CHM(t).$implicit;return e.KtG(a.enonceDecode=i)}),e.qZA(),e.YNc(6,Se,2,0,"span",6),e.TgZ(7,"span",7),e._uU(8," S\xe9lectionnez le texte \xe0 masquer et cliquez sur le bouton "),e.TgZ(9,"span",4),e._uU(10,"\xa0"),e.qZA(),e._uU(11," pour en faire une variable. Cliquez \xe0 nouveau pour le supprimer. "),e._UZ(12,"br"),e._uU(13," Vous pouvez avoir plusieurs variables. Chaque valeur s\xe9lectionn\xe9e servira alors de "),e.TgZ(14,"b"),e._uU(15,"correctif"),e.qZA(),e._uU(16," pour la variable correspondante. "),e._UZ(17,"br"),e._uU(18," Une variable peut contenir plusieurs mots qui correspondent "),e.TgZ(19,"b"),e._uU(20,"aux diff\xe9rentes solutions acceptables"),e.qZA(),e._uU(21," pour cette variable. Ces mots sont s\xe9par\xe9s par le caract\xe8re "),e.TgZ(22,"b"),e._uU(23,"|"),e.qZA(),e._uU(24," . "),e._UZ(25,"br"),e._uU(26," Il suffit d\xe8s lors \xe0 l'\xe9l\xe8ve de saisir un de ces mots pour avoir juste \xe0 cette variable ! "),e.qZA()()}if(2&o){const t=s.$implicit,n=e.oxw();e.xp6(1),e.Tol(e.VKq(9,X,null==n.errorChamp?null:n.errorChamp.invalid)),e.xp6(4),e.MGl("id","textholesBox-",t.id,"")("name","textholesBox-",t.id,""),e.Q6J("ngClass",e.VKq(11,X,null==n.errorChamp?null:n.errorChamp.invalid))("stripBr",!0)("errorChamp",n.errorChamp)("ngModel",t.enonceDecode),e.xp6(1),e.Q6J("ngIf",null==n.errorChamp||null==n.errorChamp.errors?null:n.errorChamp.errors.hasTexthole)}}let Ue=(()=>{class o{constructor(t){this.modalService=t}ngOnChanges(t){t.question&&(0===this.question.propositions.length?this.question.propositions.push(new c.Iil):this.question.propositions.length>1&&(this.question.propositions.length=1),this.updateTextHoles())}updateTextHoles(){this.question.propositions.forEach(t=>{c.FSr.isNotEmptyString(t.correctifDecode,!0)||(t.correctifDecode=""),c.FSr.isNotEmptyString(t.enonceDecode,!0)||(t.enonceDecode=""),""!==t.enonceDecode&&(t.enonceDecode=t.correctifDecode.split(c.IZV).reduce((n,i,r)=>n.replace(`${c.IZV}${r}`,`<b>${i}</b>`),t.enonceDecode))})}formatDoc(t,n){t.preventDefault();const i=document.getSelection(),r=i.toString();if(!c.FSr.isNotEmptyString(r,!0))return;let a=!0;const d=i?i.anchorNode:null;if(d){const p=d.parentNode,_=p?p.nodeName:"";c.FSr.isNotEmptyString(_)&&("b"===_.toLowerCase()||"strong"===_.toLowerCase())&&(a=!1)}if(document.execCommand("bold",!1,null),a){const p=[];if(i.rangeCount)for(let _=0,f=i.rangeCount;_<f;++_)p.push(i.getRangeAt(_));this.promptTagsModal(n,r,p)}else{const p=document.getElementById("textholesBox-"+n);p&&setTimeout(()=>p.focus(),0)}}promptTagsModal(t,n,i){this.modalService.show(ye,{id:this.modalService.getModalsCount()+1,initialState:{trou:n,title:"Les propositions valides",label:"Saisissez les diff\xe9rentes propositions qui sont valident pour la variable s\xe9lectionn\xe9e"}}),this.modalService.onHide.pipe((0,C.q)(1),(0,x.b)(r=>{const a=JSON.parse(r);if(a.reason===Q.G.validation&&a.data&&Array.isArray(a.data.tags)){const d=a.data.tags.map(_=>_.trim()).join("|"),p=document.getSelection();if(p){p.removeAllRanges();for(let f=0,v=i.length;f<v;++f)p.addRange(i[f]);document.execCommand("insertText",!1,d);const _=document.getElementById("textholesBox-"+t);_&&setTimeout(()=>_.focus(),0)}}})).subscribe()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.tT))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-question-type-textholes"]],inputs:{question:"question",idQCM:"idQCM",errorChamp:"errorChamp"},features:[e.TTD],decls:2,vars:4,consts:[["class","question-proposition",4,"ngFor","ngForOf","ngForTrackBy"],[1,"question-proposition"],["id","toolBarBox"],["title","Texte s\xe9lectionn\xe9 vers variable","type","button",1,"btn","btn-sm",3,"click"],[1,"cke_button_icon","cke_button__hiddenfield_icon"],["editable","true","unformattedPaste","","propValueAccessor","innerHTML","edTextholeEditable","",1,"textBox",3,"ngClass","id","name","stripBr","errorChamp","ngModel","ngModelChange"],["class","text-danger",4,"ngIf"],[1,"form-text"],[1,"text-danger"]],template:function(t,n){1&t&&(e.YNc(0,we,27,13,"div",0),e.ALo(1,"trackByProperty")),2&t&&e.Q6J("ngForOf",n.question.propositions)("ngForTrackBy",e.lcZ(1,2,"id"))},dependencies:[m.mk,m.sg,m.O5,l.JJ,l.On,Ae.m,Ee,q.$],styles:[".question-proposition[_ngcontent-%COMP%]   #toolBarBox[_ngcontent-%COMP%]{border:1px solid #b6b6b6;border-bottom:none;padding:6px 8px 2px;white-space:normal;box-shadow:0 1px #fff inset;background:#cfd1cf linear-gradient(to bottom,var(--menu-hover-color),#cfd1cf)}.question-proposition[_ngcontent-%COMP%]   #toolBarBox[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:1px solid #a6a6a6;border-bottom-color:#979797;border-radius:3px;box-shadow:0 1px #ffffff80,0 0 2px #ffffff26 inset,0 1px #ffffff26 inset;background:#e4e4e4 linear-gradient(to bottom,#fff,#e4e4e4)}.question-proposition[_ngcontent-%COMP%]   #toolBarBox[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{box-shadow:0 0 1px #0000004d inset;background:var(--dark-placeholder-color) linear-gradient(to bottom,#f2f2f2,var(--dark-placeholder-color))}.question-proposition[_ngcontent-%COMP%]   #toolBarBox.has-error[_ngcontent-%COMP%]{border-color:var(--secondary-color)}.question-proposition[_ngcontent-%COMP%]   .textBox[_ngcontent-%COMP%]{resize:vertical;overflow:auto;height:150px;border:1px solid #b6b6b6;padding:10px}.question-proposition[_ngcontent-%COMP%]   .textBox[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .question-proposition[_ngcontent-%COMP%]   .textBox[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{background-color:var(--dark-placeholder-color);border:1px grey dashed;padding:2px;line-height:2}.question-proposition[_ngcontent-%COMP%]   .textBox[_ngcontent-%COMP%]:focus{border-color:#66afe9;outline:0;box-shadow:inset 0 1px 1px #00000013,0 0 8px #66afe999}.question-proposition[_ngcontent-%COMP%]   .textBox.has-error[_ngcontent-%COMP%]{border-color:var(--secondary-color);box-shadow:inset 0 1px 1px #00000013,0 0 6px #ce8483}.question-proposition[_ngcontent-%COMP%]   .form-text[_ngcontent-%COMP%]   .cke_button_icon[_ngcontent-%COMP%]{float:none}"],changeDetection:0}),o})();const ke=["editQuestionForm"];function Je(o,s){1&o&&(e.TgZ(0,"alert",43)(1,"strong"),e._uU(2,"Attention !"),e.qZA(),e._uU(3," Certains champs ne sont pas renseign\xe9s ou sont incorrects "),e.qZA()),2&o&&e.Q6J("dismissible",!0)}function Ne(o,s){1&o&&(e.TgZ(0,"span",44),e._uU(1,"Saisissez une question !"),e.qZA())}function Fe(o,s){1&o&&(e.TgZ(0,"div",9)(1,"span",16),e._uU(2,"Vous devez d'abord sauvegarder la question avant d'ajouter un son."),e.qZA()())}function Oe(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",9)(1,"ed-input-files",45),e.NdJ("successUpload",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.onUploadSuccess(i))})("removedFile",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onRemovedSuccess())}),e.qZA(),e.TgZ(2,"span",16),e._uU(3,"Ce son compl\xe8te votre question et l'\xe9nonc\xe9. Utilisez un format compatible .mp3, .ogg ou .wav pour de la lecture en streaming."),e.qZA(),e._UZ(4,"span",46),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("dropzoneConfig",t.dropZoneConfig)("config",t.inputFilesConfig)}}function De(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",9),e._uU(1),e.TgZ(2,"button",47),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.deleteFile())}),e._UZ(3,"i",48),e.qZA(),e.TgZ(4,"span",16),e._uU(5,"Ce son accompagne la question."),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.hij(" ",t.question.titreSon," ")}}function Pe(o,s){if(1&o&&(e.TgZ(0,"option",49),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.Q6J("ngValue",t.id),e.xp6(1),e.Oqu(t.libelle)}}function Ie(o,s){1&o&&(e.TgZ(0,"span",44),e._uU(1,"Choisissez un type de question !"),e.qZA())}function Ye(o,s){if(1&o&&e._UZ(0,"ed-question-type-choice",50),2&o){const t=e.oxw(),n=e.MAs(35);e.Q6J("question",t.question)("idQCM",t.idQCM)("max",1)("errorChamp",n)}}function Be(o,s){if(1&o&&e._UZ(0,"ed-question-type-choice",50),2&o){const t=e.oxw(),n=e.MAs(35);e.Q6J("question",t.question)("idQCM",t.idQCM)("max",1e3)("errorChamp",n)}}function Re(o,s){if(1&o&&e._UZ(0,"ed-question-type-textholes",51),2&o){const t=e.oxw(),n=e.MAs(35);e.Q6J("question",t.question)("idQCM",t.idQCM)("errorChamp",n)}}const W=function(o){return{"has-error":o}};let Le=(()=>{class o{constructor(t,n,i,r){this.modalService=t,this.modalRef=n,this.qcmService=i,this.uiService=r,this.onClose$=new Y.x,this.encours=!1,this.sonUpdated=!1,this.processingFiles=0,this.dropZoneConfig={parallelUploads:1,previewsContainer:!1,url:`${(0,k.Je)()}/televersement.awp?verbe=post&mode=${c.qt_.QCM}`,timeout:3e6,maxFilesize:10,maxFiles:1,acceptedFiles:"audio/mpeg, audio/aac, audio/ogg, audio/mp3, audio/vnd.wav, audio/x-wav, audio/wav, audio/wave",dictInvalidFileType:"Vous pouvez envoyer uniquement des fichiers audios ayant l'extension <strong>.wav</strong>, <strong>.aac</strong>, <strong>.ogg</strong> et <strong>.mp3</strong>",processing:()=>this.processingEvent(),queuecomplete:()=>this.completeEvent()},this.inputFilesConfig={fromCloudEnabled:!1,keepComplete:!0,mode:"QCM",dropzoneContainer:"#container-question-manage"},this.questionBaseType={...c.xq9},delete this.questionBaseType.textarea}ngOnInit(){this.pageTitre=this.question.id>0?"Modifier la question":"Nouvelle question",this.question.questionDecode=c.FSr.isNotEmptyString(this.question.question)?c.YC.base64decode(this.question.question):"",this.question.enonceDecode=c.FSr.isNotEmptyString(this.question.enonce)?c.YC.base64decode(this.question.enonce):"",this.question.remediationDecode=c.FSr.isNotEmptyString(this.question.remediation)?c.YC.base64decode(this.question.remediation):"",this.question.propositions.forEach(t=>{t.enonceDecode=c.FSr.isNotEmptyString(t.enonce)?c.YC.base64decode(t.enonce):"",t.correctifDecode=c.FSr.isNotEmptyString(t.correctif)?c.YC.base64decode(t.correctif):""})}ngOnDestroy(){this.onClose$.complete()}onCKReady(t){(0,k.UZ)(t)}onSubmit(){if(this.formQuestion.valid&&!this.encours){if(this.encours=!0,this.question.questionDecode.length>1572864||this.question.enonceDecode.length>1572864||this.question.remediationDecode.length>1572864)return this.uiService.notifyEvent(c.DOJ.genericError,"Enregistrement impossible. Votre saisie est trop grande (>1.5Mo).","Erreur","icon-ed_qcm"),void(this.encours=!1);const t=new c.cmE(this.question);switch(t.question=c.YC.base64encode(t.questionDecode),t.enonce=c.YC.base64encode(t.enonceDecode),t.remediation=c.YC.base64encode(t.remediationDecode),delete t.questionDecode,delete t.enonceDecode,delete t.remediationDecode,t.typeQ){case c.xq9.radio.id:case c.xq9.checkbox.id:t.propositions.forEach(n=>{n.enonce=c.YC.base64encode(n.enonceDecode),delete n.enonceDecode,delete n.correctifDecode,n.correctif=""});break;case c.xq9.textholes.id:t.propositions.forEach(n=>{let i=n.enonceDecode.replace(/<strong>(.*?)<\/strong>/gi,"<b>$1</b>").replace(/<b>(.*?)<\/b>/gi,"<b>$1</b>").replace(/&nbsp;/gi," ");const r=i.match(/<b>(.*?)<\/b>/g),a=r.map((d,p)=>(i=i.replace(r[p],`${c.IZV}${p}`),d.replace(/<\/?b[^>]*>/g,"").trim()));n.enonce=c.YC.base64encode(i),n.correctif=c.YC.base64encode(a.join(c.IZV)),delete n.enonceDecode,delete n.correctifDecode,n.valide=!0});break;default:this.encours=!1}if(!this.encours)return void this.uiService.notifyEvent(c.DOJ.genericError,"Enregistrement impossible. Vous n'avez pas choisi le type de question.","Erreur","icon-ed_qcm");this.loader=this.qcmService.saveQuestion(this.idQCM,t).pipe((0,y.x)(()=>this.encours=!1)).subscribe({next:n=>{t.id=n.id>0?n.id:t.id,t.srcSon=n.srcSon,this.uiService.notifyEvent(c.DOJ.genericSuccess,"La question a bien \xe9t\xe9 enregistr\xe9e.","QCM","icon-ed_qcm"),this.close({question:t,sonUpdated:this.sonUpdated})},error:n=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de l'enregistrement de la question.","Erreur","icon-ed_qcm")})}}processingEvent(){this.processingFiles++}completeEvent(){this.processingFiles=0}onUploadSuccess(t){this.encours=!0;const n=new c.eD9(t),i=new c.cmE(this.question);i.uncSon=n.unc,i.titreSon=n.libelle,i.srcSon="",this.loader=this.qcmService.updateQuestionSon(this.idQCM,i).pipe((0,y.x)(()=>this.encours=!1)).subscribe({next:r=>{this.question.srcSon=r.srcSon,this.question.uncSon=i.uncSon,this.question.titreSon=i.titreSon,this.sonUpdated=!0,this.uiService.notifyEvent(c.DOJ.genericSuccess,"Le son a bien \xe9t\xe9 ajout\xe9. Sauvegardez vos modifications avant de fermer la fen\xeatre.","QCM","icon-ed_qcm")},error:r=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de l'ajout du son.","Erreur","icon-ed_qcm")})}onRemovedSuccess(){this.processingFiles=0,this.question.srcSon="",this.question.uncSon="",this.question.titreSon="",this.sonUpdated=!0,this.formQuestion.form.markAsDirty()}deleteFile(){this.encours=!0,this.loader=this.qcmService.supprimerQuestionSon(this.idQCM,this.question).pipe((0,y.x)(()=>this.encours=!1)).subscribe({next:t=>{this.onRemovedSuccess(),this.uiService.notifyEvent(c.DOJ.genericSuccess,"Le son a bien \xe9t\xe9 supprim\xe9. Sauvegardez vos modifications avant de fermer la fen\xeatre.","QCM","icon-ed_qcm")},error:t=>this.uiService.notifyEvent(String(t.status),t.message,"Erreur","icon-ed_qcm")})}resetErrors(){Object.isExists(this.formQuestion.errors)&&Object.keys(this.formQuestion.errors).forEach(t=>{switch(this.question.typeQ){case c.xq9.radio.id:case c.xq9.checkbox.id:"hasTexthole"===t&&this.formQuestion.form.controls.typeQ.setErrors({...this.formQuestion.form.controls.typeQ.errors,hasTexthole:!0});break;case c.xq9.textholes.id:"hasEnoughGoodPropositions"===t&&this.formQuestion.form.controls.typeQ.setErrors({...this.formQuestion.form.controls.typeQ.errors,hasEnoughGoodPropositions:!0}),"hasEnoughGoodPropositionsRequired"===t&&this.formQuestion.form.controls.typeQ.setErrors({...this.formQuestion.form.controls.typeQ.errors,hasEnoughGoodPropositionsRequired:!0})}})}openCKFormula(){const t={id:this.modalService.getModalsCount()+1,initialState:{title:"Aide \xe0 la saisie",close:"Fermer",message:"<p>Pour int\xe9grer une formule dans la proposition (choix unique ou multiples uniquement), entourez-l\xe0 par <b>#</b> de part et d'autre. Exemple : <b>#</b>x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}<b>#</b></p>"}};this.modalService.show(K.z,t)}close(t){Object.isExists(t)?this.onClose$.next(t):!0===this.sonUpdated&&this.onClose$.next({question:void 0,sonUpdated:this.sonUpdated}),this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.tT),e.Y36(g.UZ),e.Y36(c.Jqz),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-question-manage"]],viewQuery:function(t,n){if(1&t&&e.Gf(ke,5),2&t){let i;e.iGM(i=e.CRH())&&(n.formQuestion=i.first)}},inputs:{ckConf:"ckConf",idQCM:"idQCM",question:"question"},decls:70,vars:32,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],["id","container-question-manage",1,"modal-body","dropzone-container",3,"ngBusy"],["name","editQuestionForm","novalidate","",1,"row",3,"ngSubmit"],["editQuestionForm","ngForm"],["type","danger",3,"dismissible",4,"ngIf"],[1,"row","required",3,"ngClass"],["for","questionDecode",1,"col-md-2","col-form-label"],[1,"col-md-10"],["name","questionDecode","type","text","id","questionDecode","maxlength","2000","required","",1,"form-control",3,"ngModel","ngModelChange"],["questionDecode","ngModel"],["class","text-danger",4,"ngIf"],[1,"row"],["for","enonceDecode",1,"col-md-2","col-form-label"],["id","enonceDecode","name","enonceDecode",3,"config","ngModel","ready","ngModelChange"],[1,"form-text"],[1,"col-md-2","col-form-label"],["aria-hidden","true",1,"fa","fa-file-audio-o"],["class","col-md-10",4,"ngIf"],["for","typeQ",1,"col-md-2","col-form-label"],[1,"input-group"],["name","typeQ","id","typeQ","required","",1,"form-control","form-select",3,"ngModel","ngModelChange","change"],["typeQ","ngModel"],["value",""],[3,"ngValue",4,"ngFor","ngForOf","ngForTrackBy"],[1,"input-group-text","input-group-md","no-background"],["type","button","title","Comment ins\xe9rer une formule math\xe9matique",1,"btn","btn-secondary","no-background",3,"click"],["aria-hidden","true",1,"fa","fa-question-circle"],[1,"row",3,"ngSwitch"],[1,"offset-md-2","col-md-10"],[3,"question","idQCM","max","errorChamp",4,"ngSwitchCase"],[3,"question","idQCM","errorChamp",4,"ngSwitchCase"],[1,"offset-md-2","col-md-6"],[1,"form-check"],["name","aleatoire","type","checkbox","id","checkPropositionsAleatoires",1,"form-check-input",3,"ngModel","ngModelChange"],["for","checkPropositionsAleatoires",1,"form-check-label"],["for","remediationDecode",1,"col-md-2","col-form-label"],["id","remediationDecode","name","remediationDecode",3,"config","ngModel","ready","ngModelChange"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","button",1,"btn","btn-success","float-end",3,"disabled","click"],["type","danger",3,"dismissible"],[1,"text-danger"],[3,"dropzoneConfig","config","successUpload","removedFile"],[1,"clearfix"],["title","Supprimer le fichier audio","type","button",1,"btn","btn-sm","btn-danger-color",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o"],[3,"ngValue"],[3,"question","idQCM","max","errorChamp"],[3,"question","idQCM","errorChamp"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(4,"div",3)(5,"form",4,5),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.YNc(7,Je,4,1,"alert",6),e.TgZ(8,"div",7)(9,"label",8),e._uU(10,"Question"),e.qZA(),e.TgZ(11,"div",9)(12,"input",10,11),e.NdJ("ngModelChange",function(r){return n.question.questionDecode=r}),e.qZA(),e.YNc(14,Ne,2,0,"span",12),e.qZA()(),e.TgZ(15,"div",13)(16,"label",14),e._uU(17,"Enonc\xe9"),e.qZA(),e.TgZ(18,"div",9)(19,"ckeditor",15),e.NdJ("ready",function(r){return n.onCKReady(r)})("ngModelChange",function(r){return n.question.enonceDecode=r}),e.qZA(),e.TgZ(20,"span",16),e._uU(21,"Ce texte sera affich\xe9 en dessous de la question."),e.qZA()()(),e.TgZ(22,"div",13)(23,"strong",17),e._UZ(24,"i",18),e._uU(25," Son "),e.qZA(),e.YNc(26,Fe,3,0,"div",19),e.YNc(27,Oe,5,2,"div",19),e.YNc(28,De,6,1,"div",19),e.qZA(),e.TgZ(29,"div",7)(30,"label",20),e._uU(31,"Type de question"),e.qZA(),e.TgZ(32,"div",9)(33,"div",21)(34,"select",22,23),e.NdJ("ngModelChange",function(r){return n.question.typeQ=r})("change",function(){return n.resetErrors()}),e._UZ(36,"option",24),e.YNc(37,Pe,2,2,"option",25),e.ALo(38,"values"),e.ALo(39,"trackByProperty"),e.qZA(),e.TgZ(40,"span",26)(41,"button",27),e.NdJ("click",function(){return n.openCKFormula()}),e._UZ(42,"i",28),e.qZA()()(),e.YNc(43,Ie,2,0,"span",12),e.qZA()(),e.TgZ(44,"div",29)(45,"div",30),e.YNc(46,Ye,1,4,"ed-question-type-choice",31),e.YNc(47,Be,1,4,"ed-question-type-choice",31),e.YNc(48,Re,1,3,"ed-question-type-textholes",32),e.qZA()(),e.TgZ(49,"div",13)(50,"div",33)(51,"div",34)(52,"input",35),e.NdJ("ngModelChange",function(r){return n.question.aleatoire=r}),e.qZA(),e.TgZ(53,"label",36),e._uU(54,"Propositions affich\xe9es al\xe9atoirement"),e.qZA(),e.TgZ(55,"span",16),e._uU(56,"Si coch\xe9, l'ordre sera diff\xe9rent pour chaque participant (uniquement pour les questions \xe0 choix multiple / unique)."),e.qZA()()()(),e.TgZ(57,"div",13)(58,"label",37),e._uU(59,"Commentaire de rem\xe9diation"),e.qZA(),e.TgZ(60,"div",9)(61,"ckeditor",38),e.NdJ("ready",function(r){return n.onCKReady(r)})("ngModelChange",function(r){return n.question.remediationDecode=r}),e.qZA(),e.TgZ(62,"span",16),e._uU(63,"Ce texte sera affich\xe9 lors de la correction, en cas de mauvaise r\xe9ponse."),e.qZA()()()()(),e.TgZ(64,"div",39)(65,"div",40)(66,"button",41),e.NdJ("click",function(){return n.close()}),e._uU(67,"Annuler"),e.qZA(),e.TgZ(68,"button",42),e.NdJ("click",function(){return n.formQuestion.ngSubmit.emit()}),e._uU(69," Sauvegarder "),e.qZA()()()),2&t){const i=e.MAs(6),r=e.MAs(13),a=e.MAs(35);e.xp6(2),e.Oqu(n.pageTitre),e.xp6(2),e.Q6J("ngBusy",n.loader),e.xp6(3),e.Q6J("ngIf",i.submitted&&i.invalid),e.xp6(1),e.Q6J("ngClass",e.VKq(28,W,r.invalid)),e.xp6(4),e.Q6J("ngModel",n.question.questionDecode),e.xp6(2),e.Q6J("ngIf",null==r.errors?null:r.errors.required),e.xp6(5),e.Q6J("config",n.ckConf)("ngModel",n.question.enonceDecode),e.xp6(7),e.Q6J("ngIf",0===n.question.id),e.xp6(1),e.Q6J("ngIf",!n.question.uncSon&&n.question.id>0),e.xp6(1),e.Q6J("ngIf",n.question.uncSon),e.xp6(1),e.Q6J("ngClass",e.VKq(30,W,a.invalid)),e.xp6(5),e.Q6J("ngModel",n.question.typeQ),e.xp6(3),e.Q6J("ngForOf",e.lcZ(38,24,n.questionBaseType))("ngForTrackBy",e.lcZ(39,26,"id")),e.xp6(6),e.Q6J("ngIf",null==a.errors?null:a.errors.required),e.xp6(1),e.Q6J("ngSwitch",n.question.typeQ),e.xp6(2),e.Q6J("ngSwitchCase",n.questionBaseType.radio.id),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.checkbox.id),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.textholes.id),e.xp6(4),e.Q6J("ngModel",n.question.aleatoire),e.xp6(9),e.Q6J("config",n.ckConf)("ngModel",n.question.remediationDecode),e.xp6(7),e.Q6J("disabled",(null==i?null:i.invalid)||n.processingFiles>0)}},dependencies:[m.mk,m.sg,m.O5,m.RF,m.n9,l._Y,l.YN,l.Kr,l.Fj,l.Wl,l.EJ,l.JJ,l.JL,l.Q7,l.nD,l.On,l.F,A.wx,j.u,b.DC,pe.s,Te,Ue,c.gLd,q.$],styles:['.required[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]:after{content:"*";color:red;padding-left:5px}']}),o})();var E=u(87192),B=u(82722),ee=u(70655);let h=class extends c.yh4{constructor(s,t){super(t),this.authStore=s,this.devTool=t,this.etiquettesSelected=new l.NI(void 0)}updateStore(s,t,n,i){const r=c.$ej.edDBUserSpecificKey(s,t,n);this.store=new c.SnS({variantDefault:r,typeUser:t,idUser:n,choosenAnnee:i})}updateEtiquettes(s){if(Array.isArray(s)||void 0===s)this.etiquettesSelected.setValue(s);else{let t=Array.isArray(this.etiquettesSelected.value)?[...this.etiquettesSelected.value]:[];const n=t.indexOf(s);n>-1?t.splice(n,1):t.unshift(s),0===t.length&&(t=void 0),this.etiquettesSelected.setValue(t)}}deleteEtiquette(s){let t=Array.isArray(this.etiquettesSelected.value)?[...this.etiquettesSelected.value]:[];t=t.filter(n=>s!==n),0===t.length&&(t=void 0),this.etiquettesSelected.setValue(t)}updateChoosenAnnee(s){this.store=new c.SnS({...this.snapshot,choosenAnnee:s})}isActif(s){return Array.isArray(this.etiquettesSelected.value)&&this.etiquettesSelected.value.indexOf(s)>-1}getAnneesQCMsArchive(){return this.authStore.getAnneesArchive(3)}selectChoosenAnnee(){return this.select$(s=>s.choosenAnnee)}selectEtiquettes(){return this.etiquettesSelected.valueChanges}reset(){this.etiquettesSelected.setValue(void 0),super.reset()}};function He(o,s){1&o&&(e.TgZ(0,"alert",13),e._uU(1,"Aucun questionnaire disponible"),e.qZA())}function Ge(o,s){if(1&o&&(e.TgZ(0,"option",18),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.Q6J("ngValue",t.id),e.xp6(1),e.Oqu(t.titre)}}function Ve(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",14)(1,"label",15),e._uU(2,"Questionnaires"),e.qZA(),e.TgZ(3,"div",16)(4,"select",17),e.NdJ("ngModelChange",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.choosedId=i)}),e._UZ(5,"option",18),e.YNc(6,Ge,2,2,"option",19),e.ALo(7,"trackByProperty"),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(4),e.Q6J("ngModel",t.choosedId),e.xp6(1),e.Q6J("ngValue",0),e.xp6(1),e.Q6J("ngForOf",t.qcms)("ngForTrackBy",e.lcZ(7,4,"id"))}}function $e(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t),e.oxw();const i=e.MAs(9);return e.KtG(i.ngSubmit.emit())}),e._uU(1,"Choisir ce questionnaire"),e.qZA()}}h.\u0275fac=function(s){return new(s||h)(e.LFG(c.CnD),e.LFG(c.lbX))},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac}),h=(0,ee.gn)([(0,c.pcA)({classInstanceRef:c.SnS,resetWhenSwipe:!0,className:"QcmUserStore"})],h);let Ke=(()=>{class o extends((0,c.kCV)()){constructor(t,n,i,r,a){super(),this.qcmService=t,this.qcmStore=n,this.qcmUserStore=i,this.modalRef=r,this.uiService=a,this.onClose$=new Y.x}ngOnInit(){this.loader=this.qcmService.getQCMs(this.qcmUserStore.snapshot.choosenAnnee,!0).pipe((0,T.K)(t=>this.uiService.notifyErrorThenEmpty(t,!0,"Erreur","icon-ed_qcm"))).subscribe(),this.qcmStore.selectAllQCMs(this.qcmUserStore.snapshot.choosenAnnee).pipe((0,x.b)(t=>{this.qcms=Object.isExists(t)?t.qcms.filter(n=>this.idQCM!==n.id&&!(n.evaluations.length>0||n.travauxafaire.length>0)):[]}),(0,B.R)(this.componentDestroyed$)).subscribe()}ngOnDestroy(){return this.onClose$.complete(),super.ngOnDestroy()}onSubmit(){this.onClose$.next(this.choosedId),this.close()}close(){this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.Jqz),e.Y36(c.W$X),e.Y36(h),e.Y36(g.UZ),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-clone-question"]],inputs:{idQCM:"idQCM"},features:[e.qOj],decls:17,vars:4,consts:[[1,"modal-header"],[1,"modal-title"],[1,"form-text","modal-subtitle"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body",3,"ngBusy"],["name","cloneQForm","novalidate","",1,"row",3,"ngSubmit"],["cloneQForm","ngForm"],["type","warning",4,"ngIf"],["class","row",4,"ngIf"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["class","btn btn-success float-end","type","button",3,"click",4,"ngIf"],["type","warning"],[1,"row"],["for","choosedId",1,"col-md-2","col-form-label"],[1,"col-md-10"],["name","choosedId","id","choosedId",1,"form-control","form-select",3,"ngModel","ngModelChange"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"btn","btn-success","float-end",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div")(2,"h3",1),e._uU(3,"Choisir le questionnaire o\xf9 dupliquer la question"),e.qZA(),e.TgZ(4,"span",2),e._uU(5,"Seuls les questionnaires non encore associ\xe9s sont disponibles ici."),e.qZA()(),e.TgZ(6,"button",3),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(7,"div",4)(8,"form",5,6),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.YNc(10,He,2,0,"alert",7),e.YNc(11,Ve,8,6,"div",8),e.qZA()(),e.TgZ(12,"div",9)(13,"div",10)(14,"button",11),e.NdJ("click",function(){return n.close()}),e._uU(15,"Annuler"),e.qZA(),e.YNc(16,$e,2,0,"button",12),e.qZA()()),2&t&&(e.xp6(7),e.Q6J("ngBusy",n.loader),e.xp6(3),e.Q6J("ngIf",!n.qcms||0===n.qcms.length),e.xp6(1),e.Q6J("ngIf",n.qcms&&n.qcms.length>0),e.xp6(5),e.Q6J("ngIf",!n.qcms||n.qcms.length>0))},dependencies:[m.sg,m.O5,l._Y,l.YN,l.Kr,l.EJ,l.JJ,l.JL,l.On,l.F,A.wx,b.DC,q.$],encapsulation:2}),o})();var R=u(92635),je=u(73219);let ze=(()=>{class o{constructor(){this.manageQuestion=new e.vpe}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-questions-globals-actions"]],inputs:{id:"id"},outputs:{manageQuestion:"manageQuestion"},decls:12,vars:1,consts:[[1,"float-start"],[1,"list-inline"],[1,"list-inline-item","me-4","mb-2"],[1,"btn-group"],["type","button","routerLink","../../","title","Retour \xe0 mon QCM",1,"btn","btn-secondary",3,"fragment"],["aria-hidden","true",1,"fa","fa-arrow-left"],[1,"list-inline-item","mb-2"],["type","button","title","Nouvelle question",1,"btn","btn-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-plus"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"ul",1)(2,"li",2)(3,"div",3)(4,"button",4),e._UZ(5,"i",5),e._uU(6," Retour \xe0 mon QCM "),e.qZA()()(),e.TgZ(7,"li",6)(8,"div",3)(9,"button",7),e.NdJ("click",function(){return n.manageQuestion.emit()}),e._UZ(10,"i",8),e._uU(11," Nouvelle question "),e.qZA()()()()()),2&t&&(e.xp6(4),e.MGl("fragment","qcm_",n.id,""))},dependencies:[M.rH],encapsulation:2,changeDetection:0}),o})();var te=u(99533);function Xe(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.moveDown.emit())}),e._UZ(1,"i",12),e.qZA()}}function We(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.moveUp.emit())}),e._UZ(1,"i",14),e.qZA()}}let et=(()=>{class o{constructor(){this.manageQuestion=new e.vpe,this.moveDown=new e.vpe,this.moveUp=new e.vpe,this.cloneQuestion=new e.vpe,this.cloneQuestionIci=new e.vpe,this.deleteQuestion=new e.vpe}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-une-question-actions"]],inputs:{isFirst:"isFirst",isLast:"isLast"},outputs:{manageQuestion:"manageQuestion",moveDown:"moveDown",moveUp:"moveUp",cloneQuestion:"cloneQuestion",cloneQuestionIci:"cloneQuestionIci",deleteQuestion:"deleteQuestion"},decls:11,vars:2,consts:[[1,"une-question-actions"],["title","Modifier la question","type","button",1,"btn","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-pencil"],["class","btn btn-sm","title","D\xe9placer vers le bas","type","button",3,"click",4,"ngIf"],["class","btn btn-sm","title","D\xe9placer vers le haut","type","button",3,"click",4,"ngIf"],["title","Dupliquer la question ici","type","button",1,"btn","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-clipboard"],["title","Dupliquer la question sur un autre questionnaire","type","button",1,"btn","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-clone"],["title","Supprimer la question","type","button",1,"btn","btn-sm","btn-danger-color",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o"],["title","D\xe9placer vers le bas","type","button",1,"btn","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-chevron-down"],["title","D\xe9placer vers le haut","type","button",1,"btn","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-chevron-up"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return n.manageQuestion.emit()}),e._UZ(2,"i",2),e.qZA(),e.YNc(3,Xe,2,0,"button",3),e.YNc(4,We,2,0,"button",4),e.TgZ(5,"button",5),e.NdJ("click",function(){return n.cloneQuestionIci.emit()}),e._UZ(6,"i",6),e.qZA(),e.TgZ(7,"button",7),e.NdJ("click",function(){return n.cloneQuestion.emit()}),e._UZ(8,"i",8),e.qZA(),e.TgZ(9,"button",9),e.NdJ("click",function(){return n.deleteQuestion.emit()}),e._UZ(10,"i",10),e.qZA()()),2&t&&(e.xp6(3),e.Q6J("ngIf",!n.isLast),e.xp6(1),e.Q6J("ngIf",!n.isFirst))},dependencies:[m.O5],encapsulation:2,changeDetection:0}),o})();var ne=u(39653),oe=u(88246),ie=u(19293),se=u(67451);function tt(o,s){if(1&o&&(e._UZ(0,"div",9),e.ALo(1,"filterHtml"),e.ALo(2,"base64")),2&o){const t=e.oxw();e.Q6J("innerHTML",e.lcZ(1,2,e.lcZ(2,4,t.question.enonce)),e.oJD)("content",t.question.enonce)}}function nt(o,s){if(1&o&&(e.TgZ(0,"figcaption"),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Oqu(t.question.titreSon)}}function ot(o,s){if(1&o&&(e.TgZ(0,"figure"),e.YNc(1,nt,2,1,"figcaption",3),e.TgZ(2,"audio",10),e.ALo(3,"safe"),e._uU(4," Votre navigateur ne supporte pas le format "),e.TgZ(5,"code"),e._uU(6,"audio"),e.qZA(),e._uU(7," utilis\xe9. "),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.question.titreSon),e.xp6(1),e.Q6J("src",e.xi3(3,3,t.question.srcSon,"url"),e.LSH),e.uIk("id","audio"+t.question.id)}}const it=function(o){return{"proposition-success radio-success":o}};function st(o,s){if(1&o&&(e.TgZ(0,"div",13),e._UZ(1,"input",14),e.TgZ(2,"label",15),e._UZ(3,"span",16),e.ALo(4,"filterHtml"),e.ALo(5,"replaceFormulaQuestionProp"),e.ALo(6,"base64"),e.qZA()()),2&o){const t=s.$implicit,n=e.oxw(2);e.Q6J("ngClass",e.VKq(15,it,t.valide)),e.xp6(1),e.MGl("name","optionsRadios-",n.question.id,"")("id","btRadio-",n.question.id,""),e.Q6J("value",t.id)("checked",t.valide),e.xp6(1),e.MGl("for","btRadio-",n.question.id,""),e.xp6(1),e.Q6J("content",t.enonce)("innerHTML",e.xi3(4,8,e.lcZ(5,11,e.lcZ(6,13,t.enonce)),!0),e.oJD)}}function rt(o,s){if(1&o&&(e.TgZ(0,"div",11),e.YNc(1,st,7,17,"div",12),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.question.propositions)("ngForTrackBy",e.lcZ(2,2,"id"))}}const ct=function(o){return{"proposition-success":o}};function at(o,s){if(1&o&&(e.TgZ(0,"div",13),e._UZ(1,"input",18),e.TgZ(2,"label",15),e._UZ(3,"span",16),e.ALo(4,"filterHtml"),e.ALo(5,"replaceFormulaQuestionProp"),e.ALo(6,"base64"),e.qZA()()),2&o){const t=s.$implicit;e.Q6J("ngClass",e.VKq(15,ct,t.valide)),e.xp6(1),e.MGl("name","optionsCheckbox-",t.id,"")("id","check-",t.id,""),e.Q6J("value",t.id)("checked",t.valide),e.xp6(1),e.MGl("for","check-",t.id,""),e.xp6(1),e.Q6J("content",t.enonce)("innerHTML",e.xi3(4,8,e.lcZ(5,11,e.lcZ(6,13,t.enonce)),!0),e.oJD)}}function lt(o,s){if(1&o&&(e.TgZ(0,"div",17),e.YNc(1,at,7,17,"div",12),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.question.propositions)("ngForTrackBy",e.lcZ(2,2,"id"))}}function ut(o,s){if(1&o&&(e.TgZ(0,"label")(1,"span",25),e._UZ(2,"input",26),e.qZA()()),2&o){const t=e.oxw().index,n=e.oxw().$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("placeholder",i.correctifs[n.id][t])("size",i.correctifs[n.id][t].length)}}function dt(o,s){if(1&o&&(e.TgZ(0,"span",23),e._UZ(1,"span",24),e.ALo(2,"filterHtml"),e.YNc(3,ut,3,2,"label",3),e.qZA()),2&o){const t=s.$implicit,n=s.last;e.xp6(1),e.Q6J("innerHTML",e.xi3(2,2,t,!0),e.oJD),e.xp6(2),e.Q6J("ngIf",!n)}}function mt(o,s){if(1&o&&(e.TgZ(0,"div",21),e.YNc(1,dt,4,5,"span",22),e.ALo(2,"textHolesToArray"),e.ALo(3,"trackByProperty"),e.qZA()),2&o){const t=s.$implicit;e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,2,t.enonceDecode))("ngForTrackBy",e.lcZ(3,4,"$index"))}}function pt(o,s){if(1&o&&(e.TgZ(0,"div",19),e.YNc(1,mt,4,6,"div",20),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.question.propositions)("ngForTrackBy",e.lcZ(2,2,"id"))}}function _t(o,s){if(1&o&&(e.TgZ(0,"alert",27)(1,"b"),e._UZ(2,"i",28),e._uU(3," Commentaire de rem\xe9diation : "),e.qZA(),e._UZ(4,"div",29),e.ALo(5,"filterHtml"),e.ALo(6,"base64"),e.qZA()),2&o){const t=e.oxw();e.xp6(4),e.Q6J("content",t.question.remediation)("innerHTML",e.lcZ(5,2,e.lcZ(6,4,t.question.remediation)),e.oJD)}}let gt=(()=>{class o{constructor(){this.correctifs={},this.questionBaseType=c.xq9,this.deleteQuestion=new e.vpe,this.manageQuestion=new e.vpe,this.moveDownQuestion=new e.vpe,this.moveUpQuestion=new e.vpe,this.cloneQuestion=new e.vpe,this.cloneQuestionIci=new e.vpe}ngOnChanges(t){t.question&&this.updateTextHoles()}updateTextHoles(){this.question.typeQ===c.xq9.textholes.id&&(this.correctifs={},this.question.propositions.forEach(t=>{t.enonceDecode=t.enonce?c.YC.base64decode(t.enonce):"",t.enonceDecode=t.enonceDecode.replace(/<div[^>]*>(.*?)<\/div>/gi,"<br />$1");const n=t.correctif?c.YC.base64decode(t.correctif):"";this.correctifs[t.id]=n.split(c.IZV).reduce((i,r)=>(i.push(r.replace("&nbsp;","")),i),[])}))}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-une-question"]],inputs:{idQCM:"idQCM",question:"question",isFirst:"isFirst",isLast:"isLast"},outputs:{deleteQuestion:"deleteQuestion",manageQuestion:"manageQuestion",moveDownQuestion:"moveDownQuestion",moveUpQuestion:"moveUpQuestion",cloneQuestion:"cloneQuestion",cloneQuestionIci:"cloneQuestionIci"},features:[e.TTD],decls:11,vars:12,consts:[[3,"isFirst","isLast","manageQuestion","moveDown","moveUp","cloneQuestion","cloneQuestionIci","deleteQuestion"],[1,"list-group-item-heading","mt-4"],["class","list-group-item-text qcm-img-container ed-cke","edMathjax","",3,"innerHTML","content",4,"ngIf"],[4,"ngIf"],[1,"une-question-type",3,"ngSwitch"],["class","une-question-type-radio",4,"ngSwitchCase"],["class","une-question-type-checkbox",4,"ngSwitchCase"],["class","une-question-type-textholes",4,"ngSwitchCase"],["type","warning","class","qcm-img-container",4,"ngIf"],["edMathjax","",1,"list-group-item-text","qcm-img-container","ed-cke",3,"innerHTML","content"],["controls","","preload","metadata",3,"src"],[1,"une-question-type-radio"],["class","form-check disabled",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-check","disabled",3,"ngClass"],["type","radio","disabled","",1,"form-check-input",3,"name","id","value","checked"],[1,"form-check-label",3,"for"],["edMathjax","",3,"content","innerHTML"],[1,"une-question-type-checkbox"],["type","checkbox","disabled","",1,"form-check-input",3,"name","id","value","checked"],[1,"une-question-type-textholes"],["class","question-textholes",4,"ngFor","ngForOf","ngForTrackBy"],[1,"question-textholes"],["class","lennonce-textholes",4,"ngFor","ngForOf","ngForTrackBy"],[1,"lennonce-textholes"],[3,"innerHTML"],[1,"form-control-wrapper"],["type","text","disabled","","spellcheck","false","autocapitalize","off","autocomplete","off",1,"form-control","question-proposition-texthole-input","empty",3,"placeholder","size"],["type","warning",1,"qcm-img-container"],["aria-hidden","true",1,"fa","fa-question-circle"],["edMathjax","",1,"ed-cke",3,"content","innerHTML"]],template:function(t,n){1&t&&(e.TgZ(0,"ed-une-question-actions",0),e.NdJ("manageQuestion",function(){return n.manageQuestion.emit()})("moveDown",function(){return n.moveDownQuestion.emit()})("moveUp",function(){return n.moveUpQuestion.emit()})("cloneQuestion",function(){return n.cloneQuestion.emit()})("cloneQuestionIci",function(){return n.cloneQuestionIci.emit()})("deleteQuestion",function(){return n.deleteQuestion.emit()}),e.qZA(),e.TgZ(1,"h4",1),e._uU(2),e.ALo(3,"base64"),e.qZA(),e.YNc(4,tt,3,6,"div",2),e.YNc(5,ot,8,6,"figure",3),e.TgZ(6,"div",4),e.YNc(7,rt,3,4,"div",5),e.YNc(8,lt,3,4,"div",6),e.YNc(9,pt,3,4,"div",7),e.qZA(),e.YNc(10,_t,7,6,"alert",8)),2&t&&(e.Q6J("isFirst",n.isFirst)("isLast",n.isLast),e.xp6(2),e.Oqu(e.lcZ(3,10,n.question.question)),e.xp6(2),e.Q6J("ngIf",n.question.enonce),e.xp6(1),e.Q6J("ngIf",n.question.srcSon),e.xp6(1),e.Q6J("ngSwitch",n.question.typeQ),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.radio.id),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.checkbox.id),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.textholes.id),e.xp6(1),e.Q6J("ngIf",n.question.remediation))},dependencies:[m.mk,m.sg,m.O5,m.RF,m.n9,A.wx,te.L,et,c.YC,ne.w,oe.y,q.$,ie.Y,se.T],encapsulation:2,changeDetection:0}),o})();function ht(o,s){1&o&&(e.TgZ(0,"alert",10),e._uU(1,"Vous n'avez pas de question pour le moment !"),e.qZA())}function ft(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"ed-une-question",11),e.NdJ("deleteQuestion",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onDeleteQuestion(r))})("manageQuestion",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onManageQuestion(r))})("moveDownQuestion",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.OnMoveDownQuestion(r))})("moveUpQuestion",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.OnMoveUpQuestion(r))})("cloneQuestionIci",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.OnCloneQuestionIci(r))})("cloneQuestion",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onCloneQuestion(r))}),e.qZA()}if(2&o){const t=s.$implicit,n=s.last,i=s.first,r=e.oxw(2);e.MGl("id","question_",t.id,""),e.Q6J("idQCM",r.qcmQ.id)("isFirst",i)("isLast",n)("question",t)}}function qt(o,s){if(1&o&&(e.TgZ(0,"div",6),e.YNc(1,ht,2,0,"alert",7),e.TgZ(2,"div",8),e.YNc(3,ft,1,5,"ed-une-question",9),e.ALo(4,"trackByProperty"),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",0===t.qcmQ.combien),e.xp6(1),e.Q6J("sortablejsOptions",t.sortableConf)("edSortablejs",t.qcmQ.questions),e.xp6(1),e.Q6J("ngForOf",t.qcmQ.questions)("ngForTrackBy",e.lcZ(4,5,"id"))}}function Ct(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",12)(1,"div",13)(2,"ed-qcm-questions-globals-actions",2),e.NdJ("manageQuestion",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onManageQuestion())}),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("id",null==t.qcmQ?null:t.qcmQ.id)}}let vt=(()=>{class o{constructor(t,n,i,r,a,d,p,_){this.activatedRoute=t,this.authStore=n,this.loaderService=i,this.modalService=r,this.qcmUserStore=a,this.qcmService=d,this.router=p,this.uiService=_,this.editorOptions=k.x$,this.sortableConf={onEnd:f=>{this.updateQuestionsOrderNo(f.newIndex)}}}static arrayMove(t,n,i){const r=t[n];t.splice(n,1),t.splice(i,0,r)}ngOnInit(){this.authStore.isAnneeCourante(this.qcmUserStore.snapshot.choosenAnnee)&&this.activatedRoute.snapshot.paramMap.has("idQCM")?this.getQuestions():this.router.navigate(["../../"],{relativeTo:this.activatedRoute}).catch(()=>console.error("QcmQuestionsComponent navigate to ../../"))}getQuestions(){this.loader=this.qcmService.getQuestions(+this.activatedRoute.snapshot.paramMap.get("idQCM")).subscribe(t=>{this.qcmQ=new c.S0B(t),this.sortQuestionsByOrderNo()},t=>{404===t.status?(this.uiService.notifyEvent(c.DOJ.genericError,"Le questionnaire demand\xe9e est introuvable. Peut-\xeatre l'avez vous pr\xe9alablement supprim\xe9 ?","Erreur","icon-ed_qcm"),this.router.navigate(["../../"],{relativeTo:this.activatedRoute}).catch(()=>console.error("getQuestions navigate to ../../"))):530===t.status?(this.uiService.notifyEvent(c.DOJ.genericError,t.message,"Erreur","icon-ed_qcm"),this.router.navigate(["../../"],{relativeTo:this.activatedRoute}).catch(()=>console.error("getQuestions navigate to ../../"))):this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la r\xe9cup\xe9ration de vos questions.","Erreur","icon-ed_qcm")})}updateQuestionsOrderNo(t){const n=this.qcmQ.questions[t].ordre;this.qcmQ.questions[t].ordre=c.woQ.generatePosOrder(this.qcmQ.questions,t),this.loader=this.qcmService.updateQuestionOrdre(this.qcmQ.id,this.qcmQ.questions[t]).subscribe({next:i=>this.uiService.notifyEvent(c.DOJ.genericSuccess,"L'ordre a bien \xe9t\xe9 mis \xe0 jour.","Question mise \xe0 jour","icon-ed_qcm"),error:i=>{this.qcmQ.questions[t].ordre=n,this.sortQuestionsByOrderNo(),this.uiService.notifyEvent(String(i.status),i.message,"Erreur","icon-ed_qcm")}})}sortQuestionsByOrderNo(){this.qcmQ.questions.sort((t,n)=>t.ordre-n.ordre)}onManageQuestion(t){this.modalService.show(Le,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,class:"modal-lg",initialState:{idQCM:this.qcmQ.id,question:Object.isExists(t)?new c.cmE(t):c.cmE.addNewQuestion(this.qcmQ.questions),ckConf:this.editorOptions}}).content.onClose$.pipe((0,C.q)(1)).subscribe(i=>{if(Object.isExists(i)&&Object.isExists(i.question)){const r=this.qcmQ.questions.findIndex(a=>a.id===i.question.id);-1===r?this.qcmQ.questions.push(i.question):this.qcmQ.questions[r]=i.question}Object.isExists(i)&&!Object.isExists(i.question)&&!0===i.sonUpdated&&(this.router.routeReuseStrategy.shouldReuseRoute=()=>!1),this.router.navigate([this.router.url]).catch(()=>console.error("onManageQuestion navigate to route"))})}onDeleteQuestion(t){const n={title:"Suppression de la question",message:`\xcates-vous s\xfbr de vouloir supprimer <strong>d\xe9finitivement</strong> la question <strong>${c.YC.base64decode(t.question)}</strong> ?`,warningButton:"OK"},i={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:n};this.modalService.show(E.z,i),this.modalService.onHide.pipe((0,C.q)(1),(0,F.h)(r=>r===Q.G.validation),(0,Z.w)(r=>(this.loader=this.loaderService.show(this),this.qcmService.supprimerQuestion(this.qcmQ.id,t.id))),(0,x.b)(r=>{const a=this.qcmQ.questions.findIndex(d=>t.id===d.id);a>-1&&this.qcmQ.questions.splice(a,1),this.uiService.notifyEvent(c.DOJ.genericSuccess,"Votre question a bien \xe9t\xe9 supprim\xe9e.","Question supprim\xe9e","icon-ed_qcm")}),(0,y.x)(()=>this.loaderService.hide(this)),(0,T.K)(r=>(this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la suppression de la question.","Erreur","icon-ed_qcm"),U.E))).subscribe()}OnMoveDownQuestion(t){const n=this.qcmQ.questions.findIndex(r=>t.id===r.id),i=n+1;i<this.qcmQ.questions.length&&(o.arrayMove(this.qcmQ.questions,n,i),this.updateQuestionsOrderNo(i))}OnMoveUpQuestion(t){const n=this.qcmQ.questions.findIndex(r=>t.id===r.id),i=n-1;i>=0&&(o.arrayMove(this.qcmQ.questions,n,i),this.updateQuestionsOrderNo(i))}OnCloneQuestionIci(t){if(!Object.isExists(t)||0===t.id)return;let n;const i=this.qcmQ.questions.findIndex(r=>t.id===r.id);i>-1&&(this.loader=(0,D.of)(this.qcmQ).pipe((0,P.U)(r=>(r.questions.sort((a,d)=>a.ordre-d.ordre),n=c.cmE.addNewQuestion(r.questions,this.qcmQ.questions[i]),n)),(0,Z.w)(r=>this.qcmService.saveQuestion(this.qcmQ.id,r,!0)),(0,x.b)(r=>{n.id=r.id,this.qcmQ.questions.push(n),this.onManageQuestion(n)})).subscribe({next:r=>this.uiService.notifyEvent(c.DOJ.genericSuccess,"La question a bien \xe9t\xe9 dupliqu\xe9e.","QCM","icon-ed_qcm"),error:r=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la copie de la question.","Erreur","icon-ed_qcm")}))}onCloneQuestion(t){Object.isExists(t)&&0!==t.id&&this.modalService.show(Ke,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,class:"modal-lg",initialState:{idQCM:this.qcmQ.id},providers:[{provide:h,useValue:this.qcmUserStore}]}).content.onClose$.pipe((0,C.q)(1)).subscribe(i=>{if(i>0){const r=this.qcmQ.questions.findIndex(a=>t.id===a.id);r>-1&&(this.loader=this.qcmService.getQuestions(i).pipe((0,P.U)(a=>(a.questions.sort((d,p)=>d.ordre-p.ordre),c.cmE.addNewQuestion(a.questions,this.qcmQ.questions[r]))),(0,Z.w)(a=>this.qcmService.saveQuestion(i,a,!0))).subscribe({next:a=>this.uiService.notifyEvent(c.DOJ.genericSuccess,"La question a bien \xe9t\xe9 dupliqu\xe9e.","QCM","icon-ed_qcm"),error:a=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la copie de la question.","Erreur","icon-ed_qcm")}))}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.gz),e.Y36(c.CnD),e.Y36(R.S),e.Y36(g.tT),e.Y36(h),e.Y36(c.Jqz),e.Y36(M.F0),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-questions"]],decls:10,vars:5,consts:[[1,"ed-container","page-qcm-questions","double-padding"],[1,"entete-page"],[3,"id","manageQuestion"],[3,"ngBusy"],["class","les-questions margin-top-10",4,"ngIf"],["class","row mt-4",4,"ngIf"],[1,"les-questions","margin-top-10"],["type","info",4,"ngIf"],[1,"list-group","list-group-hover",3,"sortablejsOptions","edSortablejs"],["class","ed-card with-epingle simple-padding list-group-item une-question",3,"id","idQCM","isFirst","isLast","question","deleteQuestion","manageQuestion","moveDownQuestion","moveUpQuestion","cloneQuestionIci","cloneQuestion",4,"ngFor","ngForOf","ngForTrackBy"],["type","info"],[1,"ed-card","with-epingle","simple-padding","list-group-item","une-question",3,"id","idQCM","isFirst","isLast","question","deleteQuestion","manageQuestion","moveDownQuestion","moveUpQuestion","cloneQuestionIci","cloneQuestion"],[1,"row","mt-4"],[1,"col-12","globals-actions"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2"),e._uU(3," Les questions de "),e.TgZ(4,"b"),e._uU(5),e.qZA()(),e.TgZ(6,"ed-qcm-questions-globals-actions",2),e.NdJ("manageQuestion",function(){return n.onManageQuestion()}),e.qZA()(),e.TgZ(7,"div",3),e.YNc(8,qt,5,7,"div",4),e.qZA(),e.YNc(9,Ct,3,1,"div",5),e.qZA()),2&t&&(e.xp6(5),e.Oqu(null==n.qcmQ?null:n.qcmQ.titre),e.xp6(1),e.Q6J("id",null==n.qcmQ?null:n.qcmQ.id),e.xp6(1),e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("ngIf",n.qcmQ),e.xp6(1),e.Q6J("ngIf",(null==n.qcmQ?null:n.qcmQ.questions.length)>3))},dependencies:[m.sg,m.O5,A.wx,b.DC,je.Q,ze,gt,q.$],styles:[".page-qcm-questions .entete-page{justify-content:space-between}.page-qcm-questions .les-questions .list-group-hover .list-group-item:hover{background-color:var(--menu-hover-color);cursor:move}.page-qcm-questions .les-questions .sortable-ghost{opacity:.5;border:2px dotted var(--dark-placeholder-color)!important;background:#c8ebfb}.page-qcm-questions .les-questions .une-question{z-index:0;position:relative;border:none;border-radius:0}.page-qcm-questions .les-questions .une-question .qcm-img-container img{max-width:100%}.page-qcm-questions .les-questions .une-question .list-group-item-heading{margin-bottom:15px;white-space:normal;width:70%}.page-qcm-questions .les-questions .une-question .list-group-item-text{margin-bottom:15px}.page-qcm-questions .les-questions .une-question .list-group-item-text>ol{margin-left:15px}.page-qcm-questions .les-questions .une-question .alert{margin-top:15px}.page-qcm-questions .les-questions .une-question figure{margin:10px 0;padding-left:5px;border-left:2px solid dimgrey}.page-qcm-questions .les-questions .une-question figcaption{font-weight:600}.page-qcm-questions .les-questions .une-question .btn-sm{margin:0;padding:5px 10px}.page-qcm-questions .les-questions .une-question .une-question-actions{position:absolute;right:0;top:0;padding:8px;opacity:0}.page-qcm-questions .les-questions .une-question:hover .une-question-actions{opacity:.6}.page-qcm-questions .les-questions .une-question:hover .une-question-actions button{background-color:#e3e4e5;cursor:pointer}.page-qcm-questions .les-questions .une-question:hover .une-question-actions button:not(.btn-danger-color){color:#000}.page-qcm-questions .les-questions .une-question:hover .une-question-actions:hover{opacity:1}.page-qcm-questions .les-questions .une-question .une-question-type .proposition-success,.page-qcm-questions .les-questions .une-question .une-question-type .question-textholes input[type=text]:disabled::placeholder{color:var(--light-primary-color)}\n"],encapsulation:2}),o})();var bt=u(56451),Qt=u(39841),re=u(71884),ce=u(61099),xt=u(57701),Tt=u(88673);const Mt=["editQCMForm"];function Zt(o,s){1&o&&(e.TgZ(0,"div",52)(1,"p",20),e._uU(2,"Le QCM a bien \xe9t\xe9 dupliqu\xe9 sur l'ann\xe9e en cours. Vous pouvez maintenant le modifier si vous le souhaitez."),e.qZA()())}function yt(o,s){1&o&&(e.TgZ(0,"alert",53)(1,"strong"),e._uU(2,"Attention !"),e.qZA(),e._uU(3," Certains champs ne sont pas renseign\xe9s ou sont incorrects "),e.qZA()),2&o&&e.Q6J("dismissible",!0)}function At(o,s){1&o&&(e.TgZ(0,"span",54),e._uU(1,"Saisissez un titre !"),e.qZA())}function Et(o,s){1&o&&(e.TgZ(0,"span",54),e._uU(1,"Saisissez un texte d'introduction !"),e.qZA())}function St(o,s){1&o&&(e.TgZ(0,"span",54),e._uU(1,"Saisissez un texte de conclusion !"),e.qZA())}function wt(o,s){1&o&&(e.TgZ(0,"span",54),e._uU(1,"Saisissez un entier (et diff\xe9rent de z\xe9ro) !"),e.qZA())}function Ut(o,s){1&o&&(e.TgZ(0,"span",54),e._uU(1,"Saisissez un entier !"),e.qZA())}function kt(o,s){1&o&&(e.TgZ(0,"span",54),e._uU(1,"Saisissez un entier !"),e.qZA())}const S=function(o){return{"has-error":o}};let Jt=(()=>{class o{constructor(t,n,i){this.modalRef=t,this.qcmService=n,this.uiService=i,this.ckConf=k.x$,this.encours=!1,this.isDupliqAnneePrecedente=!1}ngOnInit(){this.pageTitre=this.qcm.id>0?`Modifier : ${this.qcm.titre}`:"Nouveau questionnaire",this.qcm.introductionDecode=c.FSr.isNotEmptyString(this.qcm.introduction)?c.YC.base64decode(this.qcm.introduction):"",this.qcm.conclusionDecode=c.FSr.isNotEmptyString(this.qcm.conclusion)?c.YC.base64decode(this.qcm.conclusion):""}onCKReady(t){(0,k.UZ)(t)}onSubmit(){if(this.formQCM.valid&&!this.encours){if(this.encours=!0,this.qcm.introductionDecode.length>1572864||this.qcm.conclusionDecode.length>1572864)return this.uiService.notifyEvent(c.DOJ.genericError,"Enregistrement impossible. Votre saisie est trop grande (>1.5Mo).","Erreur","icon-ed_qcm"),void(this.encours=!1);const t=new c.Gmi(this.qcm);t.introduction=c.YC.base64encode(t.introductionDecode),t.conclusion=c.YC.base64encode(t.conclusionDecode),t.resume=c.YC.base64encode(xt.V.strip(t.introductionDecode)),delete t.introductionDecode,delete t.conclusionDecode,this.loader=this.qcmService.saveQCM(t).pipe((0,y.x)(()=>this.encours=!1)).subscribe({next:()=>{this.uiService.notifyEvent(c.DOJ.genericSuccess,"Votre questionnaire a bien \xe9t\xe9 enregistr\xe9.","QCM","icon-ed_qcm"),this.close()},error:n=>this.uiService.notifyEvent(n.action,"Une erreur s'est produite lors de l'enregistrement de votre questionnaire.","Erreur","icon-ed_qcm")})}}close(){this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.UZ),e.Y36(c.Jqz),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-manage"]],viewQuery:function(t,n){if(1&t&&e.Gf(Mt,5),2&t){let i;e.iGM(i=e.CRH())&&(n.formQCM=i.first)}},inputs:{qcm:"qcm",isDupliqAnneePrecedente:"isDupliqAnneePrecedente"},decls:124,vars:60,consts:[["name","editQCMForm","novalidate","",3,"ngSubmit"],["editQCMForm","ngForm"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body",3,"ngBusy"],["class","margin-bottom-10",4,"ngIf"],["type","danger",3,"dismissible",4,"ngIf"],[1,"card","col-lg-12"],[1,"card-header"],[1,"card-body"],[1,"row","required",3,"ngClass"],["for","titre",1,"col-md-2","col-form-label"],[1,"col-md-10"],["name","titre","type","text","id","titre","required","",1,"form-control",3,"ngModel","ngModelChange"],["titre","ngModel"],["class","text-danger",4,"ngIf"],["for","introductionDecode",1,"col-md-2","col-form-label"],["id","introductionDecode","name","introductionDecode","required","",3,"config","ngModel","ready","ngModelChange"],["introductionDecode","ngModel"],[1,"form-text"],["for","conclusionDecode",1,"col-md-2","col-form-label"],["id","conclusionDecode","name","conclusionDecode","required","",3,"config","ngModel","ready","ngModelChange"],["conclusionDecode","ngModel"],[1,"row","form-control-bareme","required"],[1,"col-md-2",3,"ngClass"],["title","Nombre de points attribu\xe9s par question, qui permettra le calcul des notes dans le cas d'une \xe9valuation.",1,"col-form-label"],["aria-hidden","true",1,"fa","fa-question-circle"],[1,"row"],[1,"col-lg-3",3,"ngClass"],["name","baremeBR","type","number","id","baremeBR","step","1","edEntierWithNoZero","",1,"form-control","form-control-sm",3,"ngModel","ngModelChange"],["baremeBR","ngModel"],["name","baremeAR","type","number","id","baremeAR","step","1",1,"form-control","form-control-sm",3,"ngModel","edEntierWithNoZero","ngModelChange"],["baremeAR","ngModel"],["name","baremeMR","type","number","id","baremeMR","step","1",1,"form-control","form-control-sm",3,"ngModel","edEntierWithNoZero","ngModelChange"],["baremeMR","ngModel"],[1,"offset-md-2","col-md-9"],[1,"card","mt-3","col-lg-12"],[1,"col-form-label"],[1,"form-check"],["name","qAleatoire","type","checkbox","id","checkQuestionsAleatoires",1,"form-check-input",3,"ngModel","ngModelChange"],["for","checkQuestionsAleatoires",1,"form-check-label"],["name","masquerCorrectifFE","type","checkbox","id","checkAffichageDetailRepCorr",1,"form-check-input",3,"ngModel","ngModelChange"],["for","checkAffichageDetailRepCorr",1,"form-check-label"],["name","masquerCorrectifFormatif","type","checkbox","id","checkAffichageCorrectif",1,"form-check-input",3,"ngModel","ngModelChange"],["for","checkAffichageCorrectif",1,"form-check-label"],["name","bloquerRejeuFormatif","type","checkbox","id","checkRelancerQuestionnaire",1,"form-check-input",3,"ngModel","ngModelChange"],["for","checkRelancerQuestionnaire",1,"form-check-label"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","button",1,"btn","btn-success","float-end",3,"disabled","click"],[1,"margin-bottom-10"],["type","danger",3,"dismissible"],[1,"text-danger"]],template:function(t,n){if(1&t&&(e.TgZ(0,"form",0,1),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.TgZ(2,"div",2)(3,"h3",3),e._uU(4),e.qZA(),e.TgZ(5,"button",4),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(6,"div",5),e.YNc(7,Zt,3,0,"div",6),e.YNc(8,yt,4,1,"alert",7),e.TgZ(9,"div",8)(10,"div",9)(11,"strong"),e._uU(12,"QCM"),e.qZA()(),e.TgZ(13,"div",10)(14,"div",11)(15,"label",12),e._uU(16,"Titre"),e.qZA(),e.TgZ(17,"div",13)(18,"input",14,15),e.NdJ("ngModelChange",function(r){return n.qcm.titre=r}),e.qZA(),e.YNc(20,At,2,0,"span",16),e.qZA()(),e.TgZ(21,"div",11)(22,"label",17),e._uU(23,"Introduction"),e.qZA(),e.TgZ(24,"div",13)(25,"ckeditor",18,19),e.NdJ("ready",function(r){return n.onCKReady(r)})("ngModelChange",function(r){return n.qcm.introductionDecode=r}),e.qZA(),e.TgZ(27,"span",20),e._uU(28,"Ce texte sera affich\xe9 au d\xe9marrage du questionnaire."),e.qZA(),e.YNc(29,Et,2,0,"span",16),e.qZA()(),e.TgZ(30,"div",11)(31,"label",21),e._uU(32,"Conclusion"),e.qZA(),e.TgZ(33,"div",13)(34,"ckeditor",22,23),e.NdJ("ready",function(r){return n.onCKReady(r)})("ngModelChange",function(r){return n.qcm.conclusionDecode=r}),e.qZA(),e.TgZ(36,"span",20),e._uU(37,"Ce texte sera affich\xe9 \xe0 la fin du questionnaire."),e.qZA(),e.YNc(38,St,2,0,"span",16),e.qZA()(),e.TgZ(39,"div",24)(40,"div",25)(41,"strong",26),e._uU(42," Points "),e._UZ(43,"i",27),e.qZA()(),e.TgZ(44,"div",13)(45,"div",28)(46,"div",29),e._uU(47," Bonne r\xe9ponse "),e.TgZ(48,"input",30,31),e.NdJ("ngModelChange",function(r){return n.qcm.baremeBR=r}),e.qZA(),e.TgZ(50,"span",20),e._uU(51,"Entier + ou -"),e.qZA(),e.YNc(52,wt,2,0,"span",16),e.qZA(),e.TgZ(53,"div",29),e._uU(54," Aucune r\xe9ponse "),e.TgZ(55,"input",32,33),e.NdJ("ngModelChange",function(r){return n.qcm.baremeAR=r}),e.qZA(),e.YNc(57,Ut,2,0,"span",16),e.qZA(),e.TgZ(58,"div",29),e._uU(59," Mauvaise r\xe9ponse "),e.TgZ(60,"input",34,35),e.NdJ("ngModelChange",function(r){return n.qcm.baremeMR=r}),e.qZA(),e.YNc(62,kt,2,0,"span",16),e.qZA()()()(),e.TgZ(63,"div",28)(64,"div",36)(65,"b"),e._uU(66,"Comment est calcul\xe9e la note d'une \xe9valuation associ\xe9e \xe0 ce QCM ?"),e.qZA(),e.TgZ(67,"p"),e._uU(68),e._UZ(69,"br"),e._uU(70," Pour un devoir not\xe9 sur 20, ce total correspond \xe0 une note de 20/20. "),e._UZ(71,"br"),e._uU(72," La note finale de l'\xe9l\xe8ve sur 20 sera donc calcul\xe9e de la fa\xe7on suivante: "),e._UZ(73,"br"),e.TgZ(74,"b"),e._uU(75," (( "),e.TgZ(76,"i"),e._uU(77),e.qZA(),e._uU(78),e.qZA()()()()()(),e.TgZ(79,"div",37)(80,"div",9)(81,"strong",38),e._uU(82,"Questions"),e.qZA()(),e.TgZ(83,"div",10)(84,"div",39)(85,"input",40),e.NdJ("ngModelChange",function(r){return n.qcm.qAleatoire=r}),e.qZA(),e.TgZ(86,"label",41),e._uU(87,"Questions affich\xe9es al\xe9atoirement"),e.qZA(),e.TgZ(88,"span",20),e._uU(89,"Si coch\xe9, l'ordre sera diff\xe9rent pour chaque participant."),e.qZA()()()(),e.TgZ(90,"div",37)(91,"div",9)(92,"strong",38),e._uU(93,"Associations sommatives"),e.qZA()(),e.TgZ(94,"div",10)(95,"div",39)(96,"input",42),e.NdJ("ngModelChange",function(r){return n.qcm.masquerCorrectifFE=r}),e.qZA(),e.TgZ(97,"label",43),e._uU(98,"Ne pas afficher le corrig\xe9 sur le carnet de note de l'\xe9l\xe8ve"),e.qZA(),e.TgZ(99,"span",20),e._uU(100,"Si coch\xe9, l'\xe9l\xe8ve ne pourra pas acc\xe9der au d\xe9tail du questionnaire avec ses r\xe9ponses et les correctifs."),e.qZA()()()(),e.TgZ(101,"div",37)(102,"div",9)(103,"strong",38),e._uU(104,"Associations formatives"),e.qZA()(),e.TgZ(105,"div",10)(106,"div",39)(107,"input",44),e.NdJ("ngModelChange",function(r){return n.qcm.masquerCorrectifFormatif=r}),e.qZA(),e.TgZ(108,"label",45),e._uU(109,"Ne pas donner acc\xe8s aux correctifs"),e.qZA(),e.TgZ(110,"span",20),e._uU(111,"Si coch\xe9, l'\xe9l\xe8ve ne pourra pas acc\xe9der aux correctifs du questionnaire"),e.qZA()(),e.TgZ(112,"div",39)(113,"input",46),e.NdJ("ngModelChange",function(r){return n.qcm.bloquerRejeuFormatif=r}),e.qZA(),e.TgZ(114,"label",47),e._uU(115,"Ne pas rejouer le questionnaire"),e.qZA(),e.TgZ(116,"span",20),e._uU(117,"Si coch\xe9, l'\xe9l\xe8ve ne pourra pas rejouer le questionnaire."),e.qZA()()()()(),e.TgZ(118,"div",48)(119,"div",49)(120,"button",50),e.NdJ("click",function(){return n.close()}),e._uU(121,"Annuler"),e.qZA(),e.TgZ(122,"button",51),e.NdJ("click",function(){return n.formQCM.ngSubmit.emit()}),e._uU(123,"Sauvegarder"),e.qZA()()()()),2&t){const i=e.MAs(1),r=e.MAs(19),a=e.MAs(26),d=e.MAs(35),p=e.MAs(49),_=e.MAs(56),f=e.MAs(61);e.xp6(4),e.Oqu(n.pageTitre),e.xp6(2),e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("ngIf",n.isDupliqAnneePrecedente),e.xp6(1),e.Q6J("ngIf",i.submitted&&i.invalid),e.xp6(6),e.Q6J("ngClass",e.VKq(42,S,r.invalid)),e.xp6(4),e.Q6J("ngModel",n.qcm.titre),e.xp6(2),e.Q6J("ngIf",null==r.errors?null:r.errors.required),e.xp6(1),e.Q6J("ngClass",e.VKq(44,S,a.invalid)),e.xp6(4),e.Tol(e.VKq(46,S,a.invalid&&(a.dirty||a.touched))),e.Q6J("config",n.ckConf)("ngModel",n.qcm.introductionDecode),e.xp6(4),e.Q6J("ngIf",null==a.errors?null:a.errors.required),e.xp6(1),e.Q6J("ngClass",e.VKq(48,S,d.invalid)),e.xp6(4),e.Tol(e.VKq(50,S,d.invalid&&(d.dirty||d.touched))),e.Q6J("config",n.ckConf)("ngModel",n.qcm.conclusionDecode),e.xp6(4),e.Q6J("ngIf",null==d.errors?null:d.errors.required),e.xp6(2),e.Q6J("ngClass",e.VKq(52,S,p.invalid||_.invalid||f.invalid)),e.xp6(6),e.Q6J("ngClass",e.VKq(54,S,p.invalid)),e.xp6(2),e.Q6J("ngModel",n.qcm.baremeBR),e.xp6(4),e.Q6J("ngIf",null==p.errors?null:p.errors.entierWithNoZero),e.xp6(1),e.Q6J("ngClass",e.VKq(56,S,_.invalid)),e.xp6(2),e.Q6J("ngModel",n.qcm.baremeAR)("edEntierWithNoZero",!1),e.xp6(2),e.Q6J("ngIf",null==_.errors?null:_.errors.entierWithNoZero),e.xp6(1),e.Q6J("ngClass",e.VKq(58,S,f.invalid)),e.xp6(2),e.Q6J("ngModel",n.qcm.baremeMR)("edEntierWithNoZero",!1),e.xp6(2),e.Q6J("ngIf",null==f.errors?null:f.errors.entierWithNoZero),e.xp6(6),e.AsE(" Un qcm de 10 questions avec un bar\xeame de ",n.qcm.baremeBR," point.s pour une bonne r\xe9ponse donne un total de ",n.qcm.maxPoints," points. "),e.xp6(9),e.lnq(" Nombre de bonnes r\xe9ponses x ",n.qcm.baremeBR," + Nombre de mauvaises r\xe9ponses x ",n.qcm.baremeMR," + Nombre d'aucunes r\xe9ponses x ",n.qcm.baremeAR," ) "),e.xp6(1),e.hij(" x 20 ) / ( nombre de questions x ",n.qcm.baremeBR," ) "),e.xp6(7),e.Q6J("ngModel",n.qcm.qAleatoire),e.xp6(11),e.Q6J("ngModel",n.qcm.masquerCorrectifFE),e.xp6(11),e.Q6J("ngModel",n.qcm.masquerCorrectifFormatif),e.xp6(6),e.Q6J("ngModel",n.qcm.bloquerRejeuFormatif),e.xp6(9),e.Q6J("disabled",null==i?null:i.invalid)}},dependencies:[m.mk,m.O5,l._Y,l.Fj,l.wV,l.Wl,l.JJ,l.JL,l.Q7,l.On,l.F,A.wx,j.u,b.DC,Tt.c],styles:['required[_ngcontent-%COMP%]   .col-form-label[_ngcontent-%COMP%]:after{content:"*";color:red;padding-left:5px}.form-control-bareme[_ngcontent-%COMP%]   .form-control-wrapper[_ngcontent-%COMP%]{width:90px}']}),o})();var Nt=u(78372),Ft=u(78089),w=u(59245),Ot=u(93970),Dt=u(34331),Pt=u(63666);const It=["tree"];let ae=(()=>{class o{constructor(t,n){this.qcmService=t,this.uiService=n,this.taxonomie=[],this.treeViewConfig={displayField:"libelleDisplay",idField:"id",childrenField:"tabChildren",hasChildrenField:"hasChildrenField",rootId:"qcmTaxonomie",allowDrop:!1},this.openNode=new e.vpe,this.combienQCM=new e.vpe}ngOnInit(){this.loader=this.qcmService.getTaxonomie().pipe((0,x.b)(t=>{const n=new c.C_g(t);this.combienQCM.emit(n.combien),this.taxonomie=n.tabChildren}),(0,T.K)(t=>(t.message="Une erreur s'est produite lors de la r\xe9cup\xe9ration des cat\xe9gories",this.uiService.notifyErrorThenEmpty(t,!0,"Erreur","icon-ed_qcm")))).subscribe()}onActivate(t){t&&t.node&&t.node.hasChildren&&!0!==t.node.isExpanded&&t.node.expand()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.Jqz),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-taxonomie"]],viewQuery:function(t,n){if(1&t&&e.Gf(It,5),2&t){let i;e.iGM(i=e.CRH())&&(n.treeComponent=i.first)}},outputs:{openNode:"openNode",combienQCM:"combienQCM"},decls:3,vars:3,consts:[[1,"tree-classic",3,"ngBusy"],[3,"nodes","options","activate"],["tree",""]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"tree-root",1,2),e.NdJ("activate",function(r){return n.onActivate(r),n.openNode.emit(r.node.data)}),e.qZA()()),2&t&&(e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("nodes",n.taxonomie)("options",n.treeViewConfig))},dependencies:[b.DC,Pt.qr],styles:['.tree-classic[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component{padding-left:0;margin-left:-5px;color:#369}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-children:before, .tree-classic[_ngcontent-%COMP%]     .angular-tree-component:before{content:"";position:absolute;border-left:1px dotted #23527c;height:100%;top:-14px;left:12px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-children{position:relative;padding-left:0;margin-left:16px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-children:before{left:5px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component>tree-node-collection>div>tree-node>.tree-node:before{left:14px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component>tree-node-collection>div>tree-node>.tree-node>tree-node-wrapper>.node-wrapper>tree-node-expander>.toggle-children-wrapper{left:22px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node>tree-node-children>.tree-children{left:6px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node>tree-node-wrapper>.node-wrapper{margin-left:32px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node>tree-node-wrapper>.node-wrapper>.node-content-wrapper{margin-left:4px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .node-content-wrapper{margin-left:4px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node-leaf>tree-node-wrapper>.node-wrapper{margin-left:0}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node-level-1.tree-node-leaf>tree-node-wrapper>.node-wrapper{margin-left:7px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node:before{content:"";position:absolute;border-bottom:1px dotted #23527c;width:7px;margin-top:12px;left:7px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .toggle-children-wrapper{width:13px;height:13px;border:1px solid #23527c;position:absolute;left:15px;margin-top:5px;margin-left:0;display:inline-block;background-color:#fff;z-index:1}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .toggle-children-wrapper:before{content:"";display:inline-block;width:7px;border-top:1px solid #23527c;position:absolute;top:5px;left:2px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .toggle-children-wrapper.toggle-children-wrapper-collapsed:after{content:"";display:inline-block;height:7px;border-left:1px solid #23527c;position:absolute;top:2px;left:5px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .node-content-wrapper-active, .tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .node-content-wrapper-active.node-content-wrapper-focused, .tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .node-content-wrapper.node-content-wrapper-active:hover{background-color:#adf;font-weight:700;padding:1px 5px}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .toggle-children-wrapper .toggle-children{display:none;background-image:none}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .toggle-children-wrapper-collapsed .toggle-children{background:none;transform:none}.tree-classic[_ngcontent-%COMP%]     .angular-tree-component .tree-node .toggle-children-wrapper-expanded .toggle-children{background:none;transform:none}'],changeDetection:0}),o})();var Yt=u(54757);function Bt(o,s){if(1&o&&e._UZ(0,"i"),2&o){const n=s.value;e.Gre("fa fa-star ",s.index<n?"":"filled",""),e.uIk("aria-label","Note avec la valeur"+n)}}const Rt=function(){return["500","..."]},Lt=["*"];let Ht=(()=>{class o{constructor(t){this.authStore=t,this.qcmView=new e.vpe,this.qcmReuse=new e.vpe,this.qcmRate=new e.vpe}isQCMRatable(){return this.qcm&&(!Array.isArray(this.qcmsRatedList)||-1===this.qcmsRatedList.indexOf(this.qcm.id))&&!this.qcm.isMine(this.authStore.currentUser)}rateQCM(){this.isQCMRatable()&&this.qcmRate.emit(this.qcm.natScoring)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.CnD))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-un-qcm-national"]],inputs:{qcm:"qcm",qcmsRatedList:"qcmsRatedList"},outputs:{qcmView:"qcmView",qcmReuse:"qcmReuse",qcmRate:"qcmRate"},ngContentSelectors:Lt,decls:28,vars:22,consts:[[1,"qcm-national"],[3,"title"],["aria-hidden","true",1,"fa","fa-share-alt"],[3,"innerHTML"],[1,"qcm-share-infos"],[1,"qcm-share-auteur","float-start"],["aria-label","Votez pour ce questionnaire",1,"float-end",3,"ngModel","max","readonly","customTemplate","ngModelChange","click"],[1,"float-end"],[1,"clearfix"],[1,"qcm-share-actions","text-end"],["title","Voir ce questionnaire","type","button",1,"btn","btn-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-eye"],["title","Choisir ce questionnaire","type","button",1,"btn","btn-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-download"],["star",""]],template:function(t,n){if(1&t&&(e.F$t(),e.TgZ(0,"div",0)(1,"h4"),e._uU(2),e.TgZ(3,"small",1),e._UZ(4,"i",2),e._uU(5),e.qZA()(),e._UZ(6,"p",3),e.ALo(7,"truncate"),e.ALo(8,"nl2br"),e.TgZ(9,"div",4)(10,"div",5),e._uU(11),e._UZ(12,"br"),e._uU(13),e.ALo(14,"edDate"),e.qZA(),e.TgZ(15,"rating",6),e.NdJ("ngModelChange",function(r){return n.qcm.natScoring=r})("click",function(){return n.rateQCM()}),e.qZA(),e.TgZ(16,"span",7),e._uU(17),e.qZA()(),e._UZ(18,"div",8),e.TgZ(19,"div",9)(20,"button",10),e.NdJ("click",function(){return n.qcmView.emit()}),e._UZ(21,"i",11),e.qZA(),e.TgZ(22,"button",12),e.NdJ("click",function(){return n.qcmReuse.emit()}),e._UZ(23,"i",13),e._uU(24," R\xe9utiliser ce questionnaire "),e.qZA()()(),e.YNc(25,Bt,1,4,"ng-template",null,14,e.W1O),e.Hsn(27)),2&t){const i=e.MAs(26);e.xp6(2),e.hij(" ",n.qcm.titre," "),e.xp6(1),e.MGl("title","Utilis\xe9 ",n.qcm.natNbTelecharge," fois"),e.xp6(2),e.hij(" ",n.qcm.natNbTelecharge," "),e.xp6(1),e.Q6J("innerHTML",e.xi3(7,13,e.lcZ(8,16,n.qcm.natCommentaire),e.DdM(21,Rt)),e.oJD),e.xp6(5),e.AsE(" ",n.qcm.natAuteur," (",n.qcm.natEtablissement,") "),e.xp6(2),e.hij(" Le ",e.xi3(14,18,n.qcm.created,"d MMMM y \xe0 HH:mm")," "),e.xp6(2),e.Q6J("ngModel",n.qcm.natScoring)("max",5)("readonly",!n.isQCMRatable())("customTemplate",i),e.xp6(2),e.AsE("",n.qcm.natNbVotants," vote",n.qcm.natNbVotants>1?"s":"","")}},dependencies:[l.JJ,l.On,Yt.AT,c.kM_,c.ifA,c.W70],styles:[".qcm-national h4 small{color:#4cae4c}.qcm-national .qcm-share-infos{color:#696969}.qcm-national rating{margin:0;padding:0;display:inline-block}.qcm-national rating .bs-rating-star{padding:1px;color:#ddd;font-size:20px;text-shadow:.05em .05em #aaa;list-style-type:none;display:inline-block;cursor:pointer}.qcm-national rating .bs-rating-star.active,.qcm-national rating .bs-rating-star.active .fa-star{color:#fd0}.qcm-national .qcm-share-actions button{margin-left:5px}\n"],encapsulation:2,changeDetection:0}),o})();function Gt(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij("(",t.combien," qcm)")}}function Vt(o,s){1&o&&e._UZ(0,"i",39)}function $t(o,s){1&o&&e._UZ(0,"i",39)}function Kt(o,s){1&o&&e._UZ(0,"i",39)}function jt(o,s){1&o&&e._UZ(0,"i",39)}function zt(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"ul",32)(1,"li",33)(2,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.sortBy("created"))}),e.YNc(3,Vt,1,0,"i",35),e._uU(4," Date "),e.qZA()(),e.TgZ(5,"li",33)(6,"button",36),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.sortBy("natNbTelecharge"))}),e.YNc(7,$t,1,0,"i",35),e._uU(8," Popularit\xe9 "),e.qZA()(),e.TgZ(9,"li",33)(10,"button",37),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.sortBy("natScoring"))}),e.YNc(11,Kt,1,0,"i",35),e._uU(12," Evaluations "),e.qZA()(),e.TgZ(13,"li",33)(14,"button",38),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.sortBy("natNbVotants"))}),e.YNc(15,jt,1,0,"i",35),e._uU(16," Votants "),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngIf","created"===t.sortCritere),e.xp6(4),e.Q6J("ngIf","natNbTelecharge"===t.sortCritere),e.xp6(4),e.Q6J("ngIf","natScoring"===t.sortCritere),e.xp6(4),e.Q6J("ngIf","natNbVotants"===t.sortCritere)}}function Xt(o,s){1&o&&(e.TgZ(0,"div",40)(1,"h3"),e._uU(2,"Veuillez choisir une cat\xe9gorie"),e.qZA()())}function Wt(o,s){1&o&&(e.TgZ(0,"div",40)(1,"h3"),e._uU(2,"Aucun questionnaire trouv\xe9"),e.qZA()())}function en(o,s){1&o&&(e.TgZ(0,"div",43),e._UZ(1,"div",44),e.qZA())}function tn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"ed-un-qcm-national",41),e.NdJ("qcmView",function(){const r=e.CHM(t).item,a=e.oxw();return e.KtG(a.onQcmView(r))})("qcmReuse",function(){const r=e.CHM(t).item,a=e.oxw();return e.KtG(a.onQcmReuse(r))})("qcmRate",function(i){const a=e.CHM(t).item,d=e.oxw();return e.KtG(d.onQcmRate(a,i))}),e.qZA(),e.YNc(2,en,2,0,"div",42),e.qZA()}if(2&o){const t=s.item,n=e.oxw();e.xp6(1),e.MGl("id","qcm_",t.id,""),e.Q6J("qcm",t)("qcmsRatedList",n.qcmsRatedList),e.xp6(1),e.Q6J("ngIf",n.qcmsFilter.length>n.itemParPage)}}class J extends((0,c.kCV)()){constructor(s,t,n,i,r,a){super(),this.authStore=s,this.modalRef=t,this.modalService=n,this.qcmService=i,this.router=r,this.uiService=a,this.sortCritere="",this.currentPage=1,this.itemParPage=50,this.qcms=[],this.qcmsFilter=[],this.search=new l.NI(""),this.combien=0}ngOnInit(){this.search.valueChanges.pipe((0,Nt.b)(500),(0,re.x)(),(0,F.h)(s=>0===s.length||s.length>=3),(0,x.b)(s=>this.searchByText()),(0,B.R)(this.componentDestroyed$)).subscribe()}loadQcms(s){this.search.setValue("",{emitEvent:!1}),this.currentPage=1,this.loader=this.qcmService.getQCMsNational(s,"").pipe((0,x.b)(t=>{this.qcms=Array.isArray(t)?t.map(n=>{const i=new c.Gmi(n);return i.introductionDecode=c.FSr.isNotEmptyString(i.introduction)?c.YC.base64decode(i.introduction):"",i.conclusionDecode=c.FSr.isNotEmptyString(i.conclusion)?c.YC.base64decode(i.conclusion):"",i.resumeDecode=c.FSr.isNotEmptyString(i.resume)?c.YC.base64decode(i.resume):"",i}):[],this.qcmsFilter=[...this.qcms],this.sortBy()}),(0,T.K)(t=>(t.message="Une erreur s'est produite lors de la r\xe9cup\xe9ration des qcm",this.uiService.notifyErrorThenEmpty(t,!0,"Erreur","icon-ed_qcm")))).subscribe()}sortBy(s){!c.FSr.isNotEmptyString(s)&&c.FSr.isNotEmptyString(this.sortCritere)&&(s=this.sortCritere),this.qcmsFilter=[...this.qcmsFilter.edSortBy(s,!0)],this.sortCritere=s}searchByText(){if(this.currentPage=1,c.FSr.isNotEmptyString(this.search.value)){c.dR7.calculateDiacriticsMap();const s=new RegExp(`${c.dR7.replaceDiacritics(this.search.value)}`,"mi");this.qcmsFilter=this.qcms.filter(t=>c.dR7.replaceDiacritics(t.titre).search(s)>-1||c.FSr.isNotEmptyString(t.introductionDecode)&&c.dR7.replaceDiacritics(t.introductionDecode).search(s)>-1||c.FSr.isNotEmptyString(t.conclusionDecode)&&c.dR7.replaceDiacritics(t.conclusionDecode).search(s)>-1||c.FSr.isNotEmptyString(t.resumeDecode)&&c.dR7.replaceDiacritics(t.resumeDecode).search(s)>-1||c.FSr.isNotEmptyString(t.natCommentaire)&&c.dR7.replaceDiacritics(t.natCommentaire).search(s)>-1||c.FSr.isNotEmptyString(t.natEtablissement)&&c.dR7.replaceDiacritics(t.natEtablissement).search(s)>-1||c.FSr.isNotEmptyString(t.natAuteur)&&c.dR7.replaceDiacritics(t.natAuteur).search(s)>-1||c.FSr.isNotEmptyString(t.natMotsCles)&&c.dR7.replaceDiacritics(t.natMotsCles).search(s)>-1)}else this.qcmsFilter=[...this.qcms];this.sortBy()}onOpenNode(s){!1!==s.isLeaf&&(this.currentTaxonomie=new c.C_g(s),0===s.nbQCM?(this.qcms=[],this.qcmsFilter=[]):this.loadQcms(s.id))}onQcmRate(s,t){this.loader=this.qcmService.rateQCM(s,t).subscribe(n=>{this.qcmsRatedList=Array.isArray(this.qcmsRatedList)?[...this.qcmsRatedList,s.id]:[s.id],s.natScoring=typeof n.natScoring<"u"?n.natScoring:s.natScoring,s.natNbVotants=typeof n.natNbVotants<"u"?n.natNbVotants:s.natNbVotants,this.qcmsFilter=this.qcmsFilter.map(r=>new c.Gmi(r));const i=this.qcms.findIndex(r=>s.id===r.id);i>-1&&(this.qcms[i]=new c.Gmi(s)),this.uiService.notifyEvent(c.DOJ.genericSuccess,"Votre note a bien \xe9t\xe9 prise en compte.","Note mise \xe0 jour","icon-ed_qcm")},n=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la mise \xe0 jour du questionnaire.","Erreur","icon-ed_qcm"))}onQcmReuse(s){this.loader=this.qcmService.reuseQCM(s).subscribe({next:t=>{this.uiService.notifyEvent(c.DOJ.genericSuccess,"Le questionnaire a bien \xe9t\xe9 ajout\xe9 dans votre liste.","QCM","icon-ed_qcm")},error:t=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la r\xe9cup\xe9ration du questionnaire.","Erreur","icon-ed_qcm")})}onQcmView(s){this.router.navigate(["",{outlets:{auxiliaryModal:["repondre-au-qcm"]}}],{skipLocationChange:!0,queryParams:{idQCM:s.id,titre:s.titre,idAssociation:0,isNational:!0}}).catch(()=>console.error("onQcmView navigate to qcm form"))}onCombienQCM(s){this.combien=s}close(){this.modalRef.hide()}}J.\u0275fac=function(s){return new(s||J)(e.Y36(c.CnD),e.Y36(g.UZ),e.Y36(g.tT),e.Y36(c.Jqz),e.Y36(M.F0),e.Y36(c.VLf))},J.\u0275cmp=e.Xpm({type:J,selectors:[["ed-qcms-base-nationale-picker"]],features:[e.qOj],decls:39,vars:9,consts:[[1,"modal-header"],[1,"modal-title"],[4,"ngIf"],[1,"form-text","modal-subtitle"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body",3,"ngBusy"],[1,"row"],[1,"col-lg-5","col-md-5","col-sm-5"],[3,"openNode","combienQCM"],[1,"col-lg-7","col-md-7","col-sm-7"],[1,"row",3,"hidden"],[1,"col-lg-8"],["title","Rechercher dans les qcm","novalidate","","role","search",1,"input-group"],["id","search-qcm","placeholder","Rechercher...","title","Rechercher dans les qcm","type","search",1,"form-control","form-control-sm",3,"formControl"],[1,"input-group-text","input-group-md","no-background"],["type","submit","title","Lancer la recherche",1,"btn","btn-secondary","no-background",3,"click"],["aria-hidden","true",1,"fa","fa-search"],[1,"col-lg-4"],[1,"qcms-search-filter","float-end"],[1,"list-inline"],[1,"list-inline-item","filter"],["dropdown","",1,"btn-group"],["type","button","id","dropdownPicker","dropdownToggle","","aria-controls","dropdown-autoclose",1,"btn","btn-secondary","dropdown-toggle"],["aria-hidden","true",1,"fa","fa-sort-amount-desc","i-small","margin-whitespace"],[1,"margin-whitespace"],["class","dropdown-menu","role","menu","id","dropdown-autoclose","aria-labelledby","dropdownPicker",4,"dropdownMenu"],["class","jumbotron",4,"ngIf"],[1,"qcms-share","col-lg-12",3,"datas","pagination","modeAffichage"],["edSmartTableBodyTmp",""],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-primary","float-end",3,"click"],["role","menu","id","dropdown-autoclose","aria-labelledby","dropdownPicker",1,"dropdown-menu"],["role","menuitem"],["type","button","title","Trier par date",1,"dropdown-item",3,"click"],["class","fa fa-check","aria-hidden","true",4,"ngIf"],["type","button","title","Trier par nombre de t\xe9l\xe9chargement",1,"dropdown-item",3,"click"],["type","button","title","Trier par \xe9valuations",1,"dropdown-item",3,"click"],["type","button","title","Trier par nombre de votants",1,"dropdown-item",3,"click"],["aria-hidden","true",1,"fa","fa-check"],[1,"jumbotron"],[1,"qcm-share",3,"id","qcm","qcmsRatedList","qcmView","qcmReuse","qcmRate"],["class","row margin-top-20",4,"ngIf"],[1,"row","margin-top-20"],[1,"col-lg-12","mx-auto","text-center"]],template:function(s,t){1&s&&(e.TgZ(0,"div",0)(1,"div")(2,"h3",1),e._uU(3," Rechercher un QCM dans la base inter-\xe9tablissements "),e.YNc(4,Gt,2,1,"span",2),e.qZA(),e.TgZ(5,"span",3),e._uU(6,"Les questionnaires propos\xe9s dans cette base proviennent de l'ensemble des enseignants utilisateurs EcoleDirecte."),e.qZA()(),e.TgZ(7,"button",4),e.NdJ("click",function(){return t.close()}),e.qZA()(),e.TgZ(8,"div",5)(9,"div",6)(10,"div",7)(11,"ed-qcm-taxonomie",8),e.NdJ("openNode",function(i){return t.onOpenNode(i)})("combienQCM",function(i){return t.onCombienQCM(i)}),e.qZA()(),e.TgZ(12,"div",9)(13,"div",10)(14,"div",11)(15,"form",12),e._UZ(16,"input",13),e.TgZ(17,"span",14)(18,"button",15),e.NdJ("click",function(){return t.searchByText()}),e._UZ(19,"i",16),e.qZA()()()(),e.TgZ(20,"div",17)(21,"div",18)(22,"ul",19)(23,"li",20)(24,"div",21)(25,"button",22),e._UZ(26,"i",23),e.TgZ(27,"span",24),e._uU(28,"Trier par"),e.qZA()(),e.YNc(29,zt,17,4,"ul",25),e.qZA()()()()()(),e.TgZ(30,"div",6),e.YNc(31,Xt,3,0,"div",26),e.YNc(32,Wt,3,0,"div",26),e.TgZ(33,"ed-smart-table",27),e.YNc(34,tn,3,4,"ng-template",28),e.qZA()()()()(),e.TgZ(35,"div",29)(36,"div",30)(37,"button",31),e.NdJ("click",function(){return t.close()}),e._uU(38,"Fermer"),e.qZA()()()),2&s&&(e.xp6(4),e.Q6J("ngIf",t.combien>0),e.xp6(4),e.Q6J("ngBusy",t.loader),e.xp6(5),e.Q6J("hidden",t.qcms.length<=1),e.xp6(3),e.Q6J("formControl",t.search),e.xp6(15),e.Q6J("ngIf",!t.currentTaxonomie),e.xp6(1),e.Q6J("ngIf",t.currentTaxonomie&&0===t.qcmsFilter.length),e.xp6(1),e.Q6J("datas",t.qcmsFilter)("pagination",!0)("modeAffichage","other"))},dependencies:[m.O5,l._Y,l.Fj,l.JJ,l.JL,l.F,l.oH,w.Hz,w.Mq,w.TO,b.DC,Ot.L,Dt.r,ae,Ht],styles:[".qcms-search-filter[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:8px 15px}.qcms-search-filter[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .btn-group[_ngcontent-%COMP%]:active:not(.btn-link){box-shadow:none!important}.qcms-search-filter[_ngcontent-%COMP%]   input[type=search][_ngcontent-%COMP%]::-webkit-search-cancel-button{-webkit-appearance:searchfield-cancel-button}.qcms-search-filter[_ngcontent-%COMP%]   .form-control-sm[_ngcontent-%COMP%]{border:medium none;border-radius:4px 0 0 4px;-moz-border-radius:4px 0 0 4px;-webkit-border-radius:4px 0 0 4px;box-shadow:none;color:#8a8a8a}ed-qcm-taxonomie[_ngcontent-%COMP%]     .tree-classic{max-height:500px}"]}),(0,ee.gn)([(0,Ft.W)("qcms-rated-list")],J.prototype,"qcmsRatedList",void 0);var nn=u(4128),on=u(62843),sn=u(46590),O=u(59241);function rn(o,s){1&o&&(e.TgZ(0,"alert",6)(1,"p"),e._uU(2,"Association du questionnaire impossible."),e.qZA(),e.TgZ(3,"p"),e._uU(4," Veuillez affecter une valeur diff\xe9rente de "),e.TgZ(5,"strong"),e._uU(6,"0"),e.qZA(),e._uU(7," au bar\xeame "),e.TgZ(8,"strong"),e._uU(9,"bonne r\xe9ponse"),e.qZA()()())}function cn(o,s){if(1&o&&(e._uU(0," Evaluations sommatives "),e.TgZ(1,"span",15),e._uU(2),e.qZA()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.evaluations.length)}}function an(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",16)(1,"button",17),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.associerDevoir(r))}),e._UZ(2,"i",18),e.qZA(),e.TgZ(3,"strong"),e._uU(4),e.ALo(5,"edDate"),e.qZA(),e._UZ(6,"br"),e._uU(7),e.qZA()}if(2&o){const t=s.$implicit;e.xp6(4),e.AsE("",t.titre," (",e.xi3(5,3,t.date,"dd/MM/y"),")"),e.xp6(3),e.hij(" ",t.sousTitre," ")}}function ln(o,s){1&o&&(e.TgZ(0,"li"),e._uU(1,"Aucune \xe9valuation sommative n'est disponible"),e.qZA())}function un(o,s){if(1&o&&(e._uU(0," Travail \xe0 faire (\xe9valuation formative) "),e.TgZ(1,"span",15),e._uU(2),e.qZA()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.tafs.length)}}function dn(o,s){1&o&&(e.TgZ(0,"small",23),e._UZ(1,"i",24),e.qZA())}function mn(o,s){1&o&&e._UZ(0,"div",25)}function pn(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.hij("(",t.matiereLibelle?t.matiereLibelle:t.matiereCode,")")}}function _n(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",16)(1,"button",19),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.associerTAF(r))}),e._UZ(2,"i",18),e.qZA(),e.TgZ(3,"div",20),e._uU(4),e.ALo(5,"edDate"),e.YNc(6,dn,2,0,"small",21),e.YNc(7,mn,1,0,"div",22),e.qZA(),e._UZ(8,"br"),e._uU(9),e.YNc(10,pn,2,1,"span",5),e.qZA()}if(2&o){const t=s.$implicit,n=e.oxw(2);e.xp6(4),e.hij(" ",e.xi3(5,5,t.date,"EEEE d MMMM")," "),e.xp6(2),e.Q6J("ngIf",!n.parametrages.isCDTPrimaire&&n.parametrages.edt&&!t.idCours),e.xp6(1),e.Q6J("ngIf",t.travailAFaire),e.xp6(2),e.hij(" ",t.entityLibelle," "),e.xp6(1),e.Q6J("ngIf",!n.parametrages.isCDTPrimaire)}}function gn(o,s){1&o&&(e.TgZ(0,"li"),e._uU(1,"Aucune \xe9valuation formative n'est disponible"),e.qZA())}function hn(o,s){if(1&o&&(e.TgZ(0,"tabset")(1,"tab",7),e.YNc(2,cn,3,1,"ng-template",8),e.TgZ(3,"div",9)(4,"alert",10),e._uU(5," Seules les \xe9valuations not\xe9es (non lettr\xe9es !) d'une p\xe9riode ouverte sont disponibles ici, si elles ne sont pas d\xe9j\xe0 associ\xe9es \xe0 un autre questionnaire. "),e.qZA(),e.TgZ(6,"ul",11),e.YNc(7,an,8,6,"li",12),e.ALo(8,"trackByProperty"),e.YNc(9,ln,2,0,"li",5),e.qZA()()(),e.TgZ(10,"tab",13),e.YNc(11,un,3,1,"ng-template",8),e.TgZ(12,"div",9)(13,"ul",14),e.YNc(14,_n,11,8,"li",12),e.ALo(15,"trackByProperty"),e.YNc(16,gn,2,0,"li",5),e.qZA()()()()),2&o){const t=e.oxw();e.xp6(7),e.Q6J("ngForOf",t.evaluations)("ngForTrackBy",e.lcZ(8,6,"idEntite")),e.xp6(2),e.Q6J("ngIf",0===t.evaluations.length),e.xp6(5),e.Q6J("ngForOf",t.tafs)("ngForTrackBy",e.lcZ(15,8,"$index")),e.xp6(2),e.Q6J("ngIf",0===t.tafs.length)}}let fn=(()=>{class o{constructor(t,n,i,r,a,d,p,_){this.authStore=t,this.cahierDeTexteStore=n,this.cdtService=i,this.qcmService=r,this.qcmUserStore=a,this.etablissementStore=d,this.modalRef=p,this.uiService=_,this.evaluations=[],this.tafs=[],this._datePipe=new c.ifA}ngOnInit(){const t=c.Kg5.getModuleParams(c.qzA.CAHIER_DE_TEXTES,this.authStore.currentUser);this.parametrages={edt:"1"===t.edt,isCDTPrimaire:"1"===t.isCDTPrimaire};const n=new Date,i={dateDebut:n,dateFin:c.C_1.addNbMoisToDate(n,1)};this.loader=(0,nn.D)([this.cdtService.loadSlots(this.qcmUserStore.snapshot.idUser,this.qcmUserStore.snapshot.typeUser,this._datePipe.transform(i.dateDebut,"y-MM-dd"),this._datePipe.transform(i.dateFin,"y-MM-dd"),!0).pipe((0,T.K)(r=>this.uiService.notifyErrorThenEmpty(r,!1)),(0,sn.d)(null)),this.qcmService.getAssociationsPotentielles(this.qcm.id)]).pipe((0,x.b)(r=>{const a=c.uKw.getProfClassesGroupesTreeConcatUnique(this.etablissementStore.snapshot);a.length>0&&c.ccH.updateQCMWithCG(r[1],a),this.evaluations=r[1].map(p=>new c.Ldb(p));let d=this.cahierDeTexteStore.getCahierDeTexte(this.qcmUserStore.snapshot.typeUser,this.qcmUserStore.snapshot.idUser,i);if(Object.isExists(d)||(d=[]),this.parametrages.isCDTPrimaire){let p=new Date;for(;p<=i.dateFin;)a.forEach(_=>{const f=d.findIndex(N=>N.date===this._datePipe.transform(p,"y-MM-dd")&&N.idCDT>0&&N.entityType===_.typeEntity&&N.entityCode===_.code);let v;f>-1?v=d[f]:(v=new c.B5X,v.matiereCode=c.meW.CLASSE,v.date=this._datePipe.transform(p,"y-MM-dd"),v.entityCode=_.code,v.entityType=_.typeEntity,v.entityLibelle=_.libelle,v.aFaire=new c.l6t,v.seance=new c.mEw),this.tafs.push(v)}),p=c.C_1.addNbJourToDate(p,1)}else this.tafs=d.edUniq("uniqueID");this.tafs=this.tafs.filter(p=>-1===this.hidedTafs.findIndex(_=>p.idCDT===_.idEntite)).edSortBy("sortByForQCM").map(p=>new c.B5X(p))}),(0,T.K)(r=>(this.evaluations=[],this.tafs=[],this.uiService.notifyEvent(r.action,"Une erreur s'est produite lors de la r\xe9cup\xe9ration des associations potentielles.","Erreur","icon-ed_qcm"),U.E))).subscribe()}associerDevoir(t){this.loader=this.qcmService.associerDevoir(this.qcm.id,t).subscribe({next:()=>{const n=this.evaluations.findIndex(i=>t.idEntite===i.idEntite);n>-1&&this.evaluations.splice(n,1),this.uiService.notifyEvent(c.DOJ.genericSuccess,"Le QCM a bien \xe9t\xe9 associ\xe9 \xe0 ce devoir.","Association effectu\xe9e","icon-ed_qcm")},error:n=>this.uiService.notifyEvent(n.action,"Une erreur s'est produite lors de l'association.","Erreur","icon-ed_qcm")})}associerTAF(t){if(!c.FSr.isNotEmptyString(t.matiereCode,!0))return void this.uiService.notifyEvent(c.DOJ.genericError,"Il n'y a pas de mati\xe8re associ\xe9e. L'association est impossible.","Associations","icon-ed_qcm");if(!c.FSr.isNotEmptyString(t.entityCode,!0))return void this.uiService.notifyEvent(c.DOJ.genericError,"Il n'y a pas de classe ou de groupe associ\xe9e. L'association est impossible.","Associations","icon-ed_qcm");const n=new c.NyH({idEntite:t.idCDT,titre:"Travail \xe0 faire",sousTitre:`${t.entityLibelle} - ${t.matiereLibelle}`,date:t.date});if(t.travailAFaire)this.loader=this.qcmService.associerTAF(this.qcm.id,n).subscribe({next:()=>{const i=this.tafs.findIndex(r=>n.idEntite===r.idCDT);i>-1&&this.tafs.splice(i,1),this.uiService.notifyEvent(c.DOJ.genericSuccess,"Le QCM a bien \xe9t\xe9 associ\xe9 \xe0 ce travail.","Association effectu\xe9e","icon-ed_qcm")},error:i=>this.uiService.notifyEvent(i.action,"Une erreur s'est produite lors de l'association.","Erreur","icon-ed_qcm")});else{const i=new c.B5X(t);Object.isExists(i.aFaire)||(i.aFaire=new c.l6t),i.aFaire.modeEdit=!0,i.aFaire.contenu=c.YC.base64encode("<p>Merci de r\xe9pondre au questionnaire.</p>"),c.FSr.isNotEmptyString(i.aFaire.donneLe)||(i.aFaire.donneLe=this._datePipe.transform(new Date,"y-MM-dd")),this.loader=this.cdtService.save(i,c.P2J.AFAIRE).pipe((0,Z.w)(r=>r>0?(t.idCDT=r,n.idEntite=r,this.qcmService.associerTAF(this.qcm.id,n)):(0,on._)(()=>new c.FwQ("...")))).subscribe({next:()=>{const r=this.tafs.findIndex(a=>n.idEntite===a.idCDT);r>-1&&this.tafs.splice(r,1),this.uiService.notifyEvent(c.DOJ.genericSuccess,"Le QCM a bien \xe9t\xe9 associ\xe9 \xe0 ce travail.","Association effectu\xe9e","icon-ed_qcm")},error:r=>this.uiService.notifyEvent(r.action,"Une erreur s'est produite lors de l'association.","Erreur","icon-ed_qcm")})}}close(){this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.CnD),e.Y36(c.x1h),e.Y36(c.mYE),e.Y36(c.Jqz),e.Y36(h),e.Y36(c.VD2),e.Y36(g.UZ),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-choose-association"]],inputs:{qcm:"qcm",hidedTafs:"hidedTafs"},decls:10,vars:4,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body",3,"ngBusy"],["type","danger","class","margin-bottom",4,"ngIf"],[4,"ngIf"],["type","danger",1,"margin-bottom"],["id","onglets-qcm-associations-sommatives","role","tab"],["tabHeading",""],[1,"simple-padding"],["type","info"],[1,"qcm-associations-evaluations"],["class","item clearfix",4,"ngFor","ngForOf","ngForTrackBy"],["id","onglets-qcm-associations-formatives","role","tab"],[1,"qcm-associations-taf"],[1,"badge","alert-danger"],[1,"item","clearfix"],["title","Associer le qcm \xe0 cette \xe9valuation","type","button",1,"btn","btn-sm","btn-primary","float-end",3,"click"],["aria-hidden","true",1,"fa","fa-link"],["title","Associer le qcm \xe0 ce travail","type","button",1,"btn","btn-sm","btn-primary","float-end",3,"click"],[2,"font-weight","bold"],["title","Saisie hors emploi du temps",4,"ngIf"],["class","pastille-ok","title","Travail \xe0 faire saisi",4,"ngIf"],["title","Saisie hors emploi du temps"],["aria-hidden","true",1,"fa","fa-2x","fa-info-circle"],["title","Travail \xe0 faire saisi",1,"pastille-ok"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2," Associer "),e.TgZ(3,"b"),e._uU(4),e.qZA(),e._uU(5," \xe0 une \xe9valuation sommative (notes) ou \xe0 une \xe9valuation formative (cahier de textes) "),e.qZA(),e.TgZ(6,"button",2),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(7,"div",3),e.YNc(8,rn,10,0,"alert",4),e.YNc(9,hn,17,10,"tabset",5),e.qZA()),2&t&&(e.xp6(4),e.Oqu(n.qcm.titre),e.xp6(3),e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("ngIf",0===n.qcm.baremeBR),e.xp6(1),e.Q6J("ngIf",0!==n.qcm.baremeBR))},dependencies:[m.sg,m.O5,A.wx,b.DC,O.wW,O.AH,O.y3,c.ifA,q.$],styles:["#onglets-qcm-associations-sommatives[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], #onglets-qcm-associations-formatives[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin-bottom:20px;padding-top:20px;box-shadow:0 0 3px #0000004d;border:1px solid var(--light-placeholder-color)}.qcm-associations-taf[_ngcontent-%COMP%], .qcm-associations-evaluations[_ngcontent-%COMP%]{overflow-y:auto;max-height:700px}.qcm-associations-taf[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .qcm-associations-evaluations[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:0 0 20px;padding:20px 0 0}.qcm-associations-taf[_ngcontent-%COMP%]   .pastille-ok[_ngcontent-%COMP%]{display:inline-block;margin:0 10px;width:8px;height:8px;border-radius:50px;background:var(--travail-color)}.qcm-associations-taf[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] > small[_ngcontent-%COMP%]{color:#31708f;font-size:12px}"]}),o})();const qn=["shareQCMForm"];function Cn(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij("(",t.combien," qcm)")}}function vn(o,s){1&o&&(e.TgZ(0,"alert",27)(1,"strong"),e._uU(2,"Attention !"),e.qZA(),e._uU(3," Certains champs ne sont pas renseign\xe9s ou sont incorrects "),e.qZA()),2&o&&e.Q6J("dismissible",!0)}function bn(o,s){1&o&&(e.TgZ(0,"span",28),e._uU(1,"Saisissez un commentaire !"),e.qZA())}function Qn(o,s){1&o&&(e.TgZ(0,"span",28),e._uU(1,"Saisissez le nom de votre \xe9tablissement !"),e.qZA())}function xn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",29)(1,"button",30),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.removeTagTaxonomie(r))}),e._UZ(2,"i",31),e._uU(3),e.TgZ(4,"b"),e._uU(5),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(1),e.uIk("aria-label","Suprimer le QCM de la cat\xe9gorie "+t.libelleParent+"/"+t.libelle),e.xp6(2),e.hij(" ",t.libelleParent," / "),e.xp6(2),e.Oqu(t.libelle)}}const L=function(o){return{"has-error":o}};let Tn=(()=>{class o{constructor(t,n,i,r,a){this.authStore=t,this.modalRef=n,this.modalService=i,this.qcmService=r,this.uiService=a,this.combien=0}ngOnInit(){this.qcm.natEtablissement=this.authStore.currentUser.nomEtablissement}onOpenNode(t){!Object.isExists(t)||t.hasChildrenField||(Array.isArray(this.qcm.taxonomies)||(this.qcm.taxonomies=[]),this.qcm.taxonomies.findIndex(i=>t.id===i.id)>-1)||this.qcm.taxonomies.push(new c.C_g(t))}removeTagTaxonomie(t){!Array.isArray(this.qcm.taxonomies)||this.qcm.taxonomies.edRemove(n=>t.id===n.id)}onSubmit(){this.formShare.valid&&(this.loader=this.qcmService.shareQCM(this.qcm).subscribe({next:()=>{this.uiService.notifyEvent(c.DOJ.genericSuccess,"Votre questionnaire a bien \xe9t\xe9 partag\xe9 sur la base inter-\xe9tablissements.","QCM","icon-ed_qcm"),this.close()},error:t=>this.uiService.notifyEvent(t.action,"Une erreur s'est produite lors du partage de votre questionnaire.","Erreur","icon-ed_qcm")}))}backToQCMS(){this.formShare.dirty?(this.modalService.show(E.z,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:"Annuler les modifications",message:"<p>\xcates vous s\xfbr de vouloir annuler les modifications ?</p>"}}),this.modalService.onHide.pipe((0,C.q)(1)).subscribe(t=>{t===Q.G.validation&&this.close()})):this.close()}onCombienQCM(t){this.combien=t}close(){this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.CnD),e.Y36(g.UZ),e.Y36(g.tT),e.Y36(c.Jqz),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-base-nationale-partage"]],viewQuery:function(t,n){if(1&t&&e.Gf(qn,5),2&t){let i;e.iGM(i=e.CRH())&&(n.formShare=i.first)}},inputs:{qcm:"qcm"},decls:42,vars:21,consts:[[1,"modal-header"],[1,"modal-title"],[4,"ngIf"],[1,"form-text","modal-subtitle"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body",3,"ngBusy"],["name","shareQCMForm","novalidate","",1,"row",3,"ngSubmit"],["shareQCMForm","ngForm"],["type","danger",3,"dismissible",4,"ngIf"],[1,"row","required",3,"ngClass"],["for","natCommentaire",1,"col-md-2","col-form-label"],[1,"col-md-10"],["name","natCommentaire","id","natCommentaire","rows","3","required","",1,"form-control",3,"ngModel","ngModelChange"],["natCommentaire","ngModel"],["class","text-danger",4,"ngIf"],["for","natEtablissement",1,"col-md-2","col-form-label"],["name","natEtablissement","type","text","id","natEtablissement","required","",1,"form-control",3,"ngModel","ngModelChange"],["natEtablissement","ngModel"],[1,"col-md-2","col-form-label"],[1,"tags-taxonomie","list-inline"],["class","list-inline-item",4,"ngFor","ngForOf","ngForTrackBy"],[3,"openNode","combienQCM"],[1,"form-text"],[1,"modal-footer"],[1,"w-100"],["type","button",1,"btn","btn-warning","float-start",3,"click"],["type","button",1,"btn","btn-success","float-end",3,"disabled","click"],["type","danger",3,"dismissible"],[1,"text-danger"],[1,"list-inline-item"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-close"]],template:function(t,n){if(1&t){const i=e.EpF();e.TgZ(0,"div",0)(1,"div")(2,"h3",1),e._uU(3," Partager le questionnaire dans la base inter-\xe9tablissements "),e.YNc(4,Cn,2,1,"span",2),e.qZA(),e.TgZ(5,"span",3),e._uU(6,"Ce questionnaire pourra \xeatre utilis\xe9 par l'ensemble des enseignants utilisateurs EcoleDirecte."),e.qZA()(),e.TgZ(7,"button",4),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(8,"div",5)(9,"form",6,7),e.NdJ("ngSubmit",function(){return n.onSubmit()}),e.YNc(11,vn,4,1,"alert",8),e.TgZ(12,"div",9)(13,"label",10),e._uU(14,"Commentaire de partage"),e.qZA(),e.TgZ(15,"div",11)(16,"textarea",12,13),e.NdJ("ngModelChange",function(a){return n.qcm.natCommentaire=a}),e.qZA(),e.YNc(18,bn,2,0,"span",14),e.qZA()(),e.TgZ(19,"div",9)(20,"label",15),e._uU(21,"Votre \xe9tablissement"),e.qZA(),e.TgZ(22,"div",11)(23,"input",16,17),e.NdJ("ngModelChange",function(a){return n.qcm.natEtablissement=a}),e.qZA(),e.YNc(25,Qn,2,0,"span",14),e.qZA()(),e.TgZ(26,"div",9)(27,"strong",18),e._uU(28,"Cat\xe9gories"),e.qZA(),e.TgZ(29,"div",11)(30,"ul",19),e.YNc(31,xn,6,3,"li",20),e.ALo(32,"trackByProperty"),e.qZA(),e.TgZ(33,"ed-qcm-taxonomie",21),e.NdJ("openNode",function(a){return n.onOpenNode(a)})("combienQCM",function(a){return n.onCombienQCM(a)}),e.qZA(),e.TgZ(34,"span",22),e._uU(35,"Choisissez une ou plusieurs cat\xe9gories pour votre questionnaire dans la base inter-\xe9tablissements"),e.qZA()()()()(),e.TgZ(36,"div",23)(37,"div",24)(38,"button",25),e.NdJ("click",function(){return n.backToQCMS()}),e._uU(39,"Annuler"),e.qZA(),e.TgZ(40,"button",26),e.NdJ("click",function(){e.CHM(i);const a=e.MAs(10);return e.KtG(a.ngSubmit.emit())}),e._uU(41," Partager "),e.qZA()()()}if(2&t){const i=e.MAs(10),r=e.MAs(17),a=e.MAs(24);e.xp6(4),e.Q6J("ngIf",n.combien>0),e.xp6(4),e.Q6J("ngBusy",n.loader),e.xp6(3),e.Q6J("ngIf",i.submitted&&i.invalid),e.xp6(1),e.Q6J("ngClass",e.VKq(15,L,r.invalid)),e.xp6(4),e.Q6J("ngModel",n.qcm.natCommentaire),e.xp6(2),e.Q6J("ngIf",null==r.errors?null:r.errors.required),e.xp6(1),e.Q6J("ngClass",e.VKq(17,L,a.invalid)),e.xp6(4),e.Q6J("ngModel",n.qcm.natEtablissement),e.xp6(2),e.Q6J("ngIf",null==a.errors?null:a.errors.required),e.xp6(1),e.Q6J("ngClass",e.VKq(19,L,!n.qcm.taxonomies||0===n.qcm.taxonomies.length)),e.xp6(5),e.Q6J("ngForOf",n.qcm.taxonomies)("ngForTrackBy",e.lcZ(32,13,"$index")),e.xp6(9),e.Q6J("disabled",(null==i?null:i.invalid)||!n.qcm.taxonomies||0===n.qcm.taxonomies.length)}},dependencies:[m.mk,m.sg,m.O5,l._Y,l.Fj,l.JJ,l.JL,l.Q7,l.On,l.F,A.wx,b.DC,ae,q.$],styles:["ul.tags-taxonomie[_ngcontent-%COMP%]{margin-bottom:10px}ul.tags-taxonomie[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin:0;padding:2px}"]}),o})();function Mn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",2)(1,"ul",3)(2,"li",4)(3,"div",5)(4,"button",6),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.manageQuestionnaire.emit())}),e._UZ(5,"i",7),e._uU(6," Nouveau QCM "),e.qZA()()(),e.TgZ(7,"li",8)(8,"div",5)(9,"button",9),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.openBaseNationale.emit())}),e._UZ(10,"i",10),e._uU(11," Choisir dans la base inter-\xe9tablissements "),e.qZA()()()()()}}function Zn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).ngIf,r=e.oxw();return r.qcmUserStore.updateChoosenAnnee(i[3]),e.KtG(r.refreshQcms.emit(!1))}),e._uU(1," Ann\xe9e en cours "),e.qZA()}}function yn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw(3);return a.qcmUserStore.updateChoosenAnnee(r),e.KtG(a.refreshQcms.emit(!1))}),e._uU(1),e.qZA()}if(2&o){const t=s.$implicit;e.xp6(1),e.hij(" ",t," ")}}function An(o,s){if(1&o&&(e.TgZ(0,"ul",16)(1,"li",17),e.YNc(2,Zn,2,0,"button",18),e.YNc(3,yn,2,1,"button",19),e.ALo(4,"slice"),e.ALo(5,"trackByProperty"),e.qZA()()),2&o){const t=e.oxw().ngIf,n=e.oxw();e.xp6(2),e.Q6J("ngIf",n.qcmUserStore.snapshot.choosenAnnee),e.xp6(1),e.Q6J("ngForOf",e.Dn7(4,3,t,0,3))("ngForTrackBy",e.lcZ(5,7,"$index"))}}function En(o,s){if(1&o&&(e.TgZ(0,"div",11)(1,"ul",3)(2,"li",12)(3,"div",13)(4,"button",14)(5,"span"),e._uU(6),e.qZA()(),e.YNc(7,An,6,9,"ul",15),e.qZA()()()()),2&o){const t=e.oxw();e.xp6(6),e.Oqu(t.authStore.isAnneeCourante(t.qcmUserStore.snapshot.choosenAnnee)?"Acc\xe8s aux archives":t.qcmUserStore.snapshot.choosenAnnee)}}let Sn=(()=>{class o{constructor(t,n){this.authStore=t,this.qcmUserStore=n,this.manageQuestionnaire=new e.vpe,this.openBaseNationale=new e.vpe,this.refreshQcms=new e.vpe}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.CnD),e.Y36(h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcms-globals-actions"]],outputs:{manageQuestionnaire:"manageQuestionnaire",openBaseNationale:"openBaseNationale",refreshQcms:"refreshQcms"},decls:2,vars:2,consts:[["class","float-start",4,"ngIf"],["class","float-end",4,"ngIf"],[1,"float-start"],[1,"list-inline"],[1,"list-inline-item","add-new-qcm"],[1,"btn-group"],["type","button","title","Nouveau questionnaire",1,"btn","btn-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-plus"],[1,"list-inline-item","clone-qcm-from-national"],["type","button",1,"btn","btn-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-search-plus"],[1,"float-end"],[1,"list-inline-item","older-year"],["dropdown","",1,"btn-group"],["dropdownToggle","","id","dropdown2","type","button","aria-controls","dropdown-annees",1,"btn","btn-secondary","dropdown-toggle"],["aria-labelledby","dropdown2","id","dropdown-annees","class","dropdown-menu dropdown-menu-right","role","menu",4,"dropdownMenu"],["aria-labelledby","dropdown2","id","dropdown-annees","role","menu",1,"dropdown-menu","dropdown-menu-right"],["role","menuitem"],["type","button","class","dropdown-item",3,"click",4,"ngIf"],["type","button","class","dropdown-item",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"dropdown-item",3,"click"]],template:function(t,n){1&t&&(e.YNc(0,Mn,12,0,"div",0),e.YNc(1,En,8,1,"div",1)),2&t&&(e.Q6J("ngIf",n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)),e.xp6(1),e.Q6J("ngIf",n.qcmUserStore.getAnneesQCMsArchive()))},dependencies:[m.sg,m.O5,w.Hz,w.Mq,w.TO,m.OU,q.$],encapsulation:2,changeDetection:0}),o})();function wn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"span",13)(1,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.manageEtiquette.emit(i))}),e._UZ(2,"i",15),e.qZA(),e.TgZ(3,"button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,r=e.oxw(2);return e.KtG(r.deleteEtiquette.emit(i))}),e._UZ(4,"i",17),e.qZA()()}}const H=function(o){return{"etiquette-actif active":o}};function Un(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return a.toggleEtiquette.emit(r.id),e.KtG(a.selectFilter("tag"))}),e.TgZ(1,"span",9),e._UZ(2,"i",10),e._uU(3),e.qZA(),e.TgZ(4,"span",11),e._uU(5),e.qZA(),e.YNc(6,wn,5,0,"span",12),e.qZA()}if(2&o){const t=s.$implicit,n=e.oxw(2);e.Q6J("ngClass",e.VKq(7,H,n.qcmUserStore.isActif(t.id))),e.uIk("aria-label",(n.qcmUserStore.isActif(t.id)?"Masquer ":"Afficher ")+t.badge+" questionnaires associ\xe9s \xe0 l'\xe9tiquette "+t.libelle),e.xp6(1),e.MGl("title","",n.qcmUserStore.isActif(t.id)?"Masquer":"Afficher"," les questionnaires associ\xe9s"),e.xp6(2),e.hij(" ",t.libelle," "),e.xp6(1),e.MGl("title","",n.qcmUserStore.isActif(t.id)?"Masquer":"Afficher"," les questionnaires associ\xe9s"),e.xp6(1),e.Oqu(t.badge),e.xp6(1),e.Q6J("ngIf",n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee))}}function kn(o,s){if(1&o&&(e.TgZ(0,"div",3),e.YNc(1,Un,7,9,"button",7),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.etiquettes)("ngForTrackBy",e.lcZ(2,2,"id"))}}function Jn(o,s){1&o&&e._UZ(0,"hr",18)}function Nn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",19)(1,"div",20)(2,"div",21)(3,"button",22),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.manageEtiquette.emit())}),e._UZ(4,"i",23),e._uU(5," Nouvelle \xe9tiquette "),e.qZA()()()()}}let Fn=(()=>{class o{constructor(t,n){this.authStore=t,this.qcmUserStore=n,this.filterSelected="all",this.manageEtiquette=new e.vpe,this.deleteEtiquette=new e.vpe,this.toggleEtiquette=new e.vpe,this.orphanEtiquette=new e.vpe,this.allQ=new e.vpe}selectFilter(t){this.filterSelected=t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.CnD),e.Y36(h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcms-etiquettes"]],inputs:{etiquettes:"etiquettes"},outputs:{manageEtiquette:"manageEtiquette",deleteEtiquette:"deleteEtiquette",toggleEtiquette:"toggleEtiquette",orphanEtiquette:"orphanEtiquette",allQ:"allQ"},decls:10,vars:9,consts:[[1,"qcms-etiquette","margin-bottom-20"],["class","list-group primary",4,"ngIf"],["role","separator",4,"ngIf"],[1,"list-group","primary"],["type","button","aria-label","Afficher les QCM sans \xe9tiquettes",1,"list-group-item","list-group-item-action",3,"ngClass","click"],["aria-hidden","true",1,"fa","fa-list"],["class","row",4,"ngIf"],["type","button","class","list-group-item list-group-item-action",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"list-group-item","list-group-item-action",3,"ngClass","click"],["aria-hidden","true",1,"libelle-etiquette",3,"title"],[1,"fa","fa-tag"],["aria-hidden","true",1,"badge",3,"title"],["class","float-end btn-action-etiquette",4,"ngIf"],[1,"float-end","btn-action-etiquette"],["type","button","title","Modifier l'\xe9tiquette",1,"btn","btn-primary-color","no-padding","edit-etiquette",3,"click"],["aria-hidden","true",1,"fa","fa-pencil","i-small","size-17"],["type","button","title","Supprimer l'\xe9tiquette",1,"btn","btn-danger-color","no-padding",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o","i-small","size-17"],["role","separator"],[1,"row"],[1,"col-lg-12"],[1,"btn-group","btn-group-sm"],["type","button","title","Ajouter une nouvelle \xe9tiquette",1,"btn","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-plus"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,kn,3,4,"div",1),e.YNc(2,Jn,1,0,"hr",2),e.TgZ(3,"div",3)(4,"button",4),e.NdJ("click",function(){return n.orphanEtiquette.emit(),n.selectFilter("sansTag")}),e._uU(5," QCM sans \xe9tiquettes "),e.qZA(),e.TgZ(6,"button",4),e.NdJ("click",function(){return n.allQ.emit(),n.selectFilter("all")}),e._UZ(7,"i",5),e._uU(8," Tous les QCM "),e.qZA()()(),e.YNc(9,Nn,6,0,"div",6)),2&t&&(e.xp6(1),e.Q6J("ngIf",null==n.etiquettes?null:n.etiquettes.length),e.xp6(1),e.Q6J("ngIf",null==n.etiquettes?null:n.etiquettes.length),e.xp6(2),e.Q6J("ngClass",e.VKq(5,H,"sansTag"===n.filterSelected)),e.xp6(2),e.Q6J("ngClass",e.VKq(7,H,"all"===n.filterSelected)),e.xp6(3),e.Q6J("ngIf",n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)))},dependencies:[m.mk,m.sg,m.O5,q.$],encapsulation:2,changeDetection:0}),o})();function On(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.showCorrectif())}),e._UZ(1,"i",16),e._uU(2," Afficher le correctif "),e.qZA()}}function Dn(o,s){if(1&o&&(e.TgZ(0,"div",12)(1,"div",13),e._uU(2," Question "),e.TgZ(3,"span"),e._uU(4),e.qZA(),e._uU(5," / "),e.TgZ(6,"span"),e._uU(7),e.qZA(),e.YNc(8,On,3,0,"button",14),e.qZA()()),2&o){const t=e.oxw();e.xp6(4),e.Oqu(t.indice+1),e.xp6(3),e.Oqu(t.combienQuestions),e.xp6(1),e.Q6J("ngIf",(null==t.participant?null:t.participant.peutVoirSolutions)&&!t.displayCorrectif)}}function Pn(o,s){if(1&o&&(e.TgZ(0,"div",17),e.ALo(1,"filterHtml"),e.ALo(2,"base64"),e._uU(3," enonce "),e.qZA()),2&o){const t=e.oxw();e.Q6J("content",t.question.enonce)("compile",t.isCurrentQuestionDisplay)("innerHTML",e.lcZ(1,3,e.lcZ(2,5,t.question.enonce)),e.oJD)}}function In(o,s){if(1&o&&(e.TgZ(0,"figcaption"),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Oqu(t.question.titreSon)}}function Yn(o,s){if(1&o&&(e.TgZ(0,"figure"),e.YNc(1,In,2,1,"figcaption",5),e.TgZ(2,"audio",18),e.ALo(3,"safe"),e._uU(4," Votre navigateur ne supporte pas le format "),e.TgZ(5,"code"),e._uU(6,"audio"),e.qZA(),e._uU(7," utilis\xe9. "),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.question.titreSon),e.xp6(1),e.Q6J("src",e.xi3(3,3,t.question.srcSon,"url"),e.LSH),e.uIk("id","audio"+t.question.id)}}const G=function(o,s){return{"reponse-correcte":o,"reponse-error":s}};function Bn(o,s){if(1&o&&(e.TgZ(0,"div",21),e._UZ(1,"input",22),e.TgZ(2,"label",23),e._UZ(3,"span",24),e.ALo(4,"filterHtml"),e.ALo(5,"replaceFormulaQuestionProp"),e.ALo(6,"base64"),e.qZA()()),2&o){const t=s.$implicit,n=e.oxw(2);e.Q6J("ngClass",e.WLB(17,G,n.isPropositionGoodOne(t.id),n.isSelectedChoiceBad(t.id))),e.xp6(1),e.hYB("id","choix-",t.id,"-pour-question-",n.question.id,""),e.Q6J("checked",n.choixRadio.value===t.id)("value",t.id),e.xp6(1),e.hYB("for","choix-",t.id,"-pour-question-",n.question.id,""),e.xp6(1),e.Q6J("content",t.enonce)("innerHTML",e.xi3(4,10,e.lcZ(5,13,e.lcZ(6,15,t.enonce)),!0),e.oJD)("compile",n.isCurrentQuestionDisplay)}}function Rn(o,s){if(1&o&&(e.TgZ(0,"div",19),e.YNc(1,Bn,7,20,"div",20),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.question.propositions)("ngForTrackBy",e.lcZ(2,2,"id"))}}function Ln(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",21)(1,"input",26),e.NdJ("change",function(i){const a=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.onCheckBoxChange(a.id,i))}),e.qZA(),e.TgZ(2,"label",27),e._UZ(3,"span",24),e.ALo(4,"filterHtml"),e.ALo(5,"replaceFormulaQuestionProp"),e.ALo(6,"base64"),e.qZA()()}if(2&o){const t=s.$implicit,n=e.oxw(2);e.Q6J("ngClass",e.WLB(16,G,n.isPropositionGoodOne(t.id),n.isSelectedChoiceBad(t.id))),e.xp6(1),e.MGl("name","choix-pour-question-",n.question.id,"")("id","check_reponse_",t.id,""),e.Q6J("checked",n.choixCheckbox.value.indexOf(t.id)>-1)("disabled",n.copieCorrigee),e.xp6(1),e.MGl("for","check_reponse_",t.id,""),e.xp6(1),e.Q6J("content",t.enonce)("innerHTML",e.xi3(4,9,e.lcZ(5,12,e.lcZ(6,14,t.enonce)),!0),e.oJD)("compile",n.isCurrentQuestionDisplay)}}function Hn(o,s){if(1&o&&(e.TgZ(0,"div",25),e.YNc(1,Ln,7,19,"div",20),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.question.propositions)("ngForTrackBy",e.lcZ(2,2,"id"))}}function Gn(o,s){if(1&o&&(e.TgZ(0,"span",3),e._UZ(1,"input",36),e.qZA()),2&o){const t=e.oxw().index,n=e.oxw().$implicit,i=e.oxw(2);e.Q6J("ngClass",e.WLB(3,G,i.isHoleGood(n.id,t),i.isSelectedChoiceBad(n.id,t))),e.xp6(1),e.s9C("formControlName",t),e.Q6J("readOnly",i.copieCorrigee)}}function Vn(o,s){if(1&o&&(e.TgZ(0,"span",33),e._UZ(1,"span",34),e.ALo(2,"filterHtml"),e.YNc(3,Gn,2,6,"span",35),e.qZA()),2&o){const t=s.$implicit,n=s.last;e.xp6(1),e.Q6J("innerHTML",e.xi3(2,2,t,!0),e.oJD),e.xp6(2),e.Q6J("ngIf",!n)}}function $n(o,s){if(1&o&&(e.TgZ(0,"li")(1,"b"),e._uU(2),e.qZA()()),2&o){const t=s.$implicit;e.xp6(2),e.Oqu(t.split("|").join(" OU "))}}function Kn(o,s){if(1&o&&(e.TgZ(0,"div",37),e._UZ(1,"br"),e._uU(2," Les r\xe9ponses attendues : "),e.TgZ(3,"ol"),e.YNc(4,$n,3,1,"li",38),e.ALo(5,"trackByProperty"),e.qZA()()),2&o){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(4),e.Q6J("ngForOf",n.solution.choixDecode[t.id])("ngForTrackBy",e.lcZ(5,2,"$index"))}}function jn(o,s){if(1&o&&(e.TgZ(0,"div",30),e.YNc(1,Vn,4,5,"span",31),e.ALo(2,"textHolesToArray"),e.ALo(3,"trackByProperty"),e.YNc(4,Kn,6,4,"div",32),e.qZA()),2&o){const t=s.$implicit,n=e.oxw(2);e.s9C("formArrayName",t.id),e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,4,t.enonceDecode))("ngForTrackBy",e.lcZ(3,6,"$index")),e.xp6(3),e.Q6J("ngIf",(n.displayCorrectif||n.copieCorrigee)&&n.solution)}}function zn(o,s){if(1&o&&(e.TgZ(0,"div",28),e.YNc(1,jn,5,8,"div",29),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.question.propositions)("ngForTrackBy",e.lcZ(2,2,"id"))}}function Xn(o,s){if(1&o&&(e.TgZ(0,"alert",39)(1,"div",40),e.ALo(2,"filterHtml"),e.ALo(3,"base64"),e._uU(4," remediation "),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("content",t.solution.remediation)("innerHTML",e.lcZ(2,3,e.lcZ(3,5,t.solution.remediation)),e.oJD)("compile",t.isCurrentQuestionDisplay)}}function Wn(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",46),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.goToPreviousSlide())}),e._UZ(1,"i",47),e._uU(2," Question pr\xe9c\xe9dente "),e.qZA()}}function eo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",41),e.YNc(1,Wn,3,0,"button",42),e.TgZ(2,"button",43),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.goToNextSlide())}),e._uU(3),e._UZ(4,"i",44),e.qZA(),e._UZ(5,"span",45),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",(t.participant.peutVoirSolutions||t.copieCorrigee)&&!t.isFirstQuestion),e.xp6(2),e.hij(" ",t.isLastQuestion?"Terminer":"Question suivante"," ")}}const to=function(o,s){return{"question-success":o,"question-error":s}};let no=(()=>{class o{constructor(t,n,i,r,a){this.authStore=t,this.qcmService=n,this.loaderService=i,this.uiService=r,this.elementRef=a,this.questionBaseType=c.xq9,this.questionForm=new l.cw({radio:new l.NI(""),checkbox:new l.Oe([]),textholes:new l.cw({})}),this.nextSlide=new e.vpe,this.previousSlide=new e.vpe,this.ended=new e.vpe}ngOnInit(){this.displayCorrectif=!1,this.hasAnswered=this.authStore.isProfesseur()||this.copieCorrigee}ngOnChanges(){this.updateTextHoles(),this.createFormGroup()}ngAfterViewInit(){this.audio=this.elementRef.nativeElement.querySelector(`#audio${this.question.id}`)}getNestedGroupControl(t){return this.questionForm.get(t)}get choixRadio(){return this.questionForm.get("radio")}get choixCheckbox(){return this.questionForm.get("checkbox")}get choixTextholes(){return this.questionForm.get("textholes")}get qCSSSuccess(){return!(!this.copieCorrigee&&!this.displayCorrectif)&&this.questionForm&&!this.questionForm.hasError("invalidQuestion")}get qCSSError(){return!(!this.copieCorrigee&&!this.displayCorrectif)&&this.questionForm&&this.questionForm.hasError("invalidQuestion")}createFormGroup(){const t={};switch(this.question.typeQ){case c.xq9.radio.id:t.radio=new l.NI({value:"",disabled:this.copieCorrigee}),this.reponse&&this.reponse.choix>0&&t.radio.setValue(this.reponse.choix);break;case c.xq9.checkbox.id:t.checkbox=new l.Oe([]),this.reponse&&Array.isArray(this.reponse.choix)&&this.reponse.choix.forEach(n=>{t.checkbox.push(new l.NI(n))});break;case c.xq9.textholes.id:{const n={};if(this.reponse&&Object.isExists(this.reponse.choixDecode)){const i=Object.keys(this.reponse.choixDecode);for(const r of i){const a=this.reponse.choixDecode[r].reduce((d,p)=>(d.push(new l.NI(p)),d),[]);n[r]=new l.Oe(a)}}t.textholes=new l.cw(n);break}}if(this.questionForm=new l.cw(t),this.solution)switch(this.question.typeQ){case c.xq9.radio.id:this.solution.choix>0&&(!0===this.copieCorrigee&&this.choixRadio.enable(),this.questionForm.setValidators([(0,c.mZK)(this.question.typeQ,this.solution.choix)]),this.questionForm.updateValueAndValidity(),!0===this.copieCorrigee&&this.choixRadio.disable());break;case c.xq9.checkbox.id:Array.isArray(this.solution.choix)&&(this.questionForm.setValidators([(0,c.mZK)(this.question.typeQ,this.solution.choix)]),this.questionForm.updateValueAndValidity());break;case c.xq9.textholes.id:if(Object.isExists(this.solution.choixDecode)){const n=Object.keys(this.solution.choixDecode);for(const i of n)this.questionForm.setValidators([(0,c.mZK)(this.question.typeQ,this.solution.choixDecode[i],i)]),this.questionForm.updateValueAndValidity()}}}isPropositionGoodOne(t){if(!this.copieCorrigee&&!this.displayCorrectif)return!1;switch(this.question.typeQ){case c.xq9.radio.id:return t===this.solution.choix;case c.xq9.checkbox.id:return this.solution.choix.indexOf(t)>-1;default:return!1}}isHoleGood(t,n){if(!this.copieCorrigee&&!this.displayCorrectif)return!1;const i=this.getNestedGroupControl(["textholes",`${t}`]);if(!i)return!1;const r=i.value[n];return this.solution.choixDecode[t][n].split("|").some(p=>c.QR_.getCleanValue(r)===c.QR_.getCleanValue(p))}isSelectedChoiceBad(t,n){if(!this.copieCorrigee&&!this.displayCorrectif)return!1;switch(this.question.typeQ){case c.xq9.radio.id:return this.choixRadio.value===t&&t!==this.solution.choix;case c.xq9.checkbox.id:return-1!==this.choixCheckbox.value.indexOf(t)&&-1===this.solution.choix.indexOf(t);case c.xq9.textholes.id:{const i=this.getNestedGroupControl(["textholes",`${t}`]);if(!i)return!1;const r=i.value[n];return!this.solution.choixDecode[t][n].split("|").some(p=>c.QR_.getCleanValue(r)===c.QR_.getCleanValue(p))}default:return!1}}onCheckBoxChange(t,n){const i=n.target.checked,r=this.choixCheckbox.controls.findIndex(a=>`${a.value}`==`${t}`);i&&-1===r&&this.choixCheckbox.push(new l.NI(t)),!i&&r>-1&&this.choixCheckbox.removeAt(r)}saveQ(){if(this.authStore.isEleve()||this.authStore.isFamille()){if(this.hasAnswered)return(0,D.of)(void 0);const t=new c.xir(this.reponse);switch(this.question.typeQ){case c.xq9.radio.id:t.choix=this.choixRadio.value?this.choixRadio.value:null;break;case c.xq9.checkbox.id:t.choix=this.choixCheckbox.value.sort((i,r)=>i-r);break;case c.xq9.textholes.id:{const i=Object.keys(this.choixTextholes.value);for(const r of i){let a=!0;const d=this.choixTextholes.value[r].map(p=>(""!==p&&(a=!1),c.QR_.getCleanValue(p)));t.choix[r]=a?"":c.YC.base64encode(d.join(c.IZV)),delete t.choixDecode[r]}break}}const n=this.authStore.isFamille()&&this.idEleve>0?this.idEleve:this.authStore.currentUser.id;return this.qcmService.saveParticipantReponse(n,this.idQCM,this.association.id,this.participant.idParticipant,t).pipe((0,Z.w)(i=>(this.hasAnswered=!0,this.isLastQuestion?(this.ended.emit(!0),this.qcmService.setEndDateQCMEleve(n,this.idQCM,this.association.id,this.participant.idParticipant).pipe((0,P.U)(r=>i))):(0,D.of)(i))),(0,T.K)(i=>(i.message=i.status===c.GL1.DeniedAccess?i.message:"Une erreur s'est produite lors de l'enregistrement de votre r\xe9ponse.",this.uiService.notifyErrorThenEmpty(i,!0,"Erreur","icon-ed_qcm"))))}return(0,D.of)(void 0)}goToNextSlide(){this.stopAudio(),(this.authStore.isEleve()||this.authStore.isFamille())&&!this.hasAnswered&&(this.loader=this.loaderService.show(this)),this.saveQ().pipe((0,y.x)(()=>{(this.authStore.isEleve()||this.authStore.isFamille())&&this.loaderService.hide(this)})).subscribe(t=>this.nextSlide.emit(),t=>{})}goToPreviousSlide(){this.stopAudio(),this.previousSlide.emit()}showCorrectif(){this.displayCorrectif=!0}stopAudio(){this.audio&&(this.audio.pause(),this.audio.currentTime=0)}updateTextHoles(){this.question.typeQ===c.xq9.textholes.id&&this.question.propositions.forEach(t=>{if(t.enonceDecode=t.enonce?c.YC.base64decode(t.enonce):"",t.enonceDecode=t.enonceDecode.replace(/<div[^>]*>(.*?)<\/div>/gi,"<br />$1"),this.reponse&&this.reponse.choix&&void 0!==this.reponse.choix[t.id]){const n=t.enonceDecode.split(c.IZV),r=c.YC.base64decode(this.reponse.choix[t.id]).split(c.IZV),a=[];for(let d=0;d<n.length-1;d++)a.push(Object.isExists(r[d])?r[d]:"");this.reponse.choixDecode={[t.id]:a}}if(this.solution&&this.solution.choix&&this.solution.choix[t.id]){const i=c.YC.base64decode(this.solution.choix[t.id]).split(c.IZV).reduce((r,a)=>(r.push(a.replace("&nbsp;","")),r),[]);this.solution.choixDecode={[t.id]:i}}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.CnD),e.Y36(c.Jqz),e.Y36(R.S),e.Y36(c.VLf),e.Y36(e.SBq))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-form-viewer-question-resultat"]],inputs:{isCurrentQuestionDisplay:"isCurrentQuestionDisplay",idEleve:"idEleve",idQCM:"idQCM",association:"association",question:"question",solution:"solution",reponse:"reponse",participant:"participant",combienQuestions:"combienQuestions",indice:"indice",isFirstQuestion:"isFirstQuestion",isLastQuestion:"isLastQuestion",copieCorrigee:"copieCorrigee"},outputs:{nextSlide:"nextSlide",previousSlide:"previousSlide",ended:"ended"},features:[e.TTD],decls:15,vars:18,consts:[["class","card border-0",4,"ngIf"],[1,"qcm-form-viewer-question",3,"ngBusy"],["autocomplete","off","novalidate","",3,"formGroup"],[3,"ngClass"],["class","list-group-item-text qcm-img-container ed-cke","edMathjax","",3,"content","compile","innerHTML",4,"ngIf"],[4,"ngIf"],[1,"qcm-form-viewer-question-input",3,"ngSwitch"],["class","une-question-type-radio",4,"ngSwitchCase"],["class","une-question-type-checkbox","formArrayName","checkbox",4,"ngSwitchCase"],["class","une-question-type-textholes","formGroupName","textholes",4,"ngSwitchCase"],["type","warning","class","qcm-img-container",4,"ngIf"],["class","qcm-form-viewer-action-list",4,"ngIf"],[1,"card","border-0"],[1,"card-body","text-bold"],["class","btn btn-sm btn-primary float-end","type","button","title","Voir la solution",3,"click",4,"ngIf"],["type","button","title","Voir la solution",1,"btn","btn-sm","btn-primary","float-end",3,"click"],["aria-hidden","true",1,"fa","fa-eye","i-small"],["edMathjax","",1,"list-group-item-text","qcm-img-container","ed-cke",3,"content","compile","innerHTML"],["controls","","preload","metadata",3,"src"],[1,"une-question-type-radio"],["class","form-check",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-check",3,"ngClass"],["type","radio","formControlName","radio",3,"id","checked","value"],[1,"fw-normal",3,"for"],["edMathjax","",3,"content","innerHTML","compile"],["formArrayName","checkbox",1,"une-question-type-checkbox"],["type","checkbox",1,"form-check-input",3,"name","id","checked","disabled","change"],[1,"form-check-label","fw-normal",3,"for"],["formGroupName","textholes",1,"une-question-type-textholes"],["class","question-textholes",3,"formArrayName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"question-textholes",3,"formArrayName"],["class","lennonce-textholes",4,"ngFor","ngForOf","ngForTrackBy"],["class","correctifs-textholes reponse-correcte",4,"ngIf"],[1,"lennonce-textholes"],[3,"innerHTML"],[3,"ngClass",4,"ngIf"],["type","text","spellcheck","false","autocapitalize","off","autocomplete","off",1,"question-proposition-texthole-input","form-control","w-25",3,"formControlName","readOnly"],[1,"correctifs-textholes","reponse-correcte"],[4,"ngFor","ngForOf","ngForTrackBy"],["type","warning",1,"qcm-img-container"],["edMathjax","",1,"ed-cke",3,"content","innerHTML","compile"],[1,"qcm-form-viewer-action-list"],["class","btn btn-primary prev-question-button float-start","type","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-primary","next-question-button","float-end",3,"click"],["aria-hidden","true",1,"fa","fa-chevron-right"],[1,"clearfix"],["type","button",1,"btn","btn-primary","prev-question-button","float-start",3,"click"],["aria-hidden","true",1,"fa","fa-chevron-left"]],template:function(t,n){1&t&&(e.YNc(0,Dn,9,3,"div",0),e.TgZ(1,"div",1)(2,"form",2)(3,"div",3)(4,"h4"),e._uU(5),e.ALo(6,"base64"),e.qZA(),e.YNc(7,Pn,4,7,"div",4),e.YNc(8,Yn,8,6,"figure",5),e.TgZ(9,"div",6),e.YNc(10,Rn,3,4,"div",7),e.YNc(11,Hn,3,4,"div",8),e.YNc(12,zn,3,4,"div",9),e.qZA(),e.YNc(13,Xn,5,7,"alert",10),e.qZA()()(),e.YNc(14,eo,6,2,"div",11)),2&t&&(e.Q6J("ngIf",!n.copieCorrigee),e.xp6(1),e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("formGroup",n.questionForm),e.xp6(1),e.Q6J("ngClass",e.WLB(15,to,n.qCSSSuccess,n.qCSSError)),e.xp6(2),e.Oqu(e.lcZ(6,13,n.question.question)),e.xp6(2),e.Q6J("ngIf",n.question.enonce),e.xp6(1),e.Q6J("ngIf",n.question.srcSon),e.xp6(1),e.Q6J("ngSwitch",n.question.typeQ),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.radio.id),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.checkbox.id),e.xp6(1),e.Q6J("ngSwitchCase",n.questionBaseType.textholes.id),e.xp6(1),e.Q6J("ngIf",(n.displayCorrectif||n.copieCorrigee)&&n.questionForm.hasError("invalidQuestion")&&n.solution.remediation),e.xp6(1),e.Q6J("ngIf",!n.copieCorrigee))},dependencies:[m.mk,m.sg,m.O5,m.RF,m.n9,l._Y,l.Fj,l._,l.JJ,l.JL,l.sg,l.u,l.x0,l.CE,A.wx,b.DC,te.L,c.YC,ne.w,oe.y,q.$,ie.Y,se.T],styles:[".qcm-form-viewer-question-input[_ngcontent-%COMP%]   .question-textholes[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{display:inline-block}.qcm-form-viewer-question-input[_ngcontent-%COMP%]   .proposition-success[_ngcontent-%COMP%], .qcm-form-viewer-question-input[_ngcontent-%COMP%]   .question-textholes[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]::placeholder{color:#0f9d58}.qcm-form-viewer-question-input[_ngcontent-%COMP%]   .qcm-img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}.qcm-form-viewer-question-input[_ngcontent-%COMP%]   .question-proposition-texthole-input[readOnly][_ngcontent-%COMP%]{height:34px;padding:6px 12px;font-size:14px;line-height:1.42857143;background-color:#eee;opacity:1;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px #00000014;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:0 0 20px;padding:0 0 0 10px;border-left:5px solid var(--light-placeholder-color)}.qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div.question-success[_ngcontent-%COMP%]{border-left:5px solid #4caf50}.qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div.question-error[_ngcontent-%COMP%]{border-left:5px solid var(--secondary-color)}.qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .reponse-correcte[_ngcontent-%COMP%], .qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .reponse-success[_ngcontent-%COMP%], .qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .reponse-success[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{color:#4caf50}.qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .reponse-error[_ngcontent-%COMP%], .qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .reponse-error[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{color:var(--secondary-color)}.qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .reponse-error[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{text-decoration:line-through}.qcm-form-viewer-question[_ngcontent-%COMP%]   form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .list-group-item-text[_ngcontent-%COMP%] > ol[_ngcontent-%COMP%]{margin-left:15px}"],changeDetection:0}),o})();function oo(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.ALo(3,"base64"),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.TgZ(8,"td"),e._uU(9),e.qZA()()),2&o){const t=s.$implicit,n=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,4,t.question)),e.xp6(3),e.Oqu(n.displayStatQuestion(t.nbBR)),e.xp6(2),e.Oqu(n.displayStatQuestion(t.nbMR)),e.xp6(2),e.Oqu(n.displayStatQuestion(t.nbAR))}}function io(o,s){1&o&&e._UZ(0,"img",38)}function so(o,s){1&o&&e._UZ(0,"img",39)}function ro(o,s){if(1&o&&e._UZ(0,"img",40),2&o){const t=e.oxw(2);e.Q6J("src",t.currentEleve.photo,e.LSH)}}function co(o,s){if(1&o&&(e.TgZ(0,"div",33),e.YNc(1,io,1,0,"img",34),e.YNc(2,so,1,0,"img",35),e.YNc(3,ro,1,1,"img",36),e.TgZ(4,"div",37)(5,"p"),e._uU(6),e.ALo(7,"displayNom"),e.qZA()()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",""===t.currentEleve.photo&&"F"===t.currentEleve.sexe),e.xp6(1),e.Q6J("ngIf",""===t.currentEleve.photo&&"M"===t.currentEleve.sexe),e.xp6(1),e.Q6J("ngIf",""!==t.currentEleve.photo),e.xp6(3),e.Oqu(e.Dn7(7,4,t.currentEleve,!1,!1))}}function ao(o,s){if(1&o&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"edDate"),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij("Commenc\xe9 le ",e.xi3(2,1,t.currentEleve.debute,"EEEE d MMMM y \xe0 HH:mm"),"")}}function lo(o,s){1&o&&(e.TgZ(0,"p"),e._uU(1,"L'\xe9l\xe8ve n'a peut-\xeatre pas encore termin\xe9 !"),e.qZA())}function uo(o,s){if(1&o&&(e.TgZ(0,"p"),e._uU(1),e.ALo(2,"edDate"),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.hij("Termin\xe9 le ",e.xi3(2,1,t.currentEleve.fini,"EEEE d MMMM y \xe0 HH:mm"),"")}}function mo(o,s){if(1&o&&(e.TgZ(0,"div",47)(1,"div",48)(2,"div",15)(3,"h1"),e._uU(4),e.qZA()(),e.TgZ(5,"div",49),e._uU(6,"note"),e.qZA()()()),2&o){const t=e.oxw(2);e.xp6(4),e.Oqu(t.currentEleve.note)}}function po(o,s){if(1&o&&(e.TgZ(0,"div",41)(1,"div",42)(2,"div",43)(3,"alert",44),e.YNc(4,ao,3,4,"p",45),e.YNc(5,lo,2,0,"p",45),e.YNc(6,uo,3,4,"p",45),e.qZA()()(),e.TgZ(7,"div",46)(8,"div",47)(9,"div",48)(10,"div",15)(11,"h1"),e._uU(12),e.qZA()(),e.TgZ(13,"div",49),e._uU(14,"points"),e.qZA()()(),e.TgZ(15,"div",47)(16,"div",48)(17,"div",15)(18,"h1"),e._uU(19),e.qZA()(),e.TgZ(20,"div",49),e._uU(21,"r\xe9ussite"),e.qZA()()(),e.TgZ(22,"div",47)(23,"div",48)(24,"div",15)(25,"h1"),e._uU(26),e.qZA()(),e.TgZ(27,"div",49),e._uU(28,"classement"),e.qZA()()(),e.TgZ(29,"div",47)(30,"div",48)(31,"div",15)(32,"h1"),e._uU(33),e.qZA()(),e.TgZ(34,"div",49),e._uU(35,"r\xe9alisation"),e.qZA()()(),e.YNc(36,mo,7,1,"div",50),e.TgZ(37,"div",21)(38,"div",48)(39,"div",15)(40,"h1"),e._uU(41),e.qZA()(),e.TgZ(42,"div",49),e._uU(43,"bonnes r\xe9ponses"),e.qZA()()(),e.TgZ(44,"div",21)(45,"div",48)(46,"div",15)(47,"h1"),e._uU(48),e.qZA()(),e.TgZ(49,"div",49),e._uU(50,"mauvaises r\xe9ponses"),e.qZA()()(),e.TgZ(51,"div",21)(52,"div",48)(53,"div",15)(54,"h1"),e._uU(55),e.qZA()(),e.TgZ(56,"div",49),e._uU(57,"aucune r\xe9ponse"),e.qZA()()()()()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("type",t.currentEleve.fini?"info":"warning"),e.xp6(1),e.Q6J("ngIf",t.currentEleve.debute),e.xp6(1),e.Q6J("ngIf",!t.currentEleve.fini),e.xp6(1),e.Q6J("ngIf",t.currentEleve.fini),e.xp6(6),e.AsE("",t.currentEleve.nbPoints,"/",t.qcm.baremeBR*t.resultatsQCM.questions.length,""),e.xp6(7),e.hij("",t.currentEleve.pourcReussite," %"),e.xp6(7),e.AsE("",t.currentEleve.classement,"/",t.resultatsQCM.reponsesEleves.length,""),e.xp6(7),e.Oqu(t.currentEleve.lance),e.xp6(3),e.Q6J("ngIf",""!==t.currentEleve.note),e.xp6(5),e.Oqu(t.currentEleve.nbBR),e.xp6(7),e.Oqu(t.currentEleve.nbMR),e.xp6(7),e.Oqu(t.currentEleve.nbAR)}}function _o(o,s){if(1&o&&(e.TgZ(0,"div",51)(1,"div",15),e._UZ(2,"ed-qcm-form-viewer-question-resultat",52),e.qZA()()),2&o){const t=s.$implicit,n=s.index,i=e.oxw();e.xp6(2),e.Q6J("copieCorrigee",!0)("idQCM",i.qcm.id)("isCurrentQuestionDisplay",!0)("question",t)("reponse",i.getReponseEleveQuestion(t.id))("solution",i.resultatsQCM.solutions[n])}}let go=(()=>{class o{constructor(t,n,i){this.modalRef=t,this.qcmService=n,this.uiService=i,this.typeAffichageStatsReponses="nb",this.idxCurrentEleve=0,this.resultatsQCM=new c.lCI}ngOnInit(){this.refresh()}refresh(){this.loader=this.qcmService.getResultatsQuestionnaire(this.qcm.id,this.association.id).subscribe(t=>{this.resultatsQCM=new c.lCI(t),this.currentEleve=this.resultatsQCM.reponsesEleves[this.idxCurrentEleve]},t=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la r\xe9cup\xe9ration du questionnaire","Erreur","icon-ed_qcm"))}getReponseEleveQuestion(t){return this.currentEleve.reponses.find(n=>t===n.idQuestion)}displayStatQuestion(t){return"pourc"===this.typeAffichageStatsReponses?Math.round(100*t/this.resultatsQCM.reponsesEleves.length)+"%":`${t}`}goToPreviousEleve(){0===this.idxCurrentEleve?this.idxCurrentEleve=this.resultatsQCM.reponsesEleves.length-1:this.idxCurrentEleve--,this.currentEleve=this.resultatsQCM.reponsesEleves[this.idxCurrentEleve]}goToNextEleve(){this.idxCurrentEleve===this.resultatsQCM.reponsesEleves.length-1?this.idxCurrentEleve=0:this.idxCurrentEleve++,this.currentEleve=this.resultatsQCM.reponsesEleves[this.idxCurrentEleve]}close(){this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.UZ),e.Y36(c.Jqz),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-resultats"]],inputs:{qcm:"qcm",association:"association"},decls:68,vars:23,consts:[[1,"modal-header"],[1,"modal-title"],[1,"icon-ed_qcm"],["title","Rafra\xeechir les donn\xe9es","type","button",1,"btn","btn-secondary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],[1,"modal-body","qcm-resultats",3,"ngBusy"],["heading","R\xe9sultats","id","onglets-qcm-resultats","role","tab"],[1,"card","border-0"],[1,"card-header","border-0","bg-body","text-center"],[1,"form-check","form-check-inline"],["id","statsNb","name","typeAffichageStatsReponses","type","radio","value","nb",1,"form-check-input",3,"ngModel","ngModelChange"],["for","statsNb",1,"form-check-label"],["id","statsPourc","name","typeAffichageStatsReponses","type","radio","value","pourc",1,"form-check-input",3,"ngModel","ngModelChange"],["for","statsPourc",1,"form-check-label"],[1,"card-body"],[1,"table-responsive"],[1,"table","ed-table","table-hover"],[4,"ngFor","ngForOf","ngForTrackBy"],["heading","R\xe9ponses \xe9l\xe8ves","id","onglets-qcm-reponses","role","tab"],[1,"row","my-3","align-items-center"],[1,"col-md-4"],[1,"d-flex","align-items-center","justify-content-between"],[1,"arrow","text-start"],["type","button",1,"btn","btn-secondary",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-left"],["class","thumbnail",4,"ngIf"],[1,"arrow","text-end"],["aria-hidden","true",1,"fa","fa-arrow-right"],["class","col-md-8",4,"ngIf"],["class","card border-0 qcm-form-viewer",4,"ngFor","ngForOf","ngForTrackBy"],[1,"modal-footer","footer-modal-qcmr"],[1,"legende","flex-fill"],[1,"thumbnail"],["alt","photo \xe9l\xe8ve fille","src","/assets/images/eleve-fille.jpg",4,"ngIf"],["alt","photo \xe9l\xe8ve gar\xe7on","src","/assets/images/eleve-garcon.jpg",4,"ngIf"],["alt","photo \xe9l\xe8ve",3,"src",4,"ngIf"],[1,"caption"],["alt","photo \xe9l\xe8ve fille","src","/assets/images/eleve-fille.jpg"],["alt","photo \xe9l\xe8ve gar\xe7on","src","/assets/images/eleve-garcon.jpg"],["alt","photo \xe9l\xe8ve",3,"src"],[1,"col-md-8"],[1,"row"],[1,"col-12>"],[1,"text-center",3,"type"],[4,"ngIf"],[1,"row","g-2","m-0"],[1,"col-md-3"],[1,"card","text-center"],[1,"card-footer"],["class","col-md-3",4,"ngIf"],[1,"card","border-0","qcm-form-viewer"],[3,"copieCorrigee","idQCM","isCurrentQuestionDisplay","question","reponse","solution"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._UZ(2,"span",2),e._uU(3),e.ALo(4,"edDate"),e.TgZ(5,"button",3),e.NdJ("click",function(){return n.refresh()}),e._UZ(6,"i",4),e.qZA()(),e.TgZ(7,"button",5),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.TgZ(8,"div",6)(9,"tabset")(10,"tab",7)(11,"div",8)(12,"div",9)(13,"div",10)(14,"input",11),e.NdJ("ngModelChange",function(r){return n.typeAffichageStatsReponses=r}),e.qZA(),e.TgZ(15,"label",12),e._uU(16,"Nombre de r\xe9ponses"),e.qZA()(),e.TgZ(17,"div",10)(18,"input",13),e.NdJ("ngModelChange",function(r){return n.typeAffichageStatsReponses=r}),e.qZA(),e.TgZ(19,"label",14),e._uU(20,"Pourcentage de r\xe9ponses"),e.qZA()()(),e.TgZ(21,"div",15)(22,"div",16)(23,"table",17)(24,"thead")(25,"tr")(26,"th"),e._uU(27),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Bonne r\xe9ponse"),e.qZA(),e.TgZ(30,"th"),e._uU(31,"Mauvaise r\xe9ponse"),e.qZA(),e.TgZ(32,"th"),e._uU(33,"Aucune r\xe9ponse"),e.qZA()()(),e.TgZ(34,"tbody"),e.YNc(35,oo,10,6,"tr",18),e.ALo(36,"trackByProperty"),e.qZA()()()()()(),e.TgZ(37,"tab",19)(38,"div",20)(39,"div",21)(40,"div",22)(41,"div",23)(42,"button",24),e.NdJ("click",function(){return n.goToPreviousEleve()}),e._UZ(43,"i",25),e.qZA()(),e.YNc(44,co,8,8,"div",26),e.TgZ(45,"div",27)(46,"button",24),e.NdJ("click",function(){return n.goToNextEleve()}),e._UZ(47,"i",28),e.qZA()()()(),e.YNc(48,po,58,14,"div",29),e.qZA(),e.YNc(49,_o,3,6,"div",30),e.ALo(50,"trackByProperty"),e.qZA()()(),e.TgZ(51,"div",31)(52,"div",32)(53,"strong"),e._uU(54,"Bar\xe8me :"),e.qZA(),e.TgZ(55,"div")(56,"span")(57,"strong"),e._uU(58),e.qZA(),e._uU(59," Bonne r\xe9ponse "),e.qZA(),e.TgZ(60,"span")(61,"strong"),e._uU(62),e.qZA(),e._uU(63," Aucune r\xe9ponse "),e.qZA(),e.TgZ(64,"span")(65,"strong"),e._uU(66),e.qZA(),e._uU(67," Mauvaise r\xe9ponse "),e.qZA()()()()),2&t&&(e.xp6(3),e.lnq(" ",n.qcm.titre," / ",n.association.titre," (",e.xi3(4,16,n.association.date,"dd/MM/y"),") "),e.xp6(5),e.Q6J("ngBusy",n.loader),e.xp6(6),e.Q6J("ngModel",n.typeAffichageStatsReponses),e.xp6(4),e.Q6J("ngModel",n.typeAffichageStatsReponses),e.xp6(9),e.hij("",n.resultatsQCM.reponsesEleves.length," \xe9l\xe8ves"),e.xp6(8),e.Q6J("ngForOf",n.resultatsQCM.statsQuestions)("ngForTrackBy",e.lcZ(36,19,"$index")),e.xp6(9),e.Q6J("ngIf",n.currentEleve),e.xp6(4),e.Q6J("ngIf",n.currentEleve),e.xp6(1),e.Q6J("ngForOf",n.resultatsQCM.questions)("ngForTrackBy",e.lcZ(50,21,"id")),e.xp6(9),e.Oqu(n.qcm.baremeBR),e.xp6(4),e.Oqu(n.qcm.baremeAR),e.xp6(4),e.Oqu(n.qcm.baremeMR))},dependencies:[m.sg,m.O5,l.Fj,l._,l.JJ,l.On,A.wx,b.DC,O.wW,O.AH,no,c.$t3,c.YC,c.ifA,q.$],styles:[".qcm-resultats[_ngcontent-%COMP%]   .qcm-form-viewer[_ngcontent-%COMP%]{display:block}.qcm-resultats[_ngcontent-%COMP%]   #onglets-qcm-resultats[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding-top:20px}.qcm-resultats[_ngcontent-%COMP%]   #onglets-qcm-resultats[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   #statsNb[_ngcontent-%COMP%], .qcm-resultats[_ngcontent-%COMP%]   #onglets-qcm-resultats[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   #statsPourc[_ngcontent-%COMP%]{margin:4px 5px 0}.qcm-resultats[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%]{width:112px}.qcm-resultats[_ngcontent-%COMP%]   div.thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:150px;width:auto}.qcm-resultats[_ngcontent-%COMP%]   div.card-body[_ngcontent-%COMP%] > h1[_ngcontent-%COMP%]{font-size:1.5rem}.footer-modal-qcmr[_ngcontent-%COMP%]   .legende[_ngcontent-%COMP%]{text-align:left}.footer-modal-qcmr[_ngcontent-%COMP%]   .legende[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{border:1px solid var(--dark-placeholder-color);margin-right:15px;padding:5px}"]}),o})();var ho=u(8816);function fo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",10),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.manageQCM.emit())}),e._UZ(1,"i",11),e.qZA()}}function qo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,r=e.oxw(3);return e.KtG(r.toggleQcmEtiquette.emit(i.id))}),e._UZ(1,"i",22),e._uU(2),e.qZA()}if(2&o){const t=e.oxw().$implicit,n=e.oxw(3);e.MGl("title","",n.qcm.hasTag(t)?"Enlever":"Ajouter"," cette \xe9tiquette"),e.xp6(2),e.hij(" ",t.libelle," ")}}function Co(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.libelle)}}const vo=function(o){return{"etiquette-actif":o}};function bo(o,s){if(1&o&&(e.TgZ(0,"li",18),e.YNc(1,qo,3,2,"button",19),e.YNc(2,Co,2,1,"span",20),e.qZA()),2&o){const t=s.$implicit,n=e.oxw(3);e.Q6J("ngClass",e.VKq(3,vo,n.qcm.hasTag(t))),e.xp6(1),e.Q6J("ngIf",n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)),e.xp6(1),e.Q6J("ngIf",!n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee))}}function Qo(o,s){if(1&o&&(e.TgZ(0,"ul",16),e.YNc(1,bo,3,5,"li",17),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.etiquettes)("ngForTrackBy",e.lcZ(2,2,"id"))}}function xo(o,s){1&o&&(e.TgZ(0,"div",12)(1,"button",13),e._UZ(2,"i",14),e.qZA(),e.YNc(3,Qo,3,4,"ul",15),e.qZA())}function To(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.removeQCM.emit())}),e._UZ(1,"i",24),e.qZA()}}function Mo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.associerQCM.emit())}),e._UZ(1,"i",26),e.qZA()}if(2&o){const t=e.oxw();e.s9C("title",t.qcm.nbQuestions>0?"Associer le questionnaire \xe0 une \xe9valuation ou \xe0 un travail \xe0 faire":"Association impossible : ce questionnaire ne comporte aucune question pour le moment"),e.Q6J("disabled",0===t.qcm.nbQuestions)}}function Zo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.shareQCM.emit())}),e._UZ(1,"i",27),e.qZA()}if(2&o){const t=e.oxw();e.s9C("title",t.qcm.nbQuestions>0?"Partager le questionnaire dans la base inter-\xe9tablissements":"Partage impossible : ce questionnaire ne comporte aucune question pour le moment"),e.Q6J("disabled",0===t.qcm.nbQuestions)}}function yo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.unshareQCM.emit())}),e._UZ(1,"i",29),e.qZA()}}let Ao=(()=>{class o{constructor(t,n){this.qcmUserStore=t,this.authStore=n,this.manageQCM=new e.vpe,this.openQCM=new e.vpe,this.cloneQCM=new e.vpe,this.removeQCM=new e.vpe,this.associerQCM=new e.vpe,this.shareQCM=new e.vpe,this.unshareQCM=new e.vpe,this.toggleQcmEtiquette=new e.vpe}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(h),e.Y36(c.CnD))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-un-qcm-actions"]],inputs:{etiquettes:"etiquettes",qcm:"qcm"},outputs:{manageQCM:"manageQCM",openQCM:"openQCM",cloneQCM:"cloneQCM",removeQCM:"removeQCM",associerQCM:"associerQCM",shareQCM:"shareQCM",unshareQCM:"unshareQCM",toggleQcmEtiquette:"toggleQcmEtiquette"},decls:11,vars:7,consts:[[1,"qcm-actions","float-end"],["class","btn btn-sm btn-primary-color","title","Param\xe9trer le questionnaire","type","button",3,"click",4,"ngIf"],["title","Voir le questionnaire","type","button",1,"btn","btn-sm","btn-primary-color",3,"click"],["aria-hidden","true",1,"fa","fa-eye"],["class","btn-group","dropdown","",4,"ngIf"],["type","button",1,"btn","btn-sm","btn-primary-color",3,"title","click"],["aria-hidden","true",1,"fa","fa-clone"],["class","btn btn-sm btn-danger-color","title","Supprimer le questionnaire","type","button",3,"click",4,"ngIf"],["type","button","class","btn btn-sm btn-primary-color",3,"title","disabled","click",4,"ngIf"],["type","button","class","btn btn-sm btn-primary-color","title","Supprimer le questionnaire de la base inter-\xe9tablissements",3,"click",4,"ngIf"],["title","Param\xe9trer le questionnaire","type","button",1,"btn","btn-sm","btn-primary-color",3,"click"],["aria-hidden","true",1,"fa","fa-cogs"],["dropdown","",1,"btn-group"],["type","button","dropdownToggle","","id","dropdownEtiquette","aria-controls","dropdown-qcm-etiquette","aria-haspopup","true","aria-expanded","false","title","G\xe9rer les \xe9tiquettes du questionnaire",1,"btn","btn-sm","dropdown-toggle","btn-primary-color"],["aria-hidden","true",1,"fa","fa-tags"],["class","dropdown-menu","role","menu","aria-labelledby","dropdownEtiquette","id","dropdown-qcm-etiquette",4,"dropdownMenu"],["role","menu","aria-labelledby","dropdownEtiquette","id","dropdown-qcm-etiquette",1,"dropdown-menu"],["role","menuitem",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["role","menuitem",3,"ngClass"],["type","button","class","dropdown-item",3,"title","click",4,"ngIf"],[4,"ngIf"],["type","button",1,"dropdown-item",3,"title","click"],["aria-hidden","true",1,"fa","fa-square-o"],["title","Supprimer le questionnaire","type","button",1,"btn","btn-sm","btn-danger-color",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o"],["type","button",1,"btn","btn-sm","btn-primary-color",3,"title","disabled","click"],["aria-hidden","true",1,"fa","fa-link"],["aria-hidden","true",1,"fa","fa-share-alt"],["type","button","title","Supprimer le questionnaire de la base inter-\xe9tablissements",1,"btn","btn-sm","btn-primary-color",3,"click"],["aria-hidden","true",1,"fa","fa-ban"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,fo,2,0,"button",1),e.TgZ(2,"button",2),e.NdJ("click",function(){return n.openQCM.emit()}),e._UZ(3,"i",3),e.qZA(),e.YNc(4,xo,4,0,"div",4),e.TgZ(5,"button",5),e.NdJ("click",function(){return n.cloneQCM.emit()}),e._UZ(6,"i",6),e.qZA(),e.YNc(7,To,2,0,"button",7),e.YNc(8,Mo,2,2,"button",8),e.YNc(9,Zo,2,2,"button",8),e.YNc(10,yo,2,0,"button",9),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",!n.qcm.hasAssociations&&!n.qcm.isShared&&n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)),e.xp6(3),e.Q6J("ngIf",(null==n.etiquettes?null:n.etiquettes.length)>0&&n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)),e.xp6(1),e.MGl("title","Dupliquer le questionnaire ",n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)?"":"sur l'ann\xe9e en cours",""),e.xp6(2),e.Q6J("ngIf",!n.qcm.hasAssociations&&!n.qcm.isShared&&n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)),e.xp6(1),e.Q6J("ngIf",n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)),e.xp6(1),e.Q6J("ngIf",!n.qcm.isShared&&n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)&&"EDPROF"!==n.authStore.currentUser.identifiant),e.xp6(1),e.Q6J("ngIf",n.qcm.isShared&&n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)))},dependencies:[m.mk,m.sg,m.O5,w.Hz,w.Mq,w.TO,q.$],encapsulation:2,changeDetection:0}),o})();var le=u(94702),Eo=u(56776);function So(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij("(",t.association.sousTitre,")")}}function wo(o,s){1&o&&(e.TgZ(0,"div",7)(1,"div",34),e._uU(2,"V\xe9rifiez la concordance de vos dates"),e.qZA()())}const I=function(o){return{"has-error":o}};function Uo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"form",5),e.NdJ("ngSubmit",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onSubmit())}),e.TgZ(1,"div",6)(2,"div",7)(3,"div",8)(4,"div")(5,"label",9),e._uU(6,"Date de d\xe9but"),e.qZA(),e.TgZ(7,"div",10),e._UZ(8,"input",11,12),e.TgZ(10,"span",13)(11,"button",14),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(9);return e.KtG(i.toggle())}),e._UZ(12,"i",15),e.qZA()()()()(),e.TgZ(13,"div",8)(14,"div")(15,"label",16),e._uU(16,"Date de fin"),e.qZA(),e.TgZ(17,"div",10),e._UZ(18,"input",17,18),e.TgZ(20,"span",13)(21,"button",19),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(19);return e.KtG(i.toggle())}),e._UZ(22,"i",15),e.qZA()()()()()(),e.TgZ(23,"div",7)(24,"div",20)(25,"div")(26,"strong",21),e._uU(27,"Heure de d\xe9but"),e.qZA(),e.TgZ(28,"div",22),e._UZ(29,"timepicker",23),e.qZA()()(),e.TgZ(30,"div",24)(31,"div",25)(32,"strong",21),e._uU(33,"Heure de fin"),e.qZA(),e.TgZ(34,"div",26),e._UZ(35,"timepicker",27),e.qZA()()()(),e.YNc(36,wo,3,0,"div",28),e.qZA(),e.TgZ(37,"div",29)(38,"button",30),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.close())}),e._uU(39,"Annuler"),e.qZA(),e.TgZ(40,"button",31),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.maintenant())}),e._UZ(41,"i",32),e.qZA(),e.TgZ(42,"button",33),e._uU(43,"Enregistrer"),e.qZA()()()}if(2&o){const t=e.MAs(9),n=e.MAs(19),i=e.oxw();e.Q6J("formGroup",i.associationForm),e.xp6(4),e.Tol(e.VKq(18,I,i.associationForm.get("dateDebut").invalid)),e.xp6(4),e.Q6J("bsConfig",i.configDatePicker),e.uIk("aria-expanded",t.isOpen),e.xp6(6),e.Tol(e.VKq(20,I,i.associationForm.get("dateFin").invalid)),e.xp6(4),e.Q6J("bsConfig",i.configDatePicker),e.uIk("aria-expanded",n.isOpen),e.xp6(7),e.Tol(e.VKq(22,I,i.associationForm.get("heureDebut").invalid)),e.xp6(4),e.Q6J("showSpinners",!0)("showMeridian",!1),e.xp6(2),e.Q6J("ngClass",e.VKq(24,I,i.associationForm.get("heureFin").invalid)),e.xp6(4),e.Q6J("showSpinners",!0)("showMeridian",!1),e.xp6(1),e.Q6J("ngIf",null==i.associationForm.errors?null:i.associationForm.errors.dateDebutNotSuperieur),e.xp6(6),e.Q6J("disabled",i.associationForm.invalid)}}let ko=(()=>{class o{constructor(t,n,i){this.fb=t,this.modalRef=n,this.uiService=i,this.onClose$=new Y.x,this.configDatePicker={...k.gL,minDate:c.C_1.addNbJourToDate(new Date,-1)}}ngOnInit(){this.associationForm=this.fb.group(this.association.isDatesOK?{dateDebut:new Date(this.association.debute),heureDebut:new Date(this.association.debute),dateFin:new Date(this.association.fini),heureFin:new Date(this.association.fini)}:{dateDebut:null,heureDebut:null,dateFin:null,heureFin:null},{validators:this.datesValidator()})}ngOnDestroy(){this.onClose$.complete()}datesValidator(){return t=>{const n=t.get("dateDebut").value,i=t.get("dateFin").value,r=t.get("heureDebut").value,a=t.get("heureFin").value;if(n&&i&&r&&a){const d=new Date(`${c.C_1.dateToString(n,"YYY/MM/dd")} ${c.C_1.dateToString(r,"HH:mm:00")}`),p=new Date(`${c.C_1.dateToString(i,"YYY/MM/dd")} ${c.C_1.dateToString(a,"HH:mm:00")}`);if(!c.C_1.isAfter(p,d,!0)&&!c.C_1.isEqual(p,d,!0))return{dateDebutNotSuperieur:!0}}return null}}maintenant(){const t=new Date;t.setSeconds(0);const n=c.C_1.addNbHoursToDate(t,1);this.associationForm.setValue({dateDebut:t,heureDebut:new Date(t),dateFin:n,heureFin:new Date(n)})}onSubmit(){if(this.associationForm.valid){const t=this.associationForm.get("dateDebut").value,n=this.associationForm.get("dateFin").value,i=this.associationForm.get("heureDebut").value,r=this.associationForm.get("heureFin").value;if(!(t&&n&&i&&r))return void this.uiService.notifyEvent(c.DOJ.genericError,"V\xe9rifiez la concordance de vos dates !","Erreur","icon-ed_qcm");const a=new Date(`${c.C_1.dateToString(t,"YYY/MM/dd")} ${c.C_1.dateToString(i,"HH:mm:00")}`),d=new Date(`${c.C_1.dateToString(n,"YYY/MM/dd")} ${c.C_1.dateToString(r,"HH:mm:00")}`);this.onClose$.next([a,d]),this.close()}}close(){this.modalRef.hide()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(l.qu),e.Y36(g.UZ),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-association-evaluation-parametres"]],inputs:{association:"association"},decls:6,vars:2,consts:[[1,"modal-header"],[1,"modal-title"],[4,"ngIf"],["type","button","aria-label","Fermer cette fen\xeatre",1,"btn-close","d-print-none",3,"click"],["name","formEditAssociation","novalidate","",3,"formGroup","ngSubmit",4,"ngIf"],["name","formEditAssociation","novalidate","",3,"formGroup","ngSubmit"],["id","form-parametrage-association",1,"modal-body"],[1,"row"],[1,"col-lg-6"],["for","dateDebut",1,"form-label"],[1,"input-group"],["formControlName","dateDebut","bsDatepicker","","name","dateDebut","id","dateDebut","type","text",1,"form-control",3,"bsConfig"],["datePickerDateDebut","bsDatepicker"],[1,"input-group-text","input-group-md","no-background"],["type","button","aria-label","Ouvrir le calendrier pour choisir la date de d\xe9but",1,"btn","btn-secondary","no-background",3,"click"],["aria-hidden","true",1,"fa","fa-calendar"],["for","dateFin",1,"form-label"],["formControlName","dateFin","bsDatepicker","","name","dateFin","id","dateFin","type","text",1,"form-control",3,"bsConfig"],["datePickerDateFin","bsDatepicker"],["type","button","aria-label","Ouvrir le calendrier pour choisir la date de fin",1,"btn","btn-secondary","no-background",3,"click"],[1,"col-lg-4"],[1,"texte-label"],[1,"input-group","heureDebut"],["formControlName","heureDebut",3,"showSpinners","showMeridian"],[1,"col-lg-4","col-lg-offset-2"],[3,"ngClass"],[1,"input-group","heureFin"],["formControlName","heureFin",3,"showSpinners","showMeridian"],["class","row",4,"ngIf"],[1,"modal-footer","form-parametrage-association"],["type","button",1,"btn","btn-warning",3,"click"],["type","button","title","Rendre accessible maintenant",1,"btn","btn-secondary",3,"click"],["aria-hidden","true",1,"fa","fa-clock-o","i-small"],["id","buttonAjout","type","submit",1,"btn","btn-success",3,"disabled"],[1,"col-lg-12","form-text","text-danger"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2," Programmation "),e.YNc(3,So,2,1,"span",2),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return n.close()}),e.qZA()(),e.YNc(5,Uo,44,26,"form",4)),2&t&&(e.xp6(3),e.Q6J("ngIf",n.association.sousTitre),e.xp6(2),e.Q6J("ngIf",n.associationForm))},dependencies:[m.mk,m.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u,le.Np,le.Y5,Eo.EV],encapsulation:2}),o})();function Jo(o,s){if(1&o&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(t.association.sousTitre)}}const No=function(o,s){return{arg1:o,arg2:s}};function Fo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"div",16),e._UZ(2,"i",17),e.TgZ(3,"small",18),e._uU(4),e.ALo(5,"lowercase"),e.ALo(6,"formattedDate"),e.qZA()(),e.TgZ(7,"div",19)(8,"span",20)(9,"button",21),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.automatiser())}),e._UZ(10,"i",22),e.qZA(),e.TgZ(11,"button",23),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.deleteAutomatisation())}),e._UZ(12,"i",24),e.qZA(),e.TgZ(13,"button",25),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.refresh.emit())}),e._UZ(14,"i",26),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(4),e.hij("Programm\xe9 ",e.lcZ(5,1,e.xi3(6,3,e.WLB(6,No,t.association.debute,t.association.fini),"EEEE d MMMM")),"")}}function Oo(o,s){1&o&&e._UZ(0,"div",12)}function Do(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",27)(1,"button",28),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.confirmStartStop())}),e._UZ(2,"i",29),e.TgZ(3,"span",30),e._uU(4,"Rendre accessible"),e.qZA()()()}}function Po(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",27)(1,"button",31),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.confirmStartStop())}),e._UZ(2,"i",32),e.TgZ(3,"span",30),e._uU(4,"Rendre inaccessible"),e.qZA()()()}}function Io(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",27)(1,"button",33),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.calculer())}),e._UZ(2,"i",34),e.TgZ(3,"span",30),e._uU(4,"Calculer les notes"),e.qZA()()()}}function Yo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",27)(1,"button",35),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.automatiser())}),e._UZ(2,"i",17),e.TgZ(3,"span",30),e._uU(4,"Programmation"),e.qZA()()()}}let Bo=(()=>{class o{constructor(t,n,i){this.modalService=t,this.qcmService=n,this.uiService=i,this.associationStartStop=new e.vpe,this.refresh=new e.vpe,this.associationDelete=new e.vpe,this.displayResultat=new e.vpe,this._datePipe=new c.ifA}confirmDelete(){const t={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:"Suppression de l'association",message:'<p>\xcates-vous s\xfbr de vouloir supprimer <strong>d\xe9finitivement</strong> cette association ?</p>\n<p class="text-danger">Attention ! Les r\xe9ponses apport\xe9es par les \xe9l\xe8ves seront aussi d\xe9finitivement supprim\xe9es !</p>',btnConfirm:"Supprimer",btnCancel:"Non"}};this.modalService.show(E.z,t),this.modalService.onHide.pipe((0,C.q)(1)).subscribe(n=>{n===Q.G.validation&&this.associationDelete.emit()})}calculer(){const t={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:"Calculer les notes ?",message:"<p><b>Attention, les notes actuelles de l'\xe9valuation seront \xe9cras\xe9es</b>.<p>Les nouvelles notes seront pr\xe9-remplis automatiquement en fonction des points acquis et du bar\xeame param\xe9tr\xe9 sur le QCM.</p>",btnConfirm:"Oui",btnCancel:"Non"}};this.modalService.show(E.z,t),this.modalService.onHide.pipe((0,C.q)(1)).subscribe(n=>{n===Q.G.validation&&this.associationStartStop.emit(!0)})}confirmStartStop(){const t=this.association.isActive?{titre:"Rendre inaccessible le questionnaire aux \xe9l\xe8ves ?",sstitre:"<p>\xcates-vous s\xfbr de vouloir stopper ce questionnaire ?</p><p><b>Les notes seront pr\xe9-remplis automatiquement</b> en fonction des points acquis et du bar\xeame param\xe9tr\xe9 sur le QCM.</p>"}:{titre:"Rendre accessible le questionnaire aux \xe9l\xe8ves ?",sstitre:"<p>\xcates-vous s\xfbr de vouloir d\xe9marrer ce questionnaire ?</p><p>Les \xe9l\xe8ves pourront y acc\xe8der depuis la page <b>QCM</b>.</p>"},n={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:t.titre,message:t.sstitre,btnConfirm:"Oui",btnCancel:"Non"}};this.modalService.show(E.z,n),this.modalService.onHide.pipe((0,C.q)(1)).subscribe(i=>{i===Q.G.validation&&this.associationStartStop.emit(this.association.isActive)})}automatiser(){this.modalService.show(ko,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{association:this.association}}).content.onClose$.pipe((0,C.q)(1)).subscribe(n=>{Array.isArray(n)&&2===n.length&&(this.loader=this.qcmService.editParametresAssociation(this.qcm.id,this.association.id,{debute:this._datePipe.transform(n[0],"y-MM-dd HH:mm:ss"),fini:this._datePipe.transform(n[1],"y-MM-dd HH:mm:ss")}).subscribe({next:i=>{this.uiService.notifyEvent(c.DOJ.genericSuccess,"La p\xe9riode a bien \xe9t\xe9 enregistr\xe9e.","QCM","icon-ed_qcm")},error:i=>{this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de l'enregistrement de la p\xe9riode.","Erreur","icon-ed_qcm")}}))})}deleteAutomatisation(){this.loader=this.qcmService.deleteAutomatisationAssociation(this.qcm.id,this.association.id).subscribe({next:t=>{this.uiService.notifyEvent(c.DOJ.genericSuccess,"La p\xe9riode a bien \xe9t\xe9 supprim\xe9e.","QCM","icon-ed_qcm")},error:t=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la suppression de la p\xe9riode.","Erreur","icon-ed_qcm")})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.tT),e.Y36(c.Jqz),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-association-evaluation"]],inputs:{qcm:"qcm",association:"association"},outputs:{associationStartStop:"associationStartStop",refresh:"refresh",associationDelete:"associationDelete",displayResultat:"displayResultat"},decls:22,vars:13,consts:[[1,"row"],[1,"col-lg-10"],[1,"list-group-item-heading","mt-0",3,"ngBusy"],["aria-hidden","true",1,"icon-ed_carnetnotes"],[1,"col-lg-2","text-end"],["title","Supprimer l'association","type","button",1,"btn","btn-sm","btn-danger-color","no-padding",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],[4,"ngIf"],["class","qcm-programmation row",4,"ngIf"],["class","clearfix",4,"ngIf"],[1,"row","row-cols-auto","gy-1"],["class","col",4,"ngIf"],[1,"clearfix"],[1,"footer","text-center"],["type","button",1,"btn","btn-primary-color","btn-sm","text-bold",3,"click"],[1,"qcm-programmation","row"],[1,"col-md-9"],["aria-hidden","true",1,"fa","fa-clock-o","i-small"],[1,"margin-whitespace","text-primary"],[1,"col-md-3"],[1,"float-end","btn-action-programmation"],["type","button","title","Modifier la programmation",1,"btn","btn-primary-color","no-padding",3,"click"],["aria-hidden","true",1,"fa","fa-pencil","i-small","size-17"],["type","button","title","Supprimer la programmation",1,"btn","btn-danger-color","no-padding","margin-whitespace",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o","i-small","size-17"],["type","button","title","Rafra\xeechir la vue",1,"btn","btn-primary-color","no-padding","margin-whitespace",3,"click"],["aria-hidden","true",1,"fa","fa-refresh","i-small","size-17"],[1,"col"],["title","Activer l'acc\xe8s au questionnaire pour les \xe9l\xe8ves","type","button",1,"btn","btn-success","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-play","i-small"],[1,"margin-whitespace"],["title","D\xe9sactiver l'acc\xe8s des \xe9l\xe8ves au questionnaire","type","button",1,"btn","btn-danger","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-stop","i-small"],["title","Calculer les notes","type","button",1,"btn","btn-danger","btn-sm",3,"click"],["aria-hidden","true",1,"icon-ed_carnetnotes","i-small"],["title","Param\xe9trer l'acc\xe8s au questionnaire","type","button",1,"btn","btn-secondary","btn-sm",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),e._UZ(3,"i",3),e._uU(4),e.ALo(5,"edDate"),e.qZA()(),e.TgZ(6,"div",4)(7,"button",5),e.NdJ("click",function(){return n.confirmDelete()}),e._UZ(8,"i",6),e.qZA()()(),e.YNc(9,Jo,2,1,"p",7),e.YNc(10,Fo,15,9,"div",8),e.YNc(11,Oo,1,0,"div",9),e.TgZ(12,"div",10),e.YNc(13,Do,5,0,"div",11),e.YNc(14,Po,5,0,"div",11),e.YNc(15,Io,5,0,"div",11),e.YNc(16,Yo,5,0,"div",11),e.qZA(),e._UZ(17,"div",12),e.TgZ(18,"div",13)(19,"button",14),e.NdJ("click",function(){return n.displayResultat.emit()}),e._uU(20,"Voir les r\xe9sultats"),e.qZA()(),e._UZ(21,"div",12)),2&t&&(e.xp6(2),e.Q6J("ngBusy",n.loader),e.xp6(2),e.AsE(" ",n.association.titre," (",e.xi3(5,10,n.association.date,"dd/MM/y"),") "),e.xp6(5),e.Q6J("ngIf",n.association.sousTitre),e.xp6(1),e.Q6J("ngIf",n.association.isDatesOK),e.xp6(1),e.Q6J("ngIf",n.association.isDatesOK),e.xp6(2),e.Q6J("ngIf",!n.association.isActive),e.xp6(1),e.Q6J("ngIf",n.association.isActive),e.xp6(1),e.Q6J("ngIf",n.association.isPastAndInactive),e.xp6(1),e.Q6J("ngIf",!n.association.isDatesOK))},dependencies:[m.O5,b.DC,m.i8,c.ifA,c.Jij],styles:["[_nghost-%COMP%]{display:block;padding:20px;background:var(--light-placeholder-color);border-radius:5px;overflow:hidden}.footer[_ngcontent-%COMP%]{margin:20px -20px -20px;background:var(--smalldark-placeholder-color)}h4[_ngcontent-%COMP%]{font-size:15px}"],changeDetection:0}),o})();function Ro(o,s){if(1&o&&(e.TgZ(0,"p",8),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij(" ",t.association.sousTitre,"\n")}}let Lo=(()=>{class o{constructor(t){this.modalService=t,this.associationDelete=new e.vpe,this.displayResultat=new e.vpe}confirmDelete(){const t={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:{title:"Suppression de l'association",message:'<p>\xcates-vous s\xfbr de vouloir supprimer <strong>d\xe9finitivement</strong> cette association ?</p>\n<p class="text-danger">Attention ! Les r\xe9ponses apport\xe9es par les \xe9l\xe8ves seront aussi d\xe9finitivement supprim\xe9es !</p>',btnConfirm:"Supprimer",btnCancel:"Non"}};this.modalService.show(E.z,t),this.modalService.onHide.pipe((0,C.q)(1)).subscribe(n=>{n===Q.G.validation&&this.associationDelete.emit()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(g.tT))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcm-association-cdt"]],inputs:{qcm:"qcm",association:"association"},outputs:{associationDelete:"associationDelete",displayResultat:"displayResultat"},decls:11,vars:6,consts:[[1,"list-group-item-heading"],["aria-hidden","true",1,"icon-ed_cahierdetexte-light"],["title","Supprimer l'association","type","button",1,"btn","btn-sm","btn-danger-color","float-end",3,"click"],["aria-hidden","true",1,"fa","fa-trash"],["class","list-group-item-text",4,"ngIf"],[1,"footer","text-center"],["type","button",1,"btn","btn-primary-color","btn-sm","btn-sm","text-bold",3,"click"],[1,"clearfix"],[1,"list-group-item-text"]],template:function(t,n){1&t&&(e.TgZ(0,"h4",0),e._UZ(1,"i",1),e._uU(2),e.ALo(3,"edDate"),e.TgZ(4,"button",2),e.NdJ("click",function(){return n.confirmDelete()}),e._UZ(5,"i",3),e.qZA()(),e.YNc(6,Ro,2,1,"p",4),e.TgZ(7,"div",5)(8,"button",6),e.NdJ("click",function(){return n.displayResultat.emit()}),e._uU(9,"Voir les r\xe9sultats"),e.qZA()(),e._UZ(10,"div",7)),2&t&&(e.xp6(2),e.AsE(" ",n.association.titre," (pour le ",e.xi3(3,3,n.association.date,"dd/MM/y"),") "),e.xp6(4),e.Q6J("ngIf",n.association.sousTitre))},dependencies:[m.O5,c.ifA],styles:["[_nghost-%COMP%]{display:block;padding:20px;background:var(--light-placeholder-color);border-radius:5px;overflow:hidden}.footer[_ngcontent-%COMP%]{margin:20px -20px -20px;background:var(--smalldark-placeholder-color)}h4[_ngcontent-%COMP%]{font-size:15px}"],changeDetection:0}),o})();function Ho(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.toggleQcmEtiquette.emit(r.id))}),e._UZ(1,"i",14),e.TgZ(2,"span",15),e._uU(3),e.qZA()()}if(2&o){const t=s.$implicit;e.xp6(3),e.Oqu(t.libelle)}}function Go(o,s){if(1&o&&(e.TgZ(0,"div",11),e.YNc(1,Ho,4,1,"button",12),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.customEtiquettes())("ngForTrackBy",e.lcZ(2,2,"id"))}}const Vo=function(o){return[o,"questions"]};function $o(o,s){if(1&o&&(e.TgZ(0,"div")(1,"button",16),e._uU(2," G\xe9rer les questions "),e.TgZ(3,"span",17),e._uU(4),e.qZA()(),e._UZ(5,"div",7),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.s9C("title",t.qcm.isShared?"Vous ne pouvez pas modifier les questions quand le questionnaire est partag\xe9 dans la base inter-\xe9tablissements":"G\xe9rer les questions"),e.Q6J("routerLink",e.VKq(4,Vo,t.qcm.id))("disabled",t.qcm.isShared),e.xp6(3),e.Oqu(t.qcm.nbQuestions)}}function Ko(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"button",18),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.isCollapsed=!i.isCollapsed)}),e._uU(2," Voir les associations "),e.TgZ(3,"span",17),e._uU(4),e.qZA()(),e._UZ(5,"div",7),e.qZA()}if(2&o){const t=e.oxw();e.xp6(1),e.uIk("aria-expanded",!t.isCollapsed),e.xp6(3),e.Oqu(t.qcm.evaluations.length+t.qcm.travauxafaire.length)}}const jo=function(o,s){return{"qcm-association-inactif":o,"qcm-association-actif":s}};function zo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",24)(1,"ed-qcm-association-evaluation",25),e.NdJ("associationStartStop",function(i){const a=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.onAssociationStartStop(i,a))})("associationDelete",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onAssociationDelete(r))})("displayResultat",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onDisplayResultats(r))})("refresh",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.refresh.emit())}),e.qZA()()}if(2&o){const t=s.$implicit,n=e.oxw(2);e.Q6J("ngClass",e.WLB(3,jo,!t.isActive,t.isActive)),e.xp6(1),e.Q6J("association",t)("qcm",n.qcm)}}function Xo(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li",26)(1,"ed-qcm-association-cdt",27),e.NdJ("associationDelete",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onAssociationDelete(r))})("displayResultat",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onDisplayResultats(r))}),e.qZA()()}if(2&o){const t=s.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("association",t)("qcm",n.qcm)}}function Wo(o,s){if(1&o&&(e.TgZ(0,"div",19),e._UZ(1,"hr",20),e.TgZ(2,"ul",21),e.YNc(3,zo,2,6,"li",22),e.ALo(4,"trackByProperty"),e.YNc(5,Xo,2,2,"li",23),e.ALo(6,"trackByProperty"),e.qZA()()),2&o){const t=e.oxw();e.Q6J("collapse",t.isCollapsed)("isAnimated",!0),e.xp6(3),e.Q6J("ngForOf",t.qcm.evaluations)("ngForTrackBy",e.lcZ(4,6,"$index")),e.xp6(2),e.Q6J("ngForOf",t.qcm.travauxafaire)("ngForTrackBy",e.lcZ(6,8,"$index"))}}const ei=function(o,s){return{"fa-unlock":o,"fa-lock":s}},ti=function(){return["200","..."]};let ni=(()=>{class o{constructor(t,n,i,r,a){this.authStore=t,this.modalService=n,this.qcmService=i,this.qcmUserStore=r,this.uiService=a,this.isCollapsed=!0,this.toggleQcmEtiquette=new e.vpe,this.associerQCM=new e.vpe,this.cloneQCM=new e.vpe,this.manageQCM=new e.vpe,this.openQCM=new e.vpe,this.removeQCM=new e.vpe,this.shareQCM=new e.vpe,this.unshareQCM=new e.vpe,this.refresh=new e.vpe}customEtiquettes(){return this.qcm.etiquettes.reduce((t,n)=>{const i=this.etiquettes.find(a=>a.id===n),r=Object.isExists(i)?i.libelle:"???";return t.push({id:n,libelle:r}),t},[])}onAssociationStartStop(t,n){const i=t?this.qcmService.stopQCM(this.qcm.id,n.id,this.qcmUserStore.snapshot.choosenAnnee):this.qcmService.startQCM(this.qcm.id,n.id,this.qcmUserStore.snapshot.choosenAnnee);this.loader=i.subscribe({next:r=>{if(this.uiService.notifyEvent(c.DOJ.genericSuccess,"Le questionnaire a bien \xe9t\xe9 mis \xe0 jour.","QCM","icon-ed_qcm"),Object.isExists(r)&&r.messageNotes){const a={id:this.modalService.getModalsCount()+1,class:"modal-lg",initialState:{title:"R\xe9capitulatif de la saisie automatique des notes",message:r.messageNotes,close:"OK"}};this.modalService.show(K.z,a)}},error:r=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la mise \xe0 jour du questionnaire.","Erreur","icon-ed_qcm")})}onAssociationDelete(t){this.loader=this.qcmService.supprimerAssociation(this.qcm.id,t,this.qcmUserStore.snapshot.choosenAnnee).subscribe({next:n=>this.uiService.notifyEvent(c.DOJ.genericSuccess,"L'association a bien \xe9t\xe9 supprim\xe9e","QCM","icon-ed_qcm"),error:n=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de l'op\xe9ration.","Erreur","icon-ed_qcm")})}onDisplayResultats(t){this.modalService.show(go,{id:this.modalService.getModalsCount()+1,class:"modal-lg",initialState:{qcm:this.qcm,association:t}})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(c.CnD),e.Y36(g.tT),e.Y36(c.Jqz),e.Y36(h),e.Y36(c.VLf))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-un-qcm"]],inputs:{etiquettes:"etiquettes",qcm:"qcm"},outputs:{toggleQcmEtiquette:"toggleQcmEtiquette",associerQCM:"associerQCM",cloneQCM:"cloneQCM",manageQCM:"manageQCM",openQCM:"openQCM",removeQCM:"removeQCM",shareQCM:"shareQCM",unshareQCM:"unshareQCM",refresh:"refresh"},decls:18,vars:24,consts:[[1,"card","ed-card","with-epingle",3,"ngBusy"],[1,"card-header","d-flex","align-items-center","justify-content-between","flex-wrap"],[1,"fa",3,"title","ngClass"],[3,"qcm","etiquettes","manageQCM","openQCM","cloneQCM","removeQCM","associerQCM","shareQCM","unshareQCM","toggleQcmEtiquette"],[1,"card-body"],[3,"innerHTML"],[1,"date-item","clearfix"],[1,"clearfix"],["class","etiquettes",4,"ngIf"],[4,"ngIf"],["class","collapse with-scroll no-scroll-x","id","collapseBasic",3,"collapse","isAnimated",4,"ngIf"],[1,"etiquettes"],["class","etiquette btn btn-link p-0","title","Enlever cette \xe9tiquette","type","button",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["title","Enlever cette \xe9tiquette","type","button",1,"etiquette","btn","btn-link","p-0",3,"click"],["aria-hidden","true",1,"fa","fa-tag","i-small"],[1,"margin-whitespace"],["type","button",1,"btn","btn-primary","btn-sm","float-end",3,"routerLink","disabled","title"],[1,"badge"],["type","button","aria-controls","collapseBasic",1,"btn","btn-primary","btn-sm","float-end",3,"click"],["id","collapseBasic",1,"collapse","with-scroll","no-scroll-x",3,"collapse","isAnimated"],["role","separator"],[1,"list-group","row","list-group-horizontal"],["class","list-group-item col-lg-6 col-xl-4",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["class","list-group-item col-lg-6 col-xl-4",4,"ngFor","ngForOf","ngForTrackBy"],[1,"list-group-item","col-lg-6","col-xl-4",3,"ngClass"],[3,"association","qcm","associationStartStop","associationDelete","displayResultat","refresh"],[1,"list-group-item","col-lg-6","col-xl-4"],[3,"association","qcm","associationDelete","displayResultat"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3"),e._UZ(3,"i",2),e._uU(4),e.qZA(),e.TgZ(5,"ed-un-qcm-actions",3),e.NdJ("manageQCM",function(){return n.manageQCM.emit()})("openQCM",function(){return n.openQCM.emit()})("cloneQCM",function(){return n.cloneQCM.emit()})("removeQCM",function(){return n.removeQCM.emit()})("associerQCM",function(){return n.associerQCM.emit()})("shareQCM",function(){return n.shareQCM.emit()})("unshareQCM",function(){return n.unshareQCM.emit()})("toggleQcmEtiquette",function(r){return n.toggleQcmEtiquette.emit(r)}),e.qZA()(),e.TgZ(6,"div",4),e._UZ(7,"div",5),e.ALo(8,"truncate"),e.ALo(9,"base64"),e.TgZ(10,"span",6),e._uU(11),e.ALo(12,"edDate"),e.qZA(),e._UZ(13,"div",7),e.YNc(14,Go,3,4,"div",8),e.YNc(15,$o,6,6,"div",9),e.YNc(16,Ko,6,2,"div",9),e.YNc(17,Wo,7,10,"div",10),e.qZA()()),2&t&&(e.Q6J("ngBusy",n.loader),e.xp6(3),e.s9C("title",n.qcm.hasAssociations?"Ce questionnaire est associ\xe9 \xe0 des (auto) \xe9valuations":"Ce questionnaire n'est pas associ\xe9 \xe0 des (auto) \xe9valuations"),e.Q6J("ngClass",e.WLB(20,ei,!n.qcm.hasAssociations,n.qcm.hasAssociations)),e.xp6(1),e.hij(" ",n.qcm.titre," "),e.xp6(1),e.Q6J("qcm",n.qcm)("etiquettes",n.etiquettes),e.xp6(2),e.Q6J("innerHTML",e.xi3(8,12,e.lcZ(9,15,n.qcm.resume),e.DdM(23,ti)),e.oJD),e.xp6(4),e.hij("Cr\xe9\xe9 le ",e.xi3(12,17,n.qcm.created,"EEEE d MMMM y \xe0 HH:mm"),""),e.xp6(3),e.Q6J("ngIf",n.qcm.etiquettes.length>0),e.xp6(1),e.Q6J("ngIf",!n.qcm.hasAssociations&&n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)),e.xp6(1),e.Q6J("ngIf",n.qcm.hasAssociations&&n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)),e.xp6(1),e.Q6J("ngIf",n.qcm.hasAssociations&&n.authStore.isAnneeCourante(n.qcmUserStore.snapshot.choosenAnnee)))},dependencies:[m.mk,m.sg,m.O5,M.rH,ho.Y,b.DC,Ao,Bo,Lo,c.YC,c.ifA,c.W70,q.$],encapsulation:2,changeDetection:0}),o})();function oi(o,s){if(1&o&&(e.TgZ(0,"p",6),e._uU(1),e.ALo(2,"edDate"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij("D\xe9marr\xe9 le ",e.xi3(2,1,t.qcm.debute,"EEEE d MMMM y \xe0 HH:mm"),"")}}let ii=(()=>{class o{constructor(t){this.router=t}openQCM(){this.router.navigate(["",{outlets:{auxiliaryModal:["repondre-au-qcm"]}}],{skipLocationChange:!0,queryParams:{idQCM:this.qcm.idQCM,titre:this.qcm.titre,idAssociation:this.qcm.idAssociation}}).catch(()=>console.error("UnQcmEvalueComponent navigate to qcm form"))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-un-qcm-evalue"]],inputs:{qcm:"qcm"},decls:9,vars:2,consts:[[1,"card","ed-card","with-epingle"],[1,"card-header"],[1,"card-body"],["type","button","title","R\xe9pondre \xe0 ce questionnaire",1,"btn","btn-primary",3,"click"],["aria-hidden","true",1,"fa","fa-arrow-right"],["class","form-text",4,"ngIf"],[1,"form-text"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3"),e._uU(3),e.qZA()(),e.TgZ(4,"div",2)(5,"button",3),e.NdJ("click",function(){return n.openQCM()}),e._UZ(6,"i",4),e._uU(7," R\xe9pondre \xe0 ce questionnaire "),e.qZA(),e.YNc(8,oi,3,4,"p",5),e.qZA()()),2&t&&(e.xp6(3),e.Oqu(n.qcm.titre),e.xp6(5),e.Q6J("ngIf",n.qcm.debute))},dependencies:[m.O5,c.ifA],encapsulation:2,changeDetection:0}),o})();function si(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij("not\xe9s (",null==t.qcmsEvalues?null:t.qcmsEvalues.length,")")}}function ri(o,s){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"async"),e.qZA()),2&o){const t=e.oxw();let n;e.xp6(1),e.hij("(",null==(n=e.lcZ(2,1,t.qcms$))?null:n.length,")")}}function ci(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",12)(1,"button",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.doRefreshQCMS(!0))}),e._UZ(2,"i",14),e.qZA()()}}function ai(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"ed-qcms-globals-actions",16),e.NdJ("manageQuestionnaire",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onManageQCM())})("openBaseNationale",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onOpenBaseNationale())})("refreshQcms",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.doRefreshQCMS(i))}),e.qZA()()}}function li(o,s){1&o&&(e.TgZ(0,"div",17)(1,"h3"),e._uU(2,"Aucun questionnaire disponible actuellement !"),e.qZA()())}function ui(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",18)(1,"ed-qcms-etiquettes",19),e.NdJ("manageEtiquette",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.onManageEtiquette(i))})("toggleEtiquette",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.qcmUserStore.updateEtiquettes(i))})("allQ",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.qcmUserStore.updateEtiquettes(void 0))})("orphanEtiquette",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.qcmUserStore.updateEtiquettes([]))})("deleteEtiquette",function(i){e.CHM(t);const r=e.oxw();return e.KtG(r.onDeleteEtiquette(i))}),e.ALo(2,"async"),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("etiquettes",e.lcZ(2,1,t.etiquettes$))}}function di(o,s){if(1&o&&(e.TgZ(0,"h3"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(t.sousTitre)}}function mi(o,s){1&o&&(e.TgZ(0,"alert",20),e._uU(1,"Aucun questionnaire trouv\xe9"),e.qZA())}function pi(o,s){if(1&o&&e._UZ(0,"ed-un-qcm-evalue",23),2&o){const t=s.$implicit;e.MGl("id","qcm_evalue_",t.idAssociation,""),e.Q6J("qcm",t)}}function _i(o,s){if(1&o&&(e.TgZ(0,"div",21),e.YNc(1,pi,1,2,"ed-un-qcm-evalue",22),e.ALo(2,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.qcmsEvalues)("ngForTrackBy",e.lcZ(2,2,"idAssociation"))}}function gi(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"ed-un-qcm",25),e.NdJ("toggleQcmEtiquette",function(i){const a=e.CHM(t).$implicit,d=e.oxw(2);return e.KtG(d.onToggleQCMTag(i,a))})("associerQCM",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onAssocierQCM(r))})("cloneQCM",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onCloneQCM(r))})("manageQCM",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onManageQCM(r))})("openQCM",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onOpenQCM(r))})("removeQCM",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onRemoveQCM(r))})("shareQCM",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onShareQCM(r))})("unshareQCM",function(){const r=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.onUnshareQCM(r))})("refresh",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.doRefreshQCMS(!0))}),e.ALo(1,"async"),e.qZA()}if(2&o){const t=s.$implicit,n=e.oxw(2);e.MGl("id","qcm_",t.id,""),e.Q6J("qcm",t)("etiquettes",e.lcZ(1,3,n.etiquettes$))}}function hi(o,s){if(1&o&&(e.TgZ(0,"div",21),e.YNc(1,gi,2,5,"ed-un-qcm",24),e.ALo(2,"async"),e.ALo(3,"trackByProperty"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,2,t.qcms$))("ngForTrackBy",e.lcZ(3,4,"id"))}}const fi=function(o,s){return{"col-lg-9":o,"col-lg-6":s}};let qi=(()=>{class o extends((0,c.kCV)()){constructor(t,n,i,r,a,d,p,_,f,v,N,Qi){super(),this.activatedRoute=t,this.authStore=n,this.badgesStore=i,this.loaderService=r,this.modalService=a,this.qcmStore=d,this.qcmService=p,this.qcmUserStore=_,this.router=f,this.events=v,this.uiService=N,this.viewportScroller=Qi,this.sousTitre=""}get qUser(){return this.qcmUserStore.snapshot}ngOnInit(){this.doRefreshQCMS(!1),this.authStore.isProfesseur()&&(this.qcms$=(0,bt.T)(this.qcmUserStore.selectEtiquettes(),this.qcmUserStore.selectChoosenAnnee()).pipe((0,re.x)(),(0,Z.w)(t=>(this.sousTitre=Array.isArray(this.qcmUserStore.etiquettesSelected.value)?this.qcmUserStore.etiquettesSelected.value.length>0?"Les QCM correspondants":"Les QCM sans \xe9tiquette":"",this.qcmStore.selectQCMsFilterByEtiquette(this.qcmUserStore.etiquettesSelected.value,this.qUser.choosenAnnee))),c.z43),this.etiquettes$=(0,Qt.a)([this.qcmUserStore.selectChoosenAnnee(),this.qcmStore.select$()]).pipe((0,P.U)(([t,n])=>{const i=Object.getEntity(n,t);return Object.isExists(i)?i.etiquettes:[]}),c.z43)),this.events.select$("array:removeEntityById").pipe((0,B.R)(this.componentDestroyed$)).subscribe(t=>{t>0&&Array.isArray(this.qcmsEvalues)&&this.qcmsEvalues.edRemove(n=>t===n.idAssociation),Object.isExists(this.qcmsEvalues)?this.clearBadge(this.qcmsEvalues.length):this.clearBadge(0)})}ngAfterViewInit(){if(this.authStore.isProfesseur()){const t=this.activatedRoute.snapshot.fragment;t&&this.viewportScroller.scrollToAnchor(t)}}doRefreshQCMS(t=!0){const n=this.authStore.isFouE()?this.qcmService.getQCMSEleveEvalues(this.qUser.idUser).pipe((0,x.b)(i=>this.qcmsEvalues=i)):this.qcmService.getQCMs(this.qUser.choosenAnnee,t);this.loader=n.pipe((0,T.K)(i=>this.uiService.notifyErrorThenEmpty(i,!0,"Erreur","icon-ed_qcm"))).subscribe()}onManageQCM(t){this.modalService.show(Jt,{id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,class:"modal-lg",initialState:{qcm:Object.isExists(t)?new c.Gmi(t):c.Gmi.create(this.qUser.idUser),isDupliqAnneePrecedente:!this.authStore.isAnneeCourante(this.qcmUserStore.snapshot.choosenAnnee)}})}onOpenBaseNationale(){this.modalService.show(J,{id:this.modalService.getModalsCount()+1,class:"modal-lg"})}onToggleQCMTag(t,n){if(!this.authStore.isAnneeCourante(this.qcmUserStore.snapshot.choosenAnnee))return;let i;const r=n.etiquettes.indexOf(t),a=[...n.etiquettes];r>-1?(i=-1,a.splice(r,1)):(i=1,a.unshift(t)),this.loader=this.qcmService.updateEtiquettes(n.id,a,t,i,this.qUser.choosenAnnee).subscribe({next:d=>{this.uiService.notifyEvent(c.DOJ.genericSuccess,"Votre questionnaire a bien \xe9t\xe9 mis \xe0 jour.","QCM","icon-ed_qcm")},error:d=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la mise \xe0 jour de votre questionnaire.","Erreur","icon-ed_qcm")})}onAssocierQCM(t){const n=Object.getEntity(this.qcmStore.snapshot,this.qUser.choosenAnnee).qcms.edPluckFlatten("travauxafaire");this.modalService.show(fn,{id:this.modalService.getModalsCount()+1,initialState:{qcm:t,hidedTafs:n},providers:[{provide:h,useValue:this.qcmUserStore}]})}onCloneQCM(t){const n=new c.Gmi({...t,id:0,idAuteur:this.qUser.idUser,guid:"",evaluations:[],travauxafaire:[]});this.loader=this.qcmService.cloneQCM(t.id,n,this.qUser.choosenAnnee).subscribe({next:()=>{this.uiService.notifyEvent(c.DOJ.genericSuccess,"Le questionnaire a bien \xe9t\xe9 dupliqu\xe9. Vous pouvez maintenant le modifier.","QCM","icon-ed_qcm");const i=Object.getEntity(this.qcmStore.snapshot,this.authStore.currentUser.anneeScolaireCourante).qcms.find(r=>r.id===n.id);Object.isExists(i)&&this.onManageQCM(i)},error:i=>this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la duplication du questionnaire.","Erreur","icon-ed_qcm")})}onOpenQCM(t){this.router.navigate(["",{outlets:{auxiliaryModal:["repondre-au-qcm"]}}],{skipLocationChange:!0,queryParams:{idQCM:t.id,titre:t.titre,idAssociation:0,choosenAnnee:this.qUser.choosenAnnee}}).catch(()=>console.error("onOpenQCM navigate to qcm form"))}onRemoveQCM(t){const n={title:"Suppression du questionnaire",message:`\xcates-vous s\xfbr de vouloir supprimer <strong>d\xe9finitivement</strong> le questionnaire <strong>${t.titre}</strong> ?`,warningButton:"OK"},i={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:n};this.modalService.show(E.z,i),this.modalService.onHide.pipe((0,C.q)(1),(0,F.h)(r=>r===Q.G.validation),(0,Z.w)(r=>(this.loader=this.loaderService.show(this),this.qcmService.supprimerQCM(t.id,this.qUser.choosenAnnee))),(0,x.b)(r=>{this.uiService.notifyEvent(c.DOJ.genericSuccess,"Votre questionnaire a bien \xe9t\xe9 supprim\xe9.","QCM","icon-ed_qcm")}),(0,y.x)(()=>this.loaderService.hide(this)),(0,T.K)(r=>(this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la suppression du questionnaire.","Erreur","icon-ed_qcm"),U.E))).subscribe()}onShareQCM(t){this.modalService.show(Tn,{id:this.modalService.getModalsCount()+1,class:"modal-lg",initialState:{qcm:new c.Gmi(t)}})}onUnshareQCM(t){const n={title:"Suppression du questionnaire",message:`\xcates-vous s\xfbr de vouloir supprimer le questionnaire <strong>${t.titre}</strong> de la base inter-\xe9tablissements ?`,warningButton:"OK"},i={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:n};this.modalService.show(E.z,i),this.modalService.onHide.pipe((0,C.q)(1),(0,F.h)(r=>r===Q.G.validation),(0,Z.w)(r=>(this.loader=this.loaderService.show(this),this.qcmService.unshareQCM(t,this.qUser.choosenAnnee))),(0,x.b)(r=>{this.uiService.notifyEvent(c.DOJ.genericSuccess,"Votre questionnaire a bien \xe9t\xe9 supprim\xe9 de la base inter-\xe9tablissements.","QCM","icon-ed_qcm")}),(0,y.x)(()=>this.loaderService.hide(this)),(0,T.K)(r=>(this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la suppression du questionnaire.","Erreur","icon-ed_qcm"),U.E))).subscribe()}onManageEtiquette(t){const n=Object.isExists(t)?new c.rLV(t):new c.rLV({id:0,libelle:"",badge:0,idAuteur:this.qUser.idUser});this.modalService.show(ce.I,{id:this.modalService.getModalsCount()+1,initialState:{title:n.id>0?"Modifier l'\xe9tiquette":"Nouvelle \xe9tiquette",initialValue:n.libelle}}),this.modalService.onHide.pipe((0,C.q)(1),(0,Z.w)(i=>{const r=ce.I.afterClosed(i);if(this.loader=this.loaderService.show(this),r&&r.error)this.uiService.notifyEvent(c.DOJ.genericError,r.error);else if(r&&r.reason===Q.G.validation)return n.libelle=r.saisie,this.qcmService.manageTag(n);return U.E}),(0,y.x)(()=>this.loaderService.hide(this)),(0,T.K)(i=>(this.uiService.notifyEvent(c.DOJ.genericError,i.message,"Erreur","icon-ed_qcm"),U.E))).subscribe()}onDeleteEtiquette(t){const n={title:"Suppression de l'\xe9tiquette",message:`\xcates-vous s\xfbr de vouloir supprimer <strong>d\xe9finitivement</strong> cette \xe9tiquette <strong>${t.libelle}</strong> (les questionnaires associ\xe9s ne seront pas supprim\xe9s) ?`,warningButton:"OK"},i={id:this.modalService.getModalsCount()+1,keyboard:!1,ignoreBackdropClick:!0,initialState:n};this.modalService.show(E.z,i),this.modalService.onHide.pipe((0,C.q)(1),(0,F.h)(r=>r===Q.G.validation),(0,Z.w)(r=>(this.loader=this.loaderService.show(this),this.qcmService.supprimerTag(t))),(0,x.b)(r=>{this.qcmUserStore.deleteEtiquette(t.id),this.uiService.notifyEvent(c.DOJ.genericSuccess,"Votre libell\xe9 a bien \xe9t\xe9 supprim\xe9.","QCM","icon-ed_qcm")}),(0,y.x)(()=>this.loaderService.hide(this)),(0,T.K)(r=>(this.uiService.notifyEvent(c.DOJ.genericError,"Une erreur s'est produite lors de la suppression du libell\xe9.","Erreur","icon-ed_qcm"),U.E))).subscribe()}clearBadge(t){if(this.authStore.isFouE()){const n=this.badgesStore.cloneDeep();let i="E";this.authStore.isFamille()&&(i="FE"),Object.isExists(t)&&n.getBadgeFromModule(c.qzA.QCM,this.qUser.idUser,c.o2q[i])>0&&(n.updateBadgeForModule(t,c.qzA.QCM,this.qUser.idUser,c.o2q[i]),this.badgesStore.store=n,this.badgesStore.setStorage(n).catch(r=>console.error("QcmsComponent.clearBadge badgesStore.setStorage : ",r)))}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(M.gz),e.Y36(c.CnD),e.Y36(c.et7),e.Y36(R.S),e.Y36(g.tT),e.Y36(c.W$X),e.Y36(c.Jqz),e.Y36(h),e.Y36(M.F0),e.Y36(c.eq2),e.Y36(c.VLf),e.Y36(m.EM))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ed-qcms"]],features:[e.qOj],decls:18,vars:17,consts:[[1,"ed-container","page-qcms","double-padding"],[1,"entete-page"],[4,"ngIf"],["class","btn-group btn-refresh",4,"ngIf"],["class","globals-actions",4,"ngIf"],["class","jumbotron container-bg double-padding",4,"ngIf"],[1,"row",3,"ngBusy"],["class","col-lg-3","role","menu",4,"ngIf"],["role","main",3,"ngClass"],["type","info","class","with-margin-bottom",4,"ngIf"],[1,"row"],["class","col-lg-12",4,"ngIf"],[1,"btn-group","btn-refresh"],["title","Rafra\xeechir la liste des questionnaires \xe9valu\xe9s","type","button",1,"btn","btn-sm","btn-secondary","float-end",3,"click"],["aria-hidden","true",1,"fa","fa-refresh"],[1,"globals-actions"],[3,"manageQuestionnaire","openBaseNationale","refreshQcms"],[1,"jumbotron","container-bg","double-padding"],["role","menu",1,"col-lg-3"],[3,"etiquettes","manageEtiquette","toggleEtiquette","allQ","orphanEtiquette","deleteEtiquette"],["type","info",1,"with-margin-bottom"],[1,"col-lg-12"],["class","un-qcm-evalue",3,"id","qcm",4,"ngFor","ngForOf","ngForTrackBy"],[1,"un-qcm-evalue",3,"id","qcm"],["class","un-qcm",3,"id","qcm","etiquettes","toggleQcmEtiquette","associerQCM","cloneQCM","manageQCM","openQCM","removeQCM","shareQCM","unshareQCM","refresh",4,"ngFor","ngForOf","ngForTrackBy"],[1,"un-qcm",3,"id","qcm","etiquettes","toggleQcmEtiquette","associerQCM","cloneQCM","manageQCM","openQCM","removeQCM","shareQCM","unshareQCM","refresh"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"header",1)(2,"h2"),e._uU(3," Mes QCM "),e.YNc(4,si,2,1,"span",2),e.YNc(5,ri,3,3,"span",2),e.qZA(),e.YNc(6,ci,3,0,"div",3),e.YNc(7,ai,2,0,"div",4),e.qZA(),e.YNc(8,li,3,0,"div",5),e.TgZ(9,"div",6),e.YNc(10,ui,3,3,"div",7),e.TgZ(11,"div",8),e.YNc(12,di,2,1,"h3",2),e.YNc(13,mi,2,0,"alert",9),e.ALo(14,"async"),e.TgZ(15,"div",10),e.YNc(16,_i,3,4,"div",11),e.YNc(17,hi,4,6,"div",11),e.qZA()()()()),2&t){let i;e.xp6(4),e.Q6J("ngIf",n.authStore.isFouE()),e.xp6(1),e.Q6J("ngIf",n.authStore.isProfesseur()),e.xp6(1),e.Q6J("ngIf",n.authStore.isFouE()),e.xp6(1),e.Q6J("ngIf",n.authStore.isProfesseur()),e.xp6(1),e.Q6J("ngIf",n.authStore.isFouE()&&0===(null==n.qcmsEvalues?null:n.qcmsEvalues.length)),e.xp6(1),e.Q6J("ngBusy",n.loader),e.xp6(1),e.Q6J("ngIf",n.authStore.isProfesseur()),e.xp6(1),e.Q6J("ngClass",e.WLB(14,fi,n.authStore.isProfesseur(),n.authStore.isFouE())),e.xp6(1),e.Q6J("ngIf",n.sousTitre),e.xp6(1),e.Q6J("ngIf",n.authStore.isProfesseur()&&!((null==(i=e.lcZ(14,12,n.qcms$))?null:i.length)>0)),e.xp6(3),e.Q6J("ngIf",n.authStore.isFouE()),e.xp6(1),e.Q6J("ngIf",n.authStore.isProfesseur())}},dependencies:[m.mk,m.sg,m.O5,A.wx,b.DC,Sn,Fn,ni,ii,m.Ov,q.$],styles:['@charset "UTF-8";.page-qcms .ed-card hr{margin-left:-20px;margin-right:-20px}.page-qcms .ed-card .list-group{display:flex;flex-wrap:wrap;margin-bottom:0}.page-qcms .alert-info{margin-top:25px}.qcm-img-container img{max-width:100%}.page-qcms .entete-page{align-items:center}.page-qcms .btn-refresh{margin-top:10px;margin-left:10px}.page-qcms .globals-actions{flex:1;padding:0 0 0 40px}.page-qcms .globals-actions .btn{padding:8px 15px}.page-qcms .btn-warning:not(.btn-link):not(.btn-flat){background-color:#f0ad4e}.page-qcms .qcm-actions .btn,.page-qcms .qcms-etiquette .btn{background-color:transparent}.page-qcms .qcm-actions .etiquette-actif{background-color:#366cf31a}.page-qcms .qcm-actions .etiquette-actif i.fa-square-o:before{content:"\\f046"}.page-qcms .qcms-etiquette{margin-top:25px}.page-qcms .qcms-etiquette .list-group-item{cursor:pointer}.page-qcms .qcms-etiquettes>.row+.row{margin-top:10px}.page-qcms .qcms-etiquettes .row{margin-top:25px}.page-qcms .qcms-etiquette .list-group .list-group-item .libelle-etiquette,.page-qcms .qcms-etiquette .list-group .list-group-item .btn-action-etiquette .edit-etiquette{padding-right:5px!important}.page-qcms .qcms-etiquette .list-group .list-group-item span.badge{float:none;cursor:default}.page-qcms .qcms-etiquette .list-group .list-group-item.etiquette-actif .btn-action-etiquette i{color:#fff}.page-qcms .qcms-etiquette .list-group .list-group-item.etiquette-actif .btn-action-etiquette .btn-danger-color i{color:#ffadad}.qcm-association-inactif .qcm-programmation,.qcm-association-inactif h4{color:var(--light-primary-color)}.qcm-association-actif .qcm-programmation,.qcm-association-actif h4{color:var(--secondary-color)}.page-qcms .un-qcm .qcm-programmation button{background-color:transparent}.page-qcms .un-qcm .btn-sm{margin:0;padding:5px 10px}.page-qcms .un-qcm .list-group-item{border:none}.page-qcms .un-qcm .qcm-association-inactif .list-group-item-text,.page-qcms .un-qcm .qcm-association-actif .list-group-item-text{margin-bottom:10px}.page-qcms .un-qcm .etiquettes{padding:6px 0;display:inline-table}.page-qcms .un-qcm .etiquettes .etiquette{color:#737373;cursor:pointer;margin:0 10px 0 0;display:block;float:left}.page-qcms .un-qcm .etiquettes .etiquette:hover>span{text-decoration:underline}.page-qcms .un-qcm .etiquettes .etiquette:hover>i{color:var(--secondary-color)}.page-qcms .un-qcm .etiquettes .etiquette:hover>i.fa-tag:before{content:"\\f00d"}\n'],encapsulation:2}),o})(),V=(()=>{class o{constructor(t,n){this.authStore=t,this.qcmUserStore=n}resolve(t,n){return this.authStore.isProfesseur()?this.qcmUserStore.updateStore(this.authStore.currentUser.codeOgec,this.authStore.currentUser.typeCompte,this.authStore.currentUser.id,this.authStore.currentUser.anneeScolaireCourante):this.qcmUserStore.updateStore(this.authStore.currentUser.codeOgec,t.paramMap.get("typeUser"),+t.paramMap.get("idUser"),this.authStore.currentUser.anneeScolaireCourante),!0}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(c.CnD),e.LFG(h))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac}),o})();const Ci=[{path:"",component:qi,resolve:{ready:V}},{path:":idQCM",redirectTo:":idQCM/questions",pathMatch:"full"},{path:":idQCM/questions",canActivate:[me.a],data:{guardTypes:[c.dcH.ENSEIGNANT]},component:vt,resolve:{ready:V}}];let vi=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[V],imports:[M.Bz.forChild(Ci),M.Bz]}),o})(),bi=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[h],imports:[ue.m,vi,de.b]}),o})()}}]);